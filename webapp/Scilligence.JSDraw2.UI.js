//////////////////////////////////////////////////////////////////////////////////
//
// Scilligence JSDraw.UI
// Copyright Scilligence Corporation, 2022
// Version 7.1.0.41573
// http://www.scilligence.com/
//
//////////////////////////////////////////////////////////////////////////////////

function getIEVersion(){return window.navigator.appName!="Microsoft Internet Explorer"&&window.navigator.appName.indexOf("MSAppHost")<0&&!(window.navigator.appVersion.indexOf("Trident")>0&&document.documentMode>=11)?!1:document.documentMode==null?document.compatMode=="CSS1Compat"?7:6:document.documentMode}function getAndroidVersion(){var n=window.navigator.userAgent,t=n.indexOf("Android");return t<0?!1:(n=n.substr(t+8),t=n.indexOf(";"),n=n.substr(0,t),t=n.indexOf("."),t>0&&(n=n.substr(0,t)),isNaN(n)?!0:parseFloat(n))}function getiOSVersion(){var n=window.navigator.userAgent,t=n.indexOf("iPad");return(t<0&&(t=n.indexOf("iPhone")),t<0)?!1:(t=n.indexOf("OS",t+4),t<0)?!0:(n=n.substr(t+3),t=n.indexOf("_"),n=n.substr(0,t),t=n.indexOf("."),t>0&&(n=n.substr(0,t)),isNaN(n)?!0:parseInt(n))}scilligence={_base:function(){}};oln=scilligence;scil=scilligence;JSDraw2={version:"7.1.0.41573",kFileVersion:"6.3",speedup:{fontsize:2,gap:0,disableundo:!1,minbondlength:1},defaultoptions:{},config:{},password:{encrypt:!0}};JSDrawServices={};scilligence.JSDraw2=JSDraw2;scilligence.JSDraw3=JSDraw3=JSDraw2;scilligence.overwrite=scilligence.apply=function(n,t,i){var u=!0,r;if(i!=null&&(i===!0||i===!1?u=i:typeof i=="object"&&scilligence.apply(n,i)),n&&t&&typeof t=="object")for(r in t)(u||n[r]==null)&&(n[r]=t[r]);return n};DEBUG={enable:!1,clear:function(){DEBUG.enable&&(document.getElementById("DEBUG").value="")},print:function(n){if(DEBUG.enable){var t=document.getElementById("DEBUG");t.value+=n+"\n"}}};scilligence.apply(scilligence,{extend:function(){var t=function(n){for(var t in n)this[t]=n[t]},n=Object.prototype.constructor;return function(i,r,u){var o,f,e;return typeof r=="object"&&(u=r,r=i,i=u.constructor!=n?u.constructor:function(){r.apply(this,arguments)}),o=function(){},f=r.prototype,o.prototype=f,e=i.prototype=new o,e.constructor=i,i.superclass=f,f.constructor==n&&(f.constructor=r),i.override=function(n){scilligence.override(i,n)},e.superclass=e.supr=function(){return f},e.override=t,scilligence.override(i,u),i.extend=function(n){return scilligence.extend(i,n)},i}}(),override:function(n,t){if(t){var i=n.prototype;scilligence.apply(i,t);document.all!=null&&t.hasOwnProperty("toString")&&(i.toString=t.toString)}},clone:function(n){if(n==null)return null;if(n.length!=null)return n.concat([]);var t={};return scil.apply(t,n),t},cloneArray:function(n){var i,t,r;if(n==null)return null;if(n.length!=null){for(i=[],t=0;t<n.length;++t)i[t]=typeof n[t]=="object"?scil.clone(n[t]):n[t];return i}return r={},scil.apply(r,n),r},byId:function(n){return document.getElementById(n)},style:function(n,t){scil.apply(n.style,t)},attr:function(n,t,i){var r,u;if(typeof t=="string"){if(typeof i=="undefined")return n.getAttribute(t);i==null?n.removeAttribute(t):n.setAttribute(t,i)}else for(r in t)u=t[r],u==null?n.removeAttribute(r):n.setAttribute(r,u)},connect:function(n,t,i){if(n!=null&&t!=null&&t!=""&&i!=null)if(n.addEventListener!=null)n.addEventListener(t.substr(2),function(t){i(t,n)});else if(n.attachEvent!=null)n.attachEvent(t,function(t){i(t,n)});else throw"addEventListener is not supported";},create:function(n,t,i,r,u,f){return scil.Utils.createElement(n,t,i,r,u,f)},icon:function(n,t,i,r,u){return scil.Utils.icon(n,t,i,r,u)}});scil.callbacks={};scil.connect(window,"onload",function(){scil.__windowloaded=!0});scilligence.ready=scilligence.onload=function(n){scil.__windowloaded?n():scil.connect(window,"onload",n)};var __ieversion=getIEVersion(),__ieAppVersion=__ieversion?window.postMessage?window.performance?9:8:7:null;scilligence.Utils={__xcode:10,isIE:__ieversion,isIE8Lower:__ieversion&&__ieversion<9,nativemode:window.navigator.appName.indexOf("MSAppHost")>=0,isHtml5:!0,isFirefox:navigator.userAgent.indexOf("Firefox")>=0,isOpera:navigator.userAgent.indexOf("Opera")>=0,isChrome:navigator.userAgent.indexOf("Chrome")>=0,isEdge:navigator.userAgent.indexOf("Edge/")>=0,isLinux:navigator.userAgent.indexOf("Linux")>=0,isUbuntu:navigator.userAgent.indexOf("Ubuntu")>=0,isIpad:getiOSVersion(),isAndroid:getAndroidVersion(),isTouch:navigator.userAgent.indexOf("iPad")>=0||navigator.userAgent.indexOf("iPhone")>=0||navigator.userAgent.indexOf("Android")>=0,lastTouchTm:0,buttonWidth:160,getTopWindow:function(){for(var n=window;n.parent!=null&&n.parent!=n;)n=n.parent;return n},isRightButton:function(n){if(n!=null)return n.which?n.which==3:"button"in n?n.button==2:!1},isTouchDblClick:function(n){var t=(new Date).getTime(),i=t-scil.Utils.lastTouchTm;return scil.Utils.lastTouchTm=t,n.touches.length==1&&i<=500},hasAnsestor:function(n,t){if(t==null||n==null)return!1;while(n!=null){if(n.parentNode==t)return!0;n=n.parentNode}return!1},round:function(n,t){return scil.Math.round(n,t)},roundToSignificantDigits:function(n,t){return scil.Math.roundToSignificantDigits(n,t)},log10:function(n){return scil.Math.log10(n)},roundStr:function(n,t,i,r){return scil.Math.roundStr(n,t,i,r)},num2str:function(n,t,i,r,u,f){if(n==null||!isFinite(n)||isNaN(n))return"";if(typeof u=="string"){var e=JSDraw2.Table.parseValue("1"+u);e>0?(n/=e,i=u,u=!0):u=null}return i==null?this.roundStr(n,t,r,f):i=="%"?this.roundStr(n*100,t,r,f)+i:u?this.roundStr(n,t,r,f)+i:((i=="L"||i=="l")&&(i=i.toUpperCase()),Math.abs(n)>=1e3)?this.roundStr(n/1e3,t,r,f)+" "+this._convertUnit(i,1e3):Math.abs(n)>=1?this.roundStr(n,t,r,f)+" "+this._convertUnit(i,1):(n*=1e3,Math.abs(n)>=1)?this.roundStr(n,t,r,f)+" "+this._convertUnit(i,.001):(n*=1e3,this.roundStr(n,t,r,f)+" "+this._convertUnit(i,1e-6))},_convertUnit:function(n,t){switch(t){case 1:return n=="g/L"?"mg/mL":n=="U/L"?"mU/mL":n;case 1e3:return n=="g/L"?"g/mL":n=="U/L"?"U/mL":"k"+n;case.001:return n=="g/L"||n=="mg/mL"?"mg/L":n=="U/L"||n=="mU/mL"?"mU/L":"m"+n;case 1e-6:return n=="g/L"||n=="mg/mL"?"μg/L":n=="U/L"||n=="mU/mL"?"μU/L":"μ"+n}},disabledcontextmenus:[],disableContextMenu:function(n,t){(n!=null&&scil.Utils.indexOf(this.disabledcontextmenus,n)<0&&this.disabledcontextmenus.push(n),t==null&&(t=document),t.body.__contextmenudisabled)||(t.body.__contextmenudisabled=!0,t.body.oncontextmenu=function(n){var t,r,i,u;for(n==null&&(n=event),t=n.target||n.srcElement,r=scil.Utils.disabledcontextmenus,i=0;i<r.length;++i)if(t==r[i]||scil.Utils.isChildOf(t,r[i]))return!1;return t.parentNode!=null&&JSDraw2.Editor.get(t.parentNode.id)!=null||t.firstChild!=null&&t.firstChild.getAttribute!=null&&t.firstChild.getAttribute("jspopupmenu")=="1"?(n.preventDefault!=null&&n.preventDefault(),!1):scil.ContextMenu.isFromContextMenu(t)?(n.preventDefault!=null&&n.preventDefault(),!1):(u=scil.Utils.getParent(t,"div"),u!=null&&JSDraw2.Editor.get(u.id)!=null?(n.preventDefault!=null&&n.preventDefault(),!1):void 0)})},serviceAvailable:function(){return typeof JSDrawServices!="undefined"&&typeof JSDrawServices.url!="undefined"&&JSDrawServices.url!=null},eval:function(n){if(n==null||n==""||typeof n!="string")return null;try{return eval("var ___s="+n),___s}catch(t){}return null},isTrue:function(n){return n=(n+"").toLowerCase(),n=="1"||n=="true"||n=="yes"||n=="on"},isFalse:function(n){return n=(n+"").toLowerCase(),n=="0"||n=="false"||n=="no"||n=="off"},isAttTrue:function(n,t){var i=n.getAttribute(t)+"";return i==""||this.isTrue(i)},isAttFalse:function(n,t){var i=n.getAttribute(t)+"";return i=="0"||i.toLowerCase()=="false"},formatStr:function(n,t,i){var r=n==null?"":n.toFixed(i)+"";return scil.Utils.padLeft(r,t," ")},uuid:function(){var r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[],t,u=r.length,i;for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4",t=0;t<36;t++)n[t]||(i=0|Math.random()*16,n[t]=r[t==19?i&3|8:i]);return n.join("").toLowerCase()},padLeft:function(n,t,i){for(var r="",u=(n+"").length;u<t;++u)r+=i==null?" ":i;return r+n},padRight:function(n,t,i){for(var r="",u=n.length;u<t;++u)r+=i==null?" ":i;return n+r},endswith:function(n,t,i){if(n==null||t==null||n.length<t.length)return!1;var r=n.substr(n.length-t.length,t.length);return i?r==t:r.toLowerCase()==t.toLowerCase()},startswith:function(n,t,i){if(n==null||t==null||n.length<t.length)return!1;var r=n.substr(0,t.length);return i?r==t:r.toLowerCase()==t.toLowerCase()},trim:function(n){return n==null?null:n.replace(/^[\s|\t\r\n]+|[\s|\t\r\n]+$/g,"")},ltrim:function(n){return n==null?null:n.replace(/^[\s|\t\r\n]+/,"")},rtrim:function(n){return n==null?null:n.replace(/[\s|\t\r\n]+$/,"")},isFixedPosition:function(n){while(n!=null){if(n.style!=null&&n.style.position=="fixed")return!0;n=n.parentNode}return!1},getOffset:function(n,t,i){for(var s=scil.Utils.getScrollOffset(n.parentNode),r=new JSDraw2.Point(0,0),u=n,f,e,o;n!=null;)(n.offsetLeft>0||n.offsetTop>0)&&r.offset(n.offsetLeft,n.offsetTop),this.isIE&&(n.scrollLeft>0||n.scrollTop>0)&&r.offset(n.scrollLeft,n.scrollTop),scil.Utils.isIE&&(n.scrollTop>0||n.scrollLeft>0)&&r.offset(-n.scrollLeft,-n.scrollTop),r.absolute==null&&n.style.position=="absolute"&&(r.absolute={x:n.offsetLeft,y:n.offsetTop}),n=n.offsetParent;for(f=!1;u!=null;){if(u.style!=null&&u.style.position=="fixed"){f=!0;break}u=u.parentNode}return t==!1||f||r.offset(-s.x,-s.y),f?r.fixedposition=!0:(e=window.scrollX||window.pageXOffset,o=window.scrollY||window.pageYOffset,i&&(e>0||o>0)&&(r.x+=e,r.y+=o)),r},getScrollOffset:function(n){for(var t=new JSDraw2.Point(0,0);n!=null;)(n.scrollLeft>0||n.scrollTop>0)&&t.offset(n.scrollLeft,n.scrollTop),n=n.parentNode;return t},scrollOffset:function(){var n=document.compatMode&&document.compatMode!="BackCompat"?document.documentElement:document.body,t=scil.Utils.isIE?n.scrollLeft:pageXOffset,i=scil.Utils.isIE?n.scrollTop:pageYOffset;return new JSDraw2.Point(t,i)},scriptUrl:function(){var e,f,o,i,u;if(this._scripturl!=null||(JSDraw2.defaultoptions.imagebase!=null&&(this._scripturl=JSDraw2.defaultoptions.imagebase),this._scripturl!=null))return this._scripturl;for(e=document.getElementsByTagName("script"),f=0;f<e.length;f++)if(o=e[f],o.tagName=="SCRIPT"){if(i=o.getAttribute("src"),i==null||i.length==0)continue;var n=i.lastIndexOf("/"),t=n<0?"":scil.Utils.trim(i.substr(0,n+1)),r=scil.Utils.trim(n<0?i:i.substr(n+1)).toLowerCase();if(n=r.indexOf("?"),n>0&&(r=r.substr(0,n)),this.startswith(r,"scilligence.jsdraw2.")&&this.endswith(r,".js"))return scil.Utils.startswith(t,"http://")||scil.Utils.startswith(t,"https://")||scil.Utils.startswith(t,"//")?this._scripturl=t:scil.Utils.startswith(t,"/")?this._scripturl=document.location.protocol+"//"+document.location.host+t:(u=document.location+"",n=u.indexOf("?"),n>0&&(u=u.substr(0,n)),n=u.lastIndexOf("/"),this._scripturl=u.substr(0,n+1)+t);if(r=="jsdraw.core.js")return this._scripturl=t+"../"}return null},_imgBase:function(){return scil.Utils.scriptUrl()},imgSrc:function(n,t){var i=scil.Utils._imgBase()+n;return t&&(i="url("+i+")"),i},imgTag:function(n,t,i){return"<img"+(i==null?"":" "+i)+" src='"+this.imgSrc("img/"+n)+"'>"+(t==null?"":t)},styleRect:function(n){return new JSDraw2.Rect(scil.Utils.parsePixel(n.style.left),scil.Utils.parsePixel(n.style.top),scil.Utils.parsePixel(n.style.width),scil.Utils.parsePixel(n.style.height))},parsePixel:function(n,t){return n==null?null:scil.Utils.endswith(n,"px")?(n=n.substr(0,n.length-2),isNaN(n)?t:parseInt(n)):t},cloneArray:function(n){var t=[];return this.mergeArray(t,n),t},mergeArray:function(n,t){for(var i=0;i<t.length;++i)n.push(t[i])},fingArrayIndex:function(n,t){for(var i=0;i<n.length;++i)if(n[i]==t)return i;return-1},getFunctionName:function(n){if(typeof n=="function"){var t=(n+"").match(/function\s*([\w\$]*)\s*\(/);if(t!==null)return t[1]}return null},splitCsvRow:function(n){var i,r,e;if(n!=null&&n!="\r"&&n!=""){n.substr(n.length-1)=="\r"&&(n=n.substr(0,n.length-1));var f=[],u=!1,t="";for(i=0;i<n.length;++i)r=n.substr(i,1),r=='"'?u?i<n.length-1?(e=n.substr(i+1,1),e=='"'?(t+=r,++i):e==","?(f.push(t),t="",u=!1,++i):t+=r):u=!1:t==""?u=!0:t+=r:r==","&&(u?t+=r:(f.push(t),t=""));return f.push(t),f}},escCsvValue:function(n){return n==null?"":(typeof n!="string"&&(n=n+""),(n.indexOf(",")>=0||n.indexOf('"')>=0||n.indexOf("\r")>=0||n.indexOf("\n")>=0)&&(n='"'+scil.Utils.trim(n).replace(/[\"]/g,'""')+'"'),n)},unescXmlValue:function(n){return n==null?"":n.replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&#xA;/gi,"\n").replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&amp;/gi,"&")},escXmlValue:function(n,t){return n==null?"":(typeof n!="string"&&(n=n+""),t&&(n=scil.Utils.trim(n)),n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;").replace(/\n/g,"&#xA;").replace(/'/g,"&apos;").replace(/"/g,"&quot;"))},escUrlData:function(n){var r,t,u,i;if(n==null)return n;for(r="",t=0;t<n.length;++t)u=n.charCodeAt(t),i=n.substr(t,1),r+=u>255?i:i=="+"?"%2b":escape(i);return r},escFileName:function(n){var i,t,r,u;if(n==null)return n;for(i="",t=0;t<n.length;++t)r=n.substr(t,1),u=n.charCodeAt(t),i+=u>255||/[a-z|0-9|_| |\-|\(|\)|\{|\}|\[|\]|\.]/ig.test(r)?r:"_";return i},getFirstChild:function(n,t){if(n==null)return null;for(var i=0;i<n.childNodes.length;++i)if(n.childNodes[i].tagName==t)return n.childNodes[i];return null},parseXml:function(n){var t=this.parseXml2(n);return t!=null&&t.succeeded?t.doc:null},parseXml2:function(n){if(n==null||(n=this.trim(n),n.length<10||n.substr(0,1)!="<"||n.substr(n.length-1,1)!=">"))return null;var i=!1,r=null,t=null;try{n=n.replace(/&nbsp;/g," ");window.DOMParser?t=(new DOMParser).parseFromString(n,"text/xml"):(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(n));i=!0}catch(u){r=u.message}return{succeeded:i,error:r,doc:t}},xquery:function(n,t,i){var f,h,e,r,c,u,l,s;if(n==null||t==null||t=="")return null;for(f=null,h=t.split("/"),e=0;e<h.length;++e)if(r=h[e],r!=""){c=r.replace(/[\[]@[a-z]+[0-9|a-z]{0,9}='[^\']+'[\]]$/,"");r=r.substr(c.length+2,r.length-(c.length+3));var a=null,v=null,o=r.indexOf("=");for(o>0&&(a=r.substr(0,o),o+=2,v=r.substr(o,r.length-o-1)),u=null,l=0;l<n.childNodes.length;++l)if(s=n.childNodes[l],s.tagName==c&&(a==null||s.getAttribute(a)==v)&&(u=s),u!=null)if(e==h.length-1){if(i)return u;f==null?f=[u]:f.push(u)}else{u=s;break}if(f!=null)return f;if(u==null)return null;n=u}return null},parseJson:function(n){return this.eval(n)},containsWord:function(n,t,i){var u,r;if(n==null||t==null||n==""||t=="")return!1;for(i&&(t=t.toLowerCase()),u=n.toLowerCase().split(/\W+/),r=0;r<u.length;++r)if(u[r]==t)return!0;return!1},alert2:function(n,t,i,r){if(scil.Utils.alertdlg==null){var u=scil.Utils.createTable(),f=scil.Utils.createElement(u,"tr"),o=scil.Utils.createElement(f,"td",null,{verticalAlign:"top"}),e=scil.Utils.createElement(f,"td",null,{textAlign:"center"}),s=scil.Utils.createElement(e,"div",null,{padding:"10px",textAlign:"left",maxWidth:"800px",maxHeight:"400px",overflow:"auto",color:"#000"}),h=scil.Utils.createButton(e,{svg:"done",imgheight:16,label:"OK",onclick:function(n){var t=scil.Utils.alertdlg;t.callback!=null&&t.callback();t.hide();n.preventDefault()}});scil.Utils.alertdlg=new JSDraw2.Dialog("Attention",u.parentNode);scil.Utils.alertdlg.msg=s;scil.Utils.alertdlg.img=o}scil.Utils.alertdlg.show(t);scil.Utils.alertdlg.callback=i;scil.Utils.alertdlg.msg.innerHTML=n==null?"":"<div style='margin:0;max-width:800px;min-width:400px'>"+n+"<\/div>";scil.Utils.removeAll(scil.Utils.alertdlg.img);scil.icon(scil.Utils.alertdlg.img,scil.Icons[r]==null?"info":r,{width:50,height:50});scil.Utils.alertdlg.moveCenter()},confirm:function(n,t,i,r,u){var f,e;if(scil.Utils.confirmdlg==null){f=scil.Utils.createTable();e=scil.Utils.createElement(f,"tr");scil.icon(scil.create(e,"td"),"warning",{width:48,fill:"orange"});var s=scil.Utils.createElement(e,"td",null,{textAlign:"center"}),c=scil.Utils.createElement(s,"div",null,{padding:"10px",textAlign:"left",maxHeight:"360px",color:"black"}),o=scil.Utils.createElement(s,"div",null,{whiteSpace:"nowrap"}),l=scil.Utils.createElement(o,"button",this.res("Yes"),{width:"80px"}),a=scil.Utils.createElement(o,"button",this.res("No"),{width:"80px"}),h=scil.Utils.createElement(o,"button",this.res("Cancel"),{width:"80px"});scil.Utils.confirmdlg=new JSDraw2.Dialog(this.res("Attention"),f.parentNode);scil.Utils.confirmdlg.msg=c;scil.Utils.confirmdlg.cancel=h;scil.connect(l,"onclick",function(n){var t=scil.Utils.confirmdlg;t.hide();n.preventDefault();t.callback!=null&&t.callback(!0)});scil.connect(a,"onclick",function(n){var t=scil.Utils.confirmdlg;t.hide();n.preventDefault();t.callback!=null&&t.callback(!1)});scil.connect(h,"onclick",function(n){var t=scil.Utils.confirmdlg;t.hide();n.preventDefault();t.callback!=null&&t.callback("cancel")})}scil.Utils.confirmdlg.show();scil.Utils.confirmdlg.callback=t;scil.Utils.confirmdlg.cancel.style.display=i?"":"none";scil.Utils.confirmdlg.msg.innerHTML=n==null?"":"<pre style='margin:0'>"+n+"<\/pre>";scil.Utils.confirmdlg.hide(!0);scil.Utils.confirmdlg.show(r,null,null,null,u)},confirmYes:function(n,t,i){scil.Utils.confirm(n,function(n){n&&t()},null,null,i)},prompt2:function(n){return this.prompt(n.caption,n.message,n.defaultvalue,n.button,n.callback,n.svg||n.iconurl,n.zindex,n.multiline,n.autosuggesturl,n.owner,n.maxlength,n.height,n.plaintext)},prompt:function(n,t,i,r,u,f,e,o,s,h,c,l,a){var b,v;if(scil.Utils.promptdlg==null){var k=scil.Utils.createTable(),d=scil.Utils.createElement(k,"tr"),nt=scil.Utils.createElement(scil.Utils.createElement(d,"td"),"div",null,{width:"50px"}),y=scil.Utils.createElement(d,"td"),tt=scil.Utils.createElement(y,"div",null,{color:"black"}),p=scil.Utils.createElement(y,"div"),w=scil.Utils.createElement(p,"input",null,{width:"700px",display:"none"});w.setAttribute("x-webkit-speech","on");var it=scil.Utils.createElement(p,"textarea",null,{width:"700px",display:"none"}),p=scil.Utils.createElement(y,"div",null,{textAlign:"center",paddingTop:"5px"}),g=scil.Utils.createElement(p,"button",r,{width:scil.Utils.buttonWidth+"px"}),v=scil.Utils.promptdlg=new JSDraw2.Dialog(this.res("Message"),k.parentNode);v.icon=nt;v.msg=tt;v.input=w;v.textarea=it;v.button=g;b=function(n){var t=v,r=!0,i;t.callback!=null&&(i=t.input.style.display=="none"?t.textarea.value:t.input.value,a||(i=scil.Utils.makeSafeHtml(i)),r=t.callback(i,t.input.style.display=="none"?t.textarea:t.input)!="again");r&&t.hide();n.preventDefault!=null&&n.preventDefault()};scil.connect(v.input,"onkeydown",function(n){n.keyCode==13&&b(n)});scil.connect(g,"onclick",b);v.auto=new scil.AutoComplete(w,null)}v=scil.Utils.promptdlg;v.input.style.display=o?"none":"";v.textarea.style.display=o?"":"none";v.input.setAttribute("maxlength",c>0?c:"");l>0?(v.input.style.height=l+"px",v.textarea.style.height=l+"px"):(v.input.style.height="",v.textarea.style.height="");v.auto.url=s;v.auto.disabled=s==null||s=="";v.show(n,e);v.icon.innerHTML="";f!=null&&(f.indexOf(".")<0?scil.icon(v.icon,f,{width:36}):v.icon.innerHTML="<img style='width:50px;height:50px;' src='"+f+"'>",v.icon.style.display="");v.msg.innerHTML=t==null?"":t;v.button.innerHTML=r==null?this.res("OK"):this.res(r);(o?v.textarea:v.input).value=i==null?"":i;v.callback=u;v.hide(!0);v.show2({owner:h});(o?v.textarea:v.input).select();(o?v.textarea:v.input).focus()},makeSafeHtml:function(n){return n==null||typeof n!="string"?n:n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},createCookie:function(n,t,i,r){var f,u;if(!r&&typeof Storage!="undefined"){localStorage.setItem(n,t);return}f="";i&&(u=new Date,u.setTime(u.getTime()+i*864e5),f="; expires="+u.toGMTString());document.cookie=n+"="+escape(t)+f+"; path=/"},readCookie:function(n,t){var u,f,r,i;if(!t&&typeof Storage!="undefined")return localStorage.getItem(n);for(u=n+"=",f=document.cookie.split(";"),r=0;r<f.length;r++){for(i=f[r];i.charAt(0)==" ";)i=i.substring(1,i.length);if(i.indexOf(u)==0)return unescape(i.substring(u.length,i.length))}return null},eraseCookie:function(n){typeof Storage!="undefined"&&localStorage.removeItem(n);this.createCookie(n,"",-1)},formatFilesize:function(n){return(n>0)?n/1e3<1?n+"Bytes":(n=n/1e3,n/1e3<1)?Math.round(n*10)/10+"KB":(n=n/1e3,n/1e3<1)?Math.round(n*10)/10+"MB":(n=n/1e3,n/1e3<1)?Math.round(n*10)/10+"GB":(n=n/1024,Math.round(n*10)/10+"TB"):""},today:function(n){return typeof n=="number"?scil.Utils.trunc2date(new Date((new Date).getTime()+n*864e5)):scil.Utils.trunc2date(new Date)},trunc2date:function(n){return n==null?null:new Date(n.getFullYear(),n.getMonth(),n.getDate())},getServerTime:function(n,t){scil.Utils.ajax(JSDrawServices.url+"?cmd=servertime",function(i){var r;r=scil.Utils.isNullOrEmpty(t)?scil.Utils.time(i):scil.Utils.formatTime(i,t);n(r)},null,{showprogress:!0})},time:function(n){var i,t,e;if(n==null)return new Date;if(t=null,typeof n=="string")if(/^[0-9]+$/.test(n))n=parseInt(n);else if(i=n.split("-"),i.length==3){var u=parseInt(i[0]),f=i[1].length==3?this._parseMonth(i[1]):parseInt(i[1])-1,r=parseInt(i[2]);if(u>0&&f>=0&&f<12&&r>0&&r<=31||(t=u,u=r,r=t,u>0&&f>=0&&f<12&&r>0&&r<=31))return new Date(u,f,r)}return t==null&&(t=new Date(n)),e=t.getTimezoneOffset(),isNaN(e)&&(e=0),new Date(t.getTime()+e*6e4)},_months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],_weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekday:function(n){return this._weekdays[n.getDay()]},_parseMonth:function(n){return n==null||n.length!=3?-1:(n=n.substr(0,1).toUpperCase()+n.substr(1).toLowerCase(),scil.Utils.indexOf(this._months,n))},isnull:function(n,t){return this.isNullOrEmpty(n)?t:n},iif:function(n,t,i){return n?t:i},formatTime:function(n,t){var i,u,r;return n==0?"":(n==null&&(n=new Date),typeof n!="object"&&(n=scil.Utils.time(n)),(JSDraw2.timezoneoffet>0||JSDraw2.timezoneoffet<0)&&(n=new Date(n.getTime()+JSDraw2.timezoneoffet*36e5)),!(n.getFullYear()>0))?"":(n.getMilliseconds()>=500&&(n=new Date(n.getTime()+(1e3-n.getMilliseconds()))),i=t,scil.Utils.isNullOrEmpty(i)&&(i="yyyy-mmm-dd"),i=i.replace("yyyy",n.getFullYear()).replace("yy",(n.getFullYear()+"").substr(2)).replace("mmm",scil.Utils._months[n.getMonth()]).replace("mm",scil.Utils.padLeft(n.getMonth()+1,2,"0")).replace("dd",scil.Utils.padLeft(n.getDate(),2,"0")),u=i.indexOf("hh")>=0,r=n.getHours(),i=i.replace("hh",this.padLeft(r%12,2,"0")).replace("HH",this.padLeft(r,2,"0")).replace("MM",this.padLeft(n.getMinutes(),2,"0")).replace("SS",this.padLeft(n.getSeconds(),2,"0")).replace("ss",this.padLeft(n.getSeconds(),2,"0")),u&&(i+=r>=12?"PM":"AM"),i)},dateStr:function(n,t,i){var f,r,e,u;return scil.Utils.isNullOrEmpty(n)||n==0?"":(f=typeof n,!(f=="object"||f=="number"||f=="string"))?"":(r=n,f!="object"&&(r=scil.Utils.time(r),r==null))?"":(e=(scil.Utils.today().getTime()-scil.Utils.trunc2date(r).getTime())/864e5,u=null,t==null&&(t=JSDraw2.config.classicdate),t||(e==0?u=JSDraw2.Language.res("Today"):e==1&&(u=JSDraw2.Language.res("Yesterday"))),u==null&&(scil.Utils.isNullOrEmpty(i)&&(i=JSDraw2.defaultoptions.dateformat,scil.Utils.isNullOrEmpty(i)&&(i="yyyy-mmm-dd")),typeof n=="string"&&(r=new Date(r)),u=scil.Utils.formatTime(r,i)),u)},timeStr:function(n,t,i){if(scil.Utils.isNullOrEmpty(n)||n==0)return"";if(typeof n=="string")return n=="new"?"<span style='color:red'>"+JSDraw2.Language.res("New")+"<\/span>":n;if(n==null)return"";typeof n!="object"&&(n=scil.Utils.time(n));var r=i!=null?i:JSDraw2.defaultoptions.timeformat;return scil.Utils.isNullOrEmpty(r)&&(r="HH:MM"),scil.Utils.dateStr(n,t)+" "+scil.Utils.formatTime(n,r)},svgIcon:function(n,t){return scil.SVG.getRawXml(n,t)},svgData:function(n,t,i){return scil.SVG.asBackground(n,t,i)},icon:function(n,t,i,r,u){return scil.SVG.createIcon(n,t,i,r,u)},create:function(n,t,i,r,u,f){return this.createElement(n,t,i,r,u,f)},createButton:function(n,t,i){var f,s,u,r,e,h,o,c,v,y,l,p,a;if(typeof n=="string"&&(n=scil.byId(n)),t!=null){if(typeof t=="string"){this.createElement(n,"span",t);return}return f=(i==null?scil.Lang:i).res(t.caption||t.label),t.title==null&&t.tooltips!=null&&(t.title=t.tooltips),s=scil.Lang.res(t.title),u=null,t.svg==null&&(u=t.src||t.iconurl||t.icon,u==null||scil.App.kImageBase==null||scil.Utils.startswith(u,"/",!0)||scil.Utils.startswith(u,"http:",!0)||scil.Utils.startswith(u,"https:",!0)||(u=scil.App.kImageBase+u)),r=null,e=null,t.type=="b"?(h=scil.Utils.createTable(n,0,0,{float:t.float==null?"left":t.float,textAlign:"center",margin:0,borderRadius:"2px"}),r=h.parentNode,scil.App.skin=="7.0"&&(r.style.width="100%"),t.id!=null&&r.setAttribute("id",t.id),o=scil.Utils.createElement(h,"tr"),c=t.expandright&&t.items!=null?"3px 3px 0 12px":"3px 12px 0 12px",t.largetext!=null?scil.Utils.createElement(o,"td",t.largetext,{padding:c,background:t.background}):t.svg!=null?(v=scil.create(o,"td",null,{padding:c}),scil.icon(v,t.svg,{width:t.svg==scil.App.config.title?23:25,fill:t.fill==null?"#fff":t.fill}),t.background!=null&&scil.App.skin=="7.0"&&(o.style.background=t.background)):scil.Utils.createElement(o,"td","<img src='"+u+"'"+(t.imgheight>0?" height='"+t.imgheight+"'":"")+">",{padding:c}),scil.App.skin=="7.0"?(f!=null&&f.substr(0,1)!="&"&&(r.setAttribute("title",f),f=" "),scil.Utils.createElement(o,"td",f,{color:"#fff",fontSize:"30%"}),e=r):scil.Utils.createElement(scil.Utils.createElement(h,"tr"),"td",f,{color:"#fff",fontSize:"60%"})):f==null&&t.svg!=null?(t.width>0||(t.width=16),style={width:t.width,height:t.width,cursor:"pointer",verticalAlign:"middle",color:t.color,fill:t.fill,svgstyles:t.svgstyles},r=scil.icon(n,t.svg,style,{title:s,id:t.id}),e=r.firstChild,scil.apply(e.style,{padding:"2px",borderRadius:"2px"})):f==null&&u!=null?r=this.createElement(n,"img",null,{width:t.width,cursor:"pointer",verticalAlign:"middle"},{src:u,title:s,id:t.id}):(r=t.type=="a"||t.type=="s"?this.createElement(n,t.tagname!=null?t.tagname:t.type=="s"||scil.Utils.isNullOrEmpty(f)?"span":"u",null,{width:t.width,cursor:"pointer",background:t.background,whiteSpace:"nowrap"},{title:s,id:t.id}):this.createElement(n,"button",null,{width:t.width,background:t.background,padding:t.padding},{title:s,id:t.id}),u!=null?scil.create(r,"img",null,{verticalAlign:"middle"},{src:u,height:t.imgheight}):t.svg!=null&&(y=r.tagName=="BUTTON"&&scil.App.config!=null?scil.App.config.frame:null,scil.icon(r,t.svg,{color:y,width:t.imgheight>0?t.imgheight:16,verticalAlign:"text-top",svgstyles:t.svgstyles})),scil.Utils.isNullOrEmpty(f)||this.create(r,"span",f)),t.items!=null&&(r.tagName=="IMG"||r.tagName=="U")&&(l=this.createElement(n,"span",null),l.appendChild(r),r=l),p=t.highlightcolor==null?JSDraw2.Skin.menu.highlightcolor:t.highlightcolor,a=t.color==null?t.type=="b"?"":JSDraw2.Skin.menu.color:t.color,r.style.color=a,e!=null?(scil.connect(e,"onmouseover",function(){e.style.background=t.type=="b"?JSDraw2.Skin.kToolbarHoverColor:JSDraw2.Skin.kToolbarHilitColor}),scil.connect(e,"onmouseout",function(){e.style.background=""})):(scil.connect(r,"onmouseover",function(){r.style.color=p}),scil.connect(r,"onmouseout",function(){r.style.color=a})),t.items!=null?(t.callback==null&&(t.callback=function(n){if(t.onclick!=null)t.onclick(n,t);else for(var i=0;i<t.items.length;++i)if(t.items[i].label==n&&t.items[i].url!=null){t.items[i].target==null?window.location=t.items[i].url:window.open(t.items[i].url,t.items[i].target);break}}),t.jsd=new scil.DropdownButton(r,t)):t.onclick!=null?scil.connect(r,"onclick",function(n){t.onclick(n,t)}):t.url&&scil.connect(r,"onclick",function(){t.target==null?window.location=t.url:window.open(t.url,t.target)}),t.key!=null&&r.setAttribute("key",t.key),r}},createElement:function(n,t,i,r,u,f){var e,c,h,l,s,o;if(typeof n=="string"&&(n=scil.byId(n)),u!=null&&u.title!=null&&(u.title=scil.Utils.res(u.title)),e=null,t=t.toLowerCase(),JSDraw2.Skin!=null&&JSDraw2.Skin.kRoundish&&(t=="button"?(r==null&&(r={}),r.border==null&&scil.App.config!=null&&(r.border="solid 1px "+scil.App.config.frame),r.borderRadius==null&&(r.borderRadius=JSDraw2.Skin.kBigRadius),r.padding==null&&(r.padding="5px 20px 5px 20px"),r.background==null&&scil.App.config!=null&&(r.background=scil.App.config.button,r.color=scil.App.config.frame),r.outlineWidth=0,r.marginRight="3px"):(t=="input"||t=="select"||t=="password"||t=="textarea")&&(r==null&&(r={}),r.borderRadius==null&&(r.borderRadius=JSDraw2.Skin.kBigRadius),r.padding==null&&(r.padding="2px 6px 2px 6px"),r.border==null&&(r.border=scil.App.config!=null?"solid 1px "+scil.App.config.line:"solid 1px #999"),r.outlineWidth=0)),t=="password"&&scil.Utils.isIE)for(c=0;c<5;++c)h=scil.byId("__pwd"+c),h!=null&&h.style.display=="none"&&(e=h,h.style.display="");if(e==null&&(t=="checkbox"||t=="radio"||t=="password"||t=="hidden"||t=="file"||t=="image"?scil.Utils.isIE8Lower?(l=u!=null&&u.name!=null?" name='"+u.name+"'":"",e=document.createElement("<input type='"+t+"'"+l+">")):(e=document.createElement("input"),e.type=t):e=t=="svg"&&i!=null?document.createElement("span"):document.createElement(t)),n!=null&&n.appendChild&&n.appendChild(e),i!=null&&(t=="radio"||t=="checkbox"?this.createElement(n,"span",i):e.innerHTML=i),r!=null){for(o in r)(s=r[o],s!=null&&(t!="svg"||o!="svgstyles"))&&((o=="width"||o=="height"||o=="padding"||o=="margin")&&typeof s=="number"&&(s=s+"px"),e.style[o]=s,t=="svg"&&(o=="width"||o=="height"||o=="fill"||o=="verticalAlign")&&e.firstChild!=null&&(e.firstChild.style[o]=s));t=="svg"&&r.svgstyles!=null&&scil.apply(e.firstChild.style,r.svgstyles)}if(u!=null)for(o in u)u[o]!=null&&e.setAttribute(o,u[o]);return t=="button"&&scil.App.config!=null&&(scil.connect(e,"onmouseout",function(){e.style.background=scil.App.config.button;e.style.color=scil.App.config.frame}),scil.connect(e,"onmouseover",function(){e.style.background=scil.App.config.frame;e.style.color="white"})),e.setAttribute("autocomplete","off"),f!=null&&scil.connect(e,"onclick",function(n){f(n,e)}),e},createTable:function(n,t,i,r,u){var f=this.createElement(n,"table",null,r);return t!=null&&(f.cellSpacing=t),i!=null&&(f.cellPadding=i),u>=0&&(f.border=u),this.createElement(f,"tbody")},createTable2:function(n,t,i){var r=this.createElement(n,"table",null,t,i);return this.createElement(r,"tbody")},createTR:function(n,t){return scil.Utils.createElement(n,"tr",t)},createTD:function(n,t){return n.tagName!="TR"&&(n=this.createTR(n)),scil.Utils.createElement(n,"td",t)},createCenterBox:function(n,t){var i=this.createTable(n,0,0,null,t),r,u;return i.parentNode.setAttribute("align","center"),r=this.createElement(i,"tr"),u=this.createElement(r,"td",null,{textAlign:"left"}),u},createSelect:function(n,t,i,r,u){var f=this.createElement(n,"select",null,u);return this.listOptions(f,t,i,!1,r),f},sortIgnoreCases:function(n){n.sort(function(n,t){return(n==null?"":n+"").localeCompare(t==null?"":t+"",undefined,{sensitivity:"base"})})},listOptions:function(n,t,i,r,u){var c,l,h,a,o,e,f,s;if(r&&this.removeAll(n),t!=null&&n!=null&&n.tagName=="SELECT")if(t.length!=null)for(u&&this.sortIgnoreCases(t),e=0;e<t.length;++e)h=t[e],s=this.createElement(n,"option",h,null,{value:h}),h==i&&s.setAttribute("selected","selected");else if(n.getAttribute("usegroup")=="1"){for(c in t)if(o=t[c],o!=null)if(l=this.createElement(n,"optgroup",null,null,{label:c}),o.length==null)for(f in o)s=this.createElement(l,"option",o[f],{paddingLeft:"20px"},{value:f}),f==i&&s.setAttribute("selected","selected");else for(e=0;e<o.length;++e)h=o[e],s=this.createElement(l,"option",h,{paddingLeft:"20px"},{value:h}),h==i&&s.setAttribute("selected","selected")}else if(u){a={};o=[];for(f in t)a[t[f]]=f,o.push(t[f]);for(this.sortIgnoreCases(o),e=0;e<o.length;++e){var v=o[e],f=a[v],s=this.createElement(n,"option",v,null,{value:f});f==i&&s.setAttribute("selected","selected")}}else for(f in t)s=this.createElement(n,"option",t[f],null,{value:f}),f==i&&s.setAttribute("selected","selected")},selectOption:function(n,t,i){var r,u;if(n!=null){for(n.removeAttribute("_value"),r=0;r<n.options.length;++r)if(u=n.options[r],this.isEqualStr(u.value,t+"",i)||typeof t=="boolean"&&(t==!0&&scil.Utils.isTrue(u.value)||t==!1&&scil.Utils.isFalse(u.value))){n.selectedIndex=r;return}n.selectedIndex=-1;n.setAttribute("_value",t==null?"":t)}},isEqualStr:function(n,t,i){return n==null&&t==null?!0:n==null||t==null?!1:(n=n.replace(/μ/g,"µ"),t=t.replace(/μ/g,"µ"),i)?n.toLowerCase()==t.toLowerCase():n==t},removeAll:function(n){if(n!=null&&n.childNodes!=null)for(var t=n.childNodes.length-1;t>=0;--t)n.removeChild(n.childNodes[t])},getParent:function(n,t){for(t=t.toUpperCase();n!=null;){if(n.tagName!=null&&n.tagName.toUpperCase()==t)return n;n=n.parentNode}return n},testParent:function(n,t){if(n==null||t==null)return!1;while(n!=null){if(n.parentNode==t)return!0;n=n.parentNode}return!1},firstElement:function(n,t){var i,r;if(n==null)return null;for(i=0;i<n.childNodes.length;++i)if(r=n.childNodes[i],t==null&&r.nodeName!="#text"||t!=null&&r.nodeName==t)return r;return null},arrayContainsArray:function(n,t){if(n==null||t==null||n.length<t.length)return!1;for(var i=0;i<t.length;++i)if(this.indexOf(n,t[i])<0)return!1;return!0},indexOf:function(n,t,i){var r,u;if(n==null||typeof n=="string")return-1;for(i&&typeof t=="string"?t=t.toLowerCase():typeof t!="string"&&(i=!1),r=0;r<n.length;++r)if(u=n[r],i&&(u=u.toLowerCase()),u==t)return r;return-1},delFromArray:function(n,t){for(var r=0,i=n.length-1;i>=0;--i)n[i]==t&&(n.splice(i,1),++r);return r},post:function(n,t,i){var r,u;this.form==null&&(this.form=scil.Utils.createElement(document.body,"form",null,{display:"none"}));scil.Utils.removeAll(this.form);for(r in t)u=scil.Utils.createElement(this.form,"textarea"),u.name=r,u.value=t[r];this.form.target=i;this.form.method="post";this.form.action=n;this.form.submit()},alert:function(n){scil.Utils.isNullOrEmpty(n)||(n.length>1e3&&(n=n.substr(0,1e3)+"..."),scil.Utils.nativemode?this.alert2(n,"JSDraw2.Editor Message"):alert(n))},download:function(n,t){n+=n.indexOf("?")>0?"&__tm="+(new Date).getTime():"?__tm="+(new Date).getTime();var i={url:n,method:"get",handleAs:"text",load:t,error:function(){}};scil.Utils._ajaxcall(i)},ajax:function(n,t,i,r){r==null&&(r={});var u={url:n,method:r.method,sync:r.sync,handleAs:"text",content:i,timeout:r.timeout,error:function(n){if(r.showprogress&&scil.Progress.hide(),r.onError!=null)r.onError(n);else scil.Utils.alert(n.message)},load:function(n){r.showprogress&&scil.Progress.hide();scil.Utils.ajaxCallback(n,t,r.onError,r.ignoresucceedcheck);scil.User!=null&&scil.User.onAjax!=null&&scil.User.onAjax()}};if(r!=null&&r.postdata!=null&&(u.postData=r.postdata),r.showprogress&&scil.Progress.show(r.caption==null?"Loading ...":r.caption,!1,r.message==null?"Communicating with the server ...":r.message,!1),scil.Utils.onajaxcall!=null)scil.Utils.onajaxcall(u,r);r.headers!=null&&(u.headers=r.headers);scil.Utils._ajaxcall(u)},_ajaxcall:function(n){var u=scil.Utils.isNullOrEmpty(n.method)?"POST":n.method,r,i,o,f,t,e;switch((n.method+"").toLowerCase()){case"delete":case"del":u="DELETE";break;default:scil.Utils.isNullOrEmpty(n.method)||(u=n.method.toUpperCase())}if(r=n.postData,scil.Utils.isNullOrEmpty(r)&&n.content!=null&&(r=this._dict2postdata(n.content)),n.headers==null&&(n.headers={}),i=n.url,u=="GET"||n.jsonpcallbackfun!=null?scil.Utils.isNullOrEmpty(r)||(o=i.lastIndexOf("?"),o<0?i+="?":i.substr(i.length-1,1)!="&"&&(i+="&"),i+=r):scil.Utils.isNullOrEmpty(n.headers["content-type"])&&(n.headers["content-type"]="application/x-www-form-urlencoded; charset=utf-8"),n.jsonpcallbackfun!=null)f=document.createElement("script"),f.type="text/javascript",scil.callbacks[n.jsonpcallbackfun]=function(t){n.load(t);document.body.removeChild(f)},f.src=i,document.body.appendChild(f);else{t=new XMLHttpRequest;try{t.open(u,i,!n.sync,n.username,n.password);for(e in n.headers)t.setRequestHeader(e,n.headers[e]);u=="GET"?t.send():t.send(r==null?"":r);t.onreadystatechange=function(){if(n.onstatus!=null)n.onstatus({status:t.status,text:t.statusText,xhttp:t,input:n});this.readyState==4&&(this.status==200?n.load!=null&&n.load(this.responseText):n.error!=null&&n.error({message:t.status+": "+t.statusText,status:t.status,xhttp:t,input:n}))}}catch(s){n.error!=null&&n.error(s)}}},kPostEscapeChars:{"%":"%25","&":"%26","=":"%3D","?":"%3F","+":"%2B","#":"%23"},_dict2postdata:function(n){var i="",r,t,u;for(r in n)if(!scil.Utils.isNullOrEmpty(r)&&(t=n[r],t!=null)){typeof t!="string"&&(t=t+"");for(u in scil.Utils.kPostEscapeChars)t=t.replace(new RegExp("["+u+"]","g"),scil.Utils.kPostEscapeChars[u]);i.length>0&&(i+="&");i+=r+"="+t}return i},ajaxwait:function(n,t){var i=null,r=function(n){i=n};return this.ajax(n,r,t,{sync:!0}),i},jsonp:function(n,t,i,r){var f,e,o,u;if(!scil.Utils.isNullOrEmpty(n)){if(r==null&&(r={}),i==null?i={wrapper:"jsonp"}:i.wrapper="jsonp",f="fun"+(new Date).getTime(),i.callback="scil.callbacks."+f,scil.Utils.startswith(n,"//")&&(e=(window.location+"").toLowerCase(),n=scil.Utils.startswith(e,"https:")?"https:"+n:"http:"+n),o=n.indexOf("?"),n+=o<0?"?":"&",n+="__jsdraw_timestamp__="+(new Date).getTime(),r.showprogress&&scil.Progress.show(r.caption==null?"Loading ...":r.caption,!1,r.message==null?"Communicating with the server ...":r.message,!1),u={url:n,jsonpcallbackfun:f,content:i,error:function(n){if(r.showprogress&&scil.Progress.hide(),r.onError!=null)r.onError(n);else scil.Utils.alert(n.message)},load:function(n){r.showprogress&&scil.Progress.hide();scil.Utils.ajaxCallback(n,t,r.onError,r.ignoresucceedcheck)}},scil.Utils.onjsonpcall!=null)scil.Utils.onjsonpcall(u);u.method="get";scil.Utils._ajaxcall(u)}},getZindex:function(n){while(n!=null){if(n.style!=null&&n.style.zIndex!=""&&n.style.zIndex!=null)return parseInt(n.style.zIndex);n=n.parentNode}return 1},onAjaxCallback:null,ajaxCallback:function(n,t,i,r){var u=null;switch(typeof n){case"string":try{n==""?u=null:(eval("var o="+n),u=o)}catch(f){scil.Message.show("Error when parsing Ajax results:\n"+f.message+"\n"+n,"error");return}break;case"object":u=n;break;default:scil.Utils.alert("Unknown return format")}if(scil.Utils.onAjaxCallback==null||!scil.Utils.onAjaxCallback(u))if(r==!0)t!=null&&t(u);else if(u.succeed)t!=null&&t(u.ret);else{if(scil.User!=null&&scil.User.needLogin!=null&&scil.User.needLogin(u))return;i!=null?i(u):u.errcode=="None"?scil.Message.show(u.error,"error"):scil.Message.show("["+(u.errcode==null?"ERROR":u.errcode)+"]: "+u.error,"error")}},ajaxUploadFile:function(n,t,i,r){var h,u,f,o,s,c,e;i==null&&(i={});t.toLowerCase().indexOf("wrapper=textarea")<0&&(h=t.indexOf("?"),t+=h>0?"&wrapper=textarea":"?wrapper=textarea");u=[];for(f in i)(o=i[f],scil.Utils.isNullOrEmpty(f)||scil.Utils.isNullOrEmpty(o))||(s=scil.create(n,"textarea",null,{display:"none"},{name:f}),s.value=o,u.push(s));for(c=scil.__uploadfileiframe.name,scil.attr(n,{action:t,method:"POST",target:c}),scil.__uploadfileiframe.onload=function(){scil.Progress.hide();var n=scil.__uploadfileiframe.contentDocument.body.firstChild;n!=null&&n.tagName=="TEXTAREA"?scil.Utils.ajaxCallback(n.value,r):scil.Utils.alert(scil.__uploadfileiframe.contentDocument.body.innerHTML)},n.submit(),scil.Progress.show("Uploading",!1,"Communicating with the server ...",!1),e=0;e<u.length;++e)n.removeChild(u[e])},res:function(n){return JSDraw2.Language.res(n)},uploadFile:function(n,t,i,r,u,f,e){scil.FileUploader.upload({caption:n,message:t,data:u,url:i,multiple:e,callback:r})},ie2touches:function(n){for(var i=n.getPointerList(),r=[],t=0;t<i.length;++t)r.push({pointerId:i[t].pointerId,clientX:i[t].clientX,clientY:i[t].clientY,target:n.target,button:n.button});return r.sort(function(n,t){return n.pointerId-t.pointerId}),n.touches=r,n},getScreenSize:function(n){n==null&&(n=window);var t=n.document.documentElement||n.document.body,i=n.document.parentWindow||n.document.defaultView;return{w:i.innerWidth||t.clientWidth,h:i.innerHeight||t.clientHeight}},json2str:function(n,t,i,r){var e=i?'"':"'",o,u,s,f,h;if(n==null)return"null";if(typeof n=="number")return n;if(typeof n=="boolean")return n?"true":"false";if(r&&typeof n=="function")return n+"";if(typeof n=="string")return u=n.replace(/\r/g,"\\r").replace(/\n/g,"\\n"),u=e=='"'?u.replace(/\"/g,'\\"'):u.replace(/\'/g,"\\'"),e+u+e;if(typeof n=="object"){if(n.length!=null){for(u=t?"[ ":"[",o=0;o<n.length;++o)u+=(o>0?t?", ":",":"")+this.json2str(n[o],t,i,r);return u+(t?" ]":"]")}u=t?"{ ":"{";s=0;for(f in n)f!=null&&f!=""&&n[f]!=null&&f.substr(0,1)!="_"&&(++s>1&&(u+=u.substr(u.length-1,1)=="}"?t?",\r\n":",":t?", ":","),!i&&/^[a-z|_]+[0-9|a-z|_]{0,1000}$/.test(f)?u+=f:(h=e=='"'?f.replace(/\"/g,'\\"'):f.replace(/\'/g,"\\'"),u+=e+h+e),u+=(t?": ":":")+this.json2str(n[f],t,i,r));return u+(t?" }":"}")}return"null"},getMaxZindex:function(){var n=this.getMaxZindex2("div"),t=this.getMaxZindex2("iframe"),i=this.getMaxZindex2("table");return Math.max(Math.max(n,t),i)},getMaxZindex2:function(n){for(var r,f,u=document.body.className=="mce-fullscreen"?101:1,i=document.getElementsByTagName(n),t=0;t<i.length;++t)i[t].style!=null&&i[t].style.display!="none"&&i[t].getAttribute("maxzindex")!="skip"&&(r=i[t].style.zIndex,r!=null&&r!=""&&(f=parseInt(r),f>u&&(u=f)));return u},isAllParentVisible:function(n){if(n==null)return!1;while(n!=null&&n.style!=null){if(n.style.display=="none")return!1;n=n.parentNode}return!0},xml2Json:function(n,t){var i,e,r,u,o,f,s;if(n==null||(i=n.getElementsByTagName(t),i==null||i.length==0))return null;for(e=[],r=0;r<i.length;++r){for(u=i[r],o={_e:u},f=0;f<u.attributes.length;++f)s=u.attributes[f],o[s.name]=s.value;e.push(o)}return e},jsonList2Xml:function(n,t){var r,i;if(n==null)return"";for(r="",i=0;i<n.length;++i)r+=this.json2Xml(n[i],t);return r},json2Xml:function(n,t,i){var f,u,r,e;if(n==null)return"";f="<"+t;for(u in n)(r=n[u],r!=null&&(typeof r!="string"||r!=""))&&(e=typeof r,e!="object"&&e!="function"&&(f+=" "+u+'="'+scil.Utils.escXmlValue(n[u])+'"'));return f+(i!=null&&i!=""?">"+i+"<\/"+t+">":"/>")},joinArray:function(n,t){var r,i;if(n==null&&t==null)return null;if(n==null)return t;if(t==null)return n;if(r=[],typeof n=="string"||n.length==null)r.push(n);else for(i=0;i<n.length;++i)r.push(n[i]);if(typeof t=="string"||t.length==null)r.push(t);else for(i=0;i<t.length;++i)r.push(t[i]);return r},getInnerXml:function(n){var i,t;if(n!=null){if(n.documentElement!=null&&(n=n.documentElement),n.innerXML)return n.innerXML;if(n.xml)return n.xml;if(typeof XMLSerializer!="undefined"){for(i="",t=0;t<n.childNodes.length;++t)i+=(new XMLSerializer).serializeToString(n.childNodes[t]);return i}return null}},getInnerText:function(n){if(n!=null)return n!=null&&n.documentElement!=null&&(n=n.documentElement),scil.Utils.trim(n.innerText||n.textContent||n.text)},getChildXmlElements:function(n,t){var r,i;if(n!=null&&n.documentElement!=null&&(n=n.documentElement),n==null)return null;for(r=[],i=0;i<n.childNodes.length;++i)n.childNodes[i].tagName==t&&r.push(n.childNodes[i]);return r},isImg:function(n){return n!=null&&(n=n.toLowerCase()),n=="gif"||n=="png"||n=="jpg"||n=="jpeg"||n=="tif"||n=="tiff"||n=="bmp"},isOfficeFile:function(n){return n!=null&&(n=n.toLowerCase()),n=="doc"||n=="docx"||n=="docm"||n=="rtf"||n=="ppt"||n=="pptx"||n=="pptm"||n=="xls"||n=="xlsx"||n=="xlsm"},isPDF:function(n){return n!=null&&(n=n.toLowerCase()),n=="pdf"},isVideo:function(n){return n!=null&&(n=n.toLowerCase()),n=="mp4"||n=="wmv"||n=="mov"},isSpectraFile:function(n){return n!=null&&(n=n.toLowerCase()),n=="jdx"},isChemFile:function(n){return n!=null&&(n=n.toLowerCase()),n=="cdx"||n=="cdxml"||n=="jsd"||n=="jsdraw"||n=="mol"||n=="sdf"||n=="mol2"||n=="cml"||n=="skc"||n=="tgf"||n=="mrv"||n=="rxn"||n=="rdf"||n=="helm"||n=="xhelm"},isSdFile:function(n){return n!=null&&(n=n.toLowerCase()),n=="sd"||n=="sdf"},getFileExt:function(n){if(n==null)return null;var t=n==null?-1:n.lastIndexOf(".");return t<=0?null:n.substr(t+1).toLowerCase()},isChildOf:function(n,t){if(t==null||n==null)return!1;while(n!=null){if(n.parentNode==t)return!0;n=n.parentNode}return!1},getElements:function(n,t,i){var f=[],u,r;if(n!=null&&n.childNodes!=null)for(u=0;u<n.childNodes.length;++u)r=n.childNodes[u],(t==null||r.tagName==t||i&&r.tagName!=null&&t!=null&&r.tagName.toLowerCase()==t.toLowerCase())&&f.push(r);return f},getFirstElement:function(n,t){var i,r;if(n!=null&&n.childNodes!=null)for(i=0;i<n.childNodes.length;++i)if(r=n.childNodes[i],t==null&&r.tagName!=null||t!=null&&r.tagName==t)return r;return null},parseIndex:function(n){if(n==null)return null;var t=n.replace(/[0-9]+$/,"");return t==n?{prefix:t,index:null}:{prefix:t,index:parseInt(n.substr(t.length))}},removeItem:function(n,t){var u,r,f,i;if(n==null)return 0;if(u=0,n.length>0)for(i=n.length-1;i>=0;--i)t(n[i],i)&&(++u,n.splice(i,1));else{r=[];for(f in n)t(n[f],f)&&r.push(f);for(i=0;i<r.length;++i)delete n[r[i]];u=r.length}return u},removeArrayItem:function(n,t){var i=scil.Utils.indexOf(n,t);return i<0?!1:(n.splice(i,1),!0)},removeArrayItems:function(n,t){for(var r=0,i=0;i<t.length;++i)this.removeArrayItem(n,t[i])&&++r;return r},moveToScreen:function(n,t,i,r){var u=scil.Utils.getBox();n+i.offsetWidth>u.l+u.w&&(n=r!=null?r-i.offsetWidth:u.l+u.w-i.offsetWidth);n<0&&(n=0);t+i.offsetHeight>u.t+u.h&&(t=u.t+u.h-i.offsetHeight);t<0&&(t=0);i.style.left=n+"px";i.style.top=t+"px"},unselectable:function(n){n.onselectstart=function(){return!1};n.setAttribute("unselectable","on");scil.style(n,{webkitTouchCallout:"none",webkiUserDelect:"none",khtmlUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",userSelect:"none"})},letter2num:function(n){var t,i,r;if(scil.Utils.isNullOrEmpty(n))return 0;for(t=0,n=n.toUpperCase(),i=0;i<n.length;++i)r=n.charCodeAt(i),r>=65&&r<=90&&(t=t*26+(r-64));return t},num2letter:function(n,t){for(var i="",r;n>0;)r=(n-1)%26,i=String.fromCharCode(r+(t?97:65))+i,n=(n-r-1)/26;return i},connect:function(n,t,i){return scil.connect(n,t,i)},array2str:function(n,t){var r,i;if(n==null||n.length==0)return"";for(r="",t==null&&(t=","),i=0;i<n.length;++i)i>0&&(r+=t),n[i]!=null&&(r+=n[i]);return r},isDictEmpty:function(n){if(n==null)return!0;for(var t in n)return!1;return!0},getDictValues:function(n,t){if(n==null)return null;t==null?t=[]:t==!0&&(t=[""]);for(var i in n)t.push(n[i]);return t},getDictKeys:function(n,t){if(n==null)return null;t==null?t=[]:t==!0&&(t=[""]);for(var i in n)t.push(i);return t},getDictKeyByValue:function(n,t){if(n==null)return null;for(var i in n)if(n[i]==t)return i;return null},list2dict:function(n,t){for(var r,u={},i=0;i<n.length;++i)r=n[i],u[r[t]]=r;return u},setEnv:function(n){n!=null&&n!=""&&(document.body.style.backgroundImage=scil.Utils.imgSrc("img/"+n+".gif",!0),document.body.style.backgroundRepeat="no-repeat")},sound:function(n){this.isIE&&this.isIE<9||(this.__sound==null&&(this.__sound=this.createElement(document.body,"audio",null,{display:"none"})),this.__sound.src!=n&&(this.__sound.src=n),this.__sound.play())},escapeHtml:function(n){return n==null?"":n.replace(/>/g,"&gt;").replace(/</g,"&lt;")},textWidth:function(n){var t,i;if(n==null||n.length==null)return 0;for(t=0,i=0;i<n.length;++i)n.charCodeAt(i)>255?t+=2:++t;return t},areListEq:function(n,t){if(n==t)return!0;if(n==null&&t!=null||n!=null&&t==null||n.length!=t.length)return!1;for(var i=0;i<n.length;++i)if(n[i]!=t[i])return!1;return!0},areDictEq:function(n,t){var u,i,r;if(n==t)return!0;if(n==null||t==null)return!1;for(u in n)if(i=n[u],r=t[u],!(i==r||i==null&&r==""||i==""&&r==null))return!1;return!0},splitStr:function(n,t){var r,u,i;if(n==null)return null;for(r=[],u=n.split(t),i=0;i<u.length;++i)r.push(this.trim(u[i]));return r},isEmptyStr:function(n){return this.isNullOrEmpty(n)},regFindAllMatches:function(n,t,i){var f=[],e,o,r,u;if(n==null)return f;for(i>0?n=n.substr(i):i=0,o=0;(e=t.exec(n))!=null;)r=e.index,u=e+"",f.push({start:o+r+i,str:u}),o+=r+u.length,n=n.substr(r+u.length);return f},isNumber:function(n,t){var i,r;return typeof n=="number"?!0:scil.Utils.isNullOrEmpty(n)?!1:(i=n.indexOf("."),i>0&&(r=n.indexOf(","),r>0&&r<i&&(n=n.replace(/[,]/g,""))),t?new RegExp("^[>|<|≥|≤|+|-]$").test(n+"")||new RegExp("^[>|<|≥|≤]?[ ]{0,50}[-]?[0-9]+([.][0-9]{0,50})?([e|E][-|+][0-9]+)?([ ]{0,50}[±][0-9]{0,50}([.][0-9]{0,50})?)?$").test(n+"")||new RegExp("^[+|-]?∞$").test(n+""):!isNaN(n))},htmlDecode:function(n){if(scil.Utils.isNullOrEmpty(n))return n;var t=document.createElement("div");return t.innerHTML=n,t.childNodes.length===0?"":t.childNodes[0].nodeValue},html2Text:function(n){if(this.isNullOrEmpty(n))return n;var t=document.createElement("div");return t.innerHTML=n,t.childNodes.length===0?"":this.getInnerText(t)},parseNumber:function(n){var t=n==null?NaN:parseFloat(n);return isNaN(t)?null:t},isNullOrEmpty:function(n,t){return n==null?!0:typeof n=="string"?(t&&(n=this.trim(n)),n.length==0):!1},isNaN:function(n){return scil.Math.isNaN(n)},getOuterXml:function(n){return n==null?null:n.xml!=null?n.xml:(new XMLSerializer).serializeToString(n)},addCss:function(n){var t=document.createElement("style");t.type="text/css";t.styleSheet?t.styleSheet.cssText=n:t.innerHTML=n;document.getElementsByTagName("head")[0].appendChild(t)},insertAfterDict:function(n,t,i){var u={},e=!1,f;for(var r in n)if(e)u[r]=n[r],delete n[r];else if(r==i){for(f in t)n[f]=t[f];e=!0}for(r in u)n[r]=u[r];return n},insertBeforeDict:function(n,t,i){var u={},e=!1,f;for(var r in n)if(e)u[r]=n[r],delete n[r];else if(r==i){for(f in t)n[f]=t[f];e=!0;u[r]=n[r];delete n[r]}for(r in u)n[r]=u[r];return n},delNulls:function(n){var t,r,i;if(n==null)return 0;t=[];for(r in n)scil.Utils.isNullOrEmpty(n[r])&&t.push(r);for(i=0;i<t.length;++i)delete n[t[i]];return t.length},insertBeforeArray:function(n,t,i){for(var u,r=0;r<n.length;++r)if(i(n[r])==!0){if(t.length==null)n.splice(r,0,t);else for(u=0;u<t.length;++u)n.splice(r+u,0,t[u]);return!0}return!1},insertAfterArray:function(n,t,i){for(var u,r=0;r<n.length;++r)if(i(n[r])==!0){if(t.length==null)n.splice(r+1,0,t);else for(u=0;u<t.length;++u)n.splice(r+1+u,0,t[u]);return!0}return!1},disableSelection:function(n){n!=null&&scil.apply(n.style,{webkitTouchCallout:"none",webkitUserSelect:"none",mozUserSelect:"none",msUserSelect:"none",userSelect:"none"})},getLastBarcode:function(n,t,i,r){scil.Utils.jsonp(r!=null?r:"JSDraw/Service.aspx?cmd=mobile.getlast",function(t){n(t)},{category:t,useremail:i})},beep:function(n){if(typeof Audio!="undefined"&&(this._beepobj==null&&(this._beepobj=new Audio("data:audio/wav;base64,UklGRtoEAABXQVZFZm10IBAAAAABAAEAESsAABErAAABAAgAZGF0YbUEAAB9dXFpa3F4fYSLkZiUjoeCe3RuaWtze36GjJOZkYyGgHpybGhvc3uBiI2UmZCKhX93cWxob3Z9g4mQlZaPioN8dm9qanF4f4OLkZeUjoiBe3RvaWxzeICGi5OYlIuFgXlybWltdHuBiI6Ul5CLhn14cmlqcHV8g4mOl5ePiYR8dnBoa3F3foWKkZaVjoiBenVwZ2xyeoCFjZKXlIyGgHpza2lvdHmCh4+Tl5KKhX54cWtpb3Z9gYmPlpePiYN9dnBoa3F4foOLkZeWjYmAfHRvZ25yeX+FjZKXlIyFgXlza2lvc3uAh46Vl5CLhX93cWtqb3V9g4iQlZePioJ9dnFoa3F4foSKkZaUj4eBfHVuaWtzeX+GjJKYk4yGgHl0bWdudXt/iI2VmJCMhX53cWtqb3Z8g4iQlZaPioN8dnFoa3B4foSKkZeVjoiCe3RuaWxzeX+Gi5OXk42Gf3tzbGhtdXuBh4yVl5GMhH54cmtpcHV8g4mOlpaRiYN9dm9raXF4fYSLkJaWjoeCenZuaGxzeICFjJOXk4yHf3pzbWltdHqBiI2Ul5GNhH54cmtpbnd7gomQlZePi4J9dnBqanF3fYOLkJiUj4eBfHVuaWtzeX+FjJKYk4yHgHpzbGltc3uBh42Vl5GLhX92c2ppcXV8gomPlZiOioJ+dnFpaXF5fYOKkZeWjYiDenVuaWtzeIGFjJKXk42GgHl1bWhtdHt/h42Vl5KLhH93c2tob3V9g4iPlZePi4N8d3Bpa3F3foSJkZaWj4eCfHNvaGtyen+FjJGYlIuIgHl0bGhuc3uBh42Ul5KMg4B4cmtocXR8g4mPlZWRioJ9d29ram93foSJkZeUjomCe3VvaG1yd3+Hi5KYlI2GgHpzbmdtdHqBiIyVlpKLhH95cmppb3V8g4iOlpeQiYN+dnFqaXJ2fYSLj5iUj4iCfHRuaWxzeH+FjJGYk42Hf3tzbWhudHqAho6TmZGLhX94c2ppbnZ8gomOlpePi4J+dnBqanB3foOKkJeWjoiBfHRwaGxyeH+Gi5KYk46GgXpzbWdudHqAh46TmJGMhX54cmtpb3V8g4ePlZiPioR9dnFpa3B2foOKkZaVj4iBfHZuaWxyeX6EjZGYlI2GgXlzbmhuc3qBho2Ul5KLhX95cWtpcHV8gYiPlZePi4R8d3FpanB3foOKkJiVjomBe3ZuamtyeICFipOWlI6FgXp1a2psc3uAh46SmJKLhX94c2tocHR9goiOlZeRioN9d3BqaXF3foKLkJWVj4mBfHVvaWtyeH+Gi5KXloyHgHl0bmhuc3qAh42Tl5KMhX55cmtocHZ7goiOlZePioR8eHBqanF2fYSJkJiVj4iCfHZuaGxzeH2Hi5KXlY2FgHtzbWltc3qAh42UlpKMhX94c2tqbnZ6gomOlpaRi4N9d3FpanF2fYSKkJWWjomCe3ZvaWtxeX6Fi5KYk42HgXp0bmhtc3uAhoyUmJKLhYB4c2tocHR9gYiOlpeQioN9d3JqanB3fISJkJeVj4iBfnRwaWpyeX6FjJGXlI6GgHp1bGlucnqBhoyUmJKMhH94c21nb3V8gYmOlZeQi4N+d3FqaXB3fQA=")),this._beepobj.play(),n)){var t=this;setTimeout(function(){t._beepobj.play()},300)}},textareaSelect:function(n,t,i){if(typeof n.selectionStart!="undefined"&&(n.focus(),n.selectionStart=t,n.selectionEnd=i),document.selection&&document.selection.createRange){n.focus();n.select();var r=document.selection.createRange();r.collapse(!0);r.moveEnd("character",i);r.moveStart("character",t);r.select()}},fireEvent:function(n,t,i,r,u){var f;document.createEvent?(f=document.createEvent("HTMLEvents"),f.initEvent(t,i==null?!0:i,r==null?!0:r)):(f=document.createEventObject(),f.eventType=t);u!=null&&scil.apply(f,u);f.eventName=t;document.createEvent?n.dispatchEvent(f):n.fireEvent("on"+f.eventType,f)},sum:function(n){return scil.Math.sum(n)},avg:function(n){return scil.Math.avg(n)},stdev:function(n){return scil.Math.stdev(n)},xml2Lines:function(n){var r=n==null?null:scil.Utils.parseXml("<d> "+n+"<\/d>"),h=r==null?null:r.documentElement||r.firstElementChild,u,f,t,e,o,i,s;if(h==null)return null;for(u=[],f=scil.Utils.getElements(h,null),t=0;t<f.length;++t){for(e=f[t],o={},i=0;i<e.attributes.length;++i)s=e.attributes[i],o[s.name]=s.value;u.push(o)}return u},xmlSelectSingleNode:function(n,t){var i=n==null||typeof n=="object"?n:scil.Utils.parseXml(n),r,u;return i==null?null:i.evaluate?(r=i.evaluate(t,i),u=r.iterateNext(),u==null?null:u.childNodes[0]):i.selectNodes!=null?(i.setProperty("SelectionLanguage","XPath"),r=i.selectNodes(t),r==null||r.length==0?null:r[0].childNodes[0]):null},xpath:function(n,t){if(n==null||t==null)return null;typeof n=="string"&&(n=scil.Utils.parseXml(n));var i=document.evaluate(t,n,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;return i==null?null:scil.Utils.getInnerText(i)},xml2text:function(n){var t=n==null||typeof n=="object"?n:scil.Utils.parseXml(n);return t==null?n:this.getInnerText(t)},getQueryValue:function(n){var r=window.location.href,i,t;return(n=n.replace(/[\[\]]/g,"\\$&"),i=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),t=i.exec(r),!t)?null:t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):""},newtoken:function(n,t){var i,u,f,r;for(n<2&&(n=70),i="",r=0;r<n-2;++r)u=Math.round(Math.random()*51),i+=u<26?String.fromCharCode(65+u):String.fromCharCode(97+u-26);for(r=0;r<2;++r)u=Math.round(Math.random()*9),f=Math.round(Math.random()*i.length),i=i.substr(0,f)+u+i.substr(f);for(t==null&&(t="!@$*-_+=|.,~"),r=0;r<2;++r){var u=Math.round(Math.random()*(t.length-1)),f=Math.round(Math.random()*i.length),e=t[u];i=i.substr(0,f)+e+i.substr(f)}return i},getBox:function(){var n=document.body;return{l:window.scrollX,t:window.scrollY,w:window.innerWidth,h:window.innerHeight,dw:n.scrollWidth,dh:n.scrollHeight}},selectFromDict:function(n,t){var u,i,r;if(n==null)return n;for(u={},i=0;i<t.length;++i)r=t[i],n[r]!=null&&(u[r]=n[r]);return u},hasClass:function(n,t){var i,r;if(n==null||(i=scil.Utils.splitStr(n.className," "),i==null))return!1;for(r=0;r<i.length;++r)if(i[r]==t)return!0;return!1},removeClass:function(n,t){var i,r;if(scil.Utils.isNullOrEmpty(t)||n==null||(n=document.getElementById(""),i=scil.Utils.splitStr(n.className," "),i==null))return!1;for(r=0;r<i.length;++r)if(i[r]==t)return i.splice(r,1),n.className=scil.Utils.array2str(i," "),!0;return!1}};scil.form={};JsUtils=scil.Utils;scil.Utils.padleft=scil.Utils.padLeft;scil.Utils.padright=scil.Utils.padRight;scil.create=scil.Utils.createElement;scil.ready(function(){scil.__uploadfileiframe=scil.create(document.body,"div","<iframe name='__scil_iframe_uploadfiles' src=''/>",{display:"none"}).firstChild});scil.Utils.addCss(".scil_table td a{white-space:nowrap;}");scil.Utils.isIE&&scil.Utils.addCss("select::-ms-expand{display:none;}select{border:solid 1px gray;padding-right:20px;background-repeat:no-repeat;background-position:right center;background-image:url(jsdraw/img/dropdown.gif);}");JSDraw2.Skin={jsdraw:{},jssdf:{},dialog:{},menu:{},toolbar:{autoshrink:!0},kRoundish:!0,kBorderRadius:"5px",kBigRadius:"2px",kPagesLocation:"bottom",kToolbarColor:"rgb(41, 46, 69)",kToolbarHoverColor:"rgba(255,255,255,0.2)",kToolbarHilitColor:"rgba(0,0,0,0.1)",kToolbarTextColor:"#ccc",kDarkmodeBgColor:"#343840",kLightModeBgColor:"#F8F6F7",kDarkmodeColor:"#000",reset:function(){this.jsdraw={bkcolor:"#e1e1e1",bkimg:scil.Utils.imgSrc("img/hbg.gif"),toolbarbk:scil.Utils.imgSrc("img/toolbarbk.jpg"),hovercolor:"#eef",btnselcolor:"#bbf"};this.jssdf={bgcolor:"#eee",headerimg:scil.Utils.imgSrc("img/header-bg.gif"),headercolor:"#ddd",rowcolor:"#f96",oddcolor:"",evencolor:"#eee",border:"solid 1px #ccc"};scilligence.apply(this.jssdf,this.jsdraw);this.menu={boxshadow:"5px 5px 15px 5px rgba(0,0,0,0.2)"};this.dialog={bkimg:scil.Utils.imgSrc("img/dlgheader.gif"),bkcolor:"#6badf6",border:"1px solid #4f6d81",boxshadow:"5px 5px 20px 8px rgba(0,0,0,0.5)"}},red:function(){this.jsdraw={bkcolor:"#ECCDDC",bkimg:scil.Utils.imgSrc("img/hbg-red.gif"),toolbarbk:scil.Utils.imgSrc("img/toolbarbk-red.jpg"),hovercolor:"#fCdDeC"};this.jssdf={bgcolor:"#F8CEE8",headerimg:scil.Utils.imgSrc("img/header-bgred.gif"),headercolor:"#F8CEE8",rowcolor:"#FfeEf8",oddcolor:"",evencolor:"#eee",border:"solid 1px #ccc"};scilligence.apply(this.jssdf,this.jsdraw);this.dialog={bkimg:scil.Utils.imgSrc("img/dlgheader-red.gif"),bkcolor:"#E7A6DF",border:"1px solid #4f6d81"}},green:function(){this.jsdraw={bkcolor:"#C7EEDF",bkimg:scil.Utils.imgSrc("img/hbg-green.gif"),toolbarbk:scil.Utils.imgSrc("img/toolbarbk-green.jpg"),hovercolor:"#d7fEeF"};this.jssdf={bgcolor:"#CCF8E8",headerimg:scil.Utils.imgSrc("img/header-bggreen.gif"),headercolor:"#CCF8E8",rowcolor:"#dCFff8",oddcolor:"",evencolor:"#eee",border:"solid 1px #ccc"};scilligence.apply(this.jssdf,this.jsdraw);this.dialog={bkimg:scil.Utils.imgSrc("img/dlgheader-green.gif"),bkcolor:"#95D09C",border:"1px solid #4f6d81"}},blue:function(){this.jsdraw={bkcolor:"#CDD0EC",bkimg:scil.Utils.imgSrc("img/hbg-blue.gif"),toolbarbk:scil.Utils.imgSrc("img/toolbarbk-blue.jpg"),hovercolor:"#dDe0fC"};this.jssdf={bgcolor:"#DCDFF6",headerimg:scil.Utils.imgSrc("img/header-bgblue.gif"),headercolor:"#DCDFF6",rowcolor:"#eCeFFf",oddcolor:"",evencolor:"#eee",border:"solid 1px #ccc"};scilligence.apply(this.jssdf,this.jsdraw);this.dialog={bkimg:scil.Utils.imgSrc("img/dlgheader-blue.gif"),bkcolor:"#8BB6CC",border:"1px solid #4f6d81"}},yellow:function(){this.jsdraw={bkcolor:"#ECECCD",bkimg:scil.Utils.imgSrc("img/hbg-yellow.gif"),toolbarbk:scil.Utils.imgSrc("img/toolbarbk-yellow.jpg"),hovercolor:"#fCfCdD"};this.jssdf={bgcolor:"#F4F4E1",headerimg:scil.Utils.imgSrc("img/header-bgyellow.gif"),headercolor:"#F4F4E1",rowcolor:"#F4F4B8",oddcolor:"",evencolor:"#eee",border:"solid 1px #ccc"};scilligence.apply(this.jssdf,this.jsdraw);this.dialog={bkimg:scil.Utils.imgSrc("img/dlgheader-yellow.gif"),bkcolor:"#C8BA8F",border:"1px solid #4f6d81"}},menu:{highlightcolor:"#c60",color:"blue"},form:{labelstyles:{textAlign:"right",verticalAlign:"top",whiteSpace:"nowrap",color:"#666"},fieldcolor:"blue",rowselectcolor:"#aaf",spacing:5},table:{spacing:5,cell:"grid"},login:{background:"#ddd",opacity:.8}};JSDraw2.Skin.reset();scil.Menu={timeout:scilligence.Utils.isTouch||window.navigator.msPointerEnabled?2e3:500,closetimer:0,menuitem:null,isOpen:function(){return scil.Menu.menuitem!=null&&scil.Menu.menuitem.style.display!="none"},open:function(n,t){if(scil.Menu.cancelclosetime(),scil.Menu.menuitem&&(scil.Menu.menuitem.style.display="none"),scil.Menu.menuitem=document.getElementById(n),scil.Menu.menuitem.style.display="",t!=null){var i=scil.Utils.getOffset(t,!0,!0);scil.Menu.menuitem.style.margin="";scil.Menu.menuitem.style.top=i.y-(i.absolute!=null?i.absolute.y:0)+t.offsetHeight+"px";scil.Menu.menuitem.style.left=i.x-(i.absolute!=null?i.absolute.x:0)+t.offsetWidth/2-scil.Menu.menuitem.offsetWidth/2+"px"}},close:function(){scil.Menu.menuitem&&(scil.Menu.menuitem.style.display="none")},openOrClose:function(n){scil.Menu.menuitem==null||scil.Menu.menuitem.style.display=="none"?this.open(n):this.close()},closetime:function(){scil.Menu.closetimer=window.setTimeout(scil.Menu.close,scil.Menu.timeout)},cancelclosetime:function(){scil.Menu.closetimer&&(window.clearTimeout(scil.Menu.closetimer),scil.Menu.closetimer=null)}};JSDraw2.Menu=scil.Menu;scil.Dialog=scil.extend(scil._base,{constructor:function(n,t,i){this.options=i==null?{}:i;this.lang=this.options.lang==null?scil.Lang:this.options.lang;this.id=this.options.id;(this.id==null||this.id=="")&&(scil.Dialog._idincrease==null&&(scil.Dialog._idincrease=0),this.id="__jsdialog"+ ++scil.Dialog._idincrease);scil.Dialog._allitems==null&&(scil.Dialog._allitems={});scil.Dialog._allitems[this.id]=this;this.parentWindow=this.options.parentWindow==null?window:this.options.parentWindow;this.body=t;this.title=n;this.WRAPPER="content";this.dialog=null;this.dialogmask=null;this.movingSt=null;this.__isdialog=!0},isVisible:function(){return this.dialog!=null&&this.dialog.style.display!="none"},isFrom:function(n){return this.isVisible()?scil.Utils.isChildOf(n,this.dialog):!1},show2:function(n){n==null&&(n={});this.show(n.title,n.zindex,n.modal,n.immediately,n.owner)},show:function(n,t,i,r,u){var o,f,e;if(this.owner=u,this.isVisible()){n!=null&&this.dialog.titleElement!=null&&(this.dialog.titleElement.innerHTML=this.lang.res(n));return}i==null&&(i=this.options.modal==null?!0:this.options.modal);this.dialog==null&&this._create();this.movingSt=null;n!=null&&this.dialog.titleElement!=null&&this.setTitle(n);o=scil.Utils.getMaxZindex();JSDraw2.defaultoptions.minDlgZindex>0&&o<JSDraw2.defaultoptions.minDlgZindex&&(o=JSDraw2.defaultoptions.minDlgZindex);f=t==null?o+10:t;this.dialog.style.display="";this.dialogmask.style.display="";this.dialogmask.style.minHeight="100%";this.dialogmask.style.minWidth="100%";e=scil.Utils.getBox();this.dialogmask.style.width=Math.max(e.w,e.dw)+"px";this.dialogmask.style.height=Math.max(e.h,e.dh)+"px";f>0&&(this.dialogmask.style.zIndex=f+1,this.dialog.style.zIndex=f+2);i||(this.dialog.style.zIndex=f+1,this.dialogmask.style.display="none");this.dialog.style.borderColor=i?"#fff":JSDraw2.Skin.dialog.bkcolor;this.dialog.style.display="";this.moveCenter();scil.Dialog.stack.push(this);this._scilform&&this.form!=null&&this.form.fields!=null&&this.form.focus();!r&&scil.Dialog.animation&&scil.Animation.zoomin(this.dialog,1e3)},setTitle:function(n){this.dialog.titleElement.innerHTML=this.lang.res(n)},moveCenter:function(n,t){this.dialog.style.width="200px";this.updateWidth();var i=scil.Utils.getBox(),f=i.w,e=i.h,r=i.l,u=i.t,o=this.dialog.offsetWidth,s=this.dialog.offsetHeight,h=Math.round(u+(e-s)/2),c=Math.round(r+(f-o)/2);t==null?t=Math.max(u,h):t+=scil.Utils.getScrollOffset(this.dialog).y;n==null?n=Math.max(r,c):n+=scil.Utils.getScrollOffset(this.dialog).x;scil.style(this.dialog,{top:t+"px",left:n+"px"});this.scroll();this.applySize()},_create:function(){var t,i,e,c,u,o,s;if(this.dialog==null){var n=this,r=this.parentWindow.document.body,h=200,f=scilligence.Utils.createTable(r,0,0,{position:"absolute",borderRadius:JSDraw2.Skin.kBorderRadius,zIndex:h,backgroundColor:JSDraw2.Skin.dialog.bkcolor,boxShadow:JSDraw2.Skin.dialog.boxshadow});this.dialog=f.parentNode;this.dialog.setAttribute("__scilligence_dlg",this.id);this.options.borderstyle!=null&&scil.apply(this.dialog.style,this.options.borderstyle);e="0";this.options.notitle?e="5px":(t=scilligence.Utils.createElement(f,"tr",null,{height:"40px"}),i=scilligence.Utils.createElement(t,"td",this.lang.res(this.title),{paddingLeft:"10px",fontWeight:"bold",color:scil.App==null||scil.App.config==null?"":scil.App.config.text}),this.dialog.titleElement=i,i=scilligence.Utils.createElement(t,"td",null,{textAlign:"right",verticalAlign:"top"}),this.options.noclose||(c={width:"50px",height:"16px",background:"#ccc",padding:"3px",borderRadius:"0 0 8px 8px",fill:"#fff"},u=scil.icon(i,"del",{cursor:"pointer",marginRight:"15px",borderRadius:"0 0 5px 5px",svgstyles:c},{title:JSDraw2.Language.res("Close")}),scil.connect(scilligence.Utils.isIpad?i:u,"onclick",function(t){n.hide();t.preventDefault()}),scil.connect(u.firstChild,"onmouseover",function(){u.firstChild.style.background="#eee"}),scil.connect(u.firstChild,"onmouseout",function(){u.firstChild.style.background="#ccc"})),this.options.movable!=!1&&(scilligence.Utils.isTouch?(scil.connect(t,"ontouchstart",function(t){t.touches.length==1&&n.startMove(t.touches[0])}),scil.connect(r,"ontouchmove",function(t){if(t.touches.length==1&&n.move(t.touches[0]))return t.preventDefault(),!1}),scil.connect(r,"ontouchend",function(){n.endMove()})):(t.style.cursor="move",scil.connect(t,"onmousedown",function(t){n.startMove(t)}),scil.connect(r,"onmousemove",function(t){n.move(t)}),scil.connect(r,"onmouseup",function(){n.endMove()}))));t=scil.Utils.createElement(f,"tr");i=scil.Utils.createElement(t,"td",null,{padding:e+" 5px 5px 5px"});i.colSpan=2;o={background:"#fff",padding:"5px"};this.options.bodystyle!=null&&scil.apply(o,this.options.bodystyle);this.divbody=scil.Utils.createElement(i,"div",null,o);typeof this.body=="string"?this.divbody.innerHTML="<div>"+this.body+"<\/div>":this.divbody.appendChild(this.body);this.applySize();s=this.options.opacity>0?this.options.opacity:35;this.dialogmask=scilligence.Utils.createElement(r,"div",null,{position:"absolute",top:0,left:0,minHeight:"100%",height:"100%",width:"100%",background:"#999",opacity:s/100,filter:"alpha(opacity="+s+")",zIndex:h-1});scil.connect(window,"onresize",function(){n.resize()});scil.connect(window,"onscroll",function(){n.scroll()})}},applySize:function(){var n=scil.Utils.getBox(),t,i;n.w-=30;n.h-=50;this.options.notitle&&(n.h-=20);t=this.options.width;i=this.options.height;t>0&&t>n.w&&(t=n.w);i>0&&i>n.h&&(i=n.h);t>0&&(this.divbody.style.width=t+"px");i>0&&(this.divbody.style.height=i+"px");this.divbody.style.maxWidth=n.w+"px";this.divbody.style.maxHeight=n.h+"px";this.divbody.style.overflow="auto"},scroll:function(){if(this.isVisible()&&this.dialogmask!=null&&this.dialogmask.style.display!="none"){var n=scil.Utils.getBox(),t=Math.max(n.w+n.l,this.dialog.offsetLeft+this.dialog.offsetWidth),i=Math.max(n.h+n.t,this.dialog.offsetTop+this.dialog.offsetHeight);this.dialogmask.offsetWidth<=t&&(this.dialogmask.style.width=t+"px");this.dialogmask.offsetHeight<=i&&(this.dialogmask.style.height=i+"px")}},resize:function(){this.scroll()},moveTo:function(n,t){scil.Utils.moveToScreen(n,t,this.dialog)},startMove:function(n){this.movingSt=null;var t=n.srcElement||n.target;t.tagName!="IMG"&&(this.movingSt=new JSDraw2.Point(n.clientX,n.clientY))},move:function(n){if(this.movingSt==null||(n.which||n.button)!=1)return!1;var t=new JSDraw2.Point(n.clientX-this.movingSt.x,n.clientY-this.movingSt.y),i=scilligence.Utils.parsePixel(this.dialog.style.top)+t.y,r=scilligence.Utils.parsePixel(this.dialog.style.left)+t.x;return this.moveTo(r,i),this.movingSt=new JSDraw2.Point(n.clientX,n.clientY),!0},endMove:function(){this.movingSt=null},updateWidth:function(n){n>0||(n=this.dialog.firstChild.firstChild.offsetWidth);this.dialog.style.width=n+2+"px"},hide:function(n){if(this.options.onhide!=null&&this.options.onhide(),this.form!=null&&this.form._onhidedlg!=null&&this.form._onhidedlg(),!n&&scil.Dialog.animation){var t=this;scil.Animation.zoomout(this.dialog,1e3,function(){t.close()})}else this.close();scil.Dialog.stack.pop();scil.AutoComplete.hideAll()},close:function(){this.dialog!=null&&(this.dialog.style.display="none",this.dialogmask.style.display="none",this.dialogmask.style.width="0px",this.dialogmask.style.height="0px")}});scil.apply(scil.Dialog,{animation:!1,stack:[],keydown:function(n){n.keyCode==27&&this.stack.length>0&&this.stack[this.stack.length-1].hide()},get:function(n){return scil.Dialog._allitems==null&&(scil.Dialog._allitems={}),scil.Dialog._allitems[n]},getDialog:function(n){for(var t,i;n!=null;){if(t=scil.Utils.getParent(n,"TABLE"),t==null)return null;if(i=t.getAttribute("__scilligence_dlg"),i!=null)return this.get(i);n=t.parentNode}return null},create:function(n,t){var u=scil.Utils.createElement(null,"div"),e=scil.Utils.createElement(u,"div"),i=null,r,f;if(t!=null)if(i=scil.Utils.createElement(u,"div",null,{marginTop:"10px"}),t>0)for(r=0;r<t.length;++r)scil.Uti.createButton(i,t[r]);else scil.Uti.createButton(i,t);return f=new scil.Dialog(n,u),{dlg:f,area:e,control:i}}});scil.onload(function(){scil.connect(document.body,"onkeydown",function(n){scil.Dialog.keydown(n)})});JsDialog=JSDraw2.Dialog=scil.Dialog;scil.ColorPicker=scil.extend(scilligence._base,{constructor:function(n,t){if(typeof n=="string"&&(n=document.getElementById(n)),this.input=n,this.input.style.border="solid 1px gray",n.readOnly=!0,!t){var i=this;scil.connect(n,"onclick",function(){scil.ColorPicker.show(function(n){i.setValue(n)})})}},setValue:function(n){typeof n!="string"&&(n="");this.input.style.backgroundColor=n;this.input.value=n}});scil.apply(scil.ColorPicker,{dlg:null,callback:null,width:700,show:function(n){this.callback=n;this.create();this.dlg.show()},select:function(n){var t=n.target||n.srcElement;t.tagName=="TD"&&(this.callback!=null&&this.callback(t.title),this.dlg.hide())},create:function(n){var t,c,e,o,i,s,v;if(this.dlg==null){n>0||(n=5);var l=scil.Utils.createElement(null,"div",null,{width:"700px"}),h=Math.round(256/n),u=Math.round(this.width/n/n)+"px",a="2px",f=scil.Utils.createTable(l),r=null;for(t=0;t<256;t+=h){for(c=scil.Utils.createElement(f,"tr"),e=0;e<256;e+=h)for(o=0;o<256;o+=h)i="#"+scil.Utils.padLeft(t.toString(16),2,"0")+scil.Utils.padLeft(e.toString(16),2,"0")+scil.Utils.padLeft(o.toString(16),2,"0"),r=scil.Utils.createElement(c,"td","&nbsp;",{background:i,width:u,height:u,fontSize:a,cursor:"pointer"},{title:i});i="#"+scil.Utils.padLeft(t.toString(16),2,"0")+scil.Utils.padLeft(t.toString(16),2,"0")+scil.Utils.padLeft(t.toString(16),2,"0");r=scil.Utils.createElement(c,"td","&nbsp;",{background:i,width:u,height:u,fontSize:a,cursor:"pointer"},{title:i})}scil.Utils.unselectable(f.parentNode);s="#ffffff";r.style.color=s;r.style.background=s;r.title=s;f.parentNode.setAttribute("align","center");v=this;scil.Utils.connect(f,"onclick",function(n){v.select(n)});this.dlg=new scil.Dialog(scil.Utils.res("Choose Color"),l)}}});JSDraw2.ColorPicker=scil.ColorPicker;scil.ColorPicker2=scil.extend(scilligence._base,{constructor:function(n,t){if(typeof n=="string"&&(n=document.getElementById(n)),this.options=t==null?{}:t,this.input=n,this.disablepopup=!1,this.input.style.border="solid 1px gray",this.input.readOnly=!0,!this.options.viewonly){var i=this;scil.connect(n,"onclick",function(){scilligence.ColorPicker2.show(i)})}},setValue:function(n){typeof n!="string"&&(n="");this.input.style.boxSizing="border-box";this.input.style.backgroundColor=n;this.input.value=n},getValue:function(){return this.input.value},show:function(){scilligence.ColorPicker2.show(this)},hide:function(){scilligence.ColorPicker2.hide()}});scilligence.apply(scilligence.ColorPicker2,{cellwidth:8,rows:5,dropdown:null,area:null,title:null,dp:null,show:function(n){var t,i;n.disablepopup||(this.create(),this.dp=n,t=scil.Utils.getZindex(n.input),this.dropdown.style.zIndex=t==null?10:t+1,scil.ColorPicker2.dropdown.style.display="",i=JsUtils.getOffset(n.input,!1),scil.ColorPicker2.dropdown.style.left=i.x+"px",scil.ColorPicker2.dropdown.style.top=i.y+n.input.offsetHeight+"px")},hide:function(){scilligence.ColorPicker2.dropdown!=null&&(scilligence.ColorPicker2.dropdown.style.display="none",this.dp!=null&&this.dp&&this.dp.input.focus());this.dp=null},isDropdownVisible:function(){return scilligence.ColorPicker2.dropdown!=null&&scilligence.ColorPicker2.dropdown.style.display!="none"},clickOut:function(n){var i=n.srcElement||n.target,t;(this.dp==null||i!=this.dp.input)&&(t=JsUtils.getParent(i,"TBODY"),t!=this.area&&t!=this.header&&this.hide())},create:function(){var s,h,n,u,f,e,t,o;if(this.dropdown==null){s=this;scil.connect(document,"onclick",function(n){s.clickOut(n)});h=scil.Utils.createTable(document.body,0,1,{border:JSDraw2.Skin.dialog.border,backgroundColor:JSDraw2.Skin.dialog.bkcolor,textAlign:"center",display:"none",position:"absolute"});this.dropdown=h.parentNode;scil.connect(this.dropdown,"onclick",function(n){s.select(n.srcElement||n.target)});var c=JsUtils.createElement(JsUtils.createElement(h,"tr"),"td",null,{padding:"5px"}),r=scil.Utils.createTable(c,0,0,{backgroundColor:"#fff"}),i=Math.round(256/this.rows),u=scil.Utils.createElement(r,"tr");for(n=0;n<256;n+=i)t="#"+scil.Utils.padLeft(n.toString(16),2,"0")+scil.Utils.padLeft(n.toString(16),2,"0")+scil.Utils.padLeft(n.toString(16),2,"0"),scil.Utils.createElement(u,"td","&nbsp;",{background:t,width:this.cellwidth,height:this.cellwidth,fontSize:"1px",cursor:"pointer"},{title:t,colSpan:4});for(scil.Utils.createElement(u,"td","&nbsp;",{background:"#eee",height:this.cellwidth,fontSize:"1px",cursor:"pointer",backgroundImage:"url(data:image/png;base64,R0lGODlhBgAGAIAAAP///39/fyH5BAAAAAAALAAAAAAGAAYAAAIKjIEWCMrs0pGhAAA7)"},{nocolor:1,title:"No Color",colSpan:i-this.rows*4}),n=0;n<256;n+=i)for(u=scil.Utils.createElement(r,"tr"),f=0;f<256;f+=i)for(e=0;e<256;e+=i)t="#"+scil.Utils.padLeft(n.toString(16),2,"0")+scil.Utils.padLeft(f.toString(16),2,"0")+scil.Utils.padLeft(e.toString(16),2,"0"),td=scil.Utils.createElement(u,"td","&nbsp;",{background:t,width:this.cellwidth,height:this.cellwidth,fontSize:"1px",cursor:"pointer"},{title:t});scil.Utils.unselectable(r.parentNode);o="#ffffff";td.style.color=o;td.style.background=o;td.title=o;r.parentNode.setAttribute("align","center")}},select:function(n){if(n.tagName=="TD"&&n.style.cursor=="pointer"){this.dp.setValue(n.getAttribute("nocolor")=="1"?"":n.title);try{if(this.dp.input.onchange!=null&&this.dp.input.onchange(),"createEvent"in document){var t=document.createEvent("HTMLEvents");t.initEvent("change",!1,!0);this.dp.input.dispatchEvent(t)}else this.dp.input.fireEvent("onchange")}catch(n){}this.hide()}}});scil.ContextMenu=scil.extend(scil._base,{constructor:function(n,t,i,r,u){this.document=r==null?document:r;this.tbody=null;this.callback=t;this.submenus={};this.items=n;this.cur=null;this.parentMenu=i;this.obj=null;this.lang=u!=null?u:scil.Lang},isFrom:function(n){if(this.tbody==null)return!1;if(scil.Utils.isChildOf(n,this.tbody.parentNode))return!0;for(var t in this.submenus)if(this.submenus[t].isFrom(n))return!0;return!1},show:function(n,t,i,r,u){this.hide();this._create(r);this.obj=i;var e=scil.Utils.getMaxZindex(),f=this.tbody.parentNode;f.style.display="";f.style.zIndex=e>0?e+1:100;scil.Utils.moveToScreen(n,t,f,u)},hide:function(n){if(this.tbody==null||this.tbody.parentNode.style.display=="none")return!1;this.tbody.parentNode.style.display="none";for(var t in this.submenus)this.submenus[t].hide();return this.setCur(null),n&&this.parentMenu!=null&&this.parentMenu.hide(n),!0},isVisible:function(){return this.tbody!=null&&this.tbody.parentNode.style.display!="none"},_create:function(n){if(n!=null&&(this.items=n),this.tbody==null){var t=this;this.tbody=scil.Utils.createTable(this.document.body,0,0,{position:"absolute",display:"none",backgroundColor:"#eee",color:"#000",border:"solid 1px #ddd",boxShadow:JSDraw2.Skin.menu.boxshadow});this.tbody.setAttribute("jspopupmenu","1");scil.connect(this.tbody.parentNode,"onmousedown",function(n){n.button!=2&&t.click(n)});scil.connect(this.tbody.parentNode,"onmouseover",function(n){t.hilit(n)});scil.connect(this.document.body,"onmousedown",function(n){t.clickOut(n)});this._createItems()}else n!=null&&this._createItems()},_createItems:function(){var t,n,i,r,u;for(scil.Utils.removeAll(this.tbody),t=0;t<this.items.length;++t)if(n=this.items[t],n=="-"){if(t==0||this.items[t-1]=="-"||t==this.items.length-1)continue;i=scil.Utils.createElement(this.tbody,"tr");scil.Utils.createElement(i,"td",null,{textAlign:"center",width:"20px",backgroundColor:"#f5f5f5"});scil.Utils.createElement(i,"td","<hr style='margin:0;padding:0'>",{padding:"0 2px 0 2px"}).colSpan=3}else{typeof n=="string"&&(n={caption:n});n.key==null&&(n.key=n.caption);var f=n.children!=null&&n.children.length>0,e=n.bg==null?"#fff":n.bg,i=scil.Utils.createElement(this.tbody,"tr",null,{backgroundColor:e},n.disabled?null:{menukey:n.key});scil.Utils.createElement(i,"td",n.checked?"&#10004;":null,{textAlign:"center",width:"20px",backgroundColor:"#f5f5f5"});r={padding:"1px 3px 1px 3px",color:n.disabled?"gray":""};u=n.nottranslate?n.caption:this.lang.res(n.caption);n.icon!=null&&(u="<img src='"+n.icon+"'>"+u);scil.Utils.createElement(i,"td",u,r);r.fontSize="75%";r.paddingLeft="10px";scil.Utils.createElement(i,"td",n.shortcut==null?"":n.shortcut,r);scil.Utils.createElement(i,"td",f?"&rsaquo;":null,{textAlign:"right",width:"30px",paddingRight:"5px"});f?this.submenus[n.key]=new scil.ContextMenu(n.children,n.callback==null?this.callback:n.callback,this,this.document):delete this.submenus[n.key]}},hilit:function(n){var t=scil.Utils.getParent(n.srcElement||n.target,"TR");t!=null&&t.getAttribute("menukey")!=null&&this.setCur(t)},setCur:function(n){var t,i,r;this.cur!=null&&(this.cur.childNodes[0].style.backgroundColor="#f5f5f5",this.cur.childNodes[1].style.backgroundColor="",this.cur.childNodes[2].style.backgroundColor="",this.cur.childNodes[3].style.backgroundColor="",t=this.submenus[this.cur.getAttribute("menukey")],t!=null&&t.hide());this.cur=n;n!=null&&(n.childNodes[0].style.backgroundColor="#aaf",n.childNodes[1].style.backgroundColor="#aaf",n.childNodes[2].style.backgroundColor="#aaf",n.childNodes[3].style.backgroundColor="#aaf",t=n==null?null:this.submenus[n.getAttribute("menukey")],t!=null&&(i=scil.Utils.getOffset(n.childNodes[3],!1),r=scil.Utils.getOffset(n.childNodes[0],!1),t.show(i.x+n.childNodes[3].offsetWidth+1,i.y,null,null,r.x)))},getCallbackObj:function(){return this.parentMenu==null?this.obj:this.parentMenu.getCallbackObj()},click:function(n){var t=scil.Utils.getParent(n.srcElement||n.target,"TR"),i=t==null?null:t.getAttribute("menukey");this.submenus[i]==null&&(i!=null&&this.callback!=null&&this.callback(i,this.getCallbackObj(),t.childNodes[0].innerHTML!=""),this.hide(!0),n.preventDefault())},clickOut:function(n){var t=scil.Utils.getParent(n.srcElement||n.target,"TBODY");(t==null||t.getAttribute("jspopupmenu")!="1")&&this.hide()}});scil.apply(scil.ContextMenu,{isFromContextMenu:function(n){var t=scil.Utils.getParent(n,"TBODY");return t!=null&&t.getAttribute("jspopupmenu")=="1"}});JSDraw2.ContextMenu=scil.ContextMenu;scil.Form=scil.extend(scil._base,{constructor:function(n){this.__formid=++scil.Form.__formid;this.options=typeof n=="boolean"?{viewonly:n}:n==null?{}:n;this.lang=this.options.lang==null?scil.Lang:this.options.lang;this.viewonly=this.options.viewonly;this.items=null;this.tbody=null;this.fields=null;this.buttons=null},destory:function(){this.items=null;scil.Utils.removeAll(this.tbody);this.tbody=null;this.fields=null;this.buttons=null},_onhidedlg:function(){var t,n;for(t in this.fields)(n=this.fields[t],n!=null)&&(n.jsd!=null&&n.jsd._onhidedlg!=null&&n.jsd._onhidedlg(),n.jss!=null&&n.jss._onhidedlg!=null&&n.jss._onhidedlg());this.resetRequiredFields()},getXml:function(n,t){var r=n?"":"<data>\n",u,i,f;for(u in this.fields)i=this.fields[u],f=scil.Form.getFieldData(i,this.items[u]),(t||!scil.Utils.isNullOrEmpty(f))&&(r+="<i n='"+scil.Utils.escXmlValue(u)+"'>",r+=i.stype=="jsdraw"||i.stype=="xdraw"||i.stype=="jsdraw.table"||i.stype=="jsdraw.se"||i.stype=="jsdraw.fm"||i.stype=="table"||i.stype=="plate"||i.stype=="plates"?f:scil.Utils.escXmlValue(f),r+="<\/i>\n");return n||(r+="<\/data>"),r},setXml:function(n){try{var t=scil.Form.xml2Json(n);this.setData(t)}catch(i){alert("Error raised when setting form data: "+i.message)}},getData:function(n){var u={},t,i,r;for(t in this.fields)i=this.fields[t],i!=null&&this.items[t].type!="rawfile"&&(r=scil.Form.getFieldData(i,this.items[t]),(n||!scil.Utils.isNullOrEmpty(r))&&(u[t]=r));return u},setData:function(n,t){var e,u,f,i,r;this.setDirty(!1);e=this.viewonly&&this.options.autohiderows&&!scil.Utils.isDictEmpty(n);for(u in this.fields)(f=this.fields[u],i=this.items[u],f!=null&&i!=null)&&(i.td1!=null&&this.autoHideRow(i.td1.parentNode,!1),r=null,n!=null&&(r=n[u],r==null&&i!=null&&(i.alternativekey!=null&&(r=n[i.alternativekey]),r==null&&i.was!=null&&(r=n[i.was]))),t?r!=null&&scil.Form.setFieldData(f,i,this.viewonly,r,n):scil.Form.setFieldData(f,i,this.viewonly,r,n),e&&i.type!="hidden"&&i.autohide!=!1&&i.td1!=null&&(t&&scil.Utils.isNullOrEmpty(r)&&(r=this.getFieldValue(u)),scil.Utils.isNullOrEmpty(r)&&this.autoHideRow(i.td1.parentNode,!0)));this.setDirty(!1)},showAllRows:function(){var t,n;for(t in this.fields)n=this.items[t],n!=null&&n.td1!=null&&this.autoHideRow(n.td1.parentNode,!1)},autoHideRow:function(n,t){if(n!=null)if(t)n.style.display!="none"&&(n.setAttribute("autohide",n.style.display),n.style.display="none");else{var i=n.getAttribute("autohide");i!=null&&(n.removeAttribute("autohide"),n.style.display=i)}},setFieldValue:function(n,t,i){var r=this.fields[n];scil.Form.setFieldData(this.fields[n],this.items[n],this.viewonly,t,i)},clear:function(){this.setData({})},onchange:function(n,t){if(n!=null){if(this.dirty=!0,this.options.onchange!=null)this.options.onchange(n,this,t);this.onformula(n.getAttribute("key"))}},onformula:function(n){for(var i=[n],u,t,r;i.length>0;){u=i[0];i.splice(0,1);for(t in this.items)(r=this.items[t].formula,t==n||scil.Utils.isNullOrEmpty(r))||r.indexOf("{"+u+"}")>=0&&this.updateValueByFormula(t)&&i.push(t)}},updateValueByFormula:function(n){var t,i,r;return this.items[n]==null?!1:(t=this.items[n].formula,scil.Utils.isNullOrEmpty(t))?!1:this.items[n].type=="jsdraw.table"?this.fields[n].jsd.applyFormula(t,this):(i=scil.Form.evalFormula(t,this),i==null)?!1:(r=this.getFieldValue(n),r==i)?!1:(this.setFieldValue(n,i),!0)},setDirty:function(n){this.dirty=n==null||n==!0?!0:!1},preventUnsaved:function(n){var t=this;scil.connect(window,"onbeforeunload",function(i){if(t.dirty){n==null&&(n="WARNING: Form data are not saved yet.");var r=scil.Lang.res(n);return i!=null&&(i.returnValue=r),r}})},switchForm:function(n){var i,t,r;if(this.options.alternativeforms==null)return!1;this.alternativeforms==null&&(this.alternativeforms={},this.alternativeforms[""]={tbody:this.tbody,fields:this.fields,items:this.items});this.alternativeforms[n]==null&&(i=this.options.alternativeforms[n],i!=null&&(this.render2(i,this.parent,this.renderoptions),this.alternativeforms[n]={tbody:this.tbody,fields:this.fields,items:this.items}));t=this.alternativeforms[n];t==null&&(t=this.alternativeforms[""]);this.tbody=t.tbody;this.fields=t.fields;this.items=t.items;for(r in this.alternativeforms)this.alternativeforms[r].tbody.parentNode.style.display=r==n?"":"none";return!0},selectrow:function(n){this.highlightrow(this.items[n])},onselectrow:function(n){var u=n.target||n.srcElement,i=scil.Utils.getParent(u,"TD"),r=null;for(var t in this.items)if(this.items[t]!=null&&(this.items[t].td1==i||this.items[t].td2==i)){r=this.items[t];break}this.highlightrow(r)},highlightrow:function(n){if(this.currentrow!=n&&(this.currentrow!=null&&(this.currentrow.td1.style.backgroundColor=this.currentrowbckcolor,this.currentrow.td2!=null&&(this.currentrow.td2.style.backgroundColor="")),n!=null&&(this.currentrowbckcolor=n.td1.style.backgroundColor,n.td1.style.backgroundColor=JSDraw2.Skin.form.rowselectcolor,n.td2!=null&&(n.td2.style.backgroundColor=JSDraw2.Skin.form.rowselectcolor)),this.currentrow=n,this.options.onselectrow!=null))this.options.onselectrow(n)},render:function(n,t,i){this.parent=n;this.renderoptions=i;this.render2(t,this.parent,this.renderoptions)},render2:function(n,t,i){var a=i==null?null:i.align,o=i==null?null:i.buttons,v=typeof i=="boolean"?i:i==null?!0:i.immediately!=!1,y,c,f,p,r,w,b,k,e,s,h,l,u;i!=null&&scil.apply(this.options,i);this.tbody=null;this.fields={};this.items={};this.buttons=[];for(u in n)(r=scil.clone(n[u]),r!=null)&&(this.items[u]=r,r.label==null&&r.caption!=null&&(r.label=r.caption),JSDraw2.Table!=null&&scil.Utils.indexOf(JSDraw2.Table.kNumberColumns,r.type)>=0&&(r.type="number",r.unit==null&&(r.unit=JSDraw2.Table.kDefaultUnits[r.type])));if(this.options.usepostform&&(y=JsUtils.createElement(t,"div","<form method='post' enctype='multipart/form-data'><\/form>"),this.postform=y.firstChild,t=this.postform),c=!1,f=this.options.cols,!(f>0)){f>1||(f=1);for(p in this.items)if(r=this.items[p],r.newcolumn){c=!0;break}else r.colspan>f&&(f=r.colspan)}if(w=this.options.backgroundcolor==null?scil.Form.kBackgroundColor:this.options.backgroundcolor,b=this.options.forecolor==null?scil.Form.kForeColor:this.options.forecolor,this.tbody=scil.Utils.createTable(t,JSDraw2.Skin.form.spacing,null,{backgroundColor:w,color:b}),c?this.columnLayout(i,v):this.classicLayout(i,v,f),this.options.onselectrow!=null&&(k=this,scil.connect(this.tbody.parentNode,"onclick",function(n){k.onselectrow(n)})),a!=null&&this.tbody.parentNode.setAttribute("align",a),o!=null)if(e=scil.Utils.createElement(this.tbody,"tr"),scil.Utils.createElement(e,"td","&nbsp;"),e=scil.Utils.createElement(this.tbody,"tr"),this.buttonTR=e,this.options.vertical||scil.Utils.createElement(e,"td"),s=scil.Utils.createElement(e,"td",null,{whiteSpace:"nowrap"},{colspan:this.options.colspan>1?this.options.colspan*2-1:null}),i.centerbuttons&&(s.style.textAlign="center"),o.length>0)for(h=0;h<o.length;++h)l=o[h],l==" "?scil.Utils.createElement(s,"span","&nbsp;"):this.buttons.push(scil.Utils.createButton(s,l,this.lang));else this.buttons.push(scil.Utils.createButton(s,o,this.lang));for(u in this.items)this.items[u]!=null&&this.items[u].type=="group"&&this.items[u].group!=null&&this.items[u].collapsed&&scil.Form.expand({target:this.items[u].group})},columnLayout:function(n,t){var r=[],h=0,o=0,c=null,s,u,i,e,f;for(s in this.items)if(u=this.items[s],typeof u!="function"){if(i=null,u.type!="hidden")if(u.type=="group"||u.colspan>1)i=scil.Utils.createElement(this.tbody,"tr"),r.push({item:u}),o=0;else if(u.newcolumn?(++o,o>h&&(h=o),i=r[r.length-1]!=null?r[r.length-1].item.td1.parentNode.nextSibling:this.tbody.childNodes[0]):o>0&&(i=c==null?null:c.nextSibling),i==null&&(i=scil.Utils.createElement(this.tbody,"tr")),i.childNodes.length<o*2)for(f=i.childNodes.length;f<o*2;++f)scil.Utils.createElement(i,"td");e=this.newField(u,i,t);e!=null&&(u.field=this.fields[s]=e,e.setAttribute("key",s),scil.Form.kSetID&&scil.Utils.isNullOrEmpty(e.id)&&(e.id="form"+this.__formid+"_"+s));e!=null&&this.options.onenter!=null&&e.tagName=="INPUT"&&this.connectKeyEnter(e,this.options.onenter);i!=null&&(c=i)}for(f=0;f<r.length;++f)r[f].item.td2!=null?r[f].item.td2.colSpan=(h+1)*2-1:r[f].item.td1.colSpan=(h+1)*2},classicLayout:function(n,t,i){var e=null,o=i,s=null,f,r,u;for(f in this.items)(r=this.items[f],typeof r!="function")&&(r.type=="group"?(e=scil.Utils.createElement(this.tbody,"tr"),o=i):(s==null||s.type!="group")&&e!=null&&i>1&&o<i?o+=r.colspan>0?r.colspan:1:(e=scil.Utils.createElement(this.tbody,"tr"),o=r.colspan>0?r.colspan:1),u=this.newField(r,e,t),u!=null&&(r.field=this.fields[f]=u,u.setAttribute("key",f),scil.Form.kSetID&&scil.Utils.isNullOrEmpty(u.id)&&(u.id="form"+this.__formid+"_"+f)),r.type=="group"&&i>1?r.td1.colSpan=i*2:r.colspan>1&&(r.td2.colSpan=(r.td2.colSpan>0?r.td2.colSpan:1)+(r.colspan-1)*2),u!=null&&this.options.onenter!=null&&u.tagName=="INPUT"&&this.connectKeyEnter(u,this.options.onenter))},post:function(n,t,i){var o,u,f,e,s,r;if(this.postform!=null){for(r in this.fields)o=this.fields[r],scil.Utils.isNullOrEmpty(o.getAttribute("name"))&&o.setAttribute("name",r);if(u=null,t!=null){f=this.getData();f==null&&(f={});u={};f.__updatemode&&(u.scilligencefileupdatemode="update");for(r in t)e=t[r],s=typeof e,e!=null&&s!="function"&&s!="object"&&scil.Utils.isNullOrEmpty(f[r])&&(u[r]=e)}for(r in u)scil.Utils.isNullOrEmpty(u[r])&&delete u[r];scil.Utils.ajaxUploadFile(this.postform,n,u,i)}},postForm:function(n,t,i){this.post(n,t,i)},checkRequiredFields:function(){var e,t,u,n,i,o,f;this.resetRequiredFields();e=this.fields;t=0;for(u in this.items)if((n=this.items[u],i=e[u],n!=null&&i!=null&&n.td1!=null)&&(n.td1.style.backgroundColor=JSDraw2.Skin.form.labelstyles.backgroundColor,n.type=="jsdraw.table"&&(t+=i.jsd.checkRequiredFields("all")),n.required)&&(this.originalStyles=[],o=scil.Form.getFieldData(i,n),scil.Utils.isNullOrEmpty(o,!0))){this.originalStyles.push(n.td2.firstChild.style);n.td2.firstChild.style.border="2px solid #ff4a4a";var r=n.td1.innerHTML.split("<")[0].replace(":","").toLowerCase(),h=r[0].match(/[aeiou]/)!=null,s=document.getElementById(r);s==null?(f=scil.Utils.createElement(n.td2,"div",`Please enter ${(h?"an ":"a ")+r}`,{color:"#ff4a4a",fontSize:"14px",fontWeight:"600"}),f.setAttribute("class","error"),f.setAttribute("id",r)):s.style.display="block";n.td2.firstChild.setAttribute("class","error");++t}return t},resetRequiredFields:function(){var e=this.fields,t,i,f,r,u,n;for(t in this.items)if((i=this.items[t],f=e[t],i!=null&&f!=null)&&i.td2!=null&&(r=document.getElementsByClassName("error"),r.length>1)){u=0;for(n of r)n.nodeName=="DIV"?n.style.display="none":this.originalStyles!=null&&(n.style=this.originalStyles[u],n.classList.remove("error")),u++}},connectKeyEnter:function(n,t){scil.connect(n,"onkeydown",function(i){i.keyCode==13&&(t(n),i.preventDefault())})},newField:function(n,t,i){var u=this,r=null;return(this.viewonly||(n.type=="jsdraw"||n.type=="xdraw"?(JSDraw2.defaultoptions!=null&&JSDraw2.defaultoptions.usexdraw&&(n.type="xdraw"),n.options!=null?n.options.ondatachange=function(){u.onchange(r)}:n.ondatachange=function(){u.onchange(r)}):(n.type=="jsdraw.table"||n.type=="jsdraw.se"||n.type=="jsdraw.fm"||n.type=="table"||n.type=="plate"||n.type=="plates"||n.type=="tabtext"||n.type=="multitext"||n.type=="richtext"||n.type=="plaintext"||n.type=="templatetext")&&(n.options!=null?n.options.onchange=function(n,t){u.onchange(r,t)}:n.onchange=function(n,t){u.onchange(r,t)})),r=this.newField2(n,t,i),r==null)?null:(this.viewonly||(r.tagName=="INPUT"||r.tagName=="TEXTAREA"?scil.connect(r,"onchange",function(){u.onchange(r)}):r.tagName!="SELECT"||JSDraw2.__touchmolapp||scil.connect(r,scil.Utils.isIE&&scil.Utils.isIE<9?"onclick":"onchange",function(){u.onchange(r)}),r.tagName=="INPUT"&&n.mobiledata!=null&&n.type!="number"&&new scil.MobileData(r,{category:n.mobiledata,url:scil.MobileData.getDefaultUrl(!1)})),r)},newField2:function(n,t,i){var e,s,r,u;if(t==null&&n.type=="hidden")return r=scil.Utils.createElement(this.parent,"div",null,{display:"none"}),u=scil.Form.createField(r,n,this.viewonly,n.value,null,i,null,this),u;if(e=scil.Utils.isNullOrEmpty(n.label)?"&nbsp;":this.lang.res(n.label)+(n.colon==!1||n.label=="-"?"":":"),n.type=="group"){this.tbody.childNodes.length>0&&(scil.Utils.createElement(scil.Utils.createElement(this.tbody,"tr"),"td","&nbsp;",{fontSize:"50%"},{colSpan:2}),t=scil.Utils.createElement(this.tbody,"tr"));var h=scil.App.config==null?"gray":scil.App.config.button,o=scil.App.config==null?"gray":scil.App.config.frame,f=scil.clone(JSDraw2.Skin.form.labelstyles);return scil.apply(f,{fontWeight:"bold",color:"#555",background:"",textAlign:"left",paddingLeft:"20px",borderBottom:"solid 1px "+h,color:o}),n.collapsible!=!1&&scil.apply(f,{backgroundImage:scil.SVG.asBackground("arrow2_down",o,!0),backgroundPosition:"left",backgroundRepeat:"no-repeat"}),r=scil.Utils.createElement(t,"td",e,f,{colSpan:2}),n.collapsible!=!1&&scil.connect(r,"onclick",function(n){scil.Form.expand(n)}),n.group=r,n.td1=r,null}return n.type=="note"?(r=scil.Utils.createElement(t,"td",null,null,{colSpan:2}),s=scil.Utils.createElement(r,"div",this.lang.res(n.label||n.str),n.style),n.color!=null&&(s.style.color=n.color),n.td1=r,null):(this.options.hidelabel||n.hidelabel?n.td1=scil.Utils.createElement(t,"td"):this.createLabel(n,t),this.options.vertical&&(t=scil.Utils.createElement(this.tbody,"tr")),r=scil.Utils.createElement(t,"td",n.leading,{width:n.tdwidth},{valign:"top"}),n.td2=r,u=scil.Form.createField(r,n,this.viewonly,n.value,null,i,null,this),n.type=="hidden"&&(t.style.display="none",t.setAttribute("hidden","1")),n.type=="number"&&(r.style.whiteSpace="nowrap"),u)},createLabel:function(n,t){if(t==null)return null;var i=scil.Utils.isNullOrEmpty(n.label)?"&nbsp;":this.lang.res(n.label)+(n.colon==!1||n.label=="-"?"":":");return n.required&&(i+="<span style='color:red' title='"+this.lang.res("Required")+"'>*<\/span>"),scil.Utils.isNullOrEmpty(n.icon)?(n.td1==null?n.td1=scil.Utils.createElement(t,"td",i,JSDraw2.Skin.form.labelstyles):n.td1.innerHTML=i,this.options.vertical&&(n.td1.style.textAlign="left")):(n.td1!=null?scil.Utils.removeAll(n.td1):n.td1=scil.Utils.createElement(t,"td"),scil.Utils.createElement(n.td1,"img",null,null,{src:n.icon}),scil.Utils.createElement(n.td1,"span",i)),n.labelstyle!=null&&scil.apply(n.td1.style,n.labelstyle),n.td1},setLabel:function(n,t){return this.items[n]==null?!1:(this.items[n].label=t,this.createLabel(this.items[n]),!0)},getFieldValue:function(n){return scil.Form.getFieldData(this.fields[n],this.items[n])},focus:function(n){scil.Form.focus(this.fields,n)}});scil.apply(scil.Form,{kSetID:!1,__formid:0,kAvoidXss:!0,kAuto:null,kBackgroundColor:"#fff",kDarkModeTextColor:"rgb(197, 197, 197)",kForeColor:"#333",focus:function(n,t){var r,f,i,u;if(n!=null){if(r=null,t==null){for(f in n)if(i=n[f],i!=null&&(i.tagName=="INPUT"||i.tagName=="TEXTAREA"||i.tagName=="SELECT")&&!i.disabled&&!i.readOnly&&(u=scil.Utils.getParent(i,"TR"),u!=null&&u.style.display!="none"&&!i.disabled)){r=i;break}}else r=n[t];if(r!=null&&r.style.dislay!="none"&&r.focus!=null)try{r.focus()}catch(e){}}},mergeForm:function(n,t){var r,i;if(n==null&&t==null)return null;if(r={},n==null){for(i in t)t[i]!=null&&(r[i]=t[i]);return r}if(t==null){for(i in n)n[i]!=null&&(r[i]=n[i]);return r}for(i in n)t[i]==null&&n[i]!=null&&(r[i]=n[i]);for(i in t)t[i]!=null?r[i]=t[i]:delete r[i];return r},createElement:function(n,t,i,r,u,f){return u!=null&&u.title!=null&&(u.title=scil.Lang.res(u.title)),scil.Utils.createElement(n,t,i,r,u,f)},expand:function(n){var i=n.target||n.srcElement;if(i.tagName=="TD"){var t=i.parentNode.nextSibling,r=t.style.display=="none",u=scil.App.config==null?"gray":scil.App.config.frame;for(i.style.backgroundImage=scil.SVG.asBackground(r?"arrow2_down":"arrow2_right",u,!0),i.style.borderBottomWidth=r?"1px":"2px";t!=null&&t.childNodes.length!=1&&t.getAttribute("buttonrow")!="1";)t.getAttribute("hidden")!="1"&&(t.style.display=r?"":"none"),t=t.nextSibling}},createField:function(n,t,i,r,u,f,e,o){var l="input",h=t.type,s,d,y,p,g,b,w,k,c,a,v;n!=null&&(h=="input"||h=="select"||h=="date"||h=="color"||h=="radio"||h=="checkbox"||h=="multiselect"||h==null)&&(n.style.whiteSpace="nowrap");i&&(h==null||h=="input"||h=="select"||h=="editableselect"||h=="htmltext"||h=="multiselect"||h=="dropdowninput"||h=="dropdowncheck"||h=="date")&&t.template==null&&(e||t.unit==null)&&(h="html");switch(h){case"":case"date":case"color":case"editableselect":case"dropdowninput":case"dropdowncheck":case"multiselect":l="input";break;case"hidden":l=t.render!=null?"div":"input";break;case"password":l="password";break;case"rawfile":l="file";break;case"number":l=i?"span":"input";break;case"htmltext":l="texarea";break;case"jsdraw":case"xdraw":case"jsdraw.fm":case"jsdraw.se":case"jsdraw.table":case"plate":case"plates":case"table":case"tabtext":case"multitext":case"richtext":case"plaintext":case"html":case"fileshelf":case"file":case"filepath":case"filelink":case"filedblink":case"subform":case"checklist":case"image":case"curve":case"sketches":case"code":case"signature":case"okta":case"azure":case"templatetext":case"plasmidmap":l="div";break;case"check3":l="span";break;case"button":l="button";break;case"postfile":l="file";break;case"user":l="input";t.autosuggesturl==null&&(t.autosuggesturl="Ajax.ashx?cmd=user.suggest");break;default:h!=null&&(l=h)}if(t.viewonly&&(i=t.viewonly),i&&l=="textarea"&&(l="div"),typeof n=="string"&&(n=scil.byId(n)),h=="checkbox"?(d=scil.Utils.createElement(n,"label",null,{whiteSpace:"nowrap"}),s=scil.Utils.createElement(d,l,null,t.style,t.attributes),t.str==null||o==null||e||scil.Utils.createElement(d,"span",o.lang.res(t.str)),!i&&scil.Utils.isTrue(t.value)&&(s.checked=!0)):(s=l=="svg"?scil.icon(n,t.svg,t.style,t.attributes):scil.Utils.createElement(n,l,null,t.style,t.attributes),i&&l=="div"&&(t.type=="htmltext"||t.type=="textarea")&&t.width!=null&&(t.style==null||t.style.maxWidth==null)&&(s.style.maxWidth=typeof t.width=="number"?t.width+"px":t.width,s.style.wordWrap="break-word")),t.type=="select"&&(scil.Form._getListItems(t),t.usegroup&&s.setAttribute("usegroup","1"),t.width!=null&&(t.width+=13)),l=="select")if(y=scil.Form._getListItems(t),y!=null){if(p=t.addblank,p==null)if(y.length==null){p=!0;for(g in y)if(y[g]==null||y[g]==""){p=!1;break}}else(y.length==0||y[0]!=null&&y[0]!="")&&(p=!0);p&&scil.Utils.listOptions(s,[""]);scil.Utils.listOptions(s,y,r,null,t.sort!=!1?!0:!1)}else(t.url||t.listurl)!=null&&scil.Form.listOptions(s,t.url||t.listurl,t.addblank,null,r);if(i)t.copytext&&(s.tagName=="DIV"&&(s.style.width="",s.style.display="inline"),this.createFieldButton(n,{svg:"copy",width:16,title:"Copy Text",onclick:function(){scil.Clipboard.copy(scil.Utils.getInnerText(s))}},o,s));else if(t.button!=null)if(t.buttonnewline==null&&s.tagName=="TEXTAREA"&&t.width>500&&(t.buttonnewline=!0),w=t.buttonnewline?scil.Utils.createElement(n,"div"):n,t.button.length>0)for(b=0;b<t.button.length;++b)this.createFieldButton(w,t.button[b],o,s);else this.createFieldButton(w,t.button,o,s);return t.button2!=null&&(t.buttonnewline==null&&s.tagName=="TEXTAREA"&&t.width>500&&(t.buttonnewline=!0),w=t.buttonnewline?scil.Utils.createElement(n,"div"):n,scil.Utils.createButton(n,t.button2)),e&&(e!="card"||scil.Utils.isNullOrEmpty(r))||t.str==null&&t.unit==null||h=="checkbox"||(t.fieldunit=scil.Utils.createElement(n,"span","&nbsp;"+(t.str||t.unit),{whiteSpace:"nowrap"})),e!="card"&&(k=e&&t.listwidth!=null?t.listwidth:t.width,k!=null&&k>0&&(s.style.width=k+"px")),t.height>0&&!(i&&l=="div"&&(t.type=="htmltext"||t.type=="textarea"))&&(s.style.height=t.height+"px"),t.align!=null&&(s.style.textAlign=t.align),i?l=="input"||l=="password"?(s.readOnly=!0,s.style.border="none"):(l=="checkbox"||l=="select")&&(s.disabled=!0):(t.readonly||t.viewonly)&&(l=="input"?s.readOnly=!0:(l=="checkbox"||l=="radio"||l=="select")&&(s.disabled=!0)),(l!="div"||h=="textarea"||h=="html")&&(s.style.color=JSDraw2.Skin.form.fieldcolor),s.stype=h,c=scil.clone(t),t.options!=null&&scil.apply(c,t.options),i&&(c.viewonly=i),h=="jsdraw"||h=="xdraw"?(a=function(){h=="xdraw"&&(s.style.height="");s.jsd=h=="jsdraw"||i?new JSDraw2.Editor(s,c):new scil.XDraw(s,c);scil.Utils.isNullOrEmpty(r)||scil.Form.setFieldData(s,t,i,r)},f?a():scil.ready(a)):h=="jsdraw.table"?(a=function(){if(s.jsd=new JSDraw2.Table(null,c,s),r!=null&&s.jsd.setXml(r),t.rows>0)for(var n=s.jsd.getRowCount();n<t.rows;++n)s.jsd.insert()},f?a():scil.ready(a)):h=="plasmidmap"?(a=function(){s.jsd=new scil.PlasmidMap(s,c);r!=null&&s.jsd.update(r)},f?a():scil.ready(a)):h=="plate"||h=="plates"?(a=function(){c.hidetable==null&&(c.hidetable=!0);s.jsd=h=="plate"?new JSDraw2.Plate(s,c):new JSDraw2.Plates(s,c);r!=null&&s.jsd.setXml(r)},f?a():scil.ready(a)):h=="jsdraw.se"?(a=function(){s.jsd=new JSDraw2.SequenceEditor(s,c);r!=null&&s.jsd.setXml(r)},f?a():scil.ready(a)):h=="jsdraw.fm"?(a=function(){s.jsd=new JSDraw2.Formulation(s,c);r!=null&&s.jsd.setXml(r)},f?a():scil.ready(a)):h=="table"?(s.jsd=new scil.Table(c),s.jsd.render(s,t.columns),r!=null&&s.jsd.setXml(r)):h=="tabtext"?(s.jsd=new scil.FieldTabText(s,c),r!=null&&s.jsd.setXml(r)):h=="multitext"?(s.jsd=new scil.FieldMultiText(s,c),r!=null&&s.jsd.setXml(r)):h=="code"?(s.style.marginBottom="4px",s.jsd=new scil.FieldCode(s,c),r!=null&&s.jsd.setValue(r)):h=="signature"?(s.jsd=new scil.FieldSignature(s,c),r!=null&&s.jsd.setValue(r)):h=="okta"?(s.jsd=new scil.FieldOKTA(s,c),r!=null&&s.jsd.setValue(r)):h=="azure"?(s.jsd=new scil.FieldAzure(s,c),r!=null&&s.jsd.setValue(r)):h=="richtext"?(s.jsd=new scil.FieldRichText(s,c),r!=null&&s.jsd.setXml(r)):h=="plaintext"?(s.jsd=new scil.FieldPlainText(s,c),r!=null&&s.jsd.setXml(r)):h=="subform"?(s.jsd=new scil.FieldSubform(s,c,this),r!=null&&s.jsd.setXml(r)):h=="checklist"?(s.jsd=new scil.FieldChecklist(s,c),r!=null&&s.jsd.setXml(r)):h=="check3"?(s.jsd=new scil.FieldCheck3(s,c),r!=null&&s.jsd.setValue(r)):h=="file"||h=="filelink"||h=="filedblink"||h=="filepath"||h=="image"?(h=="file"?s.jsd=new scil.FieldFile(s,c):h=="image"?s.jsd=new scil.FieldImage(s,c):(h=="filelink"||h=="filedblink"||h=="filepath")&&(c.cmd=h,s.jsd=new scil.FieldFileLink(s,c)),t.render!=null&&(r=t.render(r,u)),r!=null&&s.jsd.setXml(r)):h=="sketches"?(s.jsd=new scil.FieldSketches(s,c),t.render!=null&&(r=t.render(r,u)),r!=null&&s.jsd.setXml(r)):h=="fileshelf"?(s.jsd=new scil.FileShelf(s,c),r!=null&&s.jsd.list(r)):h=="curve"?(s.jsd=new scil.FieldCurve(s,c),r!=null&&s.jsd.setXml(r)):h=="number"?(s.jsd=new scil.FieldNumber(s,c),this.setFieldData(s,t,i,r,u)):h=="templatetext"?(s.jsd=new scil.FieldTemplateText(s,c),this.setFieldData(s,t,i,r,u)):h=="date"?(i||t.viewonly||new scil.DatePicker(s,t.options),r!=null&&r=="{today}"&&(r=scil.Utils.dateStr(new Date,!0,"yyyy-mm-dd")),this.setFieldData(s,t,i,r,u)):h=="color"?(s.jsd=new scil.ColorPicker2(s,{viewonly:i}),this.setFieldData(s,t,i,r,u)):h=="button"?s.innerHTML=t.text:(r!=null||h=="html"&&(t.template!=null||t.render!=null))&&this.setFieldData(s,t,i,r,u),t.type=="html"&&l=="div"&&(s.style.whiteSpace="nowrap"),t.title!=null&&s.setAttribute("title",t.title),t.onclick!=null&&scil.connect(s,"onclick",function(n){t.onclick(s,t,o,n)}),s.tagName=="INPUT"&&(t.onenter!=null?scil.connect(s,"onkeydown",function(n){if(n.keyCode==13){t.onenter(s);n.preventDefault()}}):scil.Utils.isIE&&scil.Utils.isIE<9&&scil.connect(s,"onkeydown",function(n){n.keyCode==13&&n.preventDefault()})),h=="password"&&scil.Form.encryptpasswordonblur&&scil.connect(s,"onblur",function(){s.value=JSDraw2.encryptpassword(s.value)}),t.autosuggesturl==null&&(t.autosuggesturl=t.autosuggest),t.autosuggesturl!=null&&t.autosuggesturl!=""&&s.tagName=="INPUT"&&(s.jsd=new scil.AutoComplete(s,t.autosuggesturl,t.options==null?t:t.options,e?null:o)),v=t.options,v==null&&(v={}),t.items!=null&&(v.items=t.items),t.url!=null&&(v.url=t.url),t.listurl!=null&&(v.url=t.listurl),t.autosuggest!=null&&(v.autosuggest=t.autosuggest),i||h!="editableselect"?i||h!="dropdowninput"?i||h!="dropdowncheck"?i||h!="multiselect"?i||h!="htmltext"||(c.buttons==null?c.buttons=[]:typeof c.buttons=="string"&&(c.buttons=[c.buttons]),c.extrabuttons!=null&&c.buttons.push(c.extrabuttons),r!=null&&r==""&&(s.value=r),scil.Richtext.initTinyMCE(s,c)):s.jsd=new scil.DropdownCheck(s,v):s.jsd=new scil.DropdownCheck(s,v):s.jsd=new scil.DropdownInput(s,v):s.jsd=new scil.EditableSelect(s,v),(s.tagName=="INPUT"||s.tagName=="SELECT"||s.tagName=="TEXTAREA")&&(t.onchange!=null&&scil.connect(s,"onchange",function(){t.onchange(s,o)}),t.onfocus!=null&&scil.connect(s,"onfocus",function(){t.onfocus(s,o)}),t.onblur!=null&&scil.connect(s,"onblur",function(){t.onblur(s,o)}),s.tagName!="INPUT"||i||(scil.Utils.isNullOrEmpty(t.placeholder)?o.options.labelinbox?s.setAttribute("placeholder",scil.Lang.res(t.label)):scil.Utils.isNullOrEmpty(t.autosuggesturl)||scil.Form.kAuto==null||s.setAttribute("placeholder",scil.Form.kAuto):s.setAttribute("placeholder",scil.Lang.res(t.placeholder)),s.setAttribute("autocomplete","off"))),t.padding>=0&&(s.tagName=="INPUT"||s.tagName=="DIV")&&(s.style.paddingLeft=s.style.paddingRight=t.padding+"px"),s.tagName=="INPUT"&&s.disabled!=!0&&t.type!="checkbox"&&t.type!="radio"&&scil.connect(s,"onfocus",function(){s.select()}),s.jsd!=null&&(s.jsd.parentform=o),t.style!=null&&scil.apply(s.style,t.style),s},createFieldButton:function(n,t,i,r){var u=scil.Utils.createButton(n,t);u!=null&&(t.dom=u,u.style.padding="",t.onclick2!=null?scil.connect(u,"onclick",function(){t.onclick2(r,i)}):t.ajaxurl!=null&&scil.connect(u,"onclick",function(){scil.Utils.ajax(t.ajaxurl,function(n){t.append!=null?r.value+=n+t.append:r.value=n},{q:r.value})}))},getFieldData:function(n,t){if(n==null||n.tagName=="INPUT"&&n.getAttribute("novalue")=="empty")return null;if(n.stype=="jsdraw")return t!=null&&t.dataformat!=null?n.jsd.getData(t.dataformat):n.jsd.getXml();if(n.stype=="xdraw"||n.stype=="jsdraw.se"||n.stype=="jsdraw.fm"||n.stype=="table"||n.stype=="plate"||n.stype=="plates")return n.jsd.getXml();if(n.stype=="jsdraw.table")return n.jsd.getRowCount()==0?null:n.jsd.getXml();if(n.stype=="plasmidmap")return null;if(n.type=="checkbox"||n.type=="radio")return n.checked;if(n.stype=="htmltext"){var i=scil.Form.getEd(n);return i==null?n.innerHTML:scil.Richtext.getHtml(i)}return n.stype=="file"||n.stype=="filelink"||n.stype=="filedblink"||n.stype=="filepath"||n.stype=="image"||n.stype=="curve"||n.stype=="sketches"?n.jsd.getXml():n.stype=="tabtext"||n.stype=="multitext"||n.stype=="richtext"||n.stype=="plaintext"||n.stype=="subform"||n.stype=="checklist"?n.jsd.getXml():n.stype=="code"?n.jsd.getValue():n.stype=="templatetext"?n.jsd.getValue():n.stype=="signature"?n.jsd.getValue():n.stype=="okta"?n.jsd.getValue():n.stype=="azure"?n.jsd.getValue():n.stype=="number"?n.jsd.getValue():n.stype=="check3"?n.jsd.getValue():n.type=="password"?n.value==""?"":t.encrypt!=!1&&JSDraw2.password!=null&&JSDraw2.password.encrypt&&JSDraw2.encryptpassword!=null?JSDraw2.encryptpassword(n.value):n.value:n.stype=="postfile"||n.stype=="button"?null:n.value==null&&n.getAttribute!=null?n.getAttribute("originalvalue"):n.value==""?null:scil.Form.kAvoidXss&&(n.tagName=="INPUT"||n.tagName=="TEXTAREA")&&t!=null&&!t.allowhtml?scil.Form._makeSafeHtml(n.value):n.value},_makeSafeHtml:function(n){return n==null||typeof n!="string"||n.indexOf("<")<0||n.indexOf(">")<0?n:n.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},setFieldData:function(n,t,i,r,u){var e,h,o,f,s;if(t!=null){if(!i&&t.viewonly&&(i=!0),i&&n.stype=="html"&&(t.type==null||t.type=="input"||t.type=="select")&&(r=this._makeSafeHtml(r)),e=r,t.render!=null?r=t.render(r,u):i&&n.jsd==null&&t.viewtemplate!=null&&(r=this.renderTemplate(t.viewtemplate,r,u)),i&&t.maxlength>0&&typeof r=="string"&&r.length>t.maxlength&&(r=r.substr(0,t.maxlength-3)+"..."),n.stype=="jsdraw"||n.stype=="xdraw"||n.stype=="jsdraw.table"||n.stype=="jsdraw.se"||n.stype=="jsdraw.fm"||n.stype=="plate"||n.stype=="plates"){if(n.stype=="jsdraw"||n.stype=="xdraw"||n.stype=="jsdraw.table"&&t.options!=null&&t.options.spreadsheet?n.jsd.clear(!0):n.jsd.clear(),t.type=="jsdraw")t.dataformat!=null?n.jsd.setData(r,t.dataformat):r==null||typeof r=="string"&&r==""||n.jsd.setXml(r);else if(r!=null&&r.rows!=null&&n.stype=="jsdraw.table"?n.jsd.setJson(r):r==null||typeof r=="string"&&r==""||n.jsd.setXml(r),n.stype=="jsdraw.table"&&t.options!=null&&t.options.spreadsheet&&n.jsd.createTable(),n.stype=="jsdraw.table"&&t.rows>0)for(h=n.jsd.getRowCount();h<t.rows;++h)n.jsd.insert()}else if(n.stype=="table")r!=null&&(typeof r=="string"||typeof r=="object"&&r.tagName=="table")?n.jsd.setXml(r):r!=null&&r.length>0?n.jsd.setData(r):n.jsd.setData([]);else if(t.type=="tabtext"||t.type=="multitext"||t.type=="richtext"||t.type=="plaintext")n.jsd.setXml(r);else if(t.type=="plasmidmap")n.jsd.update(r);else if(t.type=="checkbox"||t.type=="radio")n.checked=scil.Utils.isTrue(r);else if(t.type=="select")i?(o=scil.Form._getListItems(t),o!=null&&o.length==null&&(r=o[r]),this._setInnerHTML(n,r,e)):scil.Utils.selectOption(n,r);else if(t.type=="date")typeof r!="string"||scil.Utils.isNullOrEmpty(r)||isNaN(r)||(r=parseFloat(r),isNaN(r)&&(r=null)),f=t.timeformat==null?scil.Utils.dateStr(r,!0,t.dateformat):scil.Utils.timeStr(r,!0,t.timeformat),i?n.tagName=="INPUT"?n.value=f:this._setInnerHTML(n,f,e):n.value=f;else if(t.type=="templatetext")n.jsd.setValue(r);else if(t.type=="color")n.jsd.setValue(r);else if(n.stype=="code")n.jsd.setValue(r);else if(n.stype=="signature")n.jsd.setValue(r);else if(n.stype=="okta")n.jsd.setValue(r);else if(n.stype=="azure")n.jsd.setValue(r);else{if(n.stype=="number"||n.stype=="check3")return n.jsd.setValue(r);n.stype=="html"?(r!=null&&typeof r=="object"&&(e=r=scil.Utils.getOuterXml(r)),f=r==null?"":r,t!=null&&t.template!=null?f=this.renderTemplate(t.template,r,u):typeof f=="string"&&f.match(/^((http[s]?)|(ftp)):[\/]{2}.+$/i)!=null&&(f="<a target=_blank href='"+f+"'>"+f+"<\/a>"),this._setInnerHTML(n,f,t.noorignalvalue?null:e)):n.stype=="file"||n.stype=="filelink"||n.stype=="filedblink"||n.stype=="filepath"||n.stype=="image"||n.stype=="curve"||n.stype=="sketches"||n.stype=="subform"||n.stype=="checklist"?n.jsd.setXml(r):n.stype=="fileshelf"?n.jsd.list(r):t.type=="htmltext"?(r!=null&&typeof r=="object"&&(e=r=scil.Utils.getOuterXml(r)),i?this._setInnerHTML(n,n.innerHTML=r==null?"":r,e,!0,!0):(s=scil.Form.getEd(n),s!=null&&s.dom!=null?s.setContent(r==null?"":r):n.value=r==null?"":r)):n.stype=="textarea"?n.tagName=="TEXTAREA"?n.value=r==null?"":r:this._setInnerHTML(n,this.wrapTextarea(r),e,!0):n.stype!="div"&&n.stype!="button"&&(n.stype=="hidden"&&r!=null&&typeof r=="object"&&r.tagName!=null&&(r=scil.Utils.getOuterXml(r)),n.tagName=="INPUT"||n.tagName=="TEXTAREA"?n.value=r==null?"":r:n.tagName=="DIV"&&this._setInnerHTML(n,r==null?"":r,e))}if(t.onrendered!=null)t.onrendered(n,r)}},wrapTextarea:function(n){return n==null?"":"<pre style='margin:0;padding:0;white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; white-space: pre-wrap; word-wrap: break-word;'>"+scil.Utils.escapeHtml(n)+"<\/pre>"},disableInputs:function(n){var t=n.getElementsByTagName("input"),i;if(t!=null)for(i=0;i<t.length;++i)t[i].disabled=!0;return t==null?0:t.length},_setInnerHTML:function(n,t,i,r,u){t==null?t="":r&&(t+="<div style='clear:both'><\/div>");n.innerHTML=t;u&&this.disableInputs(n);i!=null&&i+""!=""?n.setAttribute("originalvalue",i):n.removeAttribute("originalvalue")},renderTemplate:function(n,t,i){var r,u;if((s=n.replace(/\{\?\}/g,t==null?"":t),i==null)||(r=s.match(/\{\{[a-z|0-9]+\}\}/ig),r==null))return s;for(u=0;u<r.length;++u){var f=r[u],o=f.substr(2,f.length-4),e=i[o];s=s.replace(f,e==null?"":e)}return s},listOptions:function(n,t,i,r,u){scil.Utils.jsonp(t,function(t){i&&scil.Utils.listOptions(n,[""]);var f=n.getAttribute("_value");scil.Utils.isNullOrEmpty(f)&&(f=u);scil.Utils.listOptions(n,t,f,!1,r);n.removeAttribute("_value")})},create:function(n,t,i,r,u){var h,f,s,e,o;if(typeof t=="string"&&(t=scil.byId(t)),h=scil.Utils.createElement(t,"div"),f=new scil.Form(u),f.render(h,i),r!=null)if(s=scil.Utils.createElement(f.tbody,"tr"),e=scil.Utils.createElement(s,"td"),e=scil.Utils.createElement(s,"td"),r.length==null)scil.Utils.createButton(e,r);else for(o=0;o<r.length;++o)scil.Utils.createButton(e,r[o]);if(n.load!=null)scil.onload(function(){n.load()});return f},createForm2:function(n,t,i,r){r==null&&(r={});var u=null;return i!=null&&(r.buttons=i),r.tabs!=null?u=new scil.TabbedForm(r).render(n):(u=new scil.Form(r),u.render(n,t,r)),u},_connetOnClick:function(n,t){scil.connect(n,"onclick",function(){t()})},createDlgForm:function(n,t,i,r){var f={},e,u;if(typeof r=="number"?(f.width=r+"px",r=null):r!=null&&r.width>0&&(f.width=r.width+"px"),e=scil.Utils.createElement(null,"div",null,f),u=new JSDraw2.Dialog(n,e,r),u.show2({immediately:!0,modal:r==null?null:r.modal}),u.form=this.createForm2(e,t,i,r),u._scilform=!0,u.moveCenter(),r!=null&&r.oncreated)r.oncreated(u.form);return u},createFormDlg:function(n,t,i,r){return this.createDlgForm(n,t,i,r)},createTabDlgForm:function(n,t){return this.createDlgForm(n,null,null,t)},createForm:function(n,t,i,r,u,f){var y={verticalAlign:"top",whiteSpace:"nowrap"},w={textAlign:"left"},l,p,c,s,h,b,o,v,a;for(r&&(y.border="solid 1px #f0f0f0",y.backgroundColor="#f5f5f5"),l=scil.Utils.createTable(),p=!1,o=0;o<n.length;++o)if(n[o].required){p=!0;break}for(p&&(s=scil.Utils.createElement(l,"tr"),scil.Utils.createElement(s,"td"),scil.Utils.createElement(s,"td","<span style='color:red;font-weight:bold'>* indicates required field<\/span>",w)),o=0;o<n.length;++o){var e=n[o],s=scil.Utils.createElement(l,"tr"),h=scil.Utils.createElement(s,"td",e.label+(e.required?"<b style='color:red'>*<\/b>":""),y);e.colspan?h.colSpan=2:(h=scil.Utils.createElement(s,"td",null,w),e.tag!=null&&(c=scil.Utils.createElement(h,e.tag),e.tag=="select"&&scil.Utils.listOptions(c,e.options),e.width!=null&&(c.style.width=e.width+"px"),e.height!=null&&(c.style.height=e.height+"px"),e.id!=null&&(c.id=e.id),e.tag=="hidden"&&(s.style.display="none"),e.align!=null&&(c.style.textAlign=e.align),e.id==f&&scil.connect(c,"onkeydown",function(n){n.keyCode==13&&(i(),n.preventDefault())})),e.span!=null&&scil.Utils.createElement(h,"span",e.span))}if(s=scil.Utils.createElement(l,"tr"),scil.Utils.createElement(s,"td","&nbsp;"),s=scil.Utils.createElement(l,"tr"),scil.Utils.createElement(s,"td"),h=scil.Utils.createElement(s,"td"),t!=null)if(typeof t=="string")a=scil.Utils.createElement(h,"button",t),scil.connect(a,"onclick",i);else if(t!=null&&typeof t=="object"&&t.length>0)for(b=[],o=0;o<t.length;++o)v=t[o],a=scil.Utils.createElement(h,"button",v.caption),v.id!=null&&(a.id=v.id),this._connetOnClick(a,v.onclick);return u!=null&&scil.Utils.createElement(h,"span",u),l.parentNode},fillForm:function(n,t){for(k in n){var i=scil.byId((t==null?"":t)+k);i!=null&&(i.tagName=="SELECT"?JsUtils.selectOption(i,n[k]):i.value=n[k]==null?"":n[k])}},collectFormData:function(n){for(var o,u,f,t,r={},e=n.getElementsByTagName("input"),i=0;i<e.length;++i){t=e[i];o=(t.getAttribute("type")+"").toLowerCase();switch(o){case"radio":case"checkbox":t.checked&&this._addValue(r,t.id,t.value==null||t.value.length==0?"true":t.value);break;case"button":break;default:this._addValue(r,t.id,t.value)}}for(u=n.getElementsByTagName("textarea"),i=0;i<u.length;++i)t=u[i],this._addValue(r,t.id,t.value);for(f=n.getElementsByTagName("select"),i=0;i<f.length;++i)t=f[i],this._addValue(r,t.id,t.value);return r},_addValue:function(n,t,i){if(t!=null&&t.length!=0){var r=t.lastIndexOf(".");r>0&&(t=t.substr(r+1));n[t]=i}},toAmount:function(n,t){return n==null||n==0?"-":n>=1e3?n/1e3+(t?"L":"kg"):n<.001&&t?n*1e6+"ug":n<1?n*1e3+(t?"uL":"mg"):n+(t?"mL":"g")},processAmount:function(n){n.amount>0||(n.amount=null);n.amountleft>0||(n.amountleft=null);var t=n.amount==null?n.amountleft:n.amount;t<=0&&(t=null);t===null?n.unit=n.isliquid?"L":"kg":t>=1e3?(n.amount/=1e3,n.amountleft/=1e3,n.unit=n.isliquid?"L":"kg"):t<.001&&!n.isliquid?(n.amount*=1e6,n.amountleft*=1e6,n.unit="ug"):t<1?(n.amount*=1e3,n.amountleft*=1e3,n.unit=n.isliquid?"uL":"mg"):n.unit=n.isliquid?"mL":"g"},setButtonValueByKey:function(n,t,i){if(n!=null)for(var r=0;r<n.length;++r)if(n[r].key==t){n[r].b.value=i==null?"":i;break}},setButtonOptionsByKey:function(n,t,i){var r,u;if(n!=null)for(r=0;r<n.length;++r)if(n[r].key==t){u=n[r].b.value;scil.Utils.listOptions(n[r].b,i,u,!0);break}},setButtonValuesByKey:function(n,t,i){for(var e,f,r,u=0;u<n.length;++u)(e=n[u].key,i[e])||(f=t==null?null:t[e],r=n[u].b,r!=null)&&(r.tagName=="INPUT"?r.value=f==null?"":f:r.tagName=="SELECT"&&scil.Utils.selectOption(r,f))},getButtonValueByKey:function(n,t){if(n==null)return null;for(var i=0;i<n.length;++i)if(n[i]!=null&&n[i].key==t&&n[i].b!=null)return n[i].b.value;return null},getButtonValuesByKey:function(n,t,i){i==null&&(i={});for(var r=0;r<t.length;++r)i[t[r]]=this.getButtonValueByKey(n,t[r]);return i},createToolbarButtons:function(n,t,i,r,u){var e,f;if(n!=null&&t!=null)for(e=null,r!=null&&(e=scil.Utils.createElement(scil.Utils.createTable2(n,null,{cellSpacing:0,cellPadding:0,align:r}),"tr")),f=0;f<t.length;++f)(f!=0&&t[f-1]!="-"&&t[f-1]!="|"||t[f]!="-"&&t[f]!="|")&&(t[f].imgheight==40&&(t[f].imgheight=25,t[f].padding==null&&(t[f].padding=8)),r!=null&&(n=scil.Utils.createElement(e,"td")),this._createButton(n,t[f],f==0?3:i,t[f]!=null&&u!=null&&u==t[f].label,r))},_createButton:function(n,t,i,r,u){var f,o,e,h,s;if(t!=null){if(t.padding!=null?i=t.padding:(typeof i!="number"||i<=0)&&(i=4),typeof t=="string"){scil.Utils.createElement(n,"span",t=="-"?"|":t,{marginLeft:i+"px",marginRight:i+"px"});return}t.label=="-"&&(t.colon=!1,i=0);r&&(scil.App.skin=="7.0"?(t.background="#fff",t.fill="#555",t.color="#555"):n.style.borderBottom="solid 3px white");t.label=scil.Lang.res(t.label);t.caption=scil.Lang.res(t.caption);t.title=scil.Lang.res(t.title);f=null;o=t.colon==!1?"":":";t.type=="select"?(t.label!=null&&(e=scil.Utils.createElement(n,"span",t.label+o,t.labelstyle),e.style.marginLeft=i+"px",i=0),f=scil.Utils.createElement(n,"select",null,t.styles,t.attributes),h=scil.Form._getListItems(t),s=t.url||t.listurl,s!=null?scil.Form.listOptions(f,s,t.addblank,t.sort,t.value):scil.Utils.listOptions(f,h,t.value,null,null,t.sort),t.onchange!=null&&scil.connect(f,"onchange",function(n){t.onchange(n)}),t.autoshrink==null&&(t.autoshrink=JSDraw2.Skin.toolbar.autoshrink),t.autoshrink>0&&scil.AutoShrink!=null&&new scil.AutoShrink(f,t,!0)):t.type=="input"||t.type=="date"||t.type=="color"||t.type=="editableselect"||t.type=="dropdowninput"||t.type=="multiselect"?(t.label!=null&&(e=scil.Utils.createElement(n,"span",t.label+o,t.labelstyle),e.style.marginLeft=i+"px",i=0),f=scil.Utils.createElement(n,"input",null,t.styles,t.attributes),t.onenter!=null&&scil.connect(f,"onkeydown",function(n){if(n.keyCode==13)t.onenter(f)}),t.onchange!=null&&scil.connect(f,"onchange",function(n){t.onchange(n)}),t.autosuggesturl!=null&&new scil.AutoComplete(f,t.autosuggesturl,{onsuggest:t.onsuggest}),t.type=="date"?new scil.DatePicker(f):t.type=="color"?new scil.ColorPicker2(f):t.type=="editableselect"?new scil.EditableSelect(f,t):t.type=="dropdowninput"?new scil.DropdownInput(f,t):t.type=="multiselect"&&new scil.DropdownCheck(f,t),t.value!=null&&(f.value=t.value),t.autoshrink==null&&(t.autoshrink=JSDraw2.Skin.toolbar.autoshrink),t.autoshrink>0&&new scil.AutoShrink(f,t,!0),scil.Utils.isNullOrEmpty(t.placeholder)?scil.Utils.isNullOrEmpty(t.autosuggesturl)||scil.Form.kAuto==null||f.setAttribute("placeholder",scil.Form.kAuto):f.setAttribute("placeholder",scil.Lang.res(t.placeholder))):(t.svg!=null&&t.label==null&&(t.width=20),f=scil.Utils.createButton(n,t));scil.App.skin=="7.0"?u=="right"?(f.style.marginLeft=i+"px",f.style.marginRight=i+"px"):(t.vertical||(f.style.marginLeft=i+"px"),f.style.marginTop=i+"px"):(f.style.marginLeft=i+"px",f.style.marginRight=i+"px");t.b=f;t.blabel=e;e!=null&&t.onclicklabel!=null&&(e.style.color="blue",e.style.cursor="pointer",e.style.textDecoration="underline",scil.connect(e,"onclick",function(n){t.onclicklabel(t,n)}))}},_isAllString:function(n){var t,i;if(n==null||typeof n!="object")return!1;if(n.length>0)return!0;t=0;for(i in n){if(typeof n[i]!="string")return!1;++t}return t>0},_getListItems:function(n){typeof n.items=="function"&&(n.items=n.items());var t=n.items;return t==null&&n.options!=null&&n.options.items!=null&&(t=n.options.items,n.items=t,n.options.items=null),t==null&&this._isAllString(n.options)&&(t=n.options,n.items=t,n.options=null),t!=null&&t.length>0&&n.addblank&&!scil.Utils.isNullOrEmpty(t[0])&&t.splice(0,0,""),t},getEd:function(n){return tinymce.get(n.id)},dict2formxml:function(n){return this.json2xml(n)},json2xml:function(n,t){var i,u,r;if(n==null)return null;i=t?"":"<data>\n";for(u in n)r=n[u],r!=null&&r!=""&&(i+="<i n='"+scil.Utils.escXmlValue(u)+"'>",i+=scil.Utils.escXmlValue(r),i+="<\/i>\n");return t||(i+="<\/data>"),i},xml2json:function(n){var i=null,u,o,f,t,e,r;if(typeof n=="object"?i=n:typeof n=="string"&&(u=scil.Utils.parseXml(n),u!=null&&(i=u.documentElement||u.firstElementChild)),i==null||i.childNodes==null)return null;for(o={},f=0;f<i.childNodes.length;++f)(t=i.childNodes[f],t.tagName=="i")&&(e=t.getAttribute("id"),e==null&&(e=t.getAttribute("n")),r=scil.Utils.getFirstElement(t),r!=null&&scil.Utils.isIE&&scil.Utils.isIE<9&&(r=r.xml),o[e]=r!=null?r:t.text||t.textContent);return o},evalFormula:function(n,t,i,r){var s,h,e,u,f,o,c;if(scil.Utils.isNullOrEmpty(n))return null;for(s=scil.Form.splitVars(n),h="",e=0;e<s.length;++e)u=s[e],scil.Utils.startswith(u,"{")&&scil.Utils.endswith(u,"}")&&(f=u.substr(1,u.length-2),f.substr(0,1)=="."?u=i.getCellValue(r,f.substr(1)):(o=t.items[f].type,u=o=="jsdraw.table"||o=="jsdraw"||o=="jsdraw.se"?"form.fields['"+f+"'].jsd":t.getFieldValue(f))),u=u.trim(),scil.Utils.endswith(u,"%")&&(c=u.substr(0,u.length-1),isNaN(c)||(u=parseFloat(c)/100)),h+=u;try{return eval(h)}catch(l){return null}},splitVars:function(n){for(var i=[],t;(t=n.indexOf("{"))>=0;){if(t>0&&(i.push(n.substr(0,t)),n=n.substr(t)),t=n.indexOf("}"),t<0)break;i.push(n.substr(0,t+1));n=n.substr(t+1)}return scil.Utils.isNullOrEmpty(n)||i.push(n),i},getFileIcon:function(n){var t=n.lastIndexOf("."),i=t>0?n.substr(t+1):n;switch(i){case"docx":case"rtf":case"doc":return"file-docx";case"pdf":return"file-pdf";case"pptx":case"ppt":return"file-pptx";case"xlsx":case"xlsm":case"xlsx":return"file-xlsx";case"csv":return"file-csv";case"mp4":case"wmv":case"avi":case"mov":return"file-movie";case"wav":case"mp3":return"file-audio";case"png":case"wmf":case"emf":case"bmp":case"svg":case"tif":case"tiff":case"jpeg":case"jpg":return"file-image";case"gz":case"zip":return"file-zip";case"jsd":case"jssdf":return"file-jsdraw";case"cdx":case"cdxml":case"tgf":case"skc":case"mrv":case"mol":case"rxn":return"file-mol";case"sd":case"sdf":return"file-sdf";case"txt":case"log":case"ini":return"file-txt";case"html":case"shtml":case"xhtml":case"cs":case"vb":case"cpp":case"c":case"aspx":case"asp":case"xml":case"py":case"pyc":case"config":return"file-code";default:return"file"}},ext2Icon:function(){return"unknown"}});scil.Form.xml2Json=scil.Form.xml2json;scil.AutoComplete=scil.extend(scilligence._base,{constructor:function(n,t,i,r){this.input=null;this.auto=null;this.url=t;this.sugid=0;this.disabled=!1;this.options=i==null?{}:i;this.form=r;var u=this;this.input=typeof n=="string"?document.getElementById(n):n;this.input.tagName=="INPUT"&&(scil.connect(this.input,"onkeyup",function(n){u.keydown(n)}),this.auto=scil.Utils.createElement(document.body,"div",null,{display:"none",overflowX:"hidden",overflowY:"auto",maxHeight:"400px",backgroundColor:"white",color:"black",border:"solid 1px gray",position:"absolute"}),scil.connect(document.body,"onmousedown",function(n){var t=n.srcElement||n.target;t==u.q||scil.Utils.isChildOf(t,u.auto)||t==u.auto||u.clickout()}),this.options.listedonly&&scil.connect(this.input,"onblur",function(){u.validateList()}));scil.AutoComplete._all.push(this)},validateList:function(){var n=this.input.value;(this.items==null||scil.Utils.indexOf(this.items,n)<0)&&(this.input.value="")},isVisible:function(){return this.auto!=null&&this.auto.style.display==""},hide:function(){this.auto!=null&&(this.auto.style.display="none")},keydown:function(n){var t,i,u,r;if(!this.disabled&&this.input!=null&&this.url!=null&&this.url!=""){if(this.input.value.length<1||n.keyCode==27||n.ctrlKey||n.metaKey){this.auto.style.display="none";return}if(this.isVisible()||n.keyCode!=13){if(n.keyCode==38||n.keyCode==40||n.keyCode==13){this.highlight(n);return}if(t=++this.sugid,scil.Utils.startswith(this.url,"data:"))i=this.filterlist(this.url.substr(5).split(","),this.input.value),this.list(i,t);else if(scil.Utils.startswith(this.url,"javascript:")){var f=this.url.substr(11),o=scil.Utils.eval(f),e=fun(this),i=this.filterlist(e,this.input.value);this.list(i,t)}else{if(u=this,r={q:this.input.value},this.options.onsuggest!=null)this.options.onsuggest(r,this.form,this);scil.Utils.jsonp(this.url,function(n){u.list(n.items==null?n:n.items,t)},r)}}}},filterlist:function(n,t){var r=[],i;if(t!=null&&t!=""&&n!=null)for(t=t.toLowerCase(),i=0;i<n.length;++i)n[i].toLowerCase().indexOf(t)>=0&&r.push(scil.Utils.trim(n[i]));return r},isParentHidden:function(n){for(var t=n;t!=null&&t.style!=null;){if(t.style.display=="none"||t.style.visibility=="hidden")return!0;t=t.parentNode}return!1},list:function(n,t){var i,r,u;if(n==null||n.length==0||t!=this.sugid||this.isParentHidden(this.input)){this.items=null;this.auto.style.display="none";return}for(this.auto.style.display!=""&&scil.AutoComplete.position(this.auto,this.input,this.options.minautowidth),this.items=n,scilligence.Utils.removeAll(this.auto),i=this,r=0;r<n.length;++r)u=scilligence.Utils.createElement(this.auto,"div",n[r]),scil.connect(u,"onclick",function(n){i.click(n)}),scil.connect(u,"onmouseover",function(n){i.mouseover(n)}),scil.connect(u,"onmouseout",function(n){i.mouseout(n)})},highlight:function(n){var r,i,u,f,t;if(this.auto!=null&&this.auto.style.display!="none"){if(n.preventDefault(),n.keyCode==27){this.hide();return}for(r=this.auto.childNodes,i=null,u=0;u<r.length;++u)if(f=r[u],f.getAttribute("sel")=="1"){i=u;break}if(n.keyCode==13){i!=null&&this.clickItem(r[i]);return}t=null;(n.keyCode==38||n.keyCode==40)&&(i==null?t=0:n.keyCode==38?(t=i-1,t<0&&(t=r.length-1)):(t=i+1,t>=r.length&&(t=0)),n.preventDefault());t!=null&&t!=i&&(i!=null&&this._hilitItem(r[i],!1),this._hilitItem(r[t],!0))}},mouseover:function(n){this._hilitItem(n.srcElement||n.target,!0)},mouseout:function(n){this._hilitItem(n.srcElement||n.target,!1)},_hilitItem:function(n,t){t?(n.style.backgroundColor="#ddf",n.setAttribute("sel","1")):(n.style.backgroundColor="white",n.removeAttribute("sel"))},getItemValue:function(n){var t=scil.Utils.unescXmlValue(n.innerHTML);return t=="&nbsp;"&&(t=""),t},click:function(n){var t=n.srcElement||n.target;this.clickItem(t)},clickItem:function(n){var t=this.getItemValue(n);if(this.options.onSetValue!=null)this.options.onSetValue(this.input,t);else this.options.overwrite=="unit"?this.input.value=this.changeUnit(this.input.value,t):this.options.overwrite==!1?this.input.value+=t:this.input.value=t;if(this.hide(),this.options.overwrite&&this.input.select(),this.input.focus(),this.options.onclickitem!=null)this.options.onclickitem(t);scil.Utils.fireEvent(this.input,"change",!1,!0)},clickout:function(){this.auto.style.display==""&&(this.auto.style.display="none")}});scil.apply(scil.AutoComplete,{_all:[],hideAll:function(){for(var n=0;n<this._all.length;++n)this._all[n].hide()},position:function(n,t,i){var u=scil.Utils.getOffset(t,!0,!0),f,r,e;n.style.position=u.fixedposition?"fixed":"absolute";f=scil.Utils.getZindex(t)+1;r=t.offsetWidth;i>0&&i>r&&(r=i);r<100&&(r=100);e=scil.Utils.isFixedPosition(t)?"fixed":"absolute";scil.style(n,{zIndex:f,position:e,display:"",width:r-2+"px",left:u.x+1+"px",top:u.y+t.offsetHeight+"px"})}});document.write('<style type="text/css">input._scil_dropdown::-ms-clear {display: none;}<\/style>');scil.DropdownInput=scil.extend(scilligence._base,{constructor:function(n,t){this.auto=null;this.options=t==null?{}:t;this.input=typeof n=="string"?document.getElementById(n):n;this.itemschanged=!0;this.sugid=0;this.suggestlength=this.options.suggestlength>0?this.options.suggestlength:1;this.options.autosuggest==""&&(this.options.autosuggest=null);var i=this;this.input.style.background="#fff "+scil.SVG.asBackground("arrow2_down",20,!0)+" no-repeat right center";this.input.style.border="solid 1px #999";this.input.style.padding="2px";this.input.className="_scil_dropdown";this.updateReadonly();scil.connect(this.input,"onkeyup",function(n){i.keyup(n)});scil.connect(this.input,"onclick",function(n){i.clickMe(n)})},updateDropdown:function(n){n!=null&&(this.options.readonly=n,this.updateReadonly());this.input.style.backgroundImage=this.options.items==null?"":scil.Utils.imgSrc("img/dropdown.gif",!0)},updateReadonly:function(){this.input.readOnly=this.options.readonly;this.input.style.backgroundColor=this.options.readonly?"#eee":"#fff"},keyup:function(n){var i,t,r,u;if(!this.disabled&&this.input!=null&&(this.options.autosuggest!=null||this.options.onFilter!=null||this.options.items!=null)){if(this.options.readonly){this.options.items!=null&&this.highlight(n);return}if(this.input.value.length<this.suggestlength||n.keyCode==9||n.keyCode==13){this.auto!=null&&(this.auto.style.display="none");return}if(i=++this.sugid,this.options.onFilter!=null)t=this.options.onFilter(this.input.value),this.list(t,i),this.itemschanged=!0;else if(scil.Utils.startswith(this.options.autosuggest,"data:"))t=this.filterlist(this.options.autosuggest.substr(5).split(","),this.input.value),this.list(t,i),this.itemschanged=!0;else if(scil.Utils.startswith(this.options.autosuggest,"javascript:")){var o=this.options.autosuggest.substr(11),f=scil.Utils.eval(o),e=f(this),t=this.filterlist(e,this.input.value);this.list(t,i);this.itemschanged=!0}else if(typeof this.options.autosuggest=="function"){var f=this.options.autosuggest,e=f(this),t=this.filterlist(e,this.input.value);this.list(t,i);this.itemschanged=!0}else if(this.options.items!=null&&this.options.autosuggest==null)t=this.filterlist(this.options.items,this.input.value),this.list(t,i),this.itemschanged=!0;else if(this.options.autosuggest!=null){if(r=this,u={q:this.input.value},this.options.onsuggest!=null)this.options.onsuggest(u);scil.Utils.jsonp(this.options.autosuggest,function(n){r.list(n.items==null?n:n.items,i);r.itemschanged=!0},u)}}},filterlist:function(n,t){var r=[],i;if(t!=null&&t!=""&&n!=null)for(t=t.toLowerCase(),i=0;i<n.length;++i)n[i].toLowerCase().indexOf(t)>=0&&r.push(scil.Utils.trim(n[i]));return r},clickMe:function(n){if(this.options.items!=null){var t=n.srcElement||n.target;t.offsetWidth-(n.offsetX==null?n.layerX:n.offsetX)<16&&this.show()}},setItems:function(n){n!=null&&(this.options.items=n,this.itemschanged=!0)},isChildOf:function(n){return n==this.input||JsUtils.isChildOf(n,this.auto)},isDropdownVisible:function(){return this.auto!=null&&this.auto.style.display==""},isVisible:function(){return this.input!=null&&this.input.style.display==""},show:function(){if(this.auto==null){var n=this,t=scil.Utils.isFixedPosition(this.input)?"fixed":"absolute";this.auto=scil.Utils.createElement(document.body,"div",null,{display:"none",backgroundColor:"white",color:"black",overflowX:"hidden",overflowY:"auto",maxHeight:"400px",border:"solid 1px gray",position:t,zIndex:99999});scil.connect(document.body,"onmousedown",function(t){var i=t.srcElement||t.target;i!=n.q&&i.parentNode!=n.auto&&i!=n.auto&&n.clickout()})}this.itemschanged&&this.list(this.options.items,++this.sugid);this.auto.style.display="";this.auto.style.zIndex=scil.Utils.getZindex(this.input)+1;this.updateDropdownSize()},highlight:function(n){var r,t,u,e,i,f;if(this.auto==null||this.auto.style.display=="none"){(n.keyCode==13||n.keyCode==40)&&(this.show(),n.preventDefault());return}if(n.preventDefault(),n.keyCode==27){this.hide();return}for(r=this.auto.childNodes,t=null,u=0;u<r.length;++u)if(e=r[u],e.getAttribute("sel")=="1"){t=u;break}if(n.keyCode==13){t!=null&&this.clickItem(r[t]);return}i=null;n.keyCode==38||n.keyCode==40?(t==null?i=0:n.keyCode==38?(i=t-1,i<0&&(i=r.length-1)):(i=t+1,i>=r.length&&(i=0)),n.preventDefault()):n.char!=null&&(f=n.char.toLowerCase(),i=this.findNextMatch(f,t==null?0:t+1,r.length),i==null&&t!=null&&(i=this.findNextMatch(f,0,t)));i!=null&&i!=t&&(t!=null&&this._hilitItem(r[t],!1),this._hilitItem(r[i],!0))},findNextMatch:function(n,t,i){for(var u,f,r=t;r<i;++r)if(u=this.auto.childNodes[r],u.innerHTML&&(f=this.getItemValue(u),f.length>0&&f.substr(0,1).toLowerCase()==n))return r;return null},updateDropdownSize:function(){if(this.isDropdownVisible()){var t=scil.Utils.getOffset(this.input,!0,!0),n=this.input.offsetWidth;this.options.minautowidth>0&&this.options.minautowidth>n&&(n=this.options.minautowidth);n<100&&(n=100);scil.style(this.auto,{left:t.x+"px",top:t.y+this.input.offsetHeight+"px",width:n-2+"px"})}},hide:function(){this.auto!=null&&this.auto.style.display!="none"&&(this.auto.style.display="none")},isParentHidden:function(n){for(var t=n;t!=null&&t.style!=null;){if(t.style.display=="none"||t.style.visibility=="hidden")return!0;t=t.parentNode}return!1},list:function(n,t){var i,r,f,u;if(n==null||n.length==0||t!=this.sugid||this.isParentHidden(this.input)){this.auto!=null&&(scilligence.Utils.removeAll(this.auto),this.auto.style.display="none");return}if((this.auto==null||this.auto.style.display=="none")&&(this.itemschanged=!1,this.show()),this.itemschanged=!1,scilligence.Utils.removeAll(this.auto),n!=null&&n.length!=0)for(i=this,r=0;r<n.length;++r)f=n[r],u=scilligence.Utils.createElement(this.auto,"div",scil.Utils.isNullOrEmpty(f)?"&nbsp;":f,{padding:"2px",textAlign:this.options.align}),scil.connect(u,"onclick",function(n){i.click(n)}),scil.connect(u,"onmouseover",function(n){i.mouseover(n)}),scil.connect(u,"onmouseout",function(n){i.mouseout(n)})},mouseover:function(n){this._hilitItem(n.srcElement||n.target,!0)},mouseout:function(n){this._hilitItem(n.srcElement||n.target,!1)},_hilitItem:function(n,t){t?(n.style.backgroundColor="#ddf",n.setAttribute("sel","1")):(n.style.backgroundColor="white",n.removeAttribute("sel"))},clickout:function(){this.hide()},click:function(n){var t=n.srcElement||n.target;this.clickItem(t)},getItemValue:function(n){var t=scil.Utils.htmlDecode(n.innerHTML);return t=="&nbsp;"&&(t=""),t},clickItem:function(n){var t=this.getItemValue(n);if(this.options.onSetValue!=null)this.options.onSetValue(this.input,t);else this.options.overwrite=="unit"?this.input.value=this.changeUnit(this.input.value,t):this.options.overwrite==!1?this.input.value+=t:this.input.value=t;if(this.hide(),this.options.overwrite&&this.input.select(),this.input.focus(),this.options.onclickitem!=null)this.options.onclickitem(t);scil.Utils.fireEvent(this.input,"change",!1,!0)},changeUnit:function(n,t){var i=JSDraw2.Table.parseValueUnit(n);return i==null||i.value==null?"":i.value+(t==null?"":t)}});scil.EditableSelect=scil.extend(scil._base,{constructor:function(n,t){this.q=null;this.auto=null;this.options=t==null?{}:t;this.disabled=!1;var i=this;this.options.items==null&&(this.options.url!=null||this.options.listurl!=null)&&scil.Utils.jsonp(this.options.url||this.options.listurl,function(n){i.options.items=n});this.q=typeof n=="string"?document.getElementById(n):n;scil.connect(this.q,"onkeyup",function(n){i.keyup(n)});scil.connect(this.q,"onmousedown",function(){i.showList()});this.auto=scil.Utils.createElement(document.body,"div",null,{display:"none",backgroundColor:"white",color:"black",border:"solid 1px gray",position:"absolute",zIndex:99999});scil.connect(document.body,"onmousedown",function(n){var t=n.srcElement||n.target;t!=i.q&&t.parentNode!=i.auto&&i.clickout()})},keyup:function(n){if(!this.disabled&&this.q!=null){if(n.keyCode==9||n.keyCode==13){this.auto.style.display="none";return}this.showList()}},showList:function(){var n=this.filter(this.options.items,this.q.value);this.list(n)},filter:function(n,t){var u,i,r;if(t==null||t=="")return n;for(t=t.toLowerCase(),u=[],i=0;i<n.length;++i)r=n[i],r.length>=t.length&&r.substr(0,t.length).toLowerCase()==t&&u.push(r);return u},isParentHidden:function(n){for(var t=n;t!=null&&t.style!=null;){if(t.style.display=="none"||t.style.visibility=="hidden")return!0;t=t.parentNode}return!1},list:function(n){var t,i,r;if(n==null||n.length==0||this.isParentHidden(this.q)){this.auto.style.display="none";return}for(this.auto.style.display!=""&&scil.AutoComplete.position(this.auto,this.q,this.options.minautowidth),scilligence.Utils.removeAll(this.auto),t=this,i=0;i<n.length;++i)r=scilligence.Utils.createElement(this.auto,"div",n[i]),scil.connect(r,"onclick",function(n){t.click(n)}),scil.connect(r,"onmouseover",function(n){t.mouseover(n)}),scil.connect(r,"onmouseout",function(n){t.mouseout(n)})},mouseover:function(n){var t=n.srcElement||n.target;t.style.backgroundColor="#ddddff"},mouseout:function(n){var t=n.srcElement||n.target;t.style.backgroundColor="white"},click:function(n){var i=n.srcElement||n.target,t=scil.Utils.htmlDecode(i.innerHTML);if(t=="&nbsp;"&&(t=""),this.q.value=t,this.auto.style.display="none",scil.Utils.fireEvent(this.q,"change",!1,!0),this.options.onclickitem!=null)this.options.onclickitem(this)},clickout:function(){this.auto.style.display==""&&(this.auto.style.display="none")}});scil.EditableForm=scil.extend(scilligence._base,{constructor:function(n){this.table=n;this.dlg=null;this.form=null;this.id=null},show:function(n,t){if(this.id=null,this.create(),n==null)this.dlg.show(this.table.getDisplayName()),this.form.setData(t);else{var r=this,i={};i.itemname=this.table.itemname;i[this.table.idcolumn]=n;this.table.ajax(this.table.cmd+".load",function(n){r.show2(n)},i)}},show2:function(n){this.id=n[this.table.idcolumn];this.dlg.show(this.table.getDisplayName());this.form.setData(n)},create:function(){var t,i,n,r;if(this.dlg==null){t=this;i={};for(n in this.table.columns)this.table.columns[n]!=null&&this.table.columns[n].inForm!=!1&&(i[n]=this.table.columns[n]);r=[{svg:"save",caption:"Save",onclick:function(){t.save()}},{svg:"del",caption:"Delete",onclick:function(){t.del()}}];this.dlg=scil.Form.createDlgForm("",i,r);this.form=this.dlg.form}},save:function(){var n,t;if(this.form.checkRequiredFields()>0){scil.Utils.alert("Some required field(s) are blank");return}(n=this.form.getData(),n[this.table.idcolumn]=this.id,n.itemname=this.table.itemname,this.table.options.onSave==null||this.table.options.onSave(n)!=!1)&&(t=this,this.table.ajax(this.table.cmd+".save",function(i){n[t.table.idcolumn]=i[t.table.idcolumn];t.save2(n)},n))},save2:function(n){this.id==null?this.table.table.addRow(n):this.table.table.updateRow(this.id,n);this.dlg.hide()},del:function(){if(confirm("Confirm to delete this "+this.table.itemname+". Delete?")){var t=this,n={};n.itemname=this.table.itemname;n[this.table.idcolumn]=this.id;this.table.ajax(this.table.cmd+".del",function(){t.del2()},n)}},del2:function(){this.table.table.delRow(this.id);this.dlg.hide()}});scilligence.EditableTable=scilligence.extend(scilligence._base,{constructor:function(n,t,i,r){this.table=null;this.form=new scil.EditableForm(this);this.columns=t;this.options=r==null?{}:r;this.itemname=i;this.cmd=this.options.cmd!=null?this.options.cmd:this.itemname.toLowerCase();this.ajaxurl=this.options.ajaxurl;this.idcolumn=this.options.idcolumn!=null?this.options.idcolumn:this.itemname.toLowerCase()+"id";scil.EditableTable.register(this);this.ajaxurl==null&&(this.ajaxurl="ajax.ashx");typeof n=="string"&&(n=scil.byId(n));this.pages=scil.Utils.createElement(n,"div");this.init(n)},getDisplayName:function(){return this.options.displayname!=null?this.options.displayname:this.itemname},init:function(n){var i={},r,u,e,t,f;for(r in this.columns)this.columns[r]!=null&&this.columns[r].inTable!=!1&&(i[r]=this.columns[r]);if(u=this,i[this.idcolumn]==null&&(i[this.idcolumn]={type:"svg",svg:"edit",style:{width:16,height:16},title:scil.Lang.res("Edit"),iskey:!0,onclick:function(n,t){scil.EditableTable.edit2(u,n,t)}}),this.options.viewonly&&(i[this.idcolumn]=null),this.table=scil.Table.create(this,n,i,!0,this.options.loadimmediately),u=this,!this.options.viewonly&&(e=scil.Utils.createElement(n,"div",null,{marginTop:"10px"}),t=this.options.buttons!=null?this.options.buttons:{svg:"add",label:"Add",onclick:function(){u.add()}},t!=!1))if(t.length>0)for(f=0;f<t.length;++f)scil.Utils.createButton(e,t[f]);else scil.Utils.createButton(e,t)},setData:function(n){this.table.setData(n)},add:function(){this.options.onAdd==null?this.form.show(null,this.options.defaultvalues):this.options.onAdd()},edit:function(n){if(this.options.onEdit==null)this.form.show(n);else this.options.onEdit(n)},ajax:function(n,t,i){scil.Utils.ajax(this.ajaxurl+"?cmd="+n,t,i)},clear:function(){this.table.clear()},list:function(n){var t=this;this.table.setData(n.rows==null?n:n.rows);scil.Table.listPages(this.pages,n.page,n.pages,function(n){t.load(n)})},load:function(n){var i=this,t=this.options.args==null?{}:scil.clone(this.options.args);t.itemname=this.itemname;t.page=n;this.ajax(this.cmd+".list",function(n){i.list(n)},t)}});scilligence.apply(scilligence.EditableTable,{__id:0,__items:{},get:function(n){return this.__items[n]},register:function(n){n.__id=++this.__id;this.__items[n.__id]=n},edit:function(n,t){this.get(n).edit(t)},edit2:function(n,t){var i=scil.Utils.getParent(t,"TR");n.edit(i.getAttribute("key"))}});scilligence.Progress={dlg:null,bar:null,msg:null,oncancel:null,show:function(n,t,i,r){this.create();t==!1?(this.cancelbtn.style.display="none",this.oncancel=null):typeof t=="function"&&(this.cancelbtn.style.display="",this.oncancel=t);this.msg.innerHTML=i==null?"":i;this.frame.style.display=r==!1?"none":"";this.dlg.show(n)},hide:function(){this.dlg!=null&&this.dlg.hide()},cancel:function(){this.oncancel!=null&&this.oncancel();this.hide()},update:function(n,t){n>100?n=100:n>0||(n=0);var i=Math.round(3*n);i<0&&(i=0);this.bar.style.width=i+"px";this.msg.innerHTML=t==null?"":t},create:function(){if(this.dlg!=null)return!1;var n=scil.Utils.createElement(null,"div",null,{margin:"5px",width:"320px",textAlign:"center"});return this.animator=scil.icon(scil.create(n,"div",null,{textAlign:"center"}),"animator",{width:64}),this.msg=scil.Utils.createElement(n,"div","&nbsp;",{textAlign:"center"}),this.frame=scil.Utils.createElement(n,"div",null,{width:"300px",height:"20px",border:"solid 1px #e0e0e0",textAlign:"left"}),this.bar=scil.Utils.createElement(this.frame,"div","&nbsp;",{width:"1px",height:"20px",backgroundColor:"blue"}),this.cancelbtn=scil.Utils.createButton(n,{svg:"cancel",label:"Cancel",onclick:function(){scilligence.Progress.cancel()}}),this.dlg=new JSDraw2.Dialog("Progress",n),!0}};scil.ProgressCall={cancelled:!1,count:0,url:null,ondata:null,onresult:null,run:function(n){scil.Utils.ajax(JSDrawServices.url+"?cmd=jsdraw.version",function(){n()},null,{showprogress:!0})},show:function(n,t,i,r,u){this.url=n;this.count=t;this.ondata=r;this.onresult=u;this.cancelled=!1;var f=this;scil.Progress.show(i,function(){f.cancelled=!0});this.callNext(0)},callNext:function(n){var t=this.cancelled?null:this.ondata(n,this.count),i;if(t==null){scil.Progress.hide();return}t.i==null?t.i=n:n=t.i;i=this;scil.Progress.update((n-1)*100/this.count,"Process "+n+" of "+this.count);scil.Utils.ajax(this.url,function(t){i.onresult(n,t);i.callNext(n+1)},t)}};scil.Table=scil.extend(scil._base,{constructor:function(n,t,i){n!=null&&typeof n=="object"?(this.options=n,this.viewonly=this.options.viewonly,this.header=this.options.header):(this.viewonly=n,this.header=t,scil.Table._tableincrease==null&&(scil.Table._tableincrease=0),this._tableid=++scil.Table._tableincrease,this.options=typeof i=="function"?{onAdd:i}:i==null?{}:i);this.groupIndex=0;this.checkIndex=1;this.dataIndex=2;this._startrow=3;this.tbody=null;this.items=null;this.key=null;this.sortkey=null;this.sortdirection=null;this._lastcheck=null},getXml:function(){var e=this.tbody.childNodes.length-this._startrow,t,r,i,n;if(e==0)return"";for(t="<table>\n",r=0;r<e;++r){var o=this.tbody.childNodes[r+this._startrow],u=!1,f={},s=this.dataIndex;for(i in this.items)n=scil.Form.getFieldData(o.childNodes[s++].field),f[i]=n,u||n==null||n==""||(u=!0);if(u){t+="<r";o.getAttribute("isnew")=="1"&&(t+=" isnew='1'");t+=">\n";for(i in f)n=f[i],n!=null&&n!=""&&(t+="<i n='"+scil.Utils.escXmlValue(i)+"'>"+scil.Utils.escXmlValue(n)+"<\/i>\n");t+="<\/r>\n"}}return t+"<\/table>"},setXml:function(n,t){this.setData(scil.Table.xml2rows(n),t)},getCsv:function(n){var t,i,f,u,e,o,r;n==null&&(n=",");t="";i=0;for(r in this.items)++i>1&&(t+=n),t+=scil.Utils.escCsvValue(this.items[r].label);for(t+="\n",f=this.tbody.childNodes.length-this._startrow,u=0;u<f;++u){e=this.tbody.childNodes[u+this._startrow];o=this.getRowData(e,!0);i=0;for(r in this.items)++i>1&&(t+=n),t+=scil.Utils.escCsvValue(o[r]);t+="\n"}return t},getData:function(n,t,i){var e,s,u,r,f,o,h,c;if(n==null){for(e=[],u=this.tbody.childNodes.length-this._startrow,r=0;r<u;++r)f=this.tbody.childNodes[r+this._startrow],s=this.getRowData(f,i),e.push(s);return e}for(u=this.tbody.childNodes.length-this._startrow,n[t+".n"]=u,r=0;r<u;++r){f=this.tbody.childNodes[r+this._startrow];o=t+"."+r+".";f.getAttribute("isnew")=="1"&&(n[o+"isnew"]=1);h=this.dataIndex;for(c in this.items)n[o+c]=scil.Form.getFieldData(f.childNodes[h++].field)}},getRowDataByKey:function(n){var t=this.findRow(n);return this.getRowData(t)},getRowData:function(n,t,i){var r,o,e,u,f;if(n==null||typeof n=="number"&&(n=this.tbody.childNodes[n+this._startrow],n==null))return null;r={};n.getAttribute("isnew")=="1"&&(r.isnew=1);o=this.dataIndex;for(e in this.items)u=n.childNodes[o++],f=null,u!=null&&(f=i?u.innerText:scil.Form.getFieldData(u.field,this.items[e])),scil.Utils.isNullOrEmpty(f)||(r[e]=f);return t&&n.childNodes[this.checkIndex].firstChild.checked&&(r.rowchecked=!0),r},getRowTexts:function(n){var t,u,f,r,i;if(n==null||typeof n=="number"&&(n=this.tbody.childNodes[n+this._startrow],n==null))return null;t={};n.getAttribute("isnew")=="1"&&(t.isnew=1);u=this.dataIndex;for(f in this.items)r=n.childNodes[u++],i=r.text||r.textContent,i!=null&&i!=""&&(t[f]=i);return t},getCurrentRowData:function(){return this.getRowData(this.currow)},setData:function(n,t,i){if(i!=!1&&this.clear(),n!=null)for(var r=0;r<n.length;++r)this.addRow(n[r],t);this.viewonly||this.options.addrow==!1||this.options.canadd==!1||this.addRow()},clear:function(){var t,n;for(this.dirty=!1,n=this.tbody.childNodes.length-1;n>=this._startrow;--n)this.tbody.removeChild(this.tbody.childNodes[n]);if(this.currow=null,t=this.headertr.getElementsByTagName("INPUT"),t!=null)for(n=0;n<t.length;++n)t[n].checked!=null&&(t[n].checked=!1)},render:function(n,t){var a=this.options.sortby,v,f,e,s,h,c,r,l,i;this.items={};for(i in t)t[i]!=null&&(this.items[i]=t[i],this.items[i].key=i,t[i].iskey&&(this.key=i),a==null||a!="all"&&scil.Utils.indexOf(a,i)==-1||t[i].sortable!=null||scil.Utils.isNullOrEmpty(i)||i=="star"||(t[i].sortable=!0));this._hideCookieCols(this.items);this.options.pushleft&&(this.items[""]={label:"",pushleft:!0,width:this.options.pushleft>100?this.options.pushleft:scil.Table.kPushLeftWidth});typeof n=="string"&&(n=scil.byId(n));var u=this,y=this.options.forecolor==null?scil.Form.kForeColor:this.options.forecolor,o=scil.Utils.createElement(n,"div",null,{color:y});if(this.tbody=JSDraw2.Skin.table.cell=="grid"?scilligence.Utils.createTable(o,0,JSDraw2.Skin.table.spacing,{borderCollapse:"collapse"},1):JSDraw2.Skin.table.cell=="col"?scilligence.Utils.createTable(o,0,JSDraw2.Skin.table.spacing,{borderCollapse:"collapse"}):scilligence.Utils.createTable(o,0,JSDraw2.Skin.table.spacing,{borderRight:JSDraw2.Skin.jssdf.border,borderBottom:JSDraw2.Skin.jssdf.border,borderTop:JSDraw2.Skin.jssdf.border}),this.tbody.parentNode.setAttribute("bordercolor","#ddd"),this.tbody.parentNode.setAttribute("class","scil_table"),this.tbody.parentNode.style.backgroundColor="#fff",this.viewonly||this.options.addrow==!1||this.options.canadd==!1||(v=scil.icon(scil.create(o,"div"),"add",null,{title:"Add"}),scil.connect(v,"onclick",function(){if(u.options.onAdd!=null)u.options.onAdd(u);else u.addRow()})),f=scil.clone(scil.Table.headerstyles),f.borderBottom=JSDraw2.Skin.jssdf.border,f.borderLeft=JSDraw2.Skin.jssdf.border,e=scil.Utils.createElement(this.tbody,"tr"),s=this.options.header0,this.headertr=scil.Utils.createElement(this.tbody,"tr",null),this.filterrow=scil.Utils.createElement(this.tbody,"tr",null,{background:"#f0f0f0",display:this.options.filterrow&&this.options.showfilterrow?"":"none"}),s!=null)for(scil.Utils.createElement(e,"td",null,{display:this.options.grouping?"":"none"}),r=scil.Utils.createElement(e,"td",null,f),r.style.display=this.options.rowcheck?"":"none",h=0;h<s.length;++h)c=s[h],c==null?scil.Utils.createElement(e,"td"):(r=scil.Utils.createElement(e,"td",scil.Lang.res(c.label),f,{colSpan:c.colspan}),r.style.textAlign="center");r=scil.Utils.createElement(this.headertr,"td",null,scil.Table.headerstyles);l=scil.Utils.createElement(this.filterrow,"td");this.options.grouping?(r.style.width="5px",scil.icon(r,"arrow2_down",{width:16},{expanded:1},function(n){u.groupExpandAll(n)})):(r.style.display="none",l.style.display="none");r=scil.Utils.createElement(this.headertr,"td",null,scil.Table.headerstyles);l=scil.Utils.createElement(this.filterrow,"td");this.options.rowcheck?(r.style.width="5px",this.options.rowcheck!="radio"&&scil.Utils.createElement(r,"checkbox",null,null,null,function(n){u.checkAll((n.srcElement||n.target).checked)})):(r.style.display="none",l.style.display="none");for(i in this.items)this._addheadercell(i,this.items[i]);this._canDel(null)&&this._addheadercell(i,{});this.header==!1&&(this.headertr.style.display="none");this.viewonly||this.addRow();this.options.selectrow&&scil.connect(this.tbody,"onclick",function(n){u.clickRow(n)});this.options.columndraggable&&this.makeColumnDraggable();this.options.draggable&&scil.Table.makeDraggable(this)},setHeaderLabel:function(n,t){var i,r;if(this.items[n]==null||this.headertr==null)return!1;for(this.items[n].label=t,i=0;i<this.headertr.childNodes.length;++i)if(r=this.headertr.childNodes[i],r.getAttribute("key")==n)return r.innerHTML=t,!0;return!1},makeColumnDraggable:function(){var n=this;scil.Utils.unselectable(this.headertr);this.columndnd=new scil.DnD(this.headertr,{onstartdrag:function(n){var t=n.target||n.srcElement;return(t.tagName=="DIV"&&(t=t.parentNode),t.tagName!="TD"||scil.Utils.isNullOrEmpty(t.getAttribute("key")))?null:t},oncreatecopy:function(t,i){var u;if(n.options.dragtotrash){var f=t.clientX,e=t.clientY,r={position:"absolute",width:100,height:100,left:f+"px",top:e+100+"px"};this.trash=scil.icon(scil.Utils.createElement(document.body,"div",null,r),"trash",{fill:"gray",width:100})}return u=i.src,r={background:"red",position:"absolute",border:"dashed 1px #aaa",backgroundColor:u.style.backgroundColor,padding:"3px",boxShadow:"2px 2px 6px 2px rgba(0,0,0,0.2)"},r.width=u.offsetWidth-6,r.height=u.offsetHeight-8,scil.Utils.createElement(document.body,"div",u.innerText,r)},ondragover:function(n){if(this.trash!=null){var t=n.target||n.srcElement;this.trash.firstChild.firstChild.style.fill=t==this.trash||t.parentNode==this.trash||t.parentNode!=null&&t.parentNode.parentNode==this.trash?"red":"gray"}},ondrop:function(t,i){var r=t.target||t.srcElement,u,e,s,o,f;if(this.trash!=null&&(r==this.trash||r.parentNode==this.trash||r.parentNode!=null&&r.parentNode.parentNode==this.trash)){if(u=i.src.getAttribute("key"),n.delColumn(u),n.options.ondropchanged!=null)n.options.ondropchanged("delete",u)}else if(r.tagName=="DIV"&&(r=r.parentNode),r.tagName=="TD"&&!scil.Utils.isNullOrEmpty(r.getAttribute("key"))&&(u=i.src.getAttribute("key"),e=r.getAttribute("key"),u!=e)){var h=n.getColIndex(e),c=n.getColIndex(u),l={};for(l[u]=scil.clone(n.items[u]),delete n.items[u],scil.Utils.insertBeforeDict(n.items,l,e),f=n.headertr,f.insertBefore(i.src,r),n.filterrow!=null&&(f=n.filterrow,f.insertBefore(f.childNodes[c],f.childNodes[h])),s=n.tbody.childNodes,o=n._startrow;o<s.length;++o)f=s[o],f.insertBefore(f.childNodes[c],f.childNodes[h]);if(n.options.ondropchanged!=null)n.options.ondropchanged("changeorder",u,e)}i.copy!=null&&(i.copy.parentNode.removeChild(i.copy),i.copy=null);this.trash!=null&&(this.trash.parentNode.removeChild(this.trash),this.trash=null)}})},_addheadercell:function(n,t,i){var f=scil.clone(scil.Table.headerstyles),u,r,e,o,h,l,s,c;if(f.borderBottom=JSDraw2.Skin.jssdf.border,f.borderLeft=JSDraw2.Skin.jssdf.border,u=scil.Lang.res(t.label),this.options.renderheadertext!=null&&(u=this.options.renderheadertext(u,t)),t.unit!=null&&t.unit!=""&&(u+=" ("+scil.Lang.res(t.unit)+")"),r=null,i!=null)for(e=0;e<this.headertr.childNodes.length;++e)if(o=this.headertr.childNodes[e],o.getAttribute("key")==i){r=scil.Utils.createElement(null,"td",null,f,{key:n});this.headertr.insertBefore(r,o.nextSibling);break}r==null&&(r=scil.Utils.createElement(this.headertr,"td",null,f,{key:n}));h=this.createFilter(this.filterrow,t);l=scil.Utils.createElement(r,"div",u,{width:"100%"});t.width>0&&(r.style.width=t.width+"px");(t.type=="hidden"||t.ishidden)&&(r.style.display="none",h.style.display="none");t.whitespace!=null&&(r.style.whiteSpace=t.whitespace);s=this.viewonly||t.viewonly;t.editable&&(s=!1);t.type!="checkbox"||t.headercheckbox==!1||s?t.key=="star"&&scil.MyFavorite.renderHeader(r,this):(c=scil.Utils.createElement(r,"checkbox"),this.connectCheckAll(c,n));t.sortable&&this.makeSortable(r,t)},showFilterRow:function(n){n=="auto"?n=this.hasFilterValues():n==null&&(n=this.filterrow.style.display=="none");this.filterrow.style.display=n?"":"none"},makeSortable:function(n,t){if(t.sortable){var i=this;scil.apply(n.style,{paddingRight:"16px",backgroundImage:scil.Utils.svgData("updown","#fff",!0),backgroundRepeat:"no-repeat",backgroundSize:"18px 18px",backgroundPositionX:"right",backgroundPositionY:"center"});scil.connect(n,"onclick",function(){i.sortcolumn(t)})}},sortcolumn:function(n){var r,u,t,i,f,e;if(n!=null&&n.sortable){for(r=null,u=this.headertr.childNodes,t=0;t<u.length;++t)if(i=u[t],i.getAttribute("key")==n.key){r=i;break}if(r!=null){for(this.sortdirection=="up"?(this.sortdirection="down",r.style.backgroundImage=scil.Utils.svgData("south",scil.App.config==null?"green":scil.App.config.frame,!0)):(this.sortdirection="up",r.style.backgroundImage=scil.Utils.svgData("north",scil.App.config==null?"green":scil.App.config.frame,!0)),t=0;t<u.length;++t)(i=u[t],i!=r)&&(f=i.getAttribute("key"),e=scil.Utils.isNullOrEmpty(f)?null:this.items[f],i.style.backgroundImage=e!=null&&e.sortable?scil.Utils.svgData("updown","#fff",!0):"");if(this.sortkey=n.key,this.options.onsort!=null)this.options.onsort(n,this)}}},getColIndex:function(n){var i=this.tbody.childNodes[this._startrow],t,r;if(i==null)return-1;for(t=0;t<i.childNodes.length;++t)if(r=i.childNodes[t],r.field!=null&&r.getAttribute("__tid")==n)return t;return-1},sort:function(n){var h=this.tbody.childNodes,c=this.getColIndex(n.key),f,i,u,r,e,o,s,t;if(c==-1)return!1;for(f=!0,i=[],t=h.length-1;t>=this._startrow;--t)(u=h[t],u.style.display!="none")&&(r=u.childNodes[c].innerText,r==""&&(r=null),e={v:r,tr:u},i.push(e),f&&!scil.Utils.isNullOrEmpty(r)&&(o=parseFloat(r),isNaN(o)?f=!1:e.n=o),this.tbody.removeChild(u));if(f)for(t=0;t<i.length;++t)i[t].v=i[t].n;for(s=this.sortdirection=="up"?1:-1,i.sort(function(n,t){return n.v==t.v?0:n.v==null&&t.v!=null?1:n.v!=null&&t.v==null?-1:n.v>t.v?s:-s}),t=0;t<i.length;++t)this.tbody.appendChild(i[t].tr);return!0},getColValues:function(n,t){for(var f,u=[],r=this.tbody.childNodes,i=this._startrow;i<r.length;++i)(f=r[i],t&&f.style.display=="none")||u.push(this.getCellValue(r[i],n));return u},filter:function(){var o={},i={},r,n,u,f,t,e,s;this.getFilterValues(i);for(r in i)(n=i[r],n!=null)&&(n=scil.Utils.trim(n),n!="")&&(u=this.makefilter(n),u!=null&&(o[r]=u));for(f=this.tbody.childNodes,t=f.length-1;t>=this._startrow;--t)e=f[t],s=this.getRowData(e,null,!0),e.style.display=this.filtervalues(s,o)?"":"none"},makefilter:function(n){if(n=="*")return function(n){return!scil.Utils.isNullOrEmpty(n)};if(n=="-")return function(n){return scil.Utils.isNullOrEmpty(n)};if(scil.Utils.startswith(n,">")||scil.Utils.startswith(n,"<")){var t=parseFloat(n.substr(1));if(!isNaN(t))return scil.Utils.startswith(n,">")?function(n){return n>t}:function(n){return n<t}}else return n=n.toLowerCase(),function(t){return t!=null&&t.toLowerCase().indexOf(n)>=0};return null},filtervalues:function(n,t){for(var i in t)if(!t[i](n[i]))return!1;return!0},hasFilter:function(n){return this.items[n]!=null&&this.items[n].filter!=null&&this.items[n].filter&&this.items[n].filter.b!=null},setFilterValue:function(n,t){this.options.filterrow&&this.hasFilter(n)&&(this.items[n].filter.b.value=t==null?"":t)},getFilterValue:function(n){return!this.options.filterrow||!this.hasFilter(n)?null:this.items[n].filter.b.value},setFilterValues:function(n){if(this.options.filterrow){n==null&&(n={});for(var t in this.items)this.setFilterValue(t,n[t])}},getFilterValues:function(n){if(this.options.filterrow)for(var t in this.items)this.hasFilter(t)&&(n[t]=this.getFilterValue(t))},hasFilterValues:function(){if(!this.options.filterrow)return!1;for(var n in this.items)if(this.hasFilter(n)&&!scil.Utils.isNullOrEmpty(this.getFilterValue(n)))return!0;return!1},clearFilterValues:function(){this.setFilterValues({})},createFilter:function(n,t){var r=scil.Utils.createElement(n,"td",null,{padding:0}),i;return this.options.filterrow&&t.filter!=null&&t.filter!=null&&t.filter!=!1&&(i=t.filter,i.key=t.key,scil.Utils.isNullOrEmpty(i.querykey)||(i.value=scil.Utils.getQueryValue(i.querykey)),i.b=this._createFilterBox(r,i)),r},_createFilterBox:function(n,t){var i,u,r;return t==null?null:(scil.Utils.isNullOrEmpty(t.type)&&(t.type="input"),i=null,t.type=="select"?(i=scil.Utils.createElement(n,"select",null,t.styles,t.attributes),u=scil.Form._getListItems(t),r=t.url||t.listurl,r!=null?scil.Form.listOptions(i,r,t.addblank,t.sort,t.value):scil.Utils.listOptions(i,u,t.value,null,null,t.sort),t.onchange!=null&&scil.connect(i,"onchange",function(n){t.onchange(n)})):(t.type=="input"||t.type=="date"||t.type=="color"||t.type=="editableselect"||t.type=="multiselect"||t.type=="dropdowninput")&&(i=scil.Utils.createElement(n,"input",null,t.styles,t.attributes),t.onenter!=null&&scil.connect(i,"onkeydown",function(n){if(n.keyCode==13)t.onenter(i)}),t.onchange!=null&&scil.connect(i,"onchange",function(n){t.onchange(n)}),t.autosuggesturl!=null&&new scil.AutoComplete(i,t.autosuggesturl,{onsuggest:t.onsuggest}),t.type=="date"?new scil.DatePicker(i):t.type=="color"?new scil.ColorPicker2(i):t.type=="editableselect"?new scil.EditableSelect(i,t):t.type=="multiselect"?new scil.DropdownCheck(i,t):t.type=="dropdowninput"&&new scil.DropdownInput(i,t),t.value!=null&&(i.value=t.value),scil.Utils.isNullOrEmpty(t.placeholder)?scil.Utils.isNullOrEmpty(t.autosuggesturl)||scil.Form.kAuto==null||i.setAttribute("placeholder",scil.Form.kAuto):i.setAttribute("placeholder",scil.Lang.res(t.placeholder))),i!=null&&(i.style.width="100%",i.style.boxSizing="border-box",t.minwidth>0&&(i.style.minWidth=t.minwidth+"px")),i)},addColumn:function(n,t){var i,f,r,e,u,o;if(this.items[n]!=null)return!1;i=null;for(f in this.items)f!=""&&(i=f);for(r=this.getColIndex(i),r>-1&&++r,this.items[n]=t,this._addheadercell(n,t,i),e=this.tbody.childNodes,u=this._startrow;u<e.length;++u)o=e[u],this._addcell(o,n,t,null,null,r);return!0},delColumn:function(n){var f=this.getColIndex(n),i,t,r,u;if(f<=0)return!1;for(delete this.items[n],i=this.tbody.childNodes,t=0;t<i.length;++t)r=i[t],u=r.childNodes[f],u!=null&&r.removeChild(u);return!0},connectCheckAll:function(n,t){var i=this;if(this.options.oncheckall!=null)this.options.oncheckall(t,this);scil.connect(n,"onclick",function(n){i.checkAll((n.srcElement||n.target).checked,t)})},showAllColumns:function(n){for(var t in this.items)this.showColumn(t,!0,n)},autoHideColumns:function(){var f,i,r,u,n;if(this.options.autohidecolumns!=!0){this.showAllColumns(!0);return}var t={},e=this.tbody.childNodes.length-this._startrow,o=this.dataIndex-1,s=this.options.filterrow&&this.filterrow.style.display!="none";for(n in this.items){if(++o,t[n]=!1,f=this.items[n],scil.Utils.isNullOrEmpty(n)||s&&f.filter||n=="star"||n==this.sortkey||f.autohide==!1){t[n]=!0;continue}for(i=0;i<e;++i)if(r=this.tbody.childNodes[i+this._startrow].childNodes[o],u=r.innerText,u!=null&&u!=""&&u!=" "||this.hasCheckedCheckbox(r)||this.hasChild(r,"img")){t[n]=!0;break}}for(n in t)this.showColumn(n,e==0||t[n],!0)},hasChild:function(n,t){var i=n.getElementsByTagName(t);return i!=null&&i.length>0},hasCheckedCheckbox:function(n){var t=n.getElementsByTagName("input"),i,n;if(t!=null&&t.length>0)for(i=0;i<t.length;++i)if(n=t[i],n!=null&&n.checked)return!0;return!1},hidColumn:function(n){return this.showColumn(n,!1)},showColumn:function(n,t,i){var r,f,u,e,o;if(this.options.header0!=null||(t==null&&(t=!0),r=this.items[n],r==null||r.type=="hidden")||(i?r.ishidden&&(t=!1):r.ishidden=!t,this.tbody==null||this.tbody.childNodes.length<=1)||(f=this.getColIndex(n),f==-1))return!1;for(u=1;u<this.tbody.childNodes.length;++u)e=this.tbody.childNodes[u],e!=null&&(o=e.childNodes[f],o!=null&&(o.style.display=t?"":"none"));return!0},hasColumnHidden:function(n){var t=this.items[n];return t==null||t.type=="hidden"?!1:t.ishidden},getColIndex:function(n){for(var i=this.tbody.childNodes[1],t=0;t<i.childNodes.length;++t)if(i.childNodes[t].getAttribute("key")==n)return t;return-1},checkAll:function(n,t){var r,u,i,e,f;if(this.options.oncheckall==null||this.options.oncheckall(n,t,this)!="cancel")if(r=this.tbody.childNodes,t==null)for(i=this._startrow;i<r.length;++i)r[i].childNodes[this.checkIndex].firstChild.checked=r[i].style.display=="none"?!1:n;else{if(u=this.getColIndex(t),u==-1)return!1;for(i=this._startrow;i<r.length;++i)r[i].style.display=="none"?r[i].childNodes[u].firstChild.checked=!1:(e=r[i].childNodes[u],f=e.getElementsByTagName("input"),f!=null&&f.length==1&&(f[0].checked=n))}},invertCheck:function(n){var i,u,e,t,o,r;if(this.options.oncheckall==null||this.options.oncheckall(f,n,this)!="cancel")if(i=this.tbody.childNodes,n==null)for(t=this._startrow;t<i.length;++t)u=i[t].childNodes[this.checkIndex],i[t].style.display!="none"&&(u.firstChild.checked=!u.firstChild.checked);else{if(e=this.getColIndex(n),e==-1)return!1;for(t=this._startrow;t<i.length;++t)i[t].style.display!="none"&&(o=i[t].childNodes[e],r=o.getElementsByTagName("input"),r!=null&&r.length==1&&(r[0].checked=!r[0].checked))}},_isChecked:function(n){return n.childNodes[this.checkIndex].firstChild.checked},getCheckedRows:function(n){for(var i=[],r=this.tbody.childNodes,t=this._startrow;t<r.length;++t)this._isChecked(r[t])&&i.push(t-this._startrow);if(i.length==0&&n&&this.currow!=null)for(t=this._startrow;t<r.length;++t)if(this.currow==r[t]){i.push(t-this._startrow);break}return i},getCheckedRows2:function(){return this.getCheckedRows(!0)},getCheckedRowData:function(n,t){for(var i,r=[],f=this.tbody.childNodes,u=this._startrow;u<f.length;++u)this._isChecked(f[u])&&(i=this.getRowData(f[u]),t!=null&&(i=i[t]),r.push(i));return r.length==0&&n&&(i=this.getCurrentRowData(),i!=null&&(t!=null&&(i=i[t]),r.push(i))),r},getCheckedRowData2:function(){return this.getCheckedRowData(!0)},getKey:function(n){return n==null?null:n.getAttribute("key")},checkRow:function(n){var t;this.options.rowcheck&&(typeof n=="string"?(t=this._findByKey(n),t!=null&&(t.childNodes[this.checkIndex].firstChild.checked=!0)):typeof n=="object"&&(t=n,t.tagName=="TR"&&(t.childNodes[this.checkIndex].firstChild.checked=!0)))},_findByKey:function(n){for(var i=this.tbody.childNodes,t=this._startrow;t<i.length;++t)if(i[t].getAttribute("key")==n)return i[t];return null},checkRows:function(n){var i,t,r;if(n!=null)for(i=this.tbody.childNodes,t=0;t<i.length;++t)r=i[t].getAttribute("key"),!scil.Utils.isNullOrEmpty(r)&&scil.Utils.indexOf(n,r)>=0&&this.checkRow(i[t],!0)},getAllKeys:function(){for(var t=[],i=this.tbody.childNodes,n=this._startrow;n<i.length;++n)t.push(i[n].getAttribute("key"));return t},getCheckedKeys:function(n){for(var u,f,t=[],r=this.tbody.childNodes,i=this._startrow;i<r.length;++i)this._isChecked(r[i])&&(u=r[i].getAttribute("key"),scil.Utils.isNullOrEmpty(u)||t.push(u));return t.length==0&&n&&(f=this.getCurrentKey(),f!=null&&t.push(f)),t},getCheckedKeys2:function(){return this.getCheckedKeys(!0)},getCurrentKey:function(){if(this.currow==null)return null;var n=this.currow.getAttribute("key");return n==""?null:n},clickRow:function(n){var t=n.srcElement||n.target;if(t.tagName=="TR")tr=t;else{if(t.tagName=="A")return;tr=scil.Utils.getParent(t,"TR")}tr!=null&&this.tbody!=tr.parentNode&&(tr=null);this.selectRow(tr)},selectFirstRow:function(){var n=this.tbody.childNodes[this._startrow];this.selectRow(n)},findRow:function(n){for(var i=this.tbody.childNodes,t=this._startrow;t<i.length;++t)if(i[t].getAttribute("key")==n)return i[t];return null},selectRow:function(n){var t,i;if((typeof n=="string"&&(n=this.findRow(n)),t=scil.Utils.indexOf(this.tbody.childNodes,n),!(t<this._startrow))&&(i=this.currow,this.currow!=null&&(this.currow.style.backgroundColor=""),this.currow=n,this.currow!=null&&(this.currow.style.backgroundColor=scil.App.config==null?"orange":scil.App.config.button),this.options.onselectrow!=null))this.options.onselectrow(this.currow,i)},delRow:function(n){for(var i=this.tbody.childNodes,t=0;t<i.length;++t)if(i[t].getAttribute("key")==n){if(this.tbody.removeChild(i[t]),this.options.onchange!=null)this.options.onchange(this);return this.dirty=!0,!0}return!1},delRowByKeys:function(n){var i,t;if(n==null)return 0;for(i=0,t=0;t<n.length;++t)this.delRow(n[t])&&++i;return i},updateRow:function(n,t){for(var i,f,u=this.tbody.childNodes,r=this._startrow;r<u.length;++r)if(u[r].getAttribute("key")==n)return i=u[r],t==null&&(t={}),t.rowchecked=this.options.rowcheck&&i.childNodes[this.checkIndex].firstChild.checked,f=this.addRow(t,null,i),this.tbody.removeChild(i),this.currow==i&&this.selectRow(f),!0;return!1},setCellValue2:function(n,t,i){var u,f,r,e;if(this.items[t]==null)return!1;if(u=null,typeof n=="number")u=this.tbody.childNodes[this._startrow+n];else if(typeof n=="object"&&n.tagName=="TR")u=n;else for(f=this.tbody.childNodes,r=this._startrow;r<f.length;++r)if(f[r].getAttribute("key")==n){u=f[r];break}if(u==null)return!1;for(r=0;r<u.childNodes.length;++r)if(e=u.childNodes[r],e.getAttribute("__tid")==t&&e.field!=null)return scil.Form.setFieldData(e.field,this.items[t],this.viewonly,i),!0;return!1},getCellValue2:function(n,t){var r,u,i,f;if(this.items[t]==null)return null;if(r=null,typeof n=="number")r=this.tbody.childNodes[this._startrow+n];else for(u=this.tbody.childNodes,i=this._startrow;i<u.length;++i)if(u[i].getAttribute("key")==n){r=u[i];break}if(r==null)return null;for(i=0;i<r.childNodes.length;++i)if(f=r.childNodes[i],f.getAttribute("__tid")==t&&f.field!=null)return scil.Form.getFieldData(f.field);return null},_hilitRow:function(n,t){var i=n.target||n.srcElement;(i.tagName!="TR"&&(i=scil.Utils.getParent(i,"TR")),i!=null&&i.getAttribute("sciltable")=="1")&&(i.style.backgroundColor=t||i==this.currow?scil.App.config==null?"orange":scil.App.config.button:"")},groupExpandAll:function(n){var i=n.target||n.srcElement,t=scil.Utils.getParent(i,"svg");f=!scil.Utils.isTrue(t.getAttribute("expanded"));scil.SVG.replaceContent(t,f?"arrow2_down":"arrow2_right");t.setAttribute("expanded",f?1:0);this.groupExpandAll2(f)},groupExpandAll2:function(n){for(var t=this.tbody.childNodes[this._startrow];t!=null;)t=this.groupExpand(t,n)},groupExpand:function(n,t){var r=this.getCellValue(n,this.options.grouping),i,u,f;if(scil.Utils.isNullOrEmpty(r))return null;if(!scil.Utils.isNullOrEmpty(n.getAttribute("expanded"))){for(t==null&&(t=!scil.Utils.isTrue(n.getAttribute("expanded"))),i=n.getElementsByTagName("svg"),i!=null&&i.length>0&&scil.SVG.replaceContent(i[0],t?"arrow2_down":"arrow2_right"),n.setAttribute("expanded",t?1:0),u=0;(n=n.nextSibling)!=null;){if(f=this.getCellValue(n,this.options.grouping),r!=f)break;++u;n.style.display=t?"":"none"}return n}},updateRowColor:function(){for(var t,i=this.tbody.childNodes,n=this._startrow;n<i.length;++n)t=null,JSDraw2.Skin.table.cell=="row"&&(t=JSDraw2.Skin.jssdf.evencolor),i[n].style.backgroundColor=t},addRow:function(n,t,i){var f,e,r,o,c,v,l,u,a,h;if(n==null&&this.options.onAdd!=null)return null;if(this.options.onBeforeAddRow!=null&&(n=this.options.onBeforeAddRow(n)),f=this,e=null,JSDraw2.Skin.table.cell=="row"&&(e=JSDraw2.Skin.jssdf.evencolor),r=scil.Utils.createElement(null,"tr",null,{backgroundColor:e},{sciltable:"1",bgcolor:e}),i=="top"?this.tbody.insertBefore(r,this.tbody.childNodes[this._startrow]):i==null?this.tbody.appendChild(r):this.tbody.insertBefore(r,i),scil.connect(this.tbody.parentNode,"onmouseover",function(n){f._hilitRow(n,!0)}),scil.connect(this.tbody.parentNode,"onmouseout",function(n){f._hilitRow(n,!1)}),o=!1,u=scil.Utils.createElement(r,"td"),this.options.grouping?(c=n==null?null:n[this.options.grouping],v=this.getCellValue(r.previousSibling,this.options.grouping),(scil.Utils.isNullOrEmpty(c)||c!=v)&&(o=!0,r.setAttribute("newgroup","1"),r.setAttribute("expanded","1"),scil.icon(u,"arrow2_down",{width:16},null,function(n){var t=scil.Utils.getParent(n.srcElement||n.target,"TR");f.groupExpand(t)}))):u.style.display="none",u=scil.Utils.createElement(r,"td"),this.options.rowcheck){var p=this.options.rowcheck=="radio"?"__scil_table_"+this._tableid+"_radio":null,y=this.options.rowcheck=="radio"?"radio":"checkbox",s=scil.Utils.createElement(u,y,null,null,{name:p});s.checked=n==null?!1:n.rowchecked;this.options.onrowcheck!=null&&scil.connect(s,"onchange",function(){f.options.onrowcheck(r,s.checked)});y=="checkbox"&&scil.connect(s,"onclick",function(n){f.checkedClick(n)})}else u.style.display="none";n==null?r.setAttribute("isnew","1"):this.key!=null&&n[this.key]!=null&&r.setAttribute("key",n[this.key]);for(l in this.items)this._addcell(r,l,this.items[l],n,t,null,i);if(this._canDel(t)&&(u=scil.Utils.createElement(r,"td"),u.style.borderLeft=JSDraw2.Skin.jssdf.border,(!this.options.grouping||o)&&(a=scil.icon(u,"del",{width:16,color:"red"},{title:scil.Lang.res("Delete")}),scil.connect(a,"onclick",function(){f.removeRow(a)}))),this.options.onAddRow!=null)this.options.onAddRow(r,n,t);if(o&&this.options.grouplinestyle!=null&&(r=r.previousSibling,r!=null))for(h=0;h<r.childNodes.length;++h)r.childNodes[h].style.borderBottom=this.options.grouplinestyle;return r},updateSelectOptions:function(n,t){var f,e,r,u,i;if(this.items[n]==null)return!1;for(f=this.getColIndex(n),this.items[n].items=t,e=this.tbody.childNodes,r=this._startrow;r<e.length;++r)u=e[r],u!=null&&u.childNodes[f]!=null&&(i=u.childNodes[f].field,i!=null&&i.tagName=="SELECT"&&scil.Utils.listOptions(i,t,i.value,!0));return!0},_canDel:function(n){return!this.viewonly&&n==null&&this.options.delrow!=!1&&this.options.candel!=!1},_addcell:function(n,t,i,r,u,f,e){var l=null,o,s,h,c;f!=null&&(l=n.childNodes[f]);l!=null?(o=scil.Utils.createElement(null,"td",null,i.styles,i.attributes),n.insertBefore(o,l)):o=scil.Utils.createElement(n,"td",null,i.styles,i.attributes);o.style.borderLeft=JSDraw2.Skin.jssdf.border;s=this.viewonly||i.viewonly||u!=null&&u[t];s||i.canedit!=!1||r==null||r.__isnew||(s=!0);h=r==null?i.value:r[t];(i.type=="hidden"||i.ishidden)&&(o.style.display="none",i.type=="jsdraw"&&(h=null));i.editable&&(s=!1);c=!1;i.renderTd!=null&&(c=i.renderTd(o,h,r,i),c&&o.field!=null&&o.field.setAttribute("originalvalue",h));c||s&&this.options.notshowifnovalue&&scil.Utils.isNullOrEmpty(h)||(o.field=scil.Form.createField(o,i,s,h,r,!0,!0,this),s&&i.type!="img"?(o.field.style.width="100%",i.maxwidth>0&&(o.field.style.maxWidth=i.maxwidth+"px",o.field.style.overflow="hidden",o.field.style.textOverflow="ellipsis",scil.connect(o,"onmouseenter",function(n){var t=(n.srcElement||n.target).firstChild,i;t!=null&&t.tagName=="DIV"&&(i=null,t.offsetWidth<t.scrollWidth&&(i=scil.Utils.getInnerText(t)),t.title=i==null?"":i)}))):(o.field.tagName=="INPUT"||o.field.tagName=="SELECT"||o.field.tagName=="TEXTAREA")&&(this._connectOnchange(o.field,i),i.addrowonenter&&e==null&&o.field.focus()));i.whitespace!=null&&(o.style.whiteSpace=i.whitespace);o.setAttribute("__tid",t);this.connectKeydown(o,i)},checkedClick:function(n){var i=n.srcElement||n.target,u,f,t;if(i.checked){if(this.options.oncheck!=null)this.options.oncheck(i,this);if(n.shiftKey){var r=this.tbody.childNodes,e=scil.Utils.indexOf(r,scil.Utils.getParent(this._lastcheck,"TR")),o=scil.Utils.indexOf(r,scil.Utils.getParent(i,"TR"));if(u!=-1&&f!=-1)for(u=Math.min(e,o),f=Math.max(e,o),t=u;t<=f;++t)r[t].childNodes[this.checkIndex].firstChild.checked=r[t].style.display=="none"?!1:!0}this._lastcheck=i}},_connectOnchange:function(n,t){var i=this;scil.connect(n,"onchange",function(n){i.onchange(n,t)})},setCellValue:function(n,t,i){var u,r;for(typeof n=="number"&&(n=this.tbody.childNodes[n+this._startrow]),u=0;u<n.childNodes.length;++u)if(r=n.childNodes[u],r.getAttribute("__tid")==t){t=="star"?scil.MyFavorite.renderStar(r,i):r.field!=null&&scil.Form.setFieldData(r.field,this.items[t],this.viewonly,i);break}},getCellValue:function(n,t){var i,r;for(typeof n=="number"&&(n=this.tbody.childNodes[n+this._startrow]),i=0;i<n.childNodes.length;++i)if(r=n.childNodes[i],r.field!=null&&r.getAttribute("__tid")==t)return scil.Form.getFieldData(r.field);return null},markAllStar:function(n){for(var r,i,u,t=this._startrow;t<this.tbody.childNodes.length;++t)for(r=this.tbody.childNodes[t],i=0;i<r.childNodes.length;++i)if(u=r.childNodes[i],u.getAttribute("__tid")=="star"){scil.MyFavorite.renderStar(u.firstChild,n);break}},markCheckedStar:function(n){for(var i,r,u,t=this._startrow;t<this.tbody.childNodes.length;++t)if(i=this.tbody.childNodes[t],this._isChecked(i))for(r=0;r<i.childNodes.length;++r)if(u=i.childNodes[r],u.getAttribute("__tid")=="star"){scil.MyFavorite.renderStar(u.firstChild,n);break}},connectKeydown:function(n,t){if(!this.viewonly&&n.field!=null&&n.field.tagName=="INPUT"&&t.addrowonenter){var i=this;scil.connect(n.field,"onkeydown",function(r){if(r.keyCode==13){var u=scil.Utils.getParent(n,"TR");typeof t.addrowonenter=="function"&&t.addrowonenter(n,t,i);i.tbody.childNodes[i.tbody.childNodes.length-1]==u&&i.addRow()}})}},onchange:function(n,t){if(this.dirty=!0,this.options.onchange!=null)this.options.onchange(this,n,t)},removeRow:function(n){var t=this;scil.Utils.confirmYes("Delete this row?",function(){var i=scilligence.Utils.getParent(n,"TR"),r;if(t.options.grouping){do r=i.nextSibling,i.parentNode.removeChild(i),i=r;while(i!=null&&i.getAttribute("newgroup")!="1")}else i.parentNode.removeChild(i);if(t.options.onchange!=null)t.options.onchange(this);t.dirty=!0})},selectColumns:function(n,t,i){scil.Table.selectColumns(this,n,t,i)},allColsForDownload:function(){return scil.Table.allColsForDownload(this)},showHideColumns:function(){var n=this;this.selectColumns("Show/Hide Columns",function(t){n.showHideColumns2(t)},function(n){return!n.ishidden})},showHideColumns2:function(n){var t,i;for(t in this.items)this.showColumn(t,n==null||t==""||this.hasCol(n,t));if(i=scil.Utils.array2str(n,","),scil.Utils.isNullOrEmpty(this.options.hidecolumncookiekey)||scil.Utils.createCookie(this.options.hidecolumncookiekey+"_scil_table_hidecols",i,3650),this.options.onshowhidecolumns!=null)this.options.onshowhidecolumns(this)},hasCol:function(n,t){for(var i=0;i<n.length;++i)if(n[i].key==t)return!0;return!1},_hideCookieCols:function(n){var r,i,t,u;if(!scil.Utils.isNullOrEmpty(this.options.hidecolumncookiekey)&&(r=scil.Utils.readCookie(this.options.hidecolumncookiekey+"_scil_table_hidecols"),!scil.Utils.isNullOrEmpty(r)))for(i=r.split(","),t=0;t<i.length;++t)u=n[i[t]],u!=null&&(n[i[t]].ishidden=!0)}});scil.apply(scil.Table,{kPushLeftWidth:5e3,headerstyles:{whiteSpace:"nowrap",verticalAlign:"top",backgroundColor:"#d5d7d8"},makeDraggable:function(n){scil.Utils.unselectable(n.tbody.parentNode);new scil.DnD(n.tbody.parentNode,{onstartdrag:function(t){var i=t.target||t.srcElement,r;if(i!=null&&i.style.cursor=="move"||(i=i.parentNode,i!=null&&i.style.cursor=="move"))return r=scil.Utils.getParent(i,"TR"),r!=null&&r.parentNode==n.tbody?n.options.grouping&&r.getAttribute("newgroup")!="1"||n.options.subtable&&r.getAttribute("subtable")=="1"?null:r:void 0},oncreatecopy:function(n,t){for(var f=t.src,e=scil.Utils.getMaxZindex(),u=scil.Utils.createTable(document.body,0,0,{position:"absolute",zIndex:e+1,border:"solid 1px #888",background:"white",opacity:.8}),o=scil.Utils.createElement(u,"tr"),r=f.childNodes,i=0;i<Math.min(8,r.length);++i)td=r[i].cloneNode(!0),td.style.width=r[i].offsetWidth+"px",td.style.height=r[i].offsetHeight+"px",o.appendChild(td);return u.parentNode},ondrop:function(t,i){var u,f,e,r;if(i.copy!=null&&i.copy.parentNode.removeChild(i.copy),u=scil.Utils.getParent(t.target||t.srcElement,"TR"),u!=null&&u.parentNode==n.tbody)if(n.options.ondrop!=null)n.options.ondrop(i.src,u,n);else{if(i.src==u)return;if(n.options.grouping&&u.getAttribute("newgroup")!="1"||n.options.subtable&&u.getAttribute("subtable")=="1")return;if(f=scil.Table._getChildren(n,i.src),e=scil.Table._getChildren(n,u),f[f.length-1].nextSibling==u)for(r=0;r<e.length;++r)n.tbody.removeChild(e[r]),n.tbody.insertBefore(e[r],f[0]);else{for(r=0;r<f.length;++r)n.tbody.removeChild(f[r]);for(r=0;r<f.length;++r)n.tbody.insertBefore(f[r],u)}n.onchange(t,null);n.updateRowColor!=null&&n.updateRowColor()}}})},_getChildren:function(n,t){var r=[t],i;if(n.options.grouping)for(i=r[r.length-1].nextSibling;i!=null&&i.getAttribute("newgroup")!="1";)r.push(i),i=i.nextSibling;else if(n.options.subtable)for(i=r[r.length-1].nextSibling;i!=null&&i.getAttribute("subtable")=="1";)r.push(i),i=i.nextSibling;return r},allColsForDownload:function(n){var r=[],t,i;for(t in n.items)scil.Utils.isNullOrEmpty(t)||n.items[t]==null||n.items[t].type=="hidden"||(i=n.items[t],r.push({key:t,caption:i.label,type:i.type,width:i.width}));return r},selectColumns:function(n,t,i,r){var f,u;if(n.selColDlg==null){var e=this;n.selColDlg=scil.Form.createDlgForm("Select Columns",{table:{type:"table",columns:{caption:{label:"Caption",width:400},key:{label:"Key",width:100,iskey:!0}},options:{rowcheck:!0,viewonly:!0}}},{label:"OK",onclick:function(){e.selectColumns2(n)}},{hidelabel:!0})}n.selColDlg.show(t);n.selColDlg.callback=i;f=[];for(u in n.items)n.items[u]==null||scil.Utils.isNullOrEmpty(u)||n.items[u].type=="hidden"||f.push({caption:n.items[u].label,key:u,rowchecked:r==null?null:r(n.items[u],u)});n.selColDlg.form.setData({table:f});n.selColDlg.moveCenter()},selectColumns2:function(n){for(var u,i,f=[],e=n.selColDlg.form.fields.table.jsd,r=e.getData(null,null,!0),t=0;t<r.length;++t)r[t].rowchecked==!0&&(u=r[t].key,i=n.items[u],f.push({key:u,caption:i.label,type:i.type,width:i.width}));n.selColDlg.callback!=null&&n.selColDlg.callback(f);n.selColDlg.hide()},create:function(n,t,i,r,u){typeof t=="string"&&(t=scil.byId(t));var e=scil.Utils.createElement(t,"div"),f=new scil.Table(r);if(f.render(e,i),u!=!1&&n.load!=null)scil.onload(function(){n.load()});return f},listPages:function(n,t,i,r,u,f){var v,e,o,h,c,a,s,l;if(n!=null){if(v=null,u!=null&&u.countperpage!=null&&(v=u.countperpage.value),scil.Utils.removeAll(n),n.style.clear="left",n.style.display="",u!=null&&(u.pagejumpto=null,u.countperpage=null),n.nextSibling!=null&&n.nextSibling.style!=null&&(n.nextSibling.style.clear="left"),t>=1&&i>1){for(--t,i<=10?(e=0,o=i):(e=t-5,e<0&&(e=0),o=e+10,t<=5&&++o,o>i&&(o=i),i-t>6?(i>12&&t>=7&&++e,o-e<9&&(e=o-9,e<0&&(e=0))):(e=i-11,e<0&&(e=0))),h=25,i>10&&(c=Math.ceil(scil.Utils.log10(i)),h=c>3?11*c:c>2?13*c:15*c),a=this.createPage(n,scil.Lang.res("Previous"),t>0?t:null,r),a.style.padding="0 3px 0 3px",e>0&&(this.createPage(n,1,1,r,h),e>1&&this.createPage(n,"...",null,r,h)),s=e;s<t;++s)this.createPage(n,s+1,s+1,r,h);for(this.createPage(n,t+1,null,r,h,!0),s=t+1;s<o;++s)this.createPage(n,s+1,s+1,r,h);o<i&&(o+1<i&&this.createPage(n,"...",null,r,h),this.createPage(n,i,i,r,h));a=this.createPage(n,scil.Lang.res("Next"),t+1<i?t+2:null,r);a.style.padding="0 3px 0 3px"}u!=null&&(i>1&&(scil.create(n,"span",scil.Lang.res("Jump to")+":",{paddingLeft:"20px"}),u.pagejumpto=scil.create(n,"input",null,{width:28}),scil.connect(u.pagejumpto,"onkeydown",function(n){n.keyCode==13&&(u.refresh(),n.preventDefault())})),l=u.options.perpagecounts,l!=null&&(l[0]>0&&l.splice(0,0,""),(t>1||i>1||this.canchangecount(f,l))&&(scil.create(n,"span",scil.Lang.res("Count")+":",{paddingLeft:"20px"}),u.countperpage=scil.create(n,"select"),scil.Utils.listOptions(u.countperpage,l,v),scil.connect(u.countperpage,"onchange",function(n){u.refresh();n.preventDefault()}))));u!=null&&u.pagejumpto==null&&u.countperpage==null&&(n.style.display="none");n.nextSibling!=null&&n.nextSibling.style!=null&&(n.nextSibling.style.clear="left")}},canchangecount:function(n,t){for(var i=0;i<t.length;++i)if(t[i]>0)return n>t[i];return!1},createPage:function(n,t,i,r,u,f){var s=null,e={border:"1px solid #ccc",display:"table",float:"left",width:u==null?"":u+"px",textAlign:"center",margin:"1px",whitespace:"nowrap"},o;return JSDraw2.Skin!=null&&JSDraw2.Skin.kRoundish&&(e.borderRadius=JSDraw2.Skin.kBigRadius),i!=null?(e.color="#333",e.background="",e.cursor="pointer",s=function(){r(i)}):f?(e.color="#fff",e.background=scil.App.config.frame):(e.color="#ccc",e.background=""),o=scil.Utils.createElement(n,"div",t,e,null,i==null?null:s),scil.Utils.unselectable(o),o},rows2xml:function(n){var t,i,r,u,f;if(n==null)return null;for(t="<table>",i=0;i<n.length;++i){r=n[i];t+="<r>";for(u in r)f=r[u],scil.Utils.isNullOrEmpty(f)||(t+="<i n='"+scil.Utils.escXmlValue(u)+"'>"+scil.Utils.escXmlValue(f)+"<\/i>");t+="<\/r>"}return t+"<\/table>"},xml2rows:function(n){var t=null,r,s,u,i,f,h,e,o,c;typeof n=="object"?t=n:typeof n=="string"&&(r=scil.Utils.parseXml(n),r!=null&&(t=r.documentElement||r.firstElementChild));s=[];try{t!=null&&t.getElementsByTagName==null&&(t=null)}catch(o){}if(t!=null)for(u=t.getElementsByTagName("r"),i=0;i<u.length;++i){for(f={},h=u[i].getElementsByTagName("i"),e=0;e<h.length;++e)o=h[e],c=o.getAttribute("n"),f[c]=o.text||o.textContent;s.push(f);f.__isnew=scil.Utils.isTrue(u[i].getAttribute("isnew"))}return s},pivotRows:function(n,t,i,r){var o,e,s,f,u,h;if(n==null||t==null||!(t.length>0)||i==null||!(i.length>0))return null;for(o={},f=0;f<i.length;++f)u=i[f],o[u]={};for(r==null&&(r="/"),u=0;u<n.length;++u){for(e=n[u],s=null,f=0;f<t.length;++f)u=t[f],s+=(u==null?null:r)+e[u],delete e[u];for(f=0;f<i.length;++f)u=i[f],h=s+r+u,e[h]=e[u],delete e[u],o[u][cols]=1}return o}});scil.Table.Print=scil.extend(scil._base,{constructor:function(n,t){this.dlg=null;this.iframe=null;this.source=n;this.table=null;this.options=t==null?{}:t;this.createDlg()},showTable:function(){var u=this.iframe.contentWindow.document.body,r=scil.clone(this.source.options),n,t,i;r.viewonly=!0;this.table=new scil.Table(r);n={};for(t in this.source.items)n[t]=scil.clone(this.source.items[t]);this.table.render(u,n);i=null;i=this.options.checkedonly?this.source.getCheckedRowData():this.source.getData();this.table.setData(i)},createDlg:function(){var n=this,t=scil.Utils.createElement(null,"div"),i=scil.Utils.createElement(t,"div",null,{textAlign:"center",marginBottom:"5px"}),r;return scil.Utils.createButton(i,{label:"Print Table",onclick:function(){scil.Utils.isIE?n.iframe.contentWindow.document.execCommand("print",!1,null):n.iframe.contentWindow.print()}}),scil.Utils.createElement(i,"span","&nbsp;"),scil.Utils.createButton(i,{label:"Hide Columns",type:"a",onclick:function(){n.table.showHideColumns()}}),this.iframe=scil.Utils.createElement(t,"iframe",null,{border:"solid 1px gray",width:this.options.width>0?this.options.width:800,height:this.options.height>0?this.options.height:500},{frameBorder:0}),scil.connect(this.iframe,"onload",function(){n.iframe.contentWindow.document.write("<html><body><\/body><\/html>");n.showTable()}),r=new scilligence.Dialog(this.options.title==null?"Print Preview":this.options,t),r.show(),r}});scil.Tree=scil.extend(scil._base,{constructor:function(n,t,i,r){var f,u;this.container=n;this.options=t==null?{}:t;this.solo=i!=null?i:this.options.solo;this.dropdown=r!=null?r:this.options.dropdown;this.onAddItem=null;this.onSelectItem=null;this.onExpandItem=null;this.cur=null;this.margin=20;this.idname="id";f=this;scil.Utils.removeAll(n);u=this.options.forecolor==null?scil.Form.kForeColor:this.options.forecolor;this.container.style.color=u},walk:function(n){return this._walk(this.container.childNodes,n)},_walk:function(n,t){var i,r,f,u,e;if(n!=null)for(i=0;i<n.length;++i)if((r=n[i],t(r.item,r)==!0)||(f=r.firstChild,u=f.nextSibling,u!=null&&(e=this._walk(u.childNodes,t),e)))return!0;return!1},filter:function(n){n!=null&&(n=scil.Utils.trim(n).toLowerCase(),n==""&&(n=null));this._filter(this.container.childNodes,n)},_filter:function(n,t){for(var r,u,i,f=!1,e=0;e<n.length;++e)r=n[e],u=r.firstChild,t==null?(r.style.display="",i=u.nextSibling,i!=null&&this._filter(i.childNodes,t)):u.innerText.toLowerCase().indexOf(t)>=0?(r.style.display="",f=!0):(i=u.nextSibling,i!=null&&this._filter(i.childNodes,t)?f=!0:r.style.display="none");return f},clear:function(){scil.Utils.removeAll(this.container)},reloadCur:function(){this.cur!=null&&this.reload(this.cur)},removeChild:function(n){return n==null?!1:(n.firstChild.nextSibling!=null&&n.removeChild(n.firstChild.nextSibling),!0)},reload:function(n){if(this.removeChild(n)){if(n.removeAttribute("loaded"),!n.item.leaf){var t=this._expand(n);this.onExpand(t)}return!0}},getCurRoot:function(){return this.getRoot(this.cur)},getRoot:function(n){if(n==null)return null;for(var t=this.getParent(n),i=n;t!=null;)i=t,t=this.getParent(i);return i},getParent:function(n){return n.parentNode==null||n.parentNode==this.container?null:n.parentNode.parentNode},add:function(n,t,i){var h,f,u,r,a,o,e,s,c,y;if(t==null)return null;if(t.length!=null){for(h=0;h<t.length;++h)this.add(n,t[h]);return null}typeof n=="string"&&(n=this.find(null,n));t._more&&(t.leaf=!0);this.options.onAddItem!=null?t=this.options.onAddItem(t):this.onAddItem!=null&&(t=this.onAddItem(t));u=null;n==null?f=this.container:(f=n.firstChild.nextSibling,f==null&&(f=scil.Utils.createElement(n,"div",null,{marginLeft:this.margin+"px"})));i?(u=scil.Utils.createElement(null,"div"),f.insertBefore(u,f.firstChild)):u=scil.Utils.createElement(f,"div");u.item=t;var l="blank",e=null,v=null;return t.leaf||t.disabled?t.leaf==2&&(l="arrow2_right",e="#ccc"):(l="arrow2_right",v="Expand"),r=scil.Utils.createElement(u,"div",null,{padding:scil.Tree.kPadding,whiteSpace:"nowrap"}),a=this,scil.icon(r,l,{width:16,color:e},{title:v},function(n){a.onExpand(n.srcElement||n.target)}),this.dropdown&&(o="blank",e=null,t.shortcut?o="shortcut":t.status!=null&&(s=t.status.toLowerCase(),s=="closed"?(o="lock",e="#00a"):s=="witnessed"||s=="archived"?(o="lock",e="orange"):s=="void"&&(o="trash",e="red")),scil.icon(r,o,{width:12,color:e})),t.svg!=null?scil.icon(r,t.svg,{width:16,verticalAlign:"text-top"}):t.icon!=null&&(t.icon.indexOf("/")<0&&(t.icon="img/icons/"+t.icon+".gif"),scil.Utils.createElement(r,"img",null,{paddingRight:this.options.icongap},{src:t.icon})),c=t.name,(t.translate||t.translate!=!1&&this.options.translate)&&(c=scil.Lang.res(c)),y=scil.Utils.createElement(r,"span",t._more?"<u style='color:blue;cursor:pointer'>more...<\/u>":c,null,{title:t.tooltip||t.title}),r.className="tbar",t.disabled?(r.style.color="gray",r.setAttribute("disabled","on")):(r.style.cursor="pointer",scil.connect(r,"onclick",function(n){var t=scil.Utils.getParent(n.target||n.srcElement,"span");if(t!=null&&t!=r.firstChild)a.onclick(r.parentNode)})),this.add(u,t.children),n!=null&&this.expand(n,!0),t.expand==!1&&this.expand(u,!1),t.selected&&this.select(u),u},onclick:function(n){var t,i;n!=null&&(n.item!=null&&n.item.onclick!=null?(t=n.item.onclick,typeof t=="string"?(i=scil.Utils.eval("function(node){"+t+"}"),i(n)==!0&&this.select(n)):n.item.onclick(n)==!0&&this.select(n)):this.select(n))},expand:function(n,t){var r=n.firstChild,i=r.firstChild;r.nextSibling==null?(i.innerHTML=scil.Icons.blank,i.firstChild.style.width="16px",i.firstChild.style.height="16px",i.removeAttribute("title")):(r.nextSibling.style.display=t?"":"none",this._expand(n,t))},_expand:function(n,t){var i=n.firstChild.firstChild;return i.innerHTML=scil.Icons[t?"arrow2_down":"arrow2_right"],i.firstChild.style.width="16px",i.firstChild.style.height="16px",i},shrinkSiblings:function(n){for(var i=n.parentNode.childNodes,t=0;t<i.length;++t)i[t]!=n&&this.expand(i[t],!1)},onExpand:function(n){var n=scil.Utils.getParent(n,"span"),i,r,t;if(n==null)return null;if((i=n.parentNode,i.tagName=="DIV"&&i.className=="tbar")&&(r=null,t=i.parentNode,t==null||t.item==null||!t.item.leaf)){if(this.options.url==null||t.getAttribute("loaded")=="1"||i.nextSibling!=null){r=i.nextSibling==null||i.nextSibling.style.display=="none";this.expand(t,r);r&&this.solo&&this.shrinkSiblings(t);return}this.onExpandItem!=null&&this.onExpandItem(t,r)||this.loadNodes(t)}},afterAjaxCall:function(n,t,i,r){if(this.options.onAfterAjaxCall==null||this.options.onAfterAjaxCall(n,r)!="cancel"){if(t.item._more){var u=t.parentNode;u.removeChild(t);t=u.parentNode}else{if(t.getAttribute("loaded")=="1"){i!=null&&i(t);return}t.setAttribute("loaded","1")}n.rows!=null&&n.rows.length>0?this.add(t,n.rows):n.length>0&&this.add(t,n);this.expand(t,!0);i!=null&&i(t)}},loadNodes:function(n,t){var u=this,r;if(n.item.children!=null){this.afterAjaxCall(n.item.children,n,t,null);return}var i=n.item;i._more&&(r=this.getParent(n),i=scil.clone(r.item),scil.apply(i,n.item));this.onAjaxData!=null&&(i=this.onAjaxData(n));this.options.url!=null&&this.options.url!=""&&scil.Utils.ajax(this.options.url,function(r){u.afterAjaxCall(r,n,t,i)},i,{popup:!1,beforeload:null,afterload:null})},select:function(n){if(typeof n=="string"&&(n=this.find(null,n)),n==null)return null;if(n.item!=null&&n.item.selectable==!1){if(n.firstChild!=null)this.onExpand(n.firstChild.firstChild);return}if(n.item!=null&&n.item._more){this.loadNodes(n);return}if(this.cur!=null&&(this.cur.firstChild.style.background=""),this.cur=n,this.dropdown&&this.cur!=null&&(this.cur.firstChild.style.background=scil.App.config.button),this.cur.firstChild.style.background=scil.App.config.button,this.onSelectItem!=null){var t=null;this.cur!=null&&(t=this.cur.firstChild.nextSibling==null);this.onSelectItem(this.cur,t)}},getIconText:function(n){if(n==null)return null;var t=n.firstChild.childNodes[2];return t.tagName=="SPAN"?t.innerHTML:"<img src='"+t.src+"'>"+t.nextSibling.innerHTML},setCurrent:function(n,t){var i=this.find(null,n,t);return i!=null&&this.select(i),i},find:function(n,t,i){var o=n==null?this.container:n.firstChild.nextSibling,f,u,r,e;if(o==null)return null;for(i==null&&(i=scil.Utils.isNullOrEmpty(this.options.key)?"id":this.options.key),f=o.childNodes,u=0;u<f.length;++u){if(r=f[u],r.item!=null&&r.item[i]==t)return r;if(e=this.find(r,t,i),e!=null)return e}return null},getChildren:function(n){var t=n==null?this.container:n.firstChild.nextSibling;return t==null?null:t.childNodes},getParent:function(n){return n.parentNode.parentNode}});scil.apply(scil.Tree,{kPadding:"3px 0 3px 0"});scil.DatePicker=scil.extend(scilligence._base,{constructor:function(n,t){typeof n=="string"&&(n=document.getElementById(n));this.input=n;this.disablepopup=!1;this.options=t==null?{}:t;var i=this;scil.connect(n,"onclick",function(){scilligence.DatePicker.show(i)})},getFormat:function(){var n=scil.Utils.isNullOrEmpty(this.options.dateformat)?JSDraw2.defaultoptions.dateformat:this.options.dateformat;return scil.Utils.isNullOrEmpty(n)&&(n="yyyy-mm-dd"),n},formatDate:function(n){return scil.Utils.dateStr(n,!0,this.getFormat())},show:function(){this.options.startdate=="today"&&(this.options.startdate=scil.Utils.today());this.options.enddate=="today"&&(this.options.enddate=scil.Utils.today());scilligence.DatePicker.show(this)},hide:function(){scilligence.DatePicker.hide()}});scilligence.apply(scilligence.DatePicker,{cellwidth:30,dropdown:null,area:null,title:null,dp:null,year:null,month:null,date:null,show:function(n){var t,i;n.disablepopup||(this.create(),this.dp=n,this.date=this.setDate(n.input.value),this.year=this.date.getFullYear(),this.month=this.date.getMonth()+1,this.loadMonth(this.year,this.month),t=scil.Utils.getZindex(n.input),this.dropdown.style.zIndex=t==null?10:t+1,scil.DatePicker.dropdown.style.display="",i=JsUtils.getOffset(n.input,!0,!0),scil.DatePicker.dropdown.style.left=i.x+"px",scil.DatePicker.dropdown.style.top=i.y+n.input.offsetHeight+"px")},setDate:function(n){var t=this.parseDate(n);return t==null?new Date:t},parseDate:function(n){if(n==null)return null;var t=n.split("-");return t.length!=3?null:t[2].length==4?t[0]==3?scil.Utils.time(t[2]+"-"+t[0]+"-"+t[1]):scil.Utils.time(t[2]+"-"+t[1]+"-"+t[0]):scil.Utils.time(n)},hide:function(){scilligence.DatePicker.dropdown!=null&&(scilligence.DatePicker.dropdown.style.display="none",this.dp!=null&&this.dp&&this.dp.input.focus());this.dp=null},isDropdownVisible:function(){return scilligence.DatePicker.dropdown!=null&&scilligence.DatePicker.dropdown.style.display!="none"},clickOut:function(n){var i=n.srcElement||n.target,t;(this.dp==null||i!=this.dp.input)&&(t=JsUtils.getParent(i,"TBODY"),t!=this.area&&t!=this.header&&this.hide())},create:function(){var t,i,r,u,n;this.dropdown==null&&(t=this,scil.connect(document,"onclick",function(n){t.clickOut(n)}),i=scil.Utils.createTable(document.body,0,1,{border:JSDraw2.Skin.dialog.border,backgroundColor:JSDraw2.Skin.dialog.bkcolor,textAlign:"center",display:"none",position:"absolute"}),this.dropdown=i.parentNode,scil.connect(this.dropdown,"onclick",function(n){t.select(n.srcElement||n.target)}),r=JsUtils.createElement(JsUtils.createElement(i,"tr"),"td",null,{padding:"5px"}),this.area=scil.Utils.createTable(r,0,0,{backgroundColor:"#fff"}),u=JsUtils.createElement(JsUtils.createElement(this.area,"tr",null,{backgroundColor:"#ddd"}),"td",null,null,{colSpan:7}),n=JsUtils.createElement(this.area,"tr"),JsUtils.createElement(n,"td","Su",{width:this.cellwidth,color:"gray"}),JsUtils.createElement(n,"td","Mo",{width:this.cellwidth}),JsUtils.createElement(n,"td","Tu",{width:this.cellwidth}),JsUtils.createElement(n,"td","We",{width:this.cellwidth}),JsUtils.createElement(n,"td","Th",{width:this.cellwidth}),JsUtils.createElement(n,"td","Fr",{width:this.cellwidth}),JsUtils.createElement(n,"td","Sa",{width:this.cellwidth,color:"gray"}),this.header=scil.Utils.createTable(u,0,0,{width:"100%"}),n=JsUtils.createElement(this.header,"tr"),JsUtils.createElement(n,"td","&lt;",{cursor:"pointer",color:"blue",textDecoration:"none"},{title:JSDraw2.Language.res("Previous Month")}),JsUtils.createElement(n,"td","&lt;&lt;",{cursor:"pointer",color:"blue",textDecoration:"none"},{colSpan:2,title:JSDraw2.Language.res("Previous Year")}),this.title=JsUtils.createElement(n,"td",null,{textAlign:"center",fontWeight:"bold"}),JsUtils.createElement(n,"td","&gt;&gt;",{cursor:"pointer",color:"blue",textDecoration:"none"},{colSpan:2,title:JSDraw2.Language.res("Next Year")}),JsUtils.createElement(n,"td","&gt;",{cursor:"pointer",color:"blue",textDecoration:"none"},{title:JSDraw2.Language.res("Next Month")}))},select:function(n){if(n.tagName=="TD"&&n.style.cursor=="pointer")if(n.innerHTML=="&lt;"||n.innerHTML=="<")--this.month,this.month==0&&(--this.year,this.month=12),this.loadMonth(this.year,this.month);else if(n.innerHTML=="&gt;"||n.innerHTML==">")++this.month,this.month==13&&(++this.year,this.month=1),this.loadMonth(this.year,this.month);else if(n.innerHTML=="&lt;&lt;"||n.innerHTML=="<<")--this.year,this.loadMonth(this.year,this.month);else if(n.innerHTML=="&gt;&gt;"||n.innerHTML==">>")++this.year,this.loadMonth(this.year,this.month);else{var t=parseInt(n.innerHTML);this.dp.input.value=this.dp.formatDate(new Date(this.year,this.month-1,t));try{this.dp.input.onchange!=null&&this.dp.input.onchange();scil.Utils.fireEvent(this.dp.input,"change",!1,!0)}catch(n){}this.hide()}},loadMonth:function(n,t){for(var f,r=this.area,i=r.childNodes.length-1;i>=2;--i)r.removeChild(r.childNodes[i]);var u=new Date(n,t-1,1),e=u.getDay(),o=new Date(t==12?n+1:n,t==12?0:t,1),s=Math.round((o.getTime()-u.getTime())/864e5);for(i=0;i<e;++i)this.loadDay(null);for(i=0;i<s;++i)this.loadDay(i+1,this.makeDate(n,t,i+1));f=["January","February","March","April","May","June","July","August","September","October","November","December"];this.title.innerHTML=JSDraw2.Language.res(f[t-1])+", "+n},makeDate:function(n,t,i){return new Date(n,t-1,i)},loadDay:function(n,t){var u=this.area,r=u.childNodes[u.childNodes.length-1],i;r.childNodes.length==7&&(r=JsUtils.createElement(u,"tr"));i={};n!=null&&(i.cursor="pointer");(r.childNodes.length==0||r.childNodes.length==6)&&(i.color="gray");n==this.date.getDate()&&(i.textDecoration="underline",this.year==this.date.getFullYear()&&this.month==this.date.getMonth()+1&&(i.backgroundColor="yellow"));t!=null&&(this.dp.options.startdate!=null&&t<this.dp.options.startdate||this.dp.options.enddate!=null&&t>this.dp.options.enddate)&&(i.color="#ccc",i.cursor="");JsUtils.createElement(r,"td",n,i)}});scil.Dropdown=scilligence.extend(scil._base,{constructor:function(n,t){var i,r;this.e=null;this.drop=null;this.selected=null;this.onselect=t;this.tree=null;i=this;this.e=typeof n=="string"?document.getElementById(n):n;this.e.innerHTML="&nbsp;";scil.style(this.e,{border:"solid 1px #7F9DB9",padding:"1px 5px 1px 5px",backgroundImage:scil.Utils.imgSrc("img/dropdown.gif",!0),backgroundRepeat:"no-repeat",backgroundPosition:"right center"});scil.connect(this.e,"onmousedown",function(){i.show(!0)});JsUtils.isIE||(r=JsUtils.styleRect(this.e),r.width>0&&(this.e.style.width=r.width-12+"px"));this.drop=JsUtils.createElement(document.body,"div",null,{display:"none",backgroundColor:"white",border:"solid 1px gray",position:"absolute",zIndex:999});scil.connect(document.body,"onmousedown",function(n){var t=n.srcElement||n.target;i.drop.style.display=="none"||t==i.e||scilligence.Utils.isChildOf(t,i.drop)||i.show(!1)});scil.connect(document.body,"onkeydown",function(n){n.keyCode==27&&i.show(!1)});this.tree=new scilligence.Tree(this.drop,null,!0,!0);this.tree.onSelectItem=function(n,t){i.onSelectItem(n,t)}},onSelectItem:function(n,t){if(!t){n!=null&&(this.tree.expand(n,!0),this.tree.shrinkSiblings(n));return}var i=n.item.id;if(this.setValue(i,this.tree.getIconText(n)),this.show(!1),this.onselect!=null)this.onselect(this.selected)},setValue:function(n,t){this.selected=n;this.e.innerHTML=t==null||t==""?"&nbsp;":t},getValue:function(){return this.selected},getItem:function(n){for(var i=this.drop.childNodes,t=0;t<i.length;++t)if(i[t].getAttribute("key")==n)return i[t];return null},list:function(n,t){var u=this,r,i;t&&this.tree.clear();for(r in n)i=n[r],typeof i=="string"&&(n[r]={name:i,id:i,leaf:!0});this.tree.add(null,n)},show:function(n){var t,i,r;if(!n){this.drop.style.display!="none"&&(this.drop.style.display="none");return}this.drop.style.display!=""&&(t=scil.Utils.getZindex(this.e),t>0||(t=999),i=JsUtils.getOffset(this.e),r=scil.Utils.getScrollOffset(this.drop),scil.style(this.drop,{zIndex:t+1,display:"",width:this.e.offsetWidth-(JsUtils.isIE?0:2)+"px",left:i.x+r.x-(JsUtils.isIE?1:0)+"px",top:i.y+r.y+this.e.offsetHeight+"px"}))}});scil.DropdownCheck=scil.extend(scil._base,{constructor:function(n,t,i){var u,f,r;this.e=null;this.drop=null;this.disabledropdown=!1;u=null;t!=null&&(t.length>0?u=t:(u=t.items,this.options=t));this.options==null&&(this.options={});r=this;this.e=typeof n=="string"?document.getElementById(n):n;this.e.tagName!="INPUT"&&(this.e.innerHTML="&nbsp;");scil.connect(this.e,"onmousedown",function(){r.show(!0)});JsUtils.isIE||(f=JsUtils.styleRect(this.e),f.width>0&&(this.e.style.width=f.width-12+"px"));this.drop=JsUtils.createElement(document.body,"div",null,{display:"none",backgroundColor:"white",border:"solid 1px gray",position:"absolute",maxHeight:"300px",overflowY:"scroll",zIndex:999});scil.connect(document.body,"onmousedown",function(n){var t=n.srcElement||n.target;r.drop.style.display=="none"||t==r.e||t==r.drop||scilligence.Utils.isChildOf(t,r.drop)||r.show(!1)});scil.connect(document.body,"onkeydown",function(n){n.keyCode==27&&r.show(!1)});i!=null&&(this.e.value=i);u!=null?this.updateList(u):(t.url!=null||t.listurl!=null)&&(r=this,scil.Utils.jsonp(t.url||t.listurl,function(n){r.updateList(n)}))},showDropdown:function(){this.e.setAttribute("readOnly","readonly");scil.style(this.e,{border:"solid 1px #7F9DB9",padding:"2px 6px",backgroundImage:scil.SVG.asBackground("arrow2_down","#aaa",!0),backgroundRepeat:"no-repeat",backgroundPosition:"right center"})},updateList:function(n){var t,i,f,u,e;if(scil.Utils.removeAll(this.drop),n!=null){var o=this,s=this.parseValues(this.e.value),h=JsUtils.createTable(this.drop,0,0,{width:"100%"}),r=n;if(n.length>0)for(r={},t=0;t<n.length;++t)r[n[t]]=n[t];t=0;for(i in r)(++t,t==1&&scil.Utils.isNullOrEmpty(i))||(f=JsUtils.createElement(h,"tr"),u=JsUtils.createElement(f,"td",null,{width:"5%"}),i=="-"?(u.setAttribute("colSpan",2),JsUtils.createElement(u,"hr",null,{padding:0,marginTop:"2px",marginBottom:"2px"})):(e=JsUtils.createElement(u,"checkbox",null,null,{_key:scil.Utils.unescXmlValue(i)}),s[i]&&(e.checked=!0),scil.connect(e,"onchange",function(){o.itemChecked()}),JsUtils.createElement(f,"td",r[i],{width:"95%"})))}},parseValues:function(n){var i,r,t;if(scil.Utils.isNullOrEmpty(n))return{};for(i=n.split(","),r={},t=0;t<i.length;++t)r[i[t]]=!0;return r},updateChecks:function(){for(var i,r=this.parseValues(this.e.value),t=this.drop.getElementsByTagName("input"),n=0;n<t.length;++n)i=t[n].getAttribute("_key"),t[n].checked=r[i]==!0},itemChecked:function(){for(var r,t="",i=this.drop.getElementsByTagName("input"),n=0;n<i.length;++n)i[n].checked&&(r=i[n].getAttribute("_key"),t+=(t==""?"":",")+r);if(this.e.value=t,this.options.onchange!=null)this.options.onchange(this)},isFromDrop:function(n){return n!=null&&scil.Utils.isChildOf(n.srcElement||n.target,this.drop)},isDropdownVisible:function(){return this.drop!=null&&this.drop.style.display==""},hide:function(){this.show(!1)},show:function(n){if(n==null&&(n=!0),!n){if(this.drop.style.display!="none"&&(this.drop.style.display="none",this.options.onhide!=null))this.options.onhide(this);return}this.disabledropdown||(this.showDropdown(),this.drop.style.display!=""&&scil.AutoComplete.position(this.drop,this.e,this.options.minautowidth),this.updateChecks())}});scilligence.DropdownButton=scilligence.extend(scilligence._base,{constructor:function(n,t){var f,i,r,u;this.auto=null;this.options=t==null?{}:t;f=this;this.button=typeof n=="string"?document.getElementById(n):n;scil.connect(this.button,"onclick",function(){f.show()});i=this.options.dropdown==null?this.options.expandright?"&#9654;":"&#9660;":this.options.dropdown;this.button.tagName=="TABLE"?(r=this.button.getElementsByTagName("TD"),u=r[r.length-1],scil.Utils.createElement(u,"span",i,{color:t.color}),this.options.expandright&&(u.style.verticalAlign="bottom")):this.options.expandright?scil.Utils.createElement(this.button,"span",i,{fontSize:"50%"}):scil.Utils.createElement(this.button,"span",i,{fontSize:"50%"})},isVisible:function(){return this.auto!=null&&this.auto.style.display!="none"},show:function(){this.isVisible()||(this.options.onshowdropdown==null||this.options.onshowdropdown(this)!="cancel")&&this.show2()},show2:function(){var n,t,f,i,r,u,e;this.auto==null&&(n=this,t=this.options.width,!(t>0)&&scil.Utils.isIE&&scil.Utils.isIE<=8&&(t=200),f=scil.Utils.isFixedPosition(this.button)?"fixed":"absolute",i={borderRadius:"1px",border:JSDraw2.Skin.dialog.border,backgroundColor:JSDraw2.Skin.dialog.bkcolor,display:"none",position:f,width:t,boxShadow:JSDraw2.Skin.menu.boxshadow},this.options.framecolor!=null&&(i.backgroundColor=this.options.framecolor),r=scil.Utils.createTable(document.body,0,1,i),this.auto=r.parentNode,u="#fff",scil.App.skin=="7.0"&&(this.auto.style.backgroundColor=JSDraw2.Skin.kToolbarColor,u=null),e=JsUtils.createElement(JsUtils.createElement(r,"tr"),"td",null,{padding:"5px"}),this.area=scil.Utils.createElement(e,"div",null,{backgroundColor:u}),scil.connect(document.body,"onmousedown",function(t){var i=t.srcElement||t.target;i==n.q||scil.Utils.isChildOf(i,n.auto)||n.clickout()}),this.list(this.options.items,this.options.form));this.position()},hide:function(){this.isVisible()&&(this.auto.style.display="none")},resetItems:function(n){this.options.items=n;this.auto=null},position:function(){var n=scil.Utils.getOffset(this.button,!0,!0),r,t,i;this.auto.style.position=n.fixedposition?"fixed":"absolute";r=scil.Utils.getZindex(this.button)+1;this.options.expandright?(t=n.x+this.button.offsetWidth+1,i=n.y):(t=n.x,i=n.y+this.button.offsetHeight);scil.style(this.auto,{zIndex:r,display:"",x:0,y:0});scil.Utils.moveToScreen(t,i,this.auto)},list:function(n,t){var u,f,e,i,r;if(n!=null&&n.length!=0){if(this.auto.style.display!=""&&this.position(),n.length==null){u=[];for(f in n)u.push({label:n[f],key:f});n=u}for(this.itemcount=0,scil.Utils.removeAll(this.area),e=this,i=0;i<n.length;++i)(r=n[i],r=="-"&&(i==0||n[i-1]=="-"||i==n.length-1)||scil.Utils.isNullOrEmpty(r))||(++this.itemcount,r.form=t,this.createItem(r))}},createItem:function(n){var r,u,t,i,o,e,s,f;if(n=="-"){r={margin:0,padding:0,borderColor:scil.App.config==null?null:scil.App.config.frame};this.options.framecolor!=null&&(r.borderColor=this.options.framecolor);scil.App.skin=="7.0"&&(r.borderColor=JSDraw2.Skin.kToolbarTextColor);scil.Utils.createElement(this.area,"hr",null,r);return}(typeof n=="string"&&(n={label:n}),n!=null&&n.type!="hidden")&&(u=this.options.translate?scil.Lang.res(n.label):n.label,n.key==null&&u!=n.label&&(n.key=n.label),t=scil.Utils.createElement(this.area,"div",null,{whiteSpace:"nowrap",padding:"3px 10px 3px 10px",backgroundColor:n.bgcolor,paddingLeft:n.paddingleft==null?null:n.paddingleft,color:JSDraw2.Skin.menu.color,cursor:"pointer"},{url:n.url,key:n.key,bgcolor:n.bgcolor,title:n.tooltip||n.title}),scil.App.skin=="7.0"&&(t.style.backgroundColor="",t.style.color=JSDraw2.Skin.kToolbarTextColor),i=t,n.items!=null&&n.items.length>0&&(o=scil.Utils.createTable(t,0,0,{width:"100%"}),e=scil.Utils.createElement(o,"tr"),i=scil.Utils.createElement(e,"td",null,{textAlign:"left"}),scil.Utils.createElement(e,"td","&#9658;",{paddingLeft:"10px",textAlign:"right",fontSize:"50%"})),s=n.pinicon==null?"data:image/png;base64,R0lGODlhBwAJAIAAAP///wAAACH5BAEAAAAALAAAAAAHAAkAAAIHhI+py+1cAAA7":n.pinicon,scil.Utils.createElement(i,"img",null,null,{src:s}),n.svg!=null?scil.icon(i,n.svg,{marginRight:"5px",verticalAlign:"text-top",fill:t.style.color,width:n.imagewidth>0?n.imagewidth:16}):n.icon!=null&&scil.Utils.createElement(i,"img",null,{marginRight:"5px"},{src:n.icon,width:n.imagewidth}),u!=null&&scil.Utils.createElement(i,"span",u,{fontSize:"90%"}),f=this,n.items!=null&&n.items.length>0?(n.expandright=!0,n.dropdown="",n.framecolor=this.options.framecolor,new scil.DropdownButton(t,n)):(n.key==null&&n.label!=null&&(n.key=n.label),scil.connect(t,"onclick",function(i){if(n.onclick!=null)n.onclick(i,n);f.click(i,t)})),scil.connect(t,"onmouseover",function(n){f.mouseover(n,t)}),scil.connect(t,"onmouseout",function(n){f.mouseout(n,t)}))},getItem:function(n){var t=n.srcElement||n.target;return t.tagName!="DIV"&&(t=scil.Utils.getParent(t,"DIV")),t},mouseover:function(n){var t=this.getItem(n);scil.App.skin=="7.0"?t.style.backgroundColor=JSDraw2.Skin.kToolbarHoverColor:(t.style.backgroundColor="#ddf",t.style.color=JSDraw2.Skin.menu.highlightcolor)},mouseout:function(n){var t=this.getItem(n),i;scil.App.skin=="7.0"?t.style.backgroundColor="":(i=t.getAttribute("bgcolor"),t.style.backgroundColor=scil.Utils.isNullOrEmpty(i)?"#fff":i,t.style.color=JSDraw2.Skin.menu.color)},clickout:function(){this.hide()},click:function(n){var t=this.getItem(n),r=t.getAttribute("url"),i=t.getAttribute("key");if(this.options.callback!=null)this.options.callback(i==null||i==""?t.innerText||t.textContent:i,r,this);else if(this.options.onclick!=null)this.options.onclick(i==null||i==""?t.innerText||t.textContent:i,r,this);else r!=null&&(this.options.target==null?window.location=r:window.open(r,this.options.target));this.hide()}});scil.User={form:null,medlg:null,_timer:null,countrycodes:{"":"","+43":"Austria +43","+32":"Belgium +32","+55":"Brazil +55","+1":"Canada +1","+86":"China +86","+45":"Denmark +45","+358":"Finland +358","+33":"France +33","+49":"Germany +49","+299":"Greenland +299","+852":"Hong Kong +852","+91":"India +91","+353":"Ireland +353","+39":"Italy +39","+81":"Japan +81","+82":"Korea +82","+52":"Mexico +52","+64":"New Zealand +64","+47":"Norway +47","+48":"Poland +48","+351":"Portugal +351","+65":"Singapore +65","+34":"Spain +34","+268":"Swaziland +268","+46":"Sweden +46","+41":"Switzerland +41","+44":"UK +44","+1":"US +1"},backgroundimages:30,kMFADyas:30,kMFAOptions:{"":"",sms:"By SMS",email:"By Email"},kRememberDevice:!0,backgrounditems:{},fields:{error:{type:"html",hidelabel:!0,render:function(n){return"<div title='"+scil.Utils.escXmlValue(n)+"' style='width:200px;color:red;overflow:hidden;text-overflow:ellipsis;'>"+(n==null?"":n)+"<\/div>"},labelstyle:{background:"",border:"",verticalAlign:"middle"}},email:{label:"Email",width:200,style:{padding:"6px",textAlign:"left"},labelstyle:{background:"",border:"",verticalAlign:"middle"}},password:{label:"Password",emailfield:"email",type:"password",width:200,style:{padding:"6px",textAlign:"left",whiteSpace:"nowrap"},labelstyle:{background:"",border:"",verticalAlign:"middle"}},mfacode:{type:"hidden"}},viewButtons:null,onSetLoginData:null,onlogin:null,options:{kAjax:"ajax.ashx?cmd=",kCookieKey:"__scil_login_email",kMFACodeKey:"__scil_mfacode",kDarkModeKey:"__scil_darkmode",loginpage:"Login.aspx",homepage:"Home.aspx",object:"user",timeout:0,roles:null,findpassword:!0,logindlgdisabled:!1},getFields:function(){return scil.OktaUI.enabled?scil.apply(this.fields.password,{type:"okta",width:120,onfinish:function(){scil.User.login()}}):scil.AzureUI.enabled&&scil.apply(this.fields.password,{type:"azure",width:120,onfinish:function(){scil.User.login()}}),this.fields},changePassword:function(n){if(this.changePwdDlg==null){var t=this;this.changePwdDlg=scil.Form.createDlgForm("Change Password",{currentpassword:{label:"Current Password",type:"password"},password:{label:"New Password",type:"password"},password2:{label:"Confirm Password",type:"password"}},{label:"Save",onclick:function(){t.changePassword2()}})}this.changePwdDlg.show();this.changePwdDlg.callback=n},changePassword2:function(){var n=this,t=this.changePwdDlg.form.getData();scil.Utils.ajax("ajax.ashx?cmd=user.changepassword",function(){n.changePwdDlg.hide();n.changePwdDlg.callback!=null&&n.changePwdDlg.callback()},t)},isAdmin:function(){var n=scil.App.config==null?null:scil.App.config.title;return n!=null&&scil[n]!=null&&scil[n].user!=null&&scil[n].user.isadmin},init:function(n,t,i,r,u){if(scil.ready(function(){var f=scil.byId("__scil_main");f.setAttribute("width","");f.setAttribute("align","center");scil.User.init2(n,t,i,r,u)}),this.backgroundimages>0&&this.canusebackground()){var f=new Date,e,o=f.getFullYear()+"-"+(f.getMonth()+1)+"-"+f.getDate();e=this.backgrounditems[o]!=null?this.backgrounditems[o]:f.getDate()%this.backgroundimages+".jpg";document.body.style.backgroundImage="url(background/"+e+")";document.body.style.backgroundSize="100%"}},canusebackground:function(){return!0},getSavedEmail:function(){return JsUtils.readCookie(this.options.kCookieKey)},init2:function(n,t,i,r,u){typeof n=="string"&&(n=scil.byId(n));u!=null&&scil.apply(this.options,u);var o=this,f=scil.Utils.createTable(n,0,0,{background:"rgba(255,255,255,0.9)",border:"solid 1px "+scil.App.config.frame,borderRadius:"5px",margin:"50px 0 0 0",boxShadow:JSDraw2.Skin.dialog.boxshadow}),e=scil.Utils.createElement(scil.Utils.createElement(f,"tr"),"td");scil.Utils.createElement(e,"img",null,{width:200,margin:"70px 70px 20px 70px"},{src:scil.App.imgBig(scil.App.config.logo)});e=scil.Utils.createElement(scil.Utils.createElement(f,"tr"),"td",null,{padding:"0 0 10px 0"});this.table=f.parentNode;this.form=new scil.Form({labelinbox:!0});this.form.render(e,this.getFields(),{buttons:this.getLoginButtons(),align:"center",hidelabel:!0,backgroundcolor:""});scil.connect(this.form.fields.password,"onkeydown",function(n){n.keyCode==13&&o.form.fields.email.value!=""&&(o.login(),n.preventDefault())});this.setFormData(this.form);scil.OktaUI.enabled?this.form.fields.password.jsd.show():scil.Animation.translateY(f.parentNode,500)},setFormData:function(n){var t={email:JsUtils.readCookie(this.options.kCookieKey),mfacode:JsUtils.readCookie(this.options.kMFACodeKey),password:""};if(this.onSetLoginData!=null)this.onSetLoginData(t,n);n.setData(t);t.email==null||t.email==""?n.fields.email.focus():n.fields.password.focus()},canFindPassword:function(){return this.options.findpassword},getLoginButtons:function(){var t=this,n=[{svg:"key",label:"Login",width:216,style:{padding:"8px"},onclick:function(){t.login(null)}}];if(this.canFindPassword()&&n.push({label:"<div style='font-size:80%;text-align:right;padding-top:8px'>"+scil.Lang.res("Reset Password")+"<\/div>",type:"a",onclick:function(){t.showFindpassword()}}),n.push({label:"<div style='font-size:60%;text-align:center;padding-top:20px'><img src='"+scil.App.imgBig("Scilligence.png")+"'/><br>Powered by Scilligence<\/div>",type:"a",url:"https://www.scilligence.com",target:"_blank"}),this.onLoginButtons!=null)this.onLoginButtons(n);return n},showFindpassword:function(){if(this.findpasswordDlg==null){var n=this;this.findpasswordDlg=scil.Form.createDlgForm("Reset Password",{email:{label:"Email",width:260}},{label:"Send Me Email",onclick:function(){n.findpassword()}})}this.findpasswordDlg.show()},showResetPassword:function(){var i,r,n,u,t;this.resetpasswordDlg==null&&(i=this,r={email:{label:"Email",width:260},data:{type:"hidden"},password:{label:"Password",type:"password",width:260},password2:{label:"Confirm Password",type:"password",width:260}},this.resetpasswordDlg=scil.Form.createDlgForm("Reset Password",r,{svg:"save",label:"Change Password",onclick:function(){i.resetPassword()}}));n=window.location+"";u=n.indexOf("?");n=n.substr(u+1);t=n.indexOf(",");this.resetpasswordDlg.show();this.resetpasswordDlg.form.setData({email:n.substr(0,t),data:n.substr(t+1)})},findpassword:function(){var t=this,n=this.findpasswordDlg.form.fields.email.value;n.length>0&&scil.Utils.ajax(this.options.kAjax+"user.findpassword",function(){t.findpasswordDlg.hide();alert("A verification email has been sent to your email box:\n\n"+n+"\n\nIt will lead you to set a new password.")},{email:n})},resetPassword:function(){var n=this.resetpasswordDlg.form.getData(),t;if(n.password!=n.password2){alert("Passwords do not match.");return}t=this;scil.Utils.ajax(this.options.kAjax+"user.resetpassword",function(){t.resetpasswordDlg.hide();scil.Utils.alert("Password set successfully.");window.location=t.options.loginpage},n)},needLogin:function(n){return n!=null&&n.errcode=="NeedLogin"?(scil.Utils.alert("Your session has timed out. Please log in."),this.showLoginDlg(),!0):!1},onAjax:function(){this.form==null&&this.resetTimeout()},resetTimeout:function(){this._timer!=null&&(clearTimeout(this._timer),this._timer=null);JSDraw2.defaultoptions.sessiontimeout>0&&(this._timer=setTimeout(function(){scil.User.timeout()},JSDraw2.defaultoptions.sessiontimeout*6e4))},timeout:function(){this._timer!=null&&(clearTimeout(this._timer),this._timer=null);(scil.App.config==null||scil.app.config.title!="JSDraw")&&this.showLoginDlg()},getEditFields:function(n){var t=this.getListFields(n?!1:!0);return n&&(t.email!=null&&(t.email.viewonly=!0),t.manager!=null&&(t.manager.type="html"),t.roles!=null&&(t.roles.type="html"),t.isadmin!=null&&(t.isadmin.viewonly=!0),t.employeeno!=null&&(t.employeeno.viewonly=!0),t.site!=null&&(t.site.viewonly=!0,t.site.type=null),t.dept!=null&&(t.dept.viewonly=!0,t.dept.type=null),t.expiry!=null&&(t.expiry.viewonly=!0),t.active=null,scil.pmf!=null&&(t.emailusername={label:"Email Username"},t.emailpassword={label:"Email Password",type:"password"})),t},getListFields:function(n){var t={userid:{label:"User ID",viewonly:!0,width:100,iskey:!0},email:{label:"Email",required:!0,width:250},firstname:{label:"First Name",required:!0,width:200},lastname:{label:"Last Name",required:!0,width:200},phone:{label:"Mobile Phone",type:"number",isnumber:!1,prefixes:this.countrycodes,width:150},employeeno:{label:"Employee No",width:200},manager:{label:"Manager",width:200,autosuggesturl:this.options.kAjax+"user.suggest"},site:{label:"Site",width:200,type:"select",items:scil.UserManager.sites},dept:{label:"Dept.",width:200,type:"select",items:scil.UserManager.departments},active:{label:"Active",type:"checkbox"},isadmin:{label:"Admin",type:"checkbox"},darkmode:{label:"Dark Mode",type:"checkbox"},roles:this.options.roles==null?null:{label:"User Roles",type:"dropdowncheck",items:this.options.roles},expiry:{label:"Access Expiration",type:"date"}};if(t.passwordexpiration={label:"Password Expiration",type:"html",render:function(n){return n==null?"":n<=0?"<span style='color:red'>Expired<\/span>":"<span style='color:"+(n<=10?"red":"")+"'>In "+n+" day(s)"}},n&&(t.password={label:"Password",width:150,type:"password",inTable:!1},t.password2={label:"Confirm Password",width:150,type:"password",inTable:!1}),this.onGetListFields!=null)this.onGetListFields(t);return t},manageUsers:function(n,t,i){var u=this,r=this.getListFields(!0);return scil.apply(r,i),r.userid=null,new scil.EditableTable(n,r,"User",{category:t,onSave:function(n){return u.onSaveUser(n)}})},onSaveUser:function(n){return n!=null&&n.password!=n.password2?(scil.Utils.alert("Password not matched"),!1):!0},showMe:function(){var n=this;scil.Utils.ajax(this.options.kAjax+this.options.object+".loadme",function(t){n.showMe2(t)})},showMe2:function(n){if(this.medlg==null){var t=this,i=[{svg:"save",label:"Save",onclick:function(){t.saveMe()}}];this.medlg=scil.Form.createDlgForm("Me",this.getEditFields(!0),i)}if(n.darkmode=scil.App.isOsDarkmode(),this.onShowMe!=null)this.onShowMe(n);this.medlg.show();this.medlg.form.setData(n)},saveMe:function(){var n=this.medlg.form.getData(),t;if(n.password!=n.password2){scil.Utils.alert("Password not matched");return}if(n.darkmode!=null&&JsUtils.createCookie(this.options.kDarkModeKey,n.darkmode,90),this.onSaveMe!=null)this.onSaveMe(n);t=this;scil.Utils.ajax(this.options.kAjax+this.options.object+".saveme",function(){t.medlg.hide();window.location.reload()},n)},showUser:function(n){var t=this;scil.Utils.ajax(this.options.kAjax+this.options.object+".load",function(n){t.showUser2(n)},{userid:n})},showUser2:function(n){if(this.userdlg==null){var t=this;this.userdlg=scil.Form.createDlgForm("User",this.getEditFields(!0),this.viewButtons,{viewonly:!0})}if(this.onShowUser!=null)this.onShowUser(n);this.userdlg.show();this.userdlg.form.setData(n)},showLicenseMsg:function(n,t){var i=null,r="Please contact Scilligence Support (<a href='mailto:support@scilligence.com'>SUPPORT@SCILLIGENCE.COM<\/a>)";i=n<0?"Your software license has expired. "+r+".":"Your software license has expired. "+r+" within ("+n+") "+(n<2?"day":"days")+" to prevent disruption of service.";scil.Utils.alert2(i,"License Expiration",t)},timeoutButton:function(n,t){n.disabled=!0;n.style.color="gray";n.innerHTML=scil.Lang.res("Resend in ")+t+scil.Lang.res(" second(s)");--t<=0?(n.style.color="green",n.disabled=!1,n.innerHTML=scil.Lang.res("Resend")):setTimeout(function(){scil.User.timeoutButton(n,t)},1e3)},mfasendcode:function(n){var t=this.mfadlg.form.getData();scil.Utils.ajax(this.options.kAjax+this.options.object+".mfa.issuecode",function(){var t=n.target||n.srcElement;scil.User.timeoutButton(t,scil.User.kMFADyas)},t)},mfaverify:function(n,t){if(this.mfadlg==null){var i=this,r={userid:{type:"hidden"},mfasession:{type:"hidden"},method:{label:"Verify Method",type:"select",items:this.kMFAOptions,button:{label:"Send",onclick:function(n){i.mfasendcode(n)}}},mfacode:{label:"Code Received"}};scil.User.kRememberDevice&&(r.remember={type:"checkbox",str:"Remember this device"});this.mfadlg=scil.Form.createDlgForm("MFA",r,{label:"Verify",onclick:function(){i.mfaverify2()}},{onenter:function(){i.mfaverify2()}})}this.mfadlg.show();this.mfadlg.form.setData(n);this.mfadlg.callback=t},mfaverify2:function(){var n=this,t=this.mfadlg.form.getData();if(scil.Utils.isNullOrEmpty(t.mfacode)){scil.Utils.alert("Please enter MFA code");return}scil.Utils.ajax(this.options.kAjax+this.options.object+".mfa.verify",function(i){if(n.mfadlg.hide(),t.remember){var r=JSDraw2.encryptpassword(i.mfacode);JsUtils.createCookie(n.options.kMFACodeKey,r,30)}n.mfadlg.callback!=null?n.mfadlg.callback(i.mfacode):n.login(null,null,i.mfacode)},t)},login:function(n,t,i){var r=null,u,f;if(this.form!=null)r=this.form;else if(this.dlg!=null)r=this.dlg.form;else return null;u=this;r.setFieldValue("error","");f=r.getData();i!=null&&(f.mfacode=i);scil.Utils.ajax(this.options.kAjax+this.options.object+".login",function(n){if(n.mfaverify)u.mfaverify(n);else{if(u.onAjaxCall!=null&&u.onAjaxCall(n,r))return;u.login2(n,f)}},f,{showprogress:!0,onError:function(n){u.form!=null?(r.setFieldValue("error",n.error||n.message),scil.Animation.shake(u.table,function(){r.fields.password.focus()})):u.dlg!=null&&(r.setFieldValue("error",n.error||n.message),scil.Animation.shake(u.dlg.dialog,function(){r.fields.password.focus()}))}})},login2:function(n,t){var i,r;JsUtils.createCookie(this.options.kCookieKey,t.email,365);i=this;n!=null&&n.passwordexpiration>0?(r=n.passwordexpiration-1,scil.Utils.confirm("Your password is going to expire "+(r>1?"in "+r+" days":"today")+".  Change it now?",function(n){n?i.changePassword(function(){i.login3()}):i.login3()})):n!=null&&n.licexpdays!=null?this.showLicenseMsg(n.licexpdays,function(){i.login3()}):this.login3()},login3:function(){if(this.onlogin!=null)this.onlogin();else if(this.dlg!=null)this.dlg.hide();else{var n=window.location+"",t=n.indexOf("?");t>0?(n=n.substr(t+1),scil.Utils.endswith(n,"/login.aspx")&&(n=n.substr(0,n.lastIndexOf("/"))),window.location=n):window.location=this.options.homepage}},logout:function(){var n=this;scil.Utils.confirmYes("Log out?",function(){scil.Utils.ajax(n.options.kAjax+n.options.object+".logout",function(){n.logout2()})})},logout2:function(){window.location=this.options.loginpage},showLogin:function(){window.location=this.options.loginpage},showLoginDlg:function(){var n,t;if(this.options.logindlgdisabled)return window.open(this.options.loginpage,"_blank"),!0;if(this.form==null){n=scil.clone(this.fields);for(t in n)n[t].labelstyle=null;this.dlg==null&&(this.dlg=scil.Form.createDlgForm("Login",n,this.getLoginButtons(!0),{onenter:function(){scil.User.login(null)},labelinbox:!0,hidelabel:!0,opacity:95}));this.dlg.show();this.setFormData(this.dlg.form)}},getAuthorName:function(){return null},getAuthorID:function(){return null}};scil.Login=scil.User;scil.UserManager={cmd:"user",kAddProjectCmd:"project.member.save",sites:[],departments:[],projectcategories:[],tabs:null,categories:[{name:"Admin",category:"admin",leaf:!0},{name:"Active",category:"active",leaf:!0},{name:"Inactive",category:"inactive",leaf:!0}],init:function(n){var i={caption:"Users",key:"category",name:"name",root:{selectable:!0,name:"Users",svg:"categories",expanded:!0,children:this.categories}},t;if(this.page=new scil.Page(n,i),this.tabs==null)this.users=this.page.addForm(this.tableForm(),this.page.tree),this.tabs=this.page.addTabs();else for(this.tabs=this.page.addTabs(),this.users=this.tabs.addForm(this.tableForm(),this.page.tree),t=0;t<this.tabs.length;++t)this.tabs.addForm(this.tabs[t]);scil.App.config!=null&&(scil.App.config.title=="ELN"||scil.App.config.title=="RegMol"||scil.App.config.title=="Inventory"||scil.App.config.title=="PMF"||scil.App.config.title=="Focus")&&this.addProjectMembers(this,this.tabs,this.users,!0);this.addHistortyList(this,this.tabs,this.users,!0);this.users.refresh()},addProjectMembers:function(n,t,i){var r=this;n.members=t.addForm({caption:"Member Projects",key:"userid",object:"user.projectmember",buttons:[{svg:"add",title:"Add Projects",onclick:function(){r.addProject(i,n.members)}},"-",{type:"select",label:"Role",key:"role",items:["","Read","Write","Manage"]},"-",{type:"select",key:"countperpage",label:"Count",items:["",10,25,50,100,200],onchange:function(){r.refresh()}}],columns:{projectcode:{label:"Project Code"},canread:{label:"Read",type:"checkbox"},canwrite:{label:"Write",type:"checkbox"},canmanage:{label:"Manage",type:"checkbox"}}},i)},addHistortyList:function(n,t,i){var r=this;n.history=t.addForm({caption:"User History",key:"userid",object:"user.history",buttons:["-",{type:"input",label:"Action",key:"action"},{type:"date",label:"Date",key:"dt1"},{type:"date",label:"-",key:"dt2"},"-",{type:"select",key:"countperpage",label:"Count",items:["",10,25,50,100,200],onchange:function(){r.refresh()}}],columns:{id:{label:"ID"},action:{label:"Action"},dt:{label:"Date",type:"date",timeformat:"hh:mm:ss"},ip:{label:"IP"},note:{label:"Note"}}},i)},addProject:function(n,t){var i,r,u;this.addprojectdlg==null&&(i={email:{label:"User",viewonly:!0},project:{label:"Project",autosuggesturl:"ajax.ashx?cmd=project.suggest"},canread:{label:"Read",type:"checkbox"},canwrite:{label:"Write",type:"checkbox"},canmanage:{label:"Manage",type:"checkbox"}},r=this,this.addprojectdlg=scil.Form.createDlgForm("Add Project",i,{label:"Add",onclick:function(){r.addProject2(t)}}));u=n.table.getCurrentRowData();this.addprojectdlg.show();this.addprojectdlg.form.setData({email:u.email})},addProject2:function(n){var i=this,t=this.addprojectdlg.form.getData();scil.Utils.ajax("ajax.ashx?cmd="+this.kAddProjectCmd,function(){i.addprojectdlg.form.fields.project.value="";t.projectcode=t.project;n.table.addRow(t)},t)},refresh:function(){this.users.refresh()},tableForm:function(){var n=this;return this.buttons=["-",{svg:"key",title:"Show License",onclick:function(){n.showLicense()}},{svg:"sendemail",title:"Send Emails to All Users",onclick:function(){n.sendEmails2All()}},"-",{type:"input",key:"fullname",label:"Full Name",styles:{width:100},autosuggesturl:"ajax.ashx?cmd=user.suggestall",onenter:function(){n.refresh()}},{type:"input",key:"email",label:"Email",styles:{width:100},autosuggesturl:"ajax.ashx?cmd=user.suggestemail",onenter:function(){n.refresh()}},{type:"input",key:"manager",label:"Manager",styles:{width:100},autosuggesturl:"ajax.ashx?cmd=user.suggestall",onenter:function(){n.refresh()}},{type:"input",label:"Employee No",key:"employeeno",styles:{width:100},onenter:function(){n.refresh()}},{type:"select",key:"dept",label:"Dept.",items:scil.UserManager.departments,styles:{width:100},onchange:function(){n.refresh()}},{type:"select",label:"Site",key:"site",items:scil.UserManager.sites,styles:{width:100},onchange:function(){n.refresh()}},{type:"input",label:"Role",key:"role",styles:{width:100},onenter:function(){n.refresh()}},"-",{type:"select",key:"countperpage",label:"Count",items:["",10,25,50,100],onchange:function(){n.refresh()}}],{caption:"Users",key:"userid",object:this.cmd,"import":!0,download:!0,importcaption:"Import Users",onimported:function(n){scil.Utils.alert(n)},buttons:this.buttons,columns:scil.User.getListFields(!1),formcaption:"User",savedoc:!1,pushleft:!0,fields:scil.User.getListFields(!0)}},showLicense:function(){scil.Utils.ajax("ajax.ashx?cmd=license.show",function(n){scil.Utils.alert(n)})},sendEmails2All:function(){if(this.emaildlg==null){var n=this;this.emaildlg=scil.Form.createDlgForm("Send Emails to All Active Users",{to:{label:"To",width:800},cc:{label:"CC",width:800},bcc:{label:"BCC",type:"html",template:"All Active Users"},subject:{label:"Subject",width:800},body:{label:"Body",type:"textarea",width:800,height:300},test:{label:"Test",type:"checkbox",str:"Send to To/CC only for test purpose"}},{label:"Send",onclick:function(){n.sendEmails2All2()}})}this.emaildlg.show()},sendEmails2All2:function(){var n=this,t=this.emaildlg.form.getData();scil.Utils.ajax("ajax.ashx?cmd=user.email2allusers",function(t){var i;i=t.failed?"Try to send email to "+t.count+" active user(s), but at least one failed.":"Email was sent to "+t.count+" user(s) successfully.";scil.Utils.alert(i);n.emaildlg.hide()},t,{showprogress:!0})}};scil.User.ProjectMember={url:"ajax.ashx?cmd=project.member.addmany",columns:{userid:{type:"hidden",iskey:!0},lastname:{label:"LastName"},firstname:{label:"First Name"},email:{label:"Email"},read:{label:"Read",type:"checkbox",headercheckbox:!0,editable:!0},write:{label:"Write",type:"checkbox",headercheckbox:!0,editable:!0},manage:{label:"Manage",type:"checkbox",headercheckbox:!0,editable:!0}},table:null,show:function(n,t){var i=scil.User.ProjectMember;i.table=n;i.searcher==null&&(i.searcher=new scil.Page.Search({caption:"Users",object:"user",type:"table",key:"userid",uselabel:"Add",rowcheck:!0,multiselect:!0,onbeforerefresh:function(n){n.active=1},buttons:[{key:"toproject",type:"input",label:"To Projects",autosuggesturl:"ajax.ashx?cmd=project.suggest",onchange:function(){}},"|",{key:"fullname",type:"input",label:"Full Name",autosuggesturl:"ajax.ashx?cmd=user.suggest"},"|",{key:"countperpage",type:"input",label:"Count",type:"select",items:["",10,25,50,100,250,500]}],columns:i.columns}));t==null&&n.args!=null&&(t=n.args.projectcode);this.searcher.show(function(n){return i.show2(n)},"Add Project Members");scil.Form.setButtonValueByKey(this.searcher.list.form.options.buttons,"toproject",t)},show2:function(n){for(var i,r=scil.Form.getButtonValueByKey(this.searcher.list.form.options.buttons,"toproject"),u="",t=0;t<n.length;++t)u+=n[t].userid+",";return u==""?(scil.Utils.alert("Please select some users first"),"cancel"):(i=this,scil.Utils.ajax(this.url,function(n){var t=n.added+" added; "+n.updated+" updated on project "+r;scil.Utils.isNullOrEmpty(n.errors)?scil.Message.show(t,"succeed",2e3):(t+="<br>"+n.errors,scil.Message.show(t,"error"));i.table.refresh()},{projectid:i.table.args.projectid,projectcode:r,users:scil.Table.rows2xml(n)}),"cancel")}};scil.HomePage={q:null,options:null,columns:[],div:null,onloaded:null,init:function(n,t){var i=this;scil.ready(function(){i.init2(n,t)})},init2:function(n,t){var s,r,e,h,o,a,i,u,f,c;if(typeof n=="string"&&(n=scil.byId(n)),this.options=t,this.div=n,this.options.quickstart!=null&&this.showQuickstart(this.options.quickstart),this.oninit!=null)this.oninit(this.options);if(this.options.notifications&&this.notice==null||(this.notification=scil.Utils.createElement(n,"div",null,{display:"none",marginBottom:"15px",border:"solid 1px "+scil.App.config.frame,borderRadius:JSDraw2.Skin.kBorderRadius,background:"yellow",padding:"5px"})),s=this,r=scil.Utils.createTable(n,0,0),r.parentNode.setAttribute("align","center"),e=this.options.columns==null?0:this.options.columns.length,h=e>1?e*2-1:e,this.options.search!=null){var c=scil.Utils.createElement(r,"tr"),y=scil.Utils.createElement(c,"td",null,{padding:"20px"},{colSpan:h}),l=scil.Utils.createTable(y,0,0);l.parentNode.setAttribute("align","center");i=scil.Utils.createElement(l,"tr",null,{background:"#fff"});o=scil.Utils.createElement(i,"td",null,{border:"solid 1px "+scil.App.config.line,borderRadius:JSDraw2.Skin.kBigRadius+" 0 0 "+JSDraw2.Skin.kBigRadius});this.q=scil.Utils.createElement(o,"input",null,{width:"300px",padding:"7px 10px 7px 10px",border:0});this.options.search.autosuggesturl!=null&&(this.q_auto=new scil.AutoComplete(this.q,this.options.search.autosuggesturl));scil.connect(this.q,"onkeyup",function(n){n.keyCode!=13||s.q_auto.isVisible()||s.search()});o=scil.Utils.createElement(i,"td",null,{border:"solid 1px "+scil.App.config.line,borderLeft:0,borderRadius:"0 "+JSDraw2.Skin.kBigRadius+" "+JSDraw2.Skin.kBigRadius+" 0",padding:"0 10px 0 10px",background:scil.App.config.button});scil.Utils.createButton(o,{label:this.options.search.label,tagname:"span",type:"a",onclick:function(){s.search()}});i=scil.Utils.createElement(l,"tr");scil.Utils.createElement(i,"td",this.options.search.hints,{color:"#aaa"})}if(a=scil.Utils.createElement(r,"tr",null,{fontSize:"18px",fontWeight:"bold"}),i=scil.Utils.createElement(r,"tr"),e>0)for(u=0;u<this.options.columns.length;++u){f=this.options.columns[u];u>0&&(scil.Utils.createElement(scil.Utils.createElement(a,"td"),"div",null,{width:20}),scil.Utils.createElement(scil.Utils.createElement(i,"td"),"div",null,{width:20}));var v=f.padding==null?"5px":f.padding,p=scil.Utils.createElement(a,"td",scil.Lang.res(f.caption),{width:f.width,padding:v,border:"solid 1px "+scil.App.config.frame,borderTopLeftRadius:JSDraw2.Skin.kBorderRadius,borderTopRightRadius:JSDraw2.Skin.kBorderRadius,backgroundColor:scil.App.config.frame,color:"#fff"}),o=scil.Utils.createElement(i,"td",null,{width:f.width,padding:v,border:"solid 1px "+scil.App.config.frame,borderBottomLeftRadius:JSDraw2.Skin.kBorderRadius,borderBottomRightRadius:JSDraw2.Skin.kBorderRadius,background:"#fff"},{valign:"top"});this.columns[u]={caption:p,area:scil.Utils.createTable(o)}}this.options.onloaded!=null&&(c=scil.Utils.createElement(r,"tr"),this.bottom=scil.Utils.createElement(c,"td",null,null,{colSpan:h}));this.load()},showQuickstart:function(n){var i,t;scil.Utils.readCookie("__quickstart")!="hide"&&(i=this.options.background,i==null&&(i="yellow"),t=scil.Utils.createElement(this.div,"div",null,{textAlign:"center",marginTop:"30px",background:i,padding:"10px"}),scil.Utils.createElement(t,"a",scil.Lang.res("Quick Start Manual"),null,{target:"_blank",href:n}),scil.Utils.createElement(t,"span"," ("),scil.Utils.createButton(t,{label:"Hide",type:"a",onclick:function(){scil.Utils.createCookie("__quickstart","hide");t.style.display="none"}}),scil.Utils.createElement(t,"span",")"))},search:function(){if(this.q.value==""){scil.Utils.alert("No input!");return}window.location=this.options.search.url+escape(this.q.value)},load:function(){if(this.options.columns==null||this.options.columns.length==0){if(this.options.onloaded!=null)this.options.onloaded(this.bottom);return}var n=this;scil.Utils.ajax(this.options.ajaxurl,function(t){if(n.loadData(t),n.options.onloaded!=null)n.options.onloaded(n.bottom);if(n.onloaded!=null)n.onloaded(n)})},renderNotification:function(n){var u,i,t,r,f;if((n.notifications!=null&&n.notifications.length>0||this.options.notice!=null)&&(this.notification.style.display="",this.notice!=null&&scil.Utils.createElement(this.notification,"div",this.notice,{textAlign:"center"}),n.notifications!=null&&n.notifications.length>0))for(u=scil.Utils.createTable(this.notification),u.parentNode.setAttribute("align","center"),i=0;i<n.notifications.length;++i)t=n.notifications[i],r=scil.Utils.createElement(u,"tr"),scil.Utils.createElement(r,"td",i+1+"."),scil.Utils.createElement(r,"td",scil.Utils.isNullOrEmpty(t.category)?null:"["+t.category+"]"),f=scil.Utils.createElement(r,"td"),scil.Utils.isNullOrEmpty(t.link)?f.innerHTML=t.text:scil.Utils.createElement(f,"a",t.text,null,{href:t.link})},loadData:function(n){var o=this.options.columns==null?0:this.options.columns.length,c=o>1?o*2-1:o,u,s,i,r,e;for(this.renderNotification(n),u=0;u<o;++u){var t=this.options.columns[u],h=this.columns[u],f=n[t.section];if(f==null&&(f=t.items),t.onrendercolumn!=null)t.onrendercolumn(h,n,t);if(f!=null){for(s=0;s<f.length;++s){if(i=f[s],e=scil.Utils.createElement(h.area,"tr"),t.render!=null){t.render(e,i);continue}r=scil.Utils.createElement(e,"td");i.icon!=null&&scil.Utils.createElement(r,"img",null,{paddingRight:"5px"},{src:i.icon});i=="-"||i=="|"?scil.Utils.createElement(r,"hr",null,{margin:0}):i.onclick!=null?scil.Utils.createButton(r,i):t.text==null&&t.id==null?scil.Utils.createElement(r,"a",i,null,{href:t.link+i}):scil.Utils.createElement(r,"a",i[t.text],null,{href:t.link+i[t.id],backgroundColor:scil.App.config.frame})}t.lastline!=null&&(e=scil.Utils.createElement(h.area,"tr"),scil.Utils.createElement(scil.Utils.createElement(e,"td"),"div",t.lastline))}}}};scil.Popup=scil.extend(scil._base,{constructor:function(n,t){if(this.a=typeof n=="string"?scil.byId(n):n,this.options=t==null?{}:t,this.a!=null){var i=this;scil.connect(this.a,"onmouseout",function(){scil.Popup.hide()});scil.connect(this.a,"onmouseover",function(n){scil.Popup.show(i,n)})}scil.Popup.init()},getHtml:function(n){return this.options.ongethtml2!=null?this.options.ongethtml2(this,n):(this.options.html==null&&this.options.ongethtml!=null&&(this.options.html=this.options.ongethtml(this)),this.options.html)},getCaption:function(n){return this.options.ongetcaption2!=null?this.options.ongetcaption2(this,n):this.options.caption}});scil.apply(scil.Popup,{current:null,inited:null,show:function(n,t){this.hide();this.current=n;e=new scil.Popup.Event(t);var i=this.current.getCaption(t),r=this.current.getHtml(t);if(scil.Utils.isNullOrEmpty(r)){this.hide();return}this.create();this.area.innerHTML="";this.title.innerHTML="";this.div.style.display="";this.title.innerHTML=i==null?"":i;this.area.innerHTML=r;e!=null&&this.move(e)},hide:function(){this.current=null;this.div!=null&&(this.title.innerHTML="",this.area.innerHTML="",this.div.style.display="none")},move:function(n){if(this.current!=null&&this.div!=null&&this.div.style.display!="none"){var t=n.srcElement==null?n.target:n.srcElement;if(this.current.a==t||this.isChildOf(t,this.current.a)){this.moveto(n);return}this.isChildOf(t,this.div)||this.hide()}},moveto:function(n){this.create();var r=this.scrollLeft(),u=this.scrollTop(),f=0,e=0;document.all==null?(f=window.innerWidth,e=window.innerHeight):(f=document.documentElement.clientWidth,e=document.documentElement.clientHeight);var o=this.div.offsetWidth,s=this.div.offsetHeight,t=n.clientX+r+10,i=n.clientY+u+20;t-r+o>f&&t-r-o>0&&(t-=o+15);i-u+s>e&&i-u-s>0&&(i-=s+25);this.div.style.left=t+"px";this.div.style.top=i+"px"},isChildOf:function(n,t){while(n!=null){if(n==t)return!0;n=n.parentNode}return!1},scrollLeft:function(){return this.filterResults(window.pageXOffset?window.pageXOffset:0,document.documentElement?document.documentElement.scrollLeft:0,document.body?document.body.scrollLeft:0)},scrollTop:function(){return this.filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)},filterResults:function(n,t,i){var r=n?n:0;return t&&(!r||r>t)&&(r=t),i&&(!r||r>i)?i:r},init:function(){this.inited!=!0&&(this.inited=!0,scil.connect(document,"onmousemove",function(n){scil.Popup.move(n)}))},create:function(){if(this.div==null){this.div=document.createElement("div");this.div.style.display="none";this.div.style.whiteSpace="nowrap";this.div.style.backgroundColor="white";this.div.style.borderStyle="solid";this.div.style.borderColor="#f0f0f0 #a0a0a0 #a0a0a0 #f0f0f0";this.div.style.borderWidth="2px";this.div.style.position="absolute";this.div.style.zIndex=scil.Utils.getMaxZindex();this.div.style.textAlign="left";document.body.appendChild(this.div);var n=document.createElement("div");n.style.border="1px solid highlight";n.style.padding="1px";this.div.appendChild(n);this.title=document.createElement("div");this.title.style.textAlign="center";this.title.style.border=JSDraw2.Skin.dialog.border;this.title.style.backgroundColor=JSDraw2.Skin.dialog.bkcolor;this.title.style.color="white";n.appendChild(this.title);this.area=document.createElement("div");this.area.style.padding="2px";this.area.style.backgroundColor="white";n.appendChild(this.area)}}});scil.Popup.Event=scil.extend(scil._base,{constructor:function(n){this.clientX=n.clientX;this.clientY=n.clientY;this.srcElement=n.target||n.srcElement}});scil.Help={tree:null,searchbox:null,init:function(n,t,i,r){var u,f,e;this.options=t==null?{}:t;this.options.editable=r;typeof n=="string"&&(n=scil.byId(n));this.options.title!=null&&scil.Utils.createElement(n,"h2",this.options.title,{margin:0,padding:"5px",background:"#aaf",borderBottom:"solid 1px blue"});u=this;f=null;this.options.editable&&(f=[{label:"New",onclick:function(){u.edit(!0)}}]);e={caption:this.options.topmargin>0?null:"TOC",marginBottom:"2px",marginTop:this.options.topmargin>0?"17px":null,buttons:f,onrender:function(n){u.createToc(n)}};this.page=new scil.Page(n,e,{resizable:!0,leftwidth:300});this.page.addForm({caption:"Contents",type:"custom",marginBottom:"2px",oncreate:function(n){u.createArea(n)}});i>0&&this.display(i)},createToc:function(n){var t=this,i={url:this.options.url+"?cmd=help.list"};this.tree=new scil.Tree(scil.Utils.createElement(n,"div"),i);this.tree.onAddItem=function(n){return t.onAddItem(n)};this.tree.onSelectItem=function(n,i){return t.onSelectItem(n,i)};this.tree.cur=this.tree.add(null,{name:"Help",leaf:!1});this.tree.reloadCur()},createArea:function(n){var t=this,i;this.searchdiv=scil.Utils.createElement(n,"div",null,{display:"none"});this.pages=scil.Utils.createElement(this.searchdiv,"div");i=scil.Utils.createElement(this.searchdiv,"div");this.table=new scil.Table(!0,!1);this.table.render(i,{name:{type:"html",label:"Title",template:"<a href='javascript:scil.Help.display({{helpid}})'>{?}<\/a>"}});this.displayurl=scil.Utils.createElement(n,"div");this.displaydiv=scil.Utils.createElement(n,"div");this.caption=scil.Utils.createElement(this.displaydiv,"h2");this.detail=scil.Utils.createElement(this.displaydiv,"div");this.editdiv=scil.Utils.createElement(this.displaydiv,"div",null,{display:"none",paddingTop:"10px"});this.options.editable&&(scil.Utils.createElement(this.editdiv,"button","Edit",null,null,function(){t.edit()}),scil.Utils.createElement(this.editdiv,"button","Delete",null,null,function(){t.del()}))},del:function(){if(this.detail.item!=null){var n=this;scil.Utils.confirmYes("Delete this topic?",function(){scil.Utils.ajax(n.options.url+"?cmd=help.del",function(){scil.Utils.alert("Deleted")},{helpid:n.detail.item.helpid})})}},edit:function(n){var t=!1,i;if(this.dlg==null){var r=this,u={label:"Save",onclick:function(){r.save()}};this.dlg=scil.Form.createDlgForm("Editor",{helpid:{type:"hidden"},category:{label:"Category",width:300},title:{label:"Title",width:800},body:{label:"Body",type:"htmltext",width:800,height:300}},u);t=!0}this.dlg.show();t&&this.options.tinymce&&(i={},i.buttons=[{id:"insertimage",iconurl:scil.Utils.imgSrc("img/add.gif"),tooltips:"Insert Image",onclick:function(n){r.insertImage(n)}}],i.buttons1="bold,italic,underline,strikethrough,|,fontsizeselect,|,bullist,numlist,|,outdent,indent,|,jsdrawsymbolplugin,|,sub,sup,|,insertimage",scil.Richtext.initTinyMCE(this.dlg.form.fields.body,i));n?(this.dlg.form.setData({category:this.detail.item==null?"General":this.detail.item.category}),!t&&this.options.tinymce&&this.getEd().setContent("")):(this.dlg.form.setData(this.detail.item),!t&&this.options.tinymce&&this.getEd().setContent(this.detail.item.body))},insertImage:function(n){var t=this;scil.Richtext.saveBookmark(n);scil.Utils.uploadFile("Insert Image","Choose a picture file:",this.options.url+"?cmd=help.uploadimage",function(i){var r="<img src='"+t.options.url+"?imageid="+i.imageid+"'>";scil.Richtext.restoreBookmark(n,r)})},getEd:function(){var n=this.dlg.form.fields.body.id;return tinymce.get(n)},save:function(){var t=this,n=this.dlg.form.getData();this.options.tinymce&&(n.body=this.getEd().getContent());scil.Utils.ajax(this.options.url+"?cmd=help.save",function(i){i.helpid>0&&(n.helpid=i.helpid);t.display2(n);t.dlg.hide()},n)},search:function(){var n=this;scil.Utils.jsonp(this.options.url+"?cmd=help.search",function(t){n.list(t)},{q:this.searchbox.value})},list:function(n){this.searchdiv.style.display="";scil.Table.listPages(this.pages,n.page,n.pages,function(n){me.loadPage(n)});this.table.setData(n.rows==null?n:n.rows);this.editdiv.style.display="none";this.display2(null)},onSelectItem:function(n,t){t&&this.display(n.item.helpid,!0)},display:function(n,t){if(t&&(this.searchdiv.style.display="none"),n!=null){var i=this;this.editdiv.style.display="";scil.Utils.jsonp(this.options.url+"?cmd=help.display",function(t){i.display2(t,n)},{helpid:n})}},display2:function(n,t){if(t>0){var i=window.location+"",r=i.indexOf("?");r>0&&(i=i.substr(0,r));i+="?helpid="+t;this.displayurl.innerHTML="URL: <a href='"+i+"'>"+i+"<\/a>"}else this.displayurl.innerHTML="";this.caption.innerHTML=n==null?"":n.title;this.detail.innerHTML=n==null?"":n.body;this.detail.item=n},onAddItem:function(n){return n.name==null&&n.category!=null&&(n.name=n.category),n},onLoadNode:function(){}};scil.Richtext={__id:0,__buttonid:0,fonts:null,fontsizes:null,kEdId:"__scil_form_richtext_ed",simplebuttons:"bold italic underline forecolor backcolor | alignleft aligncenter | numlist bullist outdent indent",defaultbuttons:"fullscreen | bold italic underline forecolor backcolor | alignleft aligncenter | numlist bullist outdent indent | fontselect fontsizeselect lineheightselect | subscript superscript",defaultplugins:"fullpage searchreplace autolink directionality visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists wordcount imagetools textpattern code lineheight",kDatetimeFormats:["%H:%M:%S","%I:%M:%S %p","%Y-%m-%d","%D","%d%b%Y"],generateId:function(){return"__richtext_"+ ++this.__id},saveBookmark:function(n){tinymce.isIE&&(n.focus(),n.oln_bookmark=n.selection.getBookmark())},restoreBookmark:function(n,t){n.focus();tinymce.isIE&&n.selection.moveToBookmark(n.oln_bookmark);t!=null&&n.execCommand("mceInsertContent",!1,t)},initTinyMCE:function(n,t){var r,i,u,e,f;if(JsUtils.isAndroid&&JsUtils.isAndroid<3||JsUtils.isIpad&&JsUtils.isIpad<5)return null;if(t==null&&(t={}),typeof n=="string"?r=n:((n.id==null||n.id=="")&&(n.id=this.generateId()),r=n.id),i={selector:"#"+r},t.css!=null&&(i.conent_css=t.css),i.plugins=this.defaultplugins,t.fonts!=null?i.font_formats=t.fonts:this.fonts!=null&&(i.font_formats=this.fonts),t.fontsizes!=null?i.fontsize_formats=t.fontsizes:this.fontsizes!=null&&(i.fontsize_formats=this.fontsizes),i.insertdatetime_formats=this.kDatetimeFormats,t.buttons==null&&(t.buttons=[]),t.buttons.push({tooltips:"Insert Symbol",icon:"symbol",onclick:function(n){scil.Richtext.saveBookmark(n);JSDraw2.Symbol.show(!0,function(t){JSDraw2.Symbol.hide();scil.Richtext.restoreBookmark(n,t)})}}),t.buttons.push({icon:"text",tooltips:"Insert Pre-formatted Text",onclick:function(n){scil.Richtext.insertCode(n)}}),(t.mode==null||t.mode!="simple")&&(t.buttons.push({icon:"image",tooltips:"Import Picture, Word, Chemical File",onclick:function(n){scil.Richtext.importFile(n)}}),t.buttons.push({icon:"benzene",tooltips:"Insert Structure",onclick:function(n){scil.Richtext.insertStructure(n)}}),t.formatpaint&&t.buttons.push({icon:"format_paint",tooltips:"Format Paint",onclick:function(n,t){scil.Richtext.formatPaint(n,t)}}),scil.Annotator==null||scil.Annotator.disabled||t.buttons.push({tooltips:"Inline Annotate",icon:"comment",onclick:function(n){scil.Annotator.edit(n)}}),t.editinoffice&&t.buttons.push({svg:"file-docx",tooltips:"Open in MS Word",onclick:function(n){scil.Richtext.editInOffice(n)}})),this.onaddbuttons!=null)this.onaddbuttons(t);if(t.hidetoolbar?i.toolbar=!1:(u=this.scanButtons(t.buttons),i.toolbar1=t.buttons1!=null?t.buttons1.replace("*",t.mode=="simple"?this.simplebuttons:this.defaultbuttons)+" "+u:(t.mode=="simple"?this.simplebuttons:this.defaultbuttons)+" "+u,t.buttons2!=null&&(i.toolbar2=this.scanButtons(t.buttons2)),t.buttons3!=null&&(i.toolbar3=this.scanButtons(t.buttons3)),t.buttons4!=null&&(i.toolbar4=this.scanButtons(t.buttons4))),e=this,i.setup=function(n){if(t.onsetup!=null)t.onsetup(n);e.onSetup(n,t,t.onchange,t.oninit,t.onfocus)},i.menubar=t.mode=="full"||t.menubar==!0?!0:!1,i.statusbar=!1,i.branding=!1,i.width=t.width,i.height=t.height,i.readonly=t.readonly,scil.Utils.isNullOrEmpty(t.contentstyle)?scil.Utils.isNullOrEmpty(scil.Richtext.kContentStyle)||(i.content_style="body{"+scil.Richtext.kContentStyle+"}"):i.content_style="body{"+t.contentstyle+"}",t.autoresize&&(i.plugins+=" autoresize",i.autoresize_on_init=!0,i.autoresize_bottom_margin=10,i.autoresize_min_height=t.autoresizemin>0?t.autoresizemin:100,t.autoresizemax>0&&(i.autoresize_max_height=t.autoresizemax)),i.color_map=["#BFEDD2","Light Green","#FBEEB8","Light Yellow","#F8CAC6","Light Red","#ECCAFA","Light Purple","#C2E0F4","Light Blue","#00FF00","Green","#FFFF00","Yellow","#FF0000","Red","#FF00FF","Purple","#0000FF","Blue","#169179","Dark Turquoise","#E67E23","Orange","#BA372A","Dark Red","#843FA1","Dark Purple","#236FA1","Dark Blue","#ECF0F1","Light Gray","#CED4D9","Medium Gray","#95A5A6","Gray","#7E8C8D","Dark Gray","#34495E","Navy Blue","#000000","Black","#ffffff","White"],t.ice&&(i.plugins="ice icesearchreplace "+i.plugins,i.ice={user:{name:"Unknown",id:0},preserveOnPaste:"p,a[href],i,em,b,span",deleteTag:"delete",insertTag:"insert"},t.trackingbuttons&&(i.toolbar1+=" ,|,iceacceptall,icerejectall,iceaccept,icereject")),this.setLang(i),this.onbeforeinit!=null)this.onbeforeinit(i,t);return i.init_instance_callback=function(n){var t=scil.byId(r),i=t==null?null:t.value;scil.Utils.isNullOrEmpty(i)||n.setContent(i)},t.renderlater?(i.selector=null,f=new tinymce.Editor(r,i,tinymce.EditorManager),tinymce.EditorManager.add(f),f):(tinymce.init(i),tinymce.get(r))},editInOffice:function(n){var t=n.getContent(),i=new scil.CustomWebsocket({callbackfn:function(t,i){n.setContent(t);i&&i()},filename:"dummy.docx",transfermode:"socket",filetype:"html",datatype:".docx",apitoken:"",content:escape(t)});i.editDocument()},formatChangeText:function(n,t,i){return scil.Lang.res((n||"Modified")+" by")+" "+t+" ["+scil.Utils.timeStr(i,!0)+"]"},setTracking:function(n,t){t||t==null?n.execCommand("ice_enable"):n.execCommand("ice_disable")},setLang:function(n){scil.Lang.language=="cn"&&(n.language="zh_CN")},scanButtons:function(n){var t="",r,i;if(n==null)return t;for(r=0;r<n.length;++r){if(i=n[r],typeof i=="string"){t+=i;continue}i.id==null&&(i.id="rte"+ ++this.__buttonid,t==""?t=" | ":t+=" ",t+=i.id)}return t},onSetup:function(n,t,i,r,u){var f;if(t.buttons!=null)for(f=0;f<t.buttons.length;++f)this.addButton(n,t.buttons[f]);if(t.buttons2!=null)for(f=0;f<t.buttons2.length;++f)this.addButton(n,t.buttons2[f]);if(t.buttons3!=null)for(f=0;f<t.buttons3.length;++f)this.addButton(n,t.buttons3[f]);if(t.buttons4!=null)for(f=0;f<t.buttons4.length;++f)this.addButton(n,t.buttons4[f]);n.on("BeforeSetContent",function(n){var t='<table id="__mce">';n!=null&&n.selection&&n.format=="html"&&scil.Utils.startswith(n.content,t)&&(n.content=n.content.substr(0,t.length-1)+" border='1' style='border-collapse:collapse;width:800px;'>"+n.content.substr(t.length))});if(t.formatpaint)n.on("mouseup",function(){if(n.formatpaiting){var t=n.selection.getContent();scil.Utils.isNullOrEmpty(t)||(scil.Richtext.applyFormating(n,n.formatpaiting),n.formatpaiting=null,n.dom.doc.body.style.cursor="text")}});if(scil.Spell.enabled)n.on("contextmenu",function(){var n=tinyMCE.activeEditor==null||tinyMCE.activeEditor.selection==null?null:tinyMCE.activeEditor.selection.getNode();if(scil.Spell.hasTypo(n))return!1;scil.Spell.contextmenu!=null&&scil.Spell.contextmenu.hide()});n.on("paste",function(t){scil.Richtext.onPaste(n,t)});if(i!=null)n.on("change",function(){i(n)});n.on("init",function(){var i,u;scil.Spell.enabled&&scil.Spell.connectRightClick(n);r!=null&&r(n);try{i=t.fontname;scil.Utils.isNullOrEmpty(i)&&(i=scil.Richtext.kFontName);scil.Utils.isNullOrEmpty(i)||n.execCommand("fontName",!1,i);u=t.fontsize;u>0||(u=scil.Richtext.kFontSize);u>0&&n.execCommand("fontSize",!1,u)}catch(f){}});n.on("click",function(t){var r=t.target||t.srcElement;r.tagName=="INPUT"&&(r.type=="checkbox"||r.type=="radio")&&i(n)});if(n.ui.registry.addMenuItem("importword",{text:scil.Lang.res("Import Word"),context:"file",onclick:function(){scil.Richtext.importWord(n)}}),n.ui.registry.addMenuItem("exportword",{text:scil.Lang.res("Export Word"),context:"file",onclick:function(){scil.Richtext.exportWord(n)}}),u!=null)n.on("focus",function(){u()})},applyFormating:function(n,t){for(var i in t)try{n.execCommand(i,!1,t[i])}catch(r){}},getFormating:function(n){for(var t={};n!=null&&n.style!=null&&n.tagName!="HTML";)t.italic==null&&(n.tagName=="EM"||n.tagName=="I")&&(t.italic="italic"),t.underline==null&&n.tagName=="U"&&(t.underline="underline"),t.bold==null&&(n.tagName=="B"||n.tagName=="STRONG")&&(t.bold="bold"),t.fontName==null&&(scil.Utils.isNullOrEmpty(n.style.fontFamily)||(t.fontName=n.style.fontFamily)),t.fontSize==null&&(scil.Utils.isNullOrEmpty(n.style.fontSize)||(t.fontSize=n.style.fontSize)),t.foreColor==null&&(scil.Utils.isNullOrEmpty(n.style.color)||(t.foreColor=n.style.color)),t.backColor==null&&(scil.Utils.isNullOrEmpty(n.style.backgroundColor)||(t.backColor=n.style.backgroundColor)),n=n.parentNode;return t},importWord:function(n){scil.Utils.uploadFile("Import Word","Select a Word file",JSDrawServices.url+"?cmd=office.importword",function(t){n.setContent(t.html)})},exportWord:function(n){scil.Utils.post(JSDrawServices.url+"?cmd=office.exportword",{html:n.getContent()},"_blank")},updateMenuitems:function(n,t,i){var r=null,u,f;if(typeof t=="string"){u=n.ui.registry.getAll().buttons;for(f in u)if(u[f].key==t){r=u[f];break}}return r==null||r.b==null?!1:(r.b.items=i,!0)},addButton:function(n,t){var r,u,i;t.items!=null?(r=this,u={onPostRender:function(){u.mcecontrol=this},key:t.buttonkey||t.key,text:t.label||t.text||t.tooltips,tooltip:t.title||t.tooltips,fetch:function(i){var f,e,u;if(n.onlisttoolbaritems!=null&&(f=n.onlisttoolbaritems(t,r),f!=null&&(t.items=f)),e=[],t.items!=null)for(u=0;u<t.items.length;++u)e.push(r.addMenuItems(n,t.items[u],t,t.onclick,t.onclick2));i(e)},b:t},n.ui.registry.addMenuButton(t.id,u)):typeof t=="object"&&(i=t.icon||t.svg,scil.Utils.isNullOrEmpty(i)&&(i="angry"),n.ui.registry.addIcon(i,scil.Utils.svgIcon(i,"width:20px;height:20px;")),n.ui.registry.addButton(t.id,{tooltip:t.title||t.tooltips,icon:i,key:t.key,context:t.context,onAction:function(){t.onclick(n,t)}}))},addMenuItems:function(n,t,i,r,u){var f=typeof t=="string"?t:t.label;return r!=null?{type:"menuitem",text:f,onAction:function(){r(t)}}:{type:"menuitem",text:f,onAction:function(){u(n,i,t)}}},onPaste:function(n,t){var i,s,e,r,u,f,o;if(t!=null&&t.clipboardData!=null&&JSDrawServices!=null&&JSDrawServices.url!=null){if(i=t.clipboardData.getData("text/html"),s=t.clipboardData.getData("text/rtf"),!scil.Utils.isNullOrEmpty(i)||!scil.Utils.isNullOrEmpty(i)){t.preventDefault();scil.Richtext.saveBookmark(n);scil.Utils.ajax(JSDrawServices.url+"?cmd=paste.cleanhtml",function(t){scil.Richtext.insertContents(n,t)},{html:i,rtf:s});return}if(e=t.clipboardData.getData("text/plain"),!scil.Utils.isNullOrEmpty(e)&&(r=new JSDraw2.Mol,r.setXml(e),!r.isEmpty())){scil.Utils.ajax(JSDrawServices.url+"?cmd=rte.uploadstructure",function(t){t!=null&&t.html!=null&&scil.Richtext.restoreBookmark(n,JSDraw2.Base64.decode(t.html))},{jsdraw:r.getXml()});t.preventDefault();return}for(u=0;u<t.clipboardData.items.length;u++)if(f=t.clipboardData.items[u],o=f==null?null:f.getAsFile(),o!=null&&scil.Utils.startswith(f.type,"image/")){t.preventDefault();scil.Richtext.saveBookmark(n);scil.Richtext.postFile(JSDrawServices.url+"?cmd=paste.tohtmltag",function(t){scil.Richtext.insertContents(n,t)},o);return}}},showDlg:function(n){this.createDlg(n.text)||(this.dlg.show(),tinyMCE.get(this.kEdId).setContent(n.text==null?"":n.text));this.dlg.args=n},createDlg:function(n){if(this.dlg!=null)return!1;var t=this,i={ed:{type:"textarea",value:n,width:700,height:400}};return this.dlg=scil.Form.createDlgForm("Richtext Editor",i,{label:"Save",svg:"save",onclick:function(){t._onsave()}},{hidelabel:!0}),this.dlg.form.fields.ed.id=this.kEdId,this.initTinyMCE(this.dlg.form.fields.ed),!0},_onsave:function(){s=this.getHtml(tinyMCE.get(this.kEdId));this.dlg.hide();this.dlg.args.callback!=null&&this.dlg.args.callback(s)},postFile:function(n,t,i,r){if(i!=null){r==null&&(r={});var u=new XMLHttpRequest;u.upload.onprogress=function(n){var t=n.loaded/n.total*100;console.log("Uploaded"+t+"%")};u.onload=function(){if(u.status==200){var n=u.response;scil.Utils.ajaxCallback(n,t,r.onError,r.ignoresucceedcheck)}else if(r.onError!=null)r.onError("Error");r.showprogress&&scil.Progress.hide()};u.onerror=function(){if(r.onError!=null)r.onError("Error");r.showprogress&&scil.Progress.hide()};u.open("POST",n,!0);u.setRequestHeader("Content-Type",i.type);r.showprogress&&scil.Progress.show(r.caption==null?"Loading ...":r.caption,!1,r.message==null?"Communicating with the server ...":r.message,!1);u.send(i)}},insertCode:function(n){scil.Richtext.saveBookmark(n);scil.Utils.prompt2({caption:"Insert Pre-formatted Text",message:"Paste Pre-formatted Text Below:",multiline:!0,height:240,callback:function(t){var t="<pre style='border:solid 1px #ddd; padding: 10px 2px 10px 2px; background: #eee; font-size:90%; max-height:300px; max-width:900px; overflow: auto'>"+t+"<\/pre>";scil.Richtext.restoreBookmark(n,t)}})},importFile:function(n){scil.Richtext.saveBookmark(n);scil.Utils.uploadFile("Import","Choose a file (Picture, Word, Chemical File):",JSDrawServices.url+"?cmd=rte.uploadimage",function(t){scil.Richtext.insertContents(n,t)})},importWord:function(n){scil.Richtext.saveBookmark(n);scil.Utils.uploadFile("Import","Choose a Word file:",JSDrawServices.url+"?cmd=rte.uploadword",function(t){scil.Richtext.insertContents(n,t)})},insertContents:function(n,t){t!=null&&t.html!=null&&(t.html.length>2e7?scil.Utils.confirmYes("Warning: The content is very big (>20MB).  Do you still want to insert it?  It might make this record very slow to load.",function(){scil.Richtext.restoreBookmark(n,JSDraw2.Base64.decode(t.html))}):scil.Richtext.restoreBookmark(n,JSDraw2.Base64.decode(t.html)))},formatPaint:function(n){var t=null;n.formatpaiting==null&&(t=n.selection.getNode());t!=null?(n.formatpaiting=scil.Richtext.getFormating(t),n.dom.doc.body.style.cursor=scil.SVG.asBackground("format_paint",20,!0)+",auto"):(n.formatpaiting=null,n.dom.doc.body.style.cursor="text")},insertStructure:function(n){scil.Richtext.saveBookmark(n);var t=scil.Richtext.getStructure(n.selection.getNode());scil.Richtext.showStructure(t,n)},curveFitting:function(n,t,i){var r=this.getSelectTable(n),u;if(r==null){scil.Utils.alert("No table selected");return}u=this;scil.Utils.ajax(JSDrawServices.url+"?cmd=rte.uploadcurve",function(n){if(n!=null&&n.html!=null){var u=scil.Utils.createElement(null,"span",JSDraw2.Base64.decode(n.html)),f=scil.Utils.createElement(null,"p",t+":"),i=r.table;i.tagName=="TBODY"&&(i=i.parentNode);i.parentNode.insertBefore(u.firstChild,i.nextSibling);i.parentNode.insertBefore(f,i.nextSibling)}},{data:r.data,fitmode:i})},getStructure:function(n){if(n==null||n.tagName!="IMG")return null;var t=n.getAttribute("alt");return scil.Utils.startswith(t,"JSDraw:[")&&scil.Utils.endswith(t,"]")?(t=t.substr(8,t.length-9),t.substr(0,1)=="*"&&(t=t.substr(1)),JSDraw2.Base64.decode(t)):null},saveStructure:function(n){var t=n.getHtml();scil.Utils.ajax(JSDrawServices.url+"?cmd=rte.uploadstructure",function(t){t!=null&&t.html!=null&&scil.Richtext.restoreBookmark(n.caller,JSDraw2.Base64.decode(t.html))},{jsdraw:t})},showStructure:function(n,t){var i=JSDraw.showPopup("JSDraw Editor",t!=null?"Save":"Dismiss",t!=null?function(n){scil.Richtext.saveStructure(n)}:null);i.clear();i.caller=t;i.setHtml(n)},viewStructure:function(n){var t,i;n.button==2&&(t=scil.Richtext.getStructure(n.srcElement||n.target),t!=null&&(i=new scil.ContextMenu(["View Large Structure"],function(){scil.Richtext.showStructure(t)}),i.show(n.clientX,n.clientY),n.preventDefault(),tinymce.dom.Event.cancel(n)))},getHtml:function(n,t){n.dom!=null&&n.dom.doc!=null&&this.updateCheckStatus(n.dom.doc.body);var i=t==null?n.getContent():n.getContent({format:t});return this.getHtmlBody(i)},updateCheckStatus:function(n){var r=n==null?null:n.getElementsByTagName("input"),i,t;if(r!=null)for(i=0;i<r.length;++i)t=r[i],(t.type=="checkbox"||t.type=="radio")&&(t.checked?t.setAttribute("checked","checked"):t.removeAttribute("checked"))},getHtmlBody:function(n){var t,i;return scil.Utils.startswith(n,"<!DOCTYPE")&&(t=n.indexOf("<body>"),t>0&&(t+=6),i=n.lastIndexOf("<\/body>"),i>0&&(n=scil.Utils.trim(n.substr(t,i-t)))),n},removeBlankLines:function(n){var t=n.contentDocument.body;this.removeEmptyElements(t,"span");this.removeEmptyElements(t,"p")},removeEmptyElements:function(n,t){var f=n.getElementsByTagName(t),u,i,r;if(f!=null)for(u=0;u<f.length;++u)i=f[u],r=i.innerText||i.textContent,r!=null&&r!=""&&(r.length!=1||r.charCodeAt(0)!=65279)||this.hasImgChild(i)||i.parentNode.removeChild(i)},hasImgChild:function(n){if(n==null||n.childNodes==null||n.childNodes.length==0)return!1;for(var t=0;t<n.childNodes.length;++t)if(n.childNodes[t].tagName=="IMG"||this.hasImgChild(n.childNodes[t]))return!0;return!1},removeSpaces:function(n){var i,t;if(n!=null&&n.childNodes!=null&&n.childNodes.length!=0)for(i=n.childNodes.length-1;i>=0;--i)t=n.childNodes[i],t.nodeName=="#text"&&scil.Utils.trim(t.innerText||t.textContent)==""&&n.removeChild(t)},isEmptyElement:function(n){return n==null?!0:(n=n.replace(/&nbsp;/ig," "),n=scil.Utils.trim(n),n.length==0)},replaceWithHtml:function(n,t){var r,u,i;if(n!=null&&t!=null&&t!=""){for(r=scil.Utils.createElement(null,"div",t),u=n.parentNode,i=0;i<r.childNodes.length;++i)u.insertBefore(r.childNodes[i],n);u.removeChild(n)}},cleanHtml:function(n){var t,i;if(n.undoManager.add(),scil.Spell.removeTypos(n),t=scil.Richtext.getHtml(n),t==null||t=="")return"";i=scil.Utils.createElement(null,"div");i.innerHTML=t;this.clearnHtml2(i);n.undoManager.add();n.setContent(i.innerHTML)},hasChildImg:function(n){var t=n.getElementsByTagName("img");return t!=null&&t.length>0},isTable:function(n){var t=n.tagName;return t=="TABLE"||t=="TBODY"||t=="TR"||t=="TD"||t=="TH"},clearnHtml2:function(n){var i,t;if(n!=null&&n.style!=null){if(n.tagName!=null&&n.tagName!="IMG"&&!this.isTable(n)&&!this.hasChildImg(n)&&(!this.isSectionTitle(this.nextElement(n))||!this.isSectionTitle(this.previousElement(n)))&&(i=n.innerText||n.textContent,i==null||scil.Utils.trim(i).length==0)){n.parentNode.removeChild(n);return}if(n.className!="mceNonEditable",n.className="",n.style.padding="",n.style.overflow="",n.style.textIndent="",n.style.lineHeight="",n.style.letterSpacing="",n.style.fontSize="",n.style.fontFamily="",n.childNodes!=null)for(t=n.childNodes.length-1;t>=0;--t)this.clearnHtml2(n.childNodes[t])}},nextElement:function(n){do n=n.nextSibling;while(n!=null&&n.tagName==null);return n},previousElement:function(n){do n=n.previousSibling;while(n!=null&&n.tagName==null);return n},makeArgs:function(n,t){var i={title:t.tooltips,image:t.iconurl};return i.onclick=function(){t.onclick(n)},i},subscriptNumbers:function(n){var i,t,r;if(n==null)return null;for(i="",t=n.match(/[0-9]+/);t!=null;)r=n.indexOf(t),i+=n.substr(0,r),i+="<sub>"+t+"<\/sub>",n=n.substr(r+(t+"").length),t=n.match(/[0-9]+/);return n!=null&&(i+=n),i},insertTableFromRawData:function(n){var i=this,t,r;i.saveBookmark(n);t=this.getSelectTable(n);t==null&&(r=n.selection.getContent(),t={data:this.html2table(r)});scil.Utils.prompt2({caption:"Insert Table from Raw Data",message:"Please paste raw data below:",multiline:!0,defaultvalue:t.data,height:400,callback:function(r){var u=i.raw2tablehtml(r,t.table);t.table==null&&i.restoreBookmark(n,u)}})},html2table:function(n){var s,u,f,o,e,i,r,t;if(n==null||n==""||(s=scil.Utils.createElement(null,"div",n),u=s.getElementsByTagName("tr"),u==null||u.length==0))return"";for(f=[],i=0;i<u.length;++i){for(o=u[i].getElementsByTagName("td"),r=[],t=0;t<o.length;++t)r.push(scil.Utils.getInnerText(o[t]));f.push(r)}if(f.length==0)return"";for(e="",i=0;i<f.length;++i){for(r=f[i],t=0;t<r.length;++t)e+=(t>0?"\t":"")+r[t];e+="\n"}return e},getSelectTable:function(n){var h=n.selection.getNode(),o=h==null?null:scil.Utils.getParent(h,"TABLE"),u,f,s,e,i,r,t;if(o==null||(u=o.getElementsByTagName("tr"),u==null||u.length==0))return null;for(f=[],i=0;i<u.length;++i){for(s=u[i].getElementsByTagName("td"),r=[],t=0;t<s.length;++t)r.push(scil.Utils.getInnerText(s[t]));f.push(r)}if(f.length==0)return null;for(e="",i=0;i<f.length;++i){for(r=f[i],t=0;t<r.length;++t)e+=(t>0?"\t":"")+r[t];e+="\n"}return{data:e,table:o}},raw2tablehtml:function(n,t){var e,f,s,h,o,i,u,r;if(n==null||n=="")return"";for(e=n.split("\n"),e.length==1&&n.indexOf("|")>0&&(e=n.split("|")),f=[],i=0;i<e.length;++i)if(n=scil.Utils.trim(e[i]),n!=""){for(u=[],s=n.indexOf("\t")>=0?n.split("\t"):n.indexOf(";")>=0?n.split(";"):n.indexOf(",")>=0?n.split(","):n.indexOf(" ")>=0?n.split(" "):[n],r=0;r<s.length;++r)u.push(scil.Utils.trim(s[r]));f.push(u)}if(f.length==0)return"";if(t!=null){for(t.firstChild.tagName=="TBODY"&&(t=t.firstChild),scil.Utils.removeAll(t),i=0;i<f.length;++i)for(u=f[i],h=scil.Utils.createElement(t,"tr",null,{background:i%2==0?"#eee":""}),r=0;r<u.length;++r)scil.Utils.createElement(h,"td",u[r]);return null}for(o="<table cellspacing=0 cellpadding=2 border=1>",i=0;i<f.length;++i){for(o+="<tr"+(i%2==0?" style='background:#eee'":"")+">",u=f[i],r=0;r<u.length;++r)o+="<td>"+scil.Utils.escXmlValue(u[r])+"<\/td>";o+="<\/tr>"}return o+"<\/table>"}};scil.Spell={enabled:!1,addButton:function(n,t,i){if(JSDraw2.defaultoptions.spell!=!1){var r=this;n.push({tooltips:"Spell Check",icon:t,onclick:function(n){r.removeTypos(n);var t=n.getContent();scil.Utils.ajax(i,function(t){t.errors>0&&n.setContent(t.content)},{sentence:t})}})}},hasTypo:function(n){return n!=null&&n.tagName=="SPAN"&&n.className=="molenginespell-typo"},onSpellClick:function(n,t){var e=t.srcElement||t.target,i,u,f,r,s,h,o;if(!this.hasTypo(e))return!1;if(i=[],u=e.getAttribute("suggests"),u!=null&&u!="")for(f=u.split(","),r=0;r<f.length;++r)i.push({nottranslate:!0,caption:f[r],key:f[r]});return i.length>0&&i.push("-"),i.push({caption:"Ignore",key:"@"}),this.contextmenu==null&&(s=this,this.contextmenu=new JSDraw2.ContextMenu(i,function(t,i){s.onMenu(n,t,i)})),h=scil.byId(n.id+"_ifr"),o=scil.Utils.getOffset(h,!1),this.contextmenu.show(t.clientX+o.x,t.clientY+o.y,e,i),!0},onMenu:function(n,t,i){n.undoManager.add();t!="@"&&t!=null&&typeof t!="undefined"&&(i.innerHTML=t);this.removeTypo(i)},removeTypos:function(n){var r=n.contentDocument.body,t,i;if(this.connectRightClick(n),t=r.getElementsByTagName("span"),t!=null)for(i=0;i<t.length;++i)this.removeTypo(t[i])},removeTypo:function(n){if(n.className=="molenginespell-typo")if(n.parentNode.childNodes.length==1){var t=scil.Utils.getInnerText(n);t!=null&&(n.parentNode.innerHTML=t)}else n.className="",n.removeAttribute("suggests")},connectRightClick:function(n){if(!n.__onmousedown&&n.contentDocument!=null){n.__onmousedown=!0;var t=this;scil.Utils.disableContextMenu();scil.connect(n.contentDocument,"onclick",function(){t.contextmenu!=null&&t.contextmenu.hide()});scil.Utils.isIE?(scil.connect(n.contentDocument,"onmouseup",function(i){if(i.button==2)t.onSpellClick(n,i)}),n.contentDocument.oncontextmenu=function(){return!1}):n.contentDocument.oncontextmenu=function(i){t.onSpellClick(n,i);return!1}}}};scil.BarcodePrinter={dlg:null,onprinted:null,testprinterlink:!0,options:{},windowprint:!0,init:function(n){n!=null&&(this.options=n)},show:function(n){this.show2(n)},show2:function(n){this.options.url==null&&(this.options.url="JSDraw/Service.aspx?cmd=barcode.print");this.options.printers==null&&(this.options.printers=JSDraw2.bcprinters);n!=null&&typeof n=="string"&&(n={barcode:n});this.create();this.dlg.show();this.args=n==null?{}:n;this.args.editable?(this.dlg.form.fields.barcode.disabled=!1,this.dlg.form.fields.epl.disabled=!1):(this.dlg.form.fields.barcode.disabled=!0,this.dlg.form.fields.epl.disabled=!0);this.dlg.form.setData(this.args)},edit:function(){this.dlg.form.fields.barcode.disabled=!1;this.dlg.form.fields.epl.disabled=!1},print:function(){this.print2()},print2:function(n){var i=this.dlg.form.getData(),t,r,f,u,e,o;if(scil.Utils.isNullOrEmpty(i.printer)){scil.Utils.alert("Please select a printer");return}if(t=this.args,t==null&&(t={}),r=this,scil.apply(t,i),this.onprintdata!=null)this.onprintdata(t);if(JsUtils.startswith(i.printer,"http://")||JsUtils.startswith(i.printer,"https://")||JsUtils.startswith(i.printer,"//"))if(n)window.open(i.printer,"_blank");else if(this.windowprint)if(f=!1,u=scil.Utils.isNullOrEmpty(t.xml)?null:scil.Table.xml2rows(xml),u!=null&&(u.length==1?scil.apply(t,u[0]):t.xml.length>1e3&&(f=!0)),f)scil.Utils.post(i.printer,t,"bcprinter");else{e=i.printer+"&wrapper=jsonp";for(o in t)e+="&"+o+"="+escape(t[o]);window.open(e,"bcprinter")}else scil.Utils.ajax(i.printer,function(){if(r.onprinted!=null)r.onprinted(t);scil.Utils.alert("Printed Successfully")},t);else n?scil.Utils.post(this.options.url,t,"_blank"):scil.Utils.ajax(this.options.url,function(){if(r.onprinted!=null)r.onprinted(t);scil.Utils.alert("Printed Successfully")},t)},testPrinter:function(){this.print2(!0)},create:function(){if(this.dlg==null){var i={printer:{label:"Select Printer",type:"select",options:this.options.printers},barcode:{label:"Barcode",width:500},epl:{label:"EPL/ZPL",type:"textarea",width:500,height:100},copies:{label:"Number of Copies",width:100}},n=this,t=[{svg:"printer",label:"Print",onclick:function(){n.print()}},{svg:"edit",label:"Edit",onclick:function(){n.edit()}}];this.testprinterlink!=!1&&(t.push(" "),t.push({label:"Test Printer",type:"a",onclick:function(){n.testPrinter()}}));this.dlg=scil.Form.createDlgForm(scil.Lang.res("Print Barcode"),i,t)}}};scil.Lang={token:"translate",key:"scil_lang",current:null,language:null,en:{},cn:{},add:function(n,t){if(n!=null){var i=t==null?this.en:scil.Lang[t];i==null&&(scil.Lang[t]={});scil.apply(i,n)}},setLang:function(n,t){n==null||n==""?scil.Utils.createCookie(this.key,"",-1,!0):scil.Utils.createCookie(this.key,n,180,!0);t&&window.location.reload()},use:function(n){n!=null&&(n=n.toLowerCase(),n=="zh"&&(n="cn"),this.language=n,this.current=this[n],this.current==null&&(this.current=this.en,this.language=null),JSDraw2.Language.use(n))},res:function(n,t){var r,t,i;return scil.Utils.isNullOrEmpty(n)||typeof n!="string"?n:t!=null?(r=this[t],r==null||r[n]==null?n:r[n]):(this.current==null&&(t=scil.Utils.readCookie(this.key,!0),t!=null&&t!=""&&this.use(t),this.current==null&&this.lang!=null&&this.use(this.lang),this.current==null&&(t=window.navigator.userLanguage,t!=null&&t.length>2&&this.use(t.substr(0,2)),this.current==null&&(this.current=this.en))),i=this.current==null?null:this.current[n],(i==null||i=="")&&(i=JSDraw2.Language.res(n)),i)},translate:function(n,t){var r,i;if(t==null||tag=="")this.translate(n,"span");else for(r=t.split(","),i=0;i<r.length;++i)this.translate(n,r[i])},translate2:function(n,t){var i,r,u,f;if(t!=null&&t!=""&&(i=(n==null?document:n).getElementsByTagName(t),i!=null))for(r=0;r<i.length;++r)(u=i[r],u.getAttribute(this.token)!=null)&&((f=this.reg(u.innerHTML),scil.Utils.isNullOrEmpty(f))||(u.innerHTML=f))}};scil.StickyMenu=scil.extend(scil._base,{constructor:function(n,t){this.options=t==null?{}:t;this.hasInner=typeof innerWidth=="number";this.hasElement=document.documentElement!=null&&document.documentElement.clientWidth;this.menu=typeof n=="string"?scil.byId(n):n;var i=scil.Utils.getOffset(this.menu);this.menu.style.position!="absolute"&&scil.Utils.createElement(this.menu.parentNode,"div","&nbsp;",{left:i.left,top:i.top,width:this.menu.offsetWidth,height:this.menu.offsetHeight});this.menu.style.position="absolute";this.menu.style.left=(this.options.left>0?this.options.left:i.x)+"px";this.menu.style.top=(this.options.top>0?this.options.top:i.y)+"px";this.menu.style.width=this.menu.offsetWidth+"px";this.menu.style.height=this.menu.offsetHeight+"px";this.init()},computeShifts:function(){this.shiftX=this.hasInner?pageXOffset:this.hasElement?document.documentElement.scrollLeft:document.body.scrollLeft;this.shiftX+=this.targetLeft>0?this.targetLeft:(this.hasElement?document.documentElement.clientWidth:this.hasInner?window.innerWidth-20:document.body.clientWidth)-this.targetRight-this.menu.offsetWidth;this.shiftY=this.hasInner?pageYOffset:this.hasElement?document.documentElement.scrollTop:document.body.scrollTop;this.shiftY+=this.targetTop>0?this.targetTop:(this.hasElement?document.documentElement.clientHeight:this.hasInner?window.innerHeight-20:document.body.clientHeight)-this.targetBottom-this.menu.offsetHeight},moveMenu:function(){this.computeShifts();(this.currentX!=this.shiftX||this.currentY!=this.shiftY)&&(this.currentX=this.shiftX,this.currentY=this.shiftY,document.layers?(this.menu.left=this.currentX,this.menu.top=this.currentY):(this.menu.style.left=this.currentX+"px",this.menu.style.top=this.currentY+"px"));this.menu.style.right="";this.menu.style.bottom=""},floatMenu:function(){this.moveMenu();var n=this;setTimeout(function(){n.floatMenu()},200)},supportsFixed:function(){var n=document.createElement("div"),t;return(n.id="testingPositionFixed",n.style.position="fixed",n.style.top="0px",n.style.right="0px",document.body.appendChild(n),t=1,typeof n.offsetTop=="number"&&n.offsetTop!=null&&n.offsetTop!="undefined"&&(t=parseInt(n.offsetTop)),t==0)?!0:!1},init:function(){var n,t;this.supportsFixed()?this.menu.style.position="fixed":(n=document.layers?this.menu:this.menu.style,this.targetLeft=parseInt(n.left),this.targetTop=parseInt(n.top),this.targetRight=parseInt(n.right),this.targetBottom=parseInt(n.bottom),document.layers&&(menu.left=0,menu.top=0),t=this,scil.connect(window,"onscroll",function(n){t.moveMenu(n)}),this.floatMenu())}});scil.FilePreviewer={kEmbeddingFirst:!1,options:{},show:function(n,t,i){new scil.FilePreviewer.Viewer(n,t,i)},playVideo:function(n,t,i,r,u){if(this.videoDlg==null){var f=this,e=scil.Utils.createElement(null,"div");this.vDlg=new scilligence.Dialog("Play Video",e,{onhide:function(){f.vDlg.body.innerHTML=""}})}t>0||(t=800);i>0||(i=500);this.videos={list:n,callback:u,autoplay:r,w:t,h:i,i:0};this.playNextVideo()},playNextVideo:function(){var n=this.videos.list[this.videos.i++],i,t,r,u;if(n==null){this.videos.callback!=null&&this.videos.callback();return}i="";this.videos.autoplay!=!1&&(i="autoplay");t="<video id='jsdrawvideo' width='"+this.videos.w+"' height='"+this.videos.h+"' controls "+i+" controlsList='nodownload'>";t+="<source src='"+n.url+"' type='"+n.mimetype+"'>";t+="<\/video>";this.vDlg.show("Play "+this.videos.i+"/"+this.videos.list.length+" ["+n.filename+"]");this.vDlg.body.innerHTML=t;this.vDlg.moveCenter();r=this;u=this.vDlg.body.firstChild;scil.connect(u,"onended",function(){r.playNextVideo()})}};scil.FilePreviewer.Viewer=scil.extend(scil._base,{constructor:function(n,t,i){if(this.fileid=n,this.source=i,this.dlg=null,this.parent=null,this.preview=null,this.tbody=null,this.options=t==null?scil.FilePreviewer.options:t,n==null)this.show({pages:1});else{var r=this;scil.Utils.ajax(this.options.url,function(n){n.base64!=null?scil.Utils.isSdFile(n.filename)?r.showSDF(JSDraw2.Base64.decode(n.base64)):r.showChem(n.filename,JSDraw2.Base64.decode(n.base64)):r.show(n)},{id:n,source:i},{showprogress:!0})}},showChem:function(n,t){var i=scil.Utils.getFileExt(n);JSDraw2.Editor.showPopup("Preview","Dismiss",null,{value:t,format:scil.Utils.isSpectraFile(i)?"jdx":"xml"})},showSDF:function(n){JSDraw2.Table.showPopup("Preview","Dismiss",null,{value:n})},show:function(n){var t,r,i;for(this.ret=n,this.create(),this.parent.style.width=this.options.width>0?this.options.width+"px":"850px",scil.Utils.removeAll(this.tbody),t=0;t<n.pages;++t)r=scil.Utils.createElement(this.tbody,"tr"),i=scil.Utils.createElement(r,"td",null,{borderTop:"solid 1px #eee"},{valign:"top"}),n.pages>1&&scil.Utils.createElement(i,"div",t+1,{padding:"5px",border:"solid 1px #eee"}),i=scil.Utils.createElement(r,"td",null,{borderTop:"solid 1px #eee"},{valign:"top"}),scil.Utils.createElement(i,"div","page "+(t+1)+" to be loaded",{padding:"20px",textAlign:"center",color:"#ccc"});this.loadPage(0);this.dlg.show()},scroll:function(n){for(var f,r,o=n,i=n.srcElement,s=100*i.scrollTop/(i.scrollHeight-i.clientHeight),e=this.preview.clientHeight,u=this.tbody.childNodes,t=0;t<u.length;++t)if(f=u[t].childNodes[0],r=f.offsetTop-this.preview.scrollTop,r>=0&&r<=e){this.loadPage(t-1);this.loadPage(t);this.loadPage(t+1);break}},loadPage:function(n){var u=this.tbody.childNodes[n].childNodes[0],t,i,f,r,e,o,s;if(u.getAttribute("loaded")!="1"&&(u.setAttribute("loaded",1),scil.Utils.startswith(this.options.previewurl,"data:")?t=this.options.previewurl:(t=this.options.previewurl.replace("{fileid}",this.fileid).replace("{source}",this.source),t.indexOf("{page}")>0?t=t.replace("{page}",n):t+=(t.indexOf("?")>0?"&":"?")+"page="+n),u.nextSibling.innerHTML="<img style='max-width:100%' src='"+t+"'>",i=this.ret.embeddedfiles,i!=null&&i.length!=0)){for(f=[],r=0;r<i.length;++r)e=i[r],i[r].page==n+1&&f.push({label:i[r].filename,key:this.fileid+"/"+e.page+":"+e.index+":"+e.filename});f.length>0&&(o=this,s={label:"[...]",type:"a",items:f,callback:function(n){o.loadChildPage(n)}},scil.Utils.createButton(u,s))}},loadChildPage:function(n){scil.FilePreviewer.show(n,{url:this.options.url,previewurl:this.options.previewurl})},viewFull:function(){window.open(this.url,"_blank")},create:function(){var n,t,i;this.dlg==null&&(this.parent=scil.Utils.createElement(null,"div",null,{width:850,textAlign:"center",whiteSpace:"nowrap"}),n=null,scil.FilePreviewer.kEmbeddingFirst?(n=scil.Utils.createElement(this.parent,"div"),this.preview=scil.Utils.createElement(this.parent,"div")):(this.preview=scil.Utils.createElement(this.parent,"div"),n=scil.Utils.createElement(this.parent,"div")),t=this,i=scil.Utils.getBox(),scil.apply(this.preview.style,{height:i.h-120+"px",overflowY:"auto",border:"solid 1px #eee"}),scil.connect(this.preview,"onscroll",function(n){t.scroll(n)}),this.tbody=scil.Utils.createTable(this.preview,0,0),this.dlg=new scil.Dialog("File Previewer",this.parent))}});scil.Frame={main:null,table:null,lefttoolbar:null,toptoolbar:null,left:null,right:null,middle:null,init:function(){var t,n,i,r;this.main==null&&(this.addCss(),this.main=scil.create(document.body,"div"),this.table=scil.Utils.createTable(this.main,0,0,{width:"100%",height:"100%",borderCollapse:"collapse"},1),t=document.body.getAttribute("notice"),scil.Utils.isNullOrEmpty(t)||(n=scil.create(this.table,"tr"),scil.create(n,"td",t,{display:"none",background:"red",color:"#fff",textAlign:"center"},{colSpan:4})),n=scil.create(this.table,"tr"),td=scil.create(n,"td",null,{backgroundColor:JSDraw2.Skin.kToolbarColor,verticalAlign:"top",width:"0.1%"},{rowSpan:2}),this.lefttoolbar=scil.create(td,"div",null,{width:50,paddingTop:"10px"}),td=scil.create(n,"td",null,null,{colSpan:3,width:"100%"}),this.toptoolbar=scil.create(td,"div",null,{height:26,textAlign:"right",paddingRight:"10px"}),n=scil.create(this.table,"tr"),td=scil.create(n,"td",null,{display:"none",height:"100%",verticalAlign:"top"}),this.left=scil.create(td,"div",null,{width:200,height:"100%",overflowY:"auto",overflowX:"hidden"}),td=scil.create(n,"td",null,{display:"none",height:"100%",verticalAlign:"top"}),this.middle=scil.create(td,"div",null,{width:5,height:"100%",cursor:"ew-resize"}),td=scil.create(n,"td",null,{height:"100%",width:"100%",verticalAlign:"top"}),this.right=scil.create(td,"div",null,{height:"100%",overflow:"auto"}),i=scil.byId("__scil_main"),i!=null&&this.right.appendChild(i),this.left.className=this.right.className="scilscroll",r=this,new scil.Resizable(this.middle,{direction:"x",mouseovercolor:"#ddd",onresize:function(n){return r.onresize(n)}}))},showTree:function(n){n==null||n>0||n==!0?(this.left.parentNode.style.display="",this.middle.parentNode.style.display="",this.left.style.width=(n>0?n:200)+"px"):(this.left.parentNode.style.display="none",this.middle.parentNode.style.display="none")},onresize:function(n){var t=scil.Utils.parsePixel(this.left.style.width)+n;return t>20?(this.left.style.width=t+"px",!0):!1},addCss:function(){var n=window.document.styleSheets[0];try{n.insertRule(".scilscroll::-webkit-scrollbar {width:8px;height:8px;}",n.cssRules.length);n.insertRule(".scilscroll::-webkit-scrollbar-button{background:#aaa;height:0;width:0}",n.cssRules.length);n.insertRule(".scilscroll::-webkit-scrollbar-track-piece{background:"+JSDraw2.Skin.jssdf.headercolor+"}",n.cssRules.length);n.insertRule(".scilscroll::-webkit-scrollbar-thumb{background:#aaa;border-radius:4px;}",n.cssRules.length)}catch(t){}}};scil.App={kCart:"__scil_cart",othermenus:[],apps:[],app:{icon:"./favicon.ico",url:"Home.aspx"},iconsize:40,kCopyrightYear:2021,kSupport:"support@scilligence.com",menugroup:null,oninitmenu:null,kMessageSite:null,usermenuitems:[{label:"Show Me",onclick:function(){scil.Login.showMe()}},{label:"Change Password",onclick:function(){scil.Login.changePassword()}},"-",{label:"Logout",onclick:function(){scil.Login.logout()}}],imgSmall:function(n,t){var i="small/"+n;return t&&(i="url("+i+")"),i},imgBig:function(n){return"icon/"+n},about:function(){if(scil.App.aboutDlg==null){var n=scil.App.config,t="<table cellspacing=0 cellpadding=0 style='background:#fff;margin:30px;color:gray;font-size:80%'><tr><td colspan=3 align=center><a target='_blank' href='"+n.link+"'><img style='width:200px;margin:50px 90px 0 90px;' border=0 src='"+scil.App.imgBig(n.logo)+"'><\/a><div style='font-size: 160%;color:gray;margin-bottom:50px'>Version "+JSDraw2.version+"<\/div><\/td><tr><tr><td>&copy;"+scil.App.kCopyrightYear+" Scilligence<\/td><td align=right><a target='_blank' href='http://www.scilligence.com/'>About Us<\/a><\/td> <td align=right><a target='_blank'' href='https://www.scilligence.com/web/contact-scilligence/'>Contact Us<\/a><\/td> <\/tr><\/table>";scil.App.aboutDlg=new JsDialog("About "+n.title,t,{bodystyle:{padding:0}})}scil.App.aboutDlg.show()},isOsDarkmode:function(){var n=JsUtils.readCookie(scil.Login.options.kDarkModeKey);if(n!=null)return n=="true";try{return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}catch(t){}return!1},betaDisclaimer:function(){scil.Utils.alert2("<div style='width:500px'>"+scil.Lang.res("This is a pre-release Beta test version, which might contain some bugs not captured by our QA.")+"<\/div>","Beta Declaimer")},applications:{jsdraw:{app:"",title:"JSDraw",logo:"",text:"#fff",frame:"#4B5CA9",line:"#999",button:"rgba(59,104,155,0.2)",background:"#6666cc"},pmf:{app:"P",title:"PMF",logo:"logo-pmf.png",text:"#fff",frame:"#F26524",inactiveTabBG:"#Faaf75",line:"#999",button:"#F8D6BD",background:"#8174b5",link:"http://www.scilligence.com/scilligence-pmf"},eln:{app:"E",title:"ELN",logo:"logo-eln.png",text:"#fff",frame:"#4B5CA9",inactiveTabBG:"#9CA6D3",line:"#999",button:"#D7D9F5",background:"#6666cc",help:"ScilligenceELN.pdf",link:"http://www.scilligence.com/scilligence-eln"},regmol:{app:"R",title:"RegMol",logo:"logo-regmol.png",text:"#fff",frame:"#F26524",inactiveTabBG:"#Faaf75",line:"#999",button:"#F8D6BD",background:"#52a3db",help:"ScilligenceRegMol.pdf",link:"http://www.scilligence.com/scilligence-regmol"},del:{app:"D",title:"DEL",logo:"logo-regmol.png",text:"#fff",frame:"rgb(49,15,131)",line:"#999",button:"rgba(16,97,98,0.2)",background:"#52a3db",help:"ScilligenceRegMol.pdf",link:"http://www.scilligence.com/scilligence-regmol"},inventory:{app:"I",title:"Inventory",logo:"logo-inventory.png",text:"#fff",frame:"#9A56A2",inactiveTabBG:"#B786BC",line:"#999",button:"#E7D7EA",background:"#6abb67",help:"ScilligenceInventory.pdf",link:"http://www.scilligence.com/scilligence-inventory"},sdms:{app:"S",title:"SDMS",logo:"logo-sdms.png",text:"#fff",frame:"#4B5CA9",inactiveTabBG:"#9CA6D3",line:"#999",button:"#E7D7EA",background:"#e35521",link:"http://www.scilligence.com/scilligence-sdms"},qmas:{app:"Q",title:"QMS",logo:"logo-qms.png",text:"#fff",frame:"rgb(59,104,155)",line:"#999",button:"rgba(49,104,166,0.2)",background:"#aaaa55",link:"http://www.scilligence.com"},qms:{app:"Q",title:"QMS",logo:"logo-qms.png",text:"#fff",frame:"rgb(59,104,155)",line:"#999",button:"rgba(49,104,166,0.2)",background:"#aaaa55",link:"http://www.scilligence.com/scilligence-qms"},lims:{app:"L",title:"LIMS",logo:"logo-lims.png",text:"#fff",frame:"rgb(75,103,42)",line:"#999",button:"rgba(75,103,42,0.2)",background:"#6666cc",link:"http://www.scilligence.com/scilligence-lims"},focus:{app:"F",title:"Focus",logo:"logo-focus.png",text:"#fff",frame:"#9A56A2",inactiveTabBG:"#B786BC",line:"#999",button:"#E7D7EA",background:"#05CF05",link:"http://www.scilligence.com/scilligence-focus"},bioassay:{app:"B",title:"BioAssay",logo:"logo-BioAssay.png",text:"#fff",frame:"rgb(59,104,155)",line:"#999",button:"rgba(49,104,166,0.2)",background:"#05CF05",link:"http://www.scilligence.com/scilligence-bioassay"},chrawler:{app:"C",title:"Chrawler",logo:"logo-Chrawler.png",text:"#fff",frame:"rgb(59,104,155)",line:"#999",button:"rgba(49,104,166,0.2)",background:"#00b3b3",link:"http://www.scilligence.com/scilligence-chrawler"},clinical:{app:"C",title:"Clinical",logo:"logo-Clinical.png",text:"#fff",frame:"rgb(59,104,155)",line:"#999",button:"rgba(49,104,166,0.2)",background:"#00b3b3",link:"http://www.scilligence.com"},monomerorg:{app:"M",title:"Monomer.org",logo:"logo-Monomerorg.png",text:"#fff",frame:"rgb(54,77,161)",line:"#999",button:"rgba(54,77,161,0.2)",background:"#cc9900",link:"http://www.monomer.org"},cds2:{app:"R",title:"RDS",logo:"logo-cds2.png",text:"#fff",frame:"rgb(24,97,98)",line:"#999",button:"rgba(24,97,98,0.2)",background:"#06BDF9",link:"http://www.scilligence.com"},rds:{app:"R",title:"RDS",logo:"logo-rds.png",text:"#fff",frame:"rgb(24,97,98)",line:"#999",button:"rgba(24,97,98,0.2)",background:"#06BDF9",link:"http://www.scilligence.com"}},setColors:function(){var n,i,t;if(this.config!=null&&(scil.Tabs.kHighlightColor=this.config.frame,scil.Tabs.kBorderStyle="solid 1px "+this.config.line,scil.Page.ExplorerForm.kHeaderStyle.background=this.config.frame,document.body.style.color=this.config.color,JSDraw2.Skin.form.fieldcolor=this.config.color,JSDraw2.Skin.dialog.bkcolor=this.config.frame,JSDraw2.Skin.menu.color=this.config.frame,JSDraw2.Skin.dialog.border="1px solid "+this.config.line,n=scil.byId("__scil_bottomline"),n!=null))for(n.style.color=this.config.line,n.style.borderTopColor=this.config.line,i=n.getElementsByTagName("A"),t=0;t<i.length;++t)i[t].style.color=this.config.frame},initjsdraw:function(){this.config==null&&(this.config=this.applications.jsdraw,this.setColors())},init:function(n,t,i,r,u){var o,v,l,s,f,e,a,h,c;if(this.config==null){if(this.version=u,o=scil.byId("__scil_toolbar"),f=scil.byId("__scil_toolbar_left"),this.skin=o!=null?o.getAttribute("skin"):f.getAttribute("skin"),this.config=this.skin=="5.1"||this.skin=="7.0"?this.applications[n]:null,v=this.config==null?null:this.config.text,o!=null&&this.skin!="7.0"&&(o.style.boxShadow="rgba(0, 0, 0, 0.2) 1px 1px 4px 2px"),this.skin=="7.0"&&this.configSkin70(),l=scil.byId("__scil_toolbar_app"),this.initAppButton(l),this.setColors(),this.oninitmenu!=null)this.oninitmenu(t,i,r,u);if(t!=null){if(this.othermenus!=null)for(e=0;e<this.othermenus.length;++e)t.push(this.othermenus[e]);if(i!=null&&(this.config==null?(t.push("-"),t.push({label:"Admin",type:"a",translate:!0,items:i})):t.push({label:"Admin",type:"b",svg:"gears",imgheight:40,translate:!0,items:i})),this.menugroup==null&&(s=scil.byId("__apppoint"),this.menugroup=s==null?null:s.getAttribute("menu")),f=scil.byId("__scil_toolbar_left"),f!=null&&(this.skin=="7.0"?(f.style.verticalAlign="top",f.style.background=JSDraw2.Skin.kToolbarColor):f.style.verticalAlign="bottom"),scil.App.skin=="7.0"){for(e=0;e<t.length;++e)t[e].fill=JSDraw2.Skin.kToolbarTextColor,t[e].color=JSDraw2.Skin.kToolbarTextColor,t[e].vertical=!0;t.splice(0,0,{vertical:!0,svg:this.config.title,items:this.getAppItems()})}else a="<div style='width:30px;height:30px;font-size:24px;;vertical-align:center;background:url("+this.imgBig("circle.png")+");background-size:contain'>"+this.config.app+"<\/div>",t.splice(0,0,{largetext:a,label:"&#9660;",padding:0,color:this.config.frame,title:this.app.title,type:"b",dropdown:"",items:this.getAppItems()});this._createToolbarButtons(f,t,"left",this.menugroup)}r!=null&&r.licexpdays!=null&&scil.Utils.endswith(window.location+"","home.aspx")&&this.showLicenseMsg(r.licexpdays);this.updateRightToolbar(r);this.skin!="7.0"&&(h=scil.byId("__scil_main"),h!=null&&(c=scil.Utils.getBox(),c.h>200&&(h.style.minHeight=c.h-200+"px")));f==null||r!=null||this.showguestmenu||(f.style.display="none")}},updateNotice:function(n){var t=scil.byId("__scil_notice");t!=null&&(scil.Utils.isNullOrEmpty(n)?t.style.display="none":(t.innerHTML=n,t.style.display=""))},configSkin70:function(){var n=scil.byId("__scil_notice"),t=scil.byId("__scil_toolbar_left"),i=scil.byId("__scil_toolbar_right"),r=scil.byId("__scil_rightarea"),u=scil.byId("__scil_main");n!=null&&(scil.apply(n.style,{background:"red",color:"white",textAlign:"center",position:"fixed",top:"0px",zIndex:3,width:document.body.clientWidth+"px"}),n.setAttribute("maxzindex","skip"));scil.apply(t.style,{height:"100%",width:"50px",background:JSDraw2.Skin.kToolbarColor,float:"left",color:"white",overflow:"hidden",boxSizing:"border-box",paddingTop:n==null||n.style.display=="none"?"16px":"26px",zIndex:2,position:"fixed"});scil.apply(i.style,{top:(n?n.clientHeight:"0")+"px",padding:"3px",color:"#fff",background:JSDraw2.Skin.kToolbarColor,position:"fixed",width:document.body.clientWidth+"px",zIndex:1});t.setAttribute("maxzindex","skip");i.setAttribute("maxzindex","skip");scil.apply(r.style,{height:"100%",overflowX:"auto",overflowY:"auto",display:"block",boxSizing:"border-box",paddingTop:n==null||n.style.display=="none"?null:"16px"});scil.apply(u.style,{padding:"40px 3px 3px "+(t.clientWidth+3).toString()+"px"});window.addEventListener("resize",function(){scil.apply(i.style,{width:document.body.clientWidth+"px"})});t.style.display!="none"&&(t.style.display="block");i.style.display!="none"&&(i.style.display="flow-root");this.isOsDarkmode()?(document.body.style.backgroundColor=JSDraw2.Skin.kDarkmodeBgColor,document.body.style.color=JSDraw2.Skin.kDarkmodeColor):document.body.style.backgroundColor=JSDraw2.Skin.kLightModeBgColor;scil.Utils.createElement(document.body,"div",`<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">`,{display:"none"});document.body.style.fontFamily="Roboto, sans-serif"},cleanButtons:function(n,t){for(var i,u=[],r=0;r<n.length;++r){if(i=n[r],this.config!=null){if(i=="-"||i=="|")continue;i.type="b";i.float=t;i.imgheight=this.iconsize}else i!="-"&&i!="|"&&(i.type="a",i.src=null);u.push(i)}return u},getUserEmail:function(){return this.__user==null?null:this.__user.email},updateRightToolbar:function(n){var u,t,i,r;if(this.__user=n,u=this,t=[],n==null?t.push({onclick:function(){scil.Login.showLogin()},label:"Login",svg:"login",type:"b",id:"__scil_login"}):(t.push({svg:"user",label:n.fullname==null?"Me":n.fullname,type:"b",id:"__scil_login",translate:!0,items:this.usermenuitems}),n.cartitems!=null&&(t.push("-"),t.push({svg:"cart#",label:"Cart",type:"b",translate:!0,items:[{label:"Show",onclick:function(){scil.Cart.show()}},"-",{label:"Clear",onclick:function(){scil.Cart.clear(!1)}}]}))),scil.MobileData.disabled||t.push({svg:"mobile",type:"b",label:"Mobile",translate:!0,items:scil.MobileData.getMenuitems()}),scil.languages!=null&&(t.push("-"),t.push({type:"b",svg:"language",label:"Language",items:scil.languages,onclick:function(n){scil.Lang.setLang(n,!0)}})),scil.Utils.isNullOrEmpty(this.config.help)||n==null||(t.push("-"),t.push({target:"_blank",label:"Help",svg:"help",url:this.config.help,type:"b"})),this.skin=="7.0")for(i=0;i<t.length;++i)t[i]!=null&&t[i].label!=null&&(t[i].title=t[i].label,t[i].label=null,t[i].fill=JSDraw2.Skin.kToolbarTextColor,t[i].color=JSDraw2.Skin.kToolbarTextColor);if(r=scil.byId("__scil_toolbar_right"),r.style.boxShadow="rgb(0 0 0 / 50%) 1px 1px 5px 2px",scil.Utils.removeAll(r),this.oncreaterightbuttons!=null)this.oncreaterightbuttons(t);this._createToolbarButtons(r,t,"right");n!=null&&n.cartitems!=null&&scil.Cart.update(0,n.cartitems)},_createToolbarButtons:function(n,t,i,r){var f,u;for(t=this.cleanButtons(t,i),u=0;u<t.length;++u)t!=null&&typeof t[u]=="object"&&(t[u].framecolor=JSDraw2.Skin.kToolbarColor);if(f=2,this.skin=="7.0")if(f=10,i=="left")for(i=null,u=0;u<t.length;++u)t[u].expandright=!0;else if(i=="right")for(u=0;u<t.length;++u)t[u].src=null,t[u].type="a",t[u].imgheight=null;scil.Form.createToolbarButtons(n,t,f,i,r)},getAppItems:function(){var r={},t=[],i,n,u,o,s,f,e;if(this.apps!=null)for(i in this.apps)(n=this.apps[i],typeof n=="string")&&(u=t,o=i.indexOf("|"),o>0&&(s=i.substr(0,o),i=i.substr(o+1),r[s]==null&&(r[s]=[]),u=r[s]),n=="-"?u.push("-"):n.indexOf("?")>0?u.push({svg:"blank",imagewidth:16,label:i,target:"_blank",url:n}):(scil.Utils.endswith(n,"/")||(n+="/"),u.push({icon:n+"favicon.ico",imagewidth:"16px",label:i,target:"_blank",url:n})));for(f=scil.Utils.getDictKeys(r),f.sort(),e=0;e<f.length;++e)t.push({svg:"blank",imagewidth:16,label:f[e],items:r[f[e]],target:"_blank"});return t.length>0&&t.push("-"),t.push({svg:"blank",imagewidth:16,label:"About",onclick:scil.App.about,type:"a"}),this.kMessageSite!=null&&(t.push("-"),t.push({svg:"blank",imagewidth:16,label:"Message Us",target:"_blank",url:this.kMessageSite,type:"a"})),t},initAppButton:function(n){var t,i;n!=null&&(this.config!=null?(t=scil.byId("__scil_toolbar"),t.style.background=JSDraw2.Skin.kToolbarColor):(n.style.width="20px",n.style.borderRight="solid 1px blue",n.style.textAlign="center",n.style.background=JSDraw2.Skin.kToolbarColor,i={icon:this.app.icon,title:this.app.title,type:"a",dropdown:"",items:items},scil.Utils.createButton(n,i)))}};scil.Cart={kAjax:"Ajax.ashx?cmd=",initButtons:function(n){var t,i;if(n==null?n=document.body:typeof n=="string"&&(n=scil.byId(n)),t=n.getElementsByTagName("i"),t!=null)for(i=0;i<t.length;++i)this.initButton2(t[i])},initButton2:function(n){var t=n.getAttribute("sid"),i=n.getAttribute("incart")=="1",r=n.getAttribute("what");this.initButton(n,t,i,r)},initButton:function(n,t,i,r){if(t!=null&&t!=""&&(scil.Utils.isTrue(i)||scil.Utils.isFalse(i))){scil.Utils.removeAll(n);var f=i==1?"Remove from Cart":"Add to Cart",u=scil.Utils.createButton(n,{svg:"cart",title:f,onclick:function(n){scil.Cart.add2cart(n)}});u.setAttribute("sid",t);u.setAttribute("incart",scil.Utils.isTrue(i)?1:0);u.setAttribute("what",r)}},update:function(n,t){var i=scil.byId(scil.App.kCart),r=parseInt(i.innerHTML);i.innerHTML=t!=null?t:r+n},render:function(){return""},add:function(n){this.add2cart(n)},add2cart:function(n){var t=n.target||n.srcElement,u;t=scil.Utils.getParent(t,"SPAN");var r=t.getAttribute("sid"),i=t.getAttribute("incart")!="1",f=t.getAttribute("what");r>0&&(u=this,scil.Utils.ajax(this.kAjax+(i?"cart.add":"cart.remove"),function(){u.update(i?1:-1);t.setAttribute("incart",i?1:0);t.setAttribute("title",i?scil.Lang.res("Remove from Cart"):scil.Lang.res("Add to Cart"))},{id:r,what:f}))},clear:function(n){var t=this;scil.Utils.ajax(this.kAjax+"cart.clear",function(){n==!1?t.update(0,0):window.location.reload()})},show:function(){window.open("Cart.aspx","_self")}};scil.Tools={array2Dict:function(n){var i,t;if(n==null)return null;for(i={},t=0;t<n.length;++t)i[n[t]]=scil.Lang.res(n[t]);return i}};scil.ProgressBar=scil.extend(scil._base,{constructor:function(n,t){var u,r;typeof n=="string"&&(n=scil.byId(n));this.options=t;var f=this.options.height>0?this.options.height:20,i=this.options.start,o=scil.Utils.createTable(n,0,0,{border:this.options.border}),e=scil.Utils.createElement(o,"tr");for(i>0&&scil.Utils.createElement(scil.Utils.createElement(e,"td"),"div",scil.Utils.imgTag("dit.gif"),{height:f,width:i}),u=0;u<this.options.sections.length;++u)r=this.options.sections[u],r.end>i&&(scil.Utils.createElement(scil.Utils.createElement(e,"td"),"div",scil.Utils.imgTag("dit.gif"),{height:f,width:r.end-i,backgroundColor:r.color==null?"green":r.color},{title:r.title}),i=r.end);i<this.options.width&&scil.Utils.createElement(scil.Utils.createElement(e,"td"),"div",scil.Utils.imgTag("dit.gif"),{height:f,width:this.options.width-i})}});scil.QuickSearch={q:null,options:null,init:function(n){var f,i,r;if(this.options==null){this.options=n==null?{}:n;this.options.suggesturl==null&&(this.options.suggesturl="Ajax.ashx?cmd=search.suggest");this.options.searchurl==null&&(this.options.searchurl="Search.aspx?text=");var h=scil.App.skin=="7.0"?"4px":"8px",c=JSDraw2.Skin.kBigRadius+" 0 0 "+JSDraw2.Skin.kBigRadius,l="0 "+JSDraw2.Skin.kBigRadius+" "+JSDraw2.Skin.kBigRadius+" 0",u=scil.byId("__scil_toolbar_middle");u==null&&(u=scil.byId("__scil_toolbar_right"));f=scil.Utils.createTable(u,0,0,{borderRadius:"2px",marginRight:"15px",marginTop:"2px"});f.parentNode.setAttribute("align","right");var r=this,e="none",o="#c4c4c4",s=scil.Utils.createElement(f,"tr"),t=scil.Utils.createElement(s,"td",null,{backgroundColor:o,border:e,borderRight:"none"});this.q=scil.Utils.createElement(t,"input",null,{border:"none",backgroundColor:o,width:120,padding:h,borderRadius:c},{placeholder:"Search",title:n.tooltips});t=JsUtils.createElement(s,"td",null,{backgroundColor:o,paddingRight:"3px",border:e,borderLeft:"none"});i=scil.icon(t,"search",{cursor:"pointer",width:16,marginTop:"3px",svgstyles:{marginTop:"5px",fill:"rgb(41, 46, 69)"}},{title:"Quick Search"});scil.connect(i,"onclick",function(){r.search()});scil.App.skin=="7.0"&&(i.style.verticalAlign="middle");this.options.onadvancedsearch!=null&&(t=JsUtils.createElement(s,"td",null,{padding:"0 4px 0 4px",background:"#eee",border:e,borderLeft:"none"}),i=scil.icon(t,"searched",{cursor:"pointer",width:16,marginTop:"3px",svgstyles:{marginTop:"5px"}},{title:"Advanced Search"}),scil.connect(i,"onclick",function(){r.options.onadvancedsearch(r)}),scil.App.skin=="7.0"&&(i.style.verticalAlign="middle"));t.style.borderRadius=l;this.options.autosuggest!=!1&&this.autosuggest!=!1&&(this.auto=new scil.AutoComplete(this.q,this.options.suggesturl));new scil.MobileData(this.q,{category:"barcode",url:scil.MobileData.getDefaultUrl(!1)});r=this;scil.connect(this.q,"onkeyup",function(n){r.onkeyup(n)})}},onkeyup:function(n){n.keyCode!=13||this.auto.isVisible()||this.search()},search:function(){var n=scil.Utils.trim(this.q.value);if(n!=""&&n!=this.token)if(this.options.onsearch!=null)this.options.onsearch(n);else window.location=this.options.searchurl+scil.Utils.escUrlData(n)}};scil.Tabs=scil.extend(scil._base,{constructor:function(n,t){var a=this,i,r,f,u,c,l;this.options=t==null?{}:t;this.currenttab=null;this.area=null;typeof n=="string"&&(n=scil.byId(n));r=scil.Utils.createTable(n,0,0,{width:"100%",marginBottom:this.options.marginBottom==null?"20px":this.options.marginBottom});this.dom=this.table=r.parentNode;this.vertical=!0;var e=this.options.border?null:scil.Tabs.kBorderStyle,o=this.options.border?"5px":0,s=this.options.border?scil.Tabs.kBorderStyle:null,h=this.options.tabgap==null?"4px":this.options.tabgap;switch(this.options.tablocation){case"left":f=scil.Utils.createElement(r,"tr");i=scil.Utils.createElement(f,"td",null,{borderRight:e,width:"1%",verticalAlign:"top",borderRightWidth:h});this.area=scil.Utils.createElement(f,"td",null,{padding:o,border:s,width:"99%",verticalAlign:"top"});this.vertical=!1;break;case"right":f=scil.Utils.createElement(r,"tr");this.area=scil.Utils.createElement(f,"td",null,{padding:o,border:s,width:"1%",verticalAlign:"top"});i=scil.Utils.createElement(f,"td",null,{borderLeft:e,width:"99%",verticalAlign:"top",borderLeftWidth:h});this.vertical=!1;break;case"bottom":this.area=scil.Utils.createElement(scil.Utils.createElement(r,"tr"),"td",null,{padding:o,border:s});i=scil.Utils.createElement(scil.Utils.createElement(r,"tr"),"td",null,{borderTop:e,borderTopWidth:h});break;default:i=scil.Utils.createElement(scil.Utils.createElement(r,"tr"),"td",null,{borderBottom:e,borderBottomWidth:h});this.area=scil.Utils.createElement(scil.Utils.createElement(r,"tr"),"td",null,{padding:o,border:s})}if(i.style.borderBottomColor=scil.Tabs.kHighlightColor,i.style.backgroundColor=scil.App.config.inactiveTabBG?scil.App.config.inactiveTabBG:"#fff",i.style.whiteSpace="nowrap",this.options.forpage&&(i.style.borderRadius=JSDraw2.Skin.kBorderRadius+" "+JSDraw2.Skin.kBorderRadius+" 0 0",i.style.borderStyle="",i.style.borderTop="solid 1px "+scil.App.config.line,i.style.borderLeft="solid 1px "+scil.App.config.line,i.style.borderRight="solid 1px "+scil.App.config.line),this.tabcontainer=scil.Utils.createTable(i,0,0),this.vertical&&(this.tr=scil.Utils.createElement(this.tabcontainer,"tr")),this.options.showtabs==!1&&(this.tr.style.display="none"),u=this.options.tabs,u!=null)if(u.length>0)for(c=0;c<u.length;++c)this.addTab(u[c]);else for(l in u)this.addTab(u[l],l)},getLastTab:function(){var n=this.vertical?this.tr.childNodes:this.tabcontainer.childNodes;return n[n.length-1]},resizeClientarea:function(n,t){for(var r,u=this.vertical?this.tr.childNodes:this.tabcontainer.childNodes,i=0;i<u.length;++i)(r=this.vertical?u[i]:u[i].childNodes[0],r.clientarea!=null)&&(n>0&&(r.clientarea.style.width=n+"px",this.options.clientareawidth=n),t>0&&(r.clientarea.style.height=t+"px",this.options.clientareaheight=t));if(this.options.onresizeclientarea!=null)this.options.onresizeclientarea(n,t,this)},addTab:function(n,t){var h,f;t==null&&n.key!=null&&(t=n.key);this.vertical?this.tr.childNodes.length>0&&scil.Utils.createElement(this.tr,"td","&nbsp;"):this.tabcontainer.childNodes.length>0&&scil.Utils.createElement(scil.Utils.createElement(scil.Utils.createElement(this.tabcontainer,"tr"),"td"),"div",null,{height:5});var e=this,o=n.caption,c=n.tooltip,l=this.options.tabpadding==null?"8px 60px 3px 10px":this.options.tabpadding,a=this.vertical?this.tr:scil.Utils.createElement(this.tabcontainer,"tr"),r={padding:l};r.backgroundColor=scil.App.config.inactiveTabBG?scil.App.config.inactiveTabBG:"#fff";r.color="rgba(255,255,255,0.80)";r.fontSize="18px";switch(this.options.tablocation){case"left":r.borderRight="none";r.borderTopLeftRadius=JSDraw2.Skin.kBorderRadius;r.borderBottomLeftRadius=JSDraw2.Skin.kBorderRadius;break;case"right":r.borderLeft="none";r.borderTopRightRadius=JSDraw2.Skin.kBorderRadius;r.borderBottomRightRadius=JSDraw2.Skin.kBorderRadius;break;case"bottom":r.borderTop="none";r.borderBottomLeftRadius=JSDraw2.Skin.kBorderRadius;r.borderBottomRightRadius=JSDraw2.Skin.kBorderRadius;break;default:r.borderBottom="none";r.borderTopLeftRadius=JSDraw2.Skin.kBorderRadius;r.borderTopRightRadius=JSDraw2.Skin.kBorderRadius}var i=scil.Utils.createElement(a,"td",null,r,{key:t||n.tabkey,sciltab:"1"}),s=scil.Utils.createTable2(i,null,{cellSpacing:0,cellPadding:0}),u=null;switch(this.options.tablocation){case"left":case"right":i._label=scil.Utils.createElement(scil.Utils.createElement(s,"tr"),"td",null,null,{title:c},function(){e.showTab(i)});u=scil.Utils.createElement(scil.Utils.createElement(s,"tr"),"td");break;case"bottom":default:h=scil.Utils.createElement(s,"tr");i._label=scil.Utils.createElement(h,"td",null,null,{title:c},function(){e.showTab(i)});u=scil.Utils.createElement(h,"td")}if(scil.create(i._label,"span",o==null?"Tab":scil.Lang.res(o)),n.svg!=null&&scil.icon(i._label,n.svg),n.closable&&(f=scil.Utils.createButton(u,{svg:"del",width:16,title:"Close",svgstyles:{fill:"red"},onclick:function(){e.closeTab(i)}}),f.style.marginLeft="10px",i.style.paddingRight="2px",scil.connect(u,"onmouseover",function(){f.style.background="#fff"}),scil.connect(u,"onmouseout",function(){f.style.background=""})),n.onmenu!=null&&(scil.connect(i,"onmouseup",function(t){if(scil.Utils.isRightButton(t))n.onmenu(t);t.preventDefault()}),scil.Utils.disableContextMenu(i)),n.caption=null,n.visible=this.currenttab==null,n.marginBottom=0,n.caption=o,i.clientarea=scil.Utils.createElement(this.area,"div",null,{display:"none",width:this.options.clientareawidth,height:this.options.clientareaheight,overflowY:this.options.clientareaheight>0?"scroll":null}),n.style!=null&&scil.style(i.clientarea,n.style),this.currenttab==null&&this.showTab(i),n.html!=null&&(i.clientarea.innerHTML=n.html),this.options.onCreateTab!=null)this.options.onCreateTab(i,i.clientarea,this);return i},updateTabLabel:function(n,t){var i=typeof n=="string"?this.findTab(n):n;i!=null&&i._label!=null&&(i._label.innerHTML=t)},closeTab:function(n){var t=typeof n=="string"?this.findTab(n):n,i,r;if(t!=null)if(i=this,this.options.onclosetab==null)scil.Utils.confirmYes("Close this tab?",function(){i.removeTab(t)});else{if(r=this.options.onclosetab(t,this),r=="cancel")return;this.removeTab(t)}},currentTabKey:function(){return this.currenttab==null?null:this.currenttab.getAttribute("key")},findTab:function(n){for(var r,i=this.vertical?this.tr.childNodes:this.tabcontainer.childNodes,t=0;t<i.length;++t)if(r=this.vertical?i[t]:i[t].childNodes[0],r.getAttribute("key")==n)return r;return null},removeTab:function(n){var t=typeof n=="string"?this.findTab(n):n,r,u,i,f,e;return t==null?!1:this.options.onRemoveTab!=null&&this.options.onRemoveTab(t,this)=="cancel"?!1:(t==this.currenttab&&(r=this.allTabsAsArray(),u=scil.Utils.indexOf(r,t),u>0?this.showTab(r[u-1]):this.showTab(r[u+1])),t.clientarea.parentNode.removeChild(t.clientarea),delete t.clientarea,this.vertical?(i=t.previousSibling,i!=null&&i.clientarea==null&&i.parentNode.removeChild(i),t.parentNode.removeChild(t)):(f=t.parentNode,e=f.previousSibling,e!=null&&e.parentNode.removeChild(e),f.parentNode.removeChild(f)),!0)},allTabsAsArray:function(){for(var i,r=[],t=this.vertical?this.tr.childNodes:this.tabcontainer.childNodes,n=0;n<t.length;++n)i=this.vertical?t[n]:t[n].childNodes[0],i.getAttribute("sciltab")=="1"&&r.push(i);return r},allTabs:function(){for(var t,i,u={},r=this.vertical?this.tr.childNodes:this.tabcontainer.childNodes,n=0;n<r.length;++n)t=this.vertical?r[n]:r[n].childNodes[0],t.getAttribute("sciltab")=="1"&&(i=t.getAttribute("key"),i!=null&&i!=""&&(u[i]=t));return u},showTab:function(n){var i,t;if(typeof n=="string"?n=this.findTab(n):typeof n=="number"&&(i=this.allTabsAsArray(),n=i[n]),n!=null&&n.tagName!="TD"&&(n=scil.Utils.getParent(n,"td")),n==null||this.currenttab==n)return null;if(t=this.currenttab,this.options.onBeforeShowTab!=null&&this.options.onBeforeShowTab(n,t)==!1)return n;if(this.currenttab!=null&&(this.currenttab.style.backgroundColor="",this.currenttab.style.color="rgba(255,255,255,0.80)"),t!=null&&t.clientarea!=null&&(t.clientarea.style.display="none"),n.style.backgroundColor=scil.App.config!=null?scil.App.config.frame:scil.Tabs.kHighlightColor,n.style.color="#fff",this.currenttab=n,n.clientarea!=null&&(n.clientarea.style.display=""),this.options.onShowTab!=null)this.options.onShowTab(n,t,this);return n},show:function(){this.table.style.display=""},hide:function(){this.table.style.display="none"}});scil.apply(scil.Tabs,{kHighlightColor:"#88f",kBorderStyle:"solid 1px #88f"});scil.TabbedForm=scil.extend(scil._base,{constructor:function(n){this.form=null;this.options=n;this.buttons=[];this.fields={}},render:function(n){var r,f,t,e,i,o,u;typeof n=="string"&&(n=scil.byId(n));r=this;this.options.onShowTab=function(n,t){n.rendered||t==null||r.renderTabForm(n)};this.options.onBeforeShowTab=function(n,t){if(r.options.onbeforeshowtab!=null&&n!=t)return r.options.onbeforeshowtab(n,t)};f=!0;for(t in this.options.tabs)this.options.tabs[t].tabkey=t;this.tabs=new scil.Tabs(n,this.options);for(t in this.options.tabs)this.options.tabs[t].tabkey=t,e=this.tabs.findTab(t),e.form=new scil.Form(this.options),(!this.options.delayrender||f)&&(this.renderTabForm(e),f=!1);if(i=this.options.buttons,i!=null)if(o=scil.Utils.createElement(n,"div",null,{marginTop:"10px",textAlign:"center"}),i.length>0)for(u=0;u<i.length;++u)this.buttons.push(scil.Utils.createButton(o,i[u]));else this.buttons.push(scil.Utils.createButton(o,i));return this},setFieldValue:function(n,t,i){var r=this.fields[n];scil.Form.setFieldData(this.fields[n],this.items[n],this.viewonly,t,i)},focus:function(n){scil.Form.focus(this.fields,n)},checkRequiredFields:function(){var t=0,i=this.tabs.allTabs(),r,n;for(r in i)n=i[r].form,n!=null&&(t+=n.checkRequiredFields());return t},resetRequiredFields:function(){var t=this.tabs.allTabs(),i,n;for(i in t)n=t[i].form,n!=null&&n.resetRequiredFields()},renderTabForm:function(n){var t,i,r;n.rendered||(t=n.getAttribute("key"),i=null,this.options.tabs!=null&&this.options.tabs[t]!=null&&(i=this.options.tabs[t].fields),r=n.clientarea.style.display,n.clientarea.style.display="",n.form.render(n.clientarea,i,this.options.tabs[t]),n.clientarea.style.display=r,scil.apply(this.fields,n.form.fields),n.rendered=!0)},getCurTabData:function(n){return this.tabs.currenttab==null||this.tabs.currenttab.form==null?null:this.tabs.currenttab.form.getData(n)},getXml:function(n){var t=n?"":"<data>\n",r=this.tabs.allTabs(),u,i;for(u in r)i=r[u].form,i!=null&&(t+=i.getXml(!0));return n||(t+="<\/data>"),t},setXml:function(n){try{var t=scil.Form.xml2Json(n);this.setData(t)}catch(i){alert("Error raised when setting form data: "+i.message)}},getData:function(n){var t,i,u,r,f;if(this.options.getdata=="tab")return this.getCurTabData(n);t={};i=this.tabs.allTabs();for(u in i)r=i[u].form,r!=null&&(f=r.getData(n),scil.apply(t,f));return t},setData:function(n,t){var i,u,r;if(this.options.setdata=="tab")this.tabs.currenttab!=null&&this.tabs.currenttab.form!=null&&this.tabs.currenttab.form.setData(n,t);else{i=this.tabs.allTabs();for(u in i)r=i[u].form,r!=null&&r.setData(n,t)}}});scil.FieldItemBase=scil.extend(scil._base,{defaultcount:function(){return 1},getAddIcon:function(){return"add"},constructor:function(n,t){var f,r,u,i;typeof n=="string"&&(n=scil.byId(n));f=this;this.options=t==null?{}:t;this.options.viewonly||this.options.maxcount!=null||(this.options.maxcount=this.defaultcount());r=scil.Utils.createElement(n,"div",null,{width:this.options.width,height:this.options.height});u=scil.Utils.createElement(scil.Utils.createTable(r,0,0),"tr");this.links=scil.Utils.createElement(u,"td",null,null,{valign:"center"});this.options.viewonly||(i=scil.Utils.createElement(u,"td"),this.options.vertical&&i.setAttribute("valign","bottom"),(this.renderAddButton==null||this.renderAddButton(i)==null)&&(this.addbutton=scil.icon(i,this.getAddIcon(),{width:16},{title:"Add "+this.getTitle()},function(){f.upload()})),this.createDnD!=null&&(this.dndfile=this.createDnD(r)));this.clear()},addItem:function(n){var r,t,i,u;return this.options.maxcount>0&&(r=this.getItems().length,r>=this.options.maxcount)?!1:(t={background:"#f8f8f8",border:"solid 1px #eee",borderRadius:"1px"},this.options.vertical?t.marginBottom="3px":(t.marginRight="3px",t.float="left"),i=scil.Utils.createElement(this.links,"div",null,t,{fielditem:"1"}),!this.renderItem(i,n))?(this.links.removeChild(i),!1):(u=this,this.options.viewonly||scil.Utils.createButton(i,{svg:"del",fill:"red",title:"Delete",type:"a",onclick:function(){u.delItem(i)}}),this.markChanged("add"),this.updateAddButton(),!0)},delItem:function(n){if(n!=null){var t=this;scil.Utils.confirmYes("Delete "+this.getTitle()+"?",function(){n.parentNode.removeChild(n);t.markChanged("del");t.updateAddButton()})}},markChanged:function(n){if(!this.options.viewonly&&this.options.onchange!=null)this.options.onchange(this,n)},clear:function(){this.links.childNodes!=null&&this.links.childNodes.length>0&&(scil.Utils.removeAll(this.links),this.markChanged("clear"));this.updateAddButton()},updateAddButton:function(){if(this.addbutton!=null&&this.options.maxcount>0){var n=this.getItems().length;n>=this.options.maxcount?(this.addbutton.style.display="none",this.dndfile!=null&&(this.dndfile.disabled=!0)):(this.addbutton.style.display="",this.dndfile!=null&&(this.dndfile.disabled=!1))}},getItems:function(n){for(var t,f,i,r=[],u=0;u<this.links.childNodes.length;++u)if(t=this.links.childNodes[u],t.tagName=="DIV"&&t.getAttribute("fielditem")=="1")if(n==null)r.push(t);else{for(f={},i=0;i<n.length;++i)f[n[i]]=t.getAttribute(n[i]);r.push(f)}return r},getXml:function(){for(var n="",i=this.getDataItems(),t=0;t<i.length;++t)n+=this.item2Xml(i[t]);return n==""?"":"<files>"+n+"<\/files>"},setXml:function(n){var t,i,r;if((this.clear(),!scil.Utils.isNullOrEmpty(n))&&(t=this.parseXml(n),t==null&&typeof n=="string"&&(t=this.parseXml(scil.Utils.unescXmlValue(n))),t==null&&this.parseValue!=null&&(t=this.parseValue(n)),t!=null))for(i=0;i<t.length;++i)r=this.xml2Item(t[i]),r!=null&&this.addItem(r)},parseXml:function(n){var t,i,r;return typeof n=="string"&&(t=n.replace(/<[\/]files>[\r]?[\n]?[\,][ ]?<files>/g,"<\/files><files>"),t.length==n.length&&(i=t.replace(/<[\/]div>[\r]?[\n]?[\,][ ]?<div[ ]/g,"<\/div><\/file><file><div "),(i.length!=t.length||scil.Utils.startswith(i,"<div "))&&(t="<files><file>"+i+"<\/file><\/files>")),n=scil.Utils.parseXml("<t>"+t+"<\/t>")),r=n==null?null:n.getElementsByTagName("file"),r!=null&&r.length==0?null:r}});scil.FieldFileBase=scil.extend(scil.FieldItemBase,{item2Xml:function(n){if(n==null||scil.Utils.isNullOrEmpty(n.fileid)&&scil.Utils.isNullOrEmpty(n.contents)||scil.Utils.isNullOrEmpty(n.filename))return"";var t="<file source='"+scil.Utils.escXmlValue(n.source)+"' fileid='"+n.fileid+"'";return n.contents!=null&&n.contents!="undefined"&&n.contents!="null"&&(t+=" contents='"+scil.Utils.escXmlValue(n.contents)+"'"),t+(">"+scil.Utils.escXmlValue(n.filename)+"<\/file>")},xml2Item:function(n){return n==null?null:{fileid:n.getAttribute("fileid"),source:n.getAttribute("source"),contents:n.getAttribute("contents"),filename:scil.Utils.unescXmlValue(n.text||n.textContent)}},getDataItems:function(){return this.getItems(["fileid","filename","source","contents"])},download:function(n){if(scil.FieldFile.confirmbeforedownload){var t=this;scil.Utils.confirmYes("Continue to download this file?",function(){t.download2(n)})}else this.download2(n)},download2:function(n){if(n==null){if(!this.options.viewonly)if(this.options.onupload!=null)this.options.onupload(this);else this.upload()}else if(this.options.ondownload!=null)this.options.ondownload(n,this);else this.downloadUrl(n)},downloadUrl:function(n){var t=this.getDownloadUrl(n);t!=null&&window.open(t)},getDownloadUrl:function(n){var r,u,t,i;if(!scil.Utils.isNullOrEmpty(n.contents)&&n.contents!="undefined"&&n.contents!="null")return r=n.filename.lastIndexOf("."),u=n.filename.substr(r+1),"data:image/"+u+";base64,"+n.contents;if(t=this.options.downloadurl,(t==null||t=="")&&(i=this.getDefaultOptions(),i.downloadurl!=null&&(t=i.downloadurl)),t=="disabled"){scil.Utils.alert("File download is disabled by Admin.");return}return(t==null||t=="")&&JSDrawServices!=null&&(t=JSDrawServices.url+"?cmd=filestore.download&fileid={fileid}&source={source}"),t==null?null:t.replace("{fileid}",n.fileid).replace("{filename}",scil.Utils.escFileName(n.filename)).replace("{source}",n.source==null?"":scil.Utils.escFileName(n.source))},preview:function(n){if(n!=null)if(this.options.onpreview!=null)this.options.onpreview(n,this);else{var t=this.getDefaultOptions();if(t.onpreview!=null)t.onpreview(n,this)}},upload2:function(n){var i,r,t;if(n!=null){if(i="fileid",this.options.filekey!=null&&this.options.filekey!=""?i=this.options.filekey:(r=this.getDefaultOptions(),r.filekey!=null&&r.filekey!=""&&(i=r.filekey)),n.length>0)for(t=0;t<n.length;++t)this.addItem({filename:n[t].filename,fileid:n[t][i],source:n[t].source});else this.addItem({filename:n.filename,fileid:n[i],source:n.source});if(this.options.onchange!=null)this.options.onchange(this,"upload")}},upload:function(){var t=this,n=this.getUploadArgs();scil.Utils.uploadFile(n.caption,n.message,n.uploadurl,function(n){t.upload2(n)},n.params,null,n.multiple)},getUploadArgs:function(){var n=scil.clone(this.options),t=this.getDefaultOptions();if(n.params==null&&t.params!=null&&(n.params=t.params),this.options.onupload==null||this.options.onupload(n.params)!=!1)return n.multiple=this.options.maxcount!=1,n.message==null&&t.message!=null&&(n.message=t.message),n.caption==null&&(n.caption=t.caption!=null?t.caption:"Upload File"+(n.multiple?"s":"")),n.uploadurl==null&&(t.uploadurl!=null?n.uploadurl=t.uploadurl:JSDrawServices!=null&&(n.uploadurl=JSDrawServices.url+"?cmd=filestore.upload")),n}});scil.FieldFile=scil.extend(scil.FieldFileBase,{getTitle:function(){return"File"},getAddIcon:function(){return"upload"},renderItem:function(n,t){return scil.FieldFile.renderFile(this,n,t)},getDefaultOptions:function(){return scil.FieldFile.defaultoptions},createDnD:function(n){var i=this,t=this.getUploadArgs();return new scil.DnDFile(n,{url:t.uploadurl,onupload:function(n){scil.apply(n,t.params)},callback:function(n){i.upload2(n)}})}});scil.apply(scil.FieldFile,{kDisplayLength:16,defaultoptions:{onpreview:function(n){scil.PDFViewer.kEnabled&&scil.PDFViewer.isPDFViewable(n.filename)?scil.PDFViewer.show("JSDraw/Service.aspx?cmd=filestore.viewpdf"+(scil.Utils.isNullOrEmpty(n.source)?"":"&source="+n.source)+"&fileid="+n.fileid,null,n.filename):scil.FilePreviewer.show(n.fileid,{url:"JSDraw/Service.aspx?cmd=filestore.preview",previewurl:"JSDraw/Service.aspx?cmd=filestore.view&filename=f.png&page={page}&source={source}&fileid={fileid}"},n.source)}},renderFile:function(n,t,i){var r,u;return i==null||i.fileid==null||i.fileid==""||i.filename==null||i.filename==""?!1:(t.setAttribute("fileid",i.fileid),t.setAttribute("source",i.source==null?"":i.source),t.setAttribute("filename",i.filename),r=i.filename,n.options.shortdisplay!=!1&&scil.FieldFile.defaultoptions.shortdisplay!=!1&&(r=i.filename.length>scil.FieldFile.kDisplayLength?i.filename.substr(0,scil.FieldFile.kDisplayLength-3)+"...":i.filename),u=scil.Form.getFileIcon(i.filename),n.options.activelink==!1?(scil.icon(t,u),scil.create(t,"span",r,{background:"#fff",background:"gray"},{title:i.filename})):(n.options.downloadable==!1?(scil.icon(t,u),scil.create(t,"span",r,{background:"#fff"},{title:i.filename})):scil.Utils.createButton(t,{svg:u,label:r,type:"a",title:i.filename,onclick:function(){n.download(i)}}),(n.options.onpreview!=null||n.getDefaultOptions().onpreview!=null)&&(n.prev=scil.Utils.createButton(t,{svg:"preview",width:16,title:"Preview",type:"a",onclick:function(){n.preview(i)}}))),!0)}});scil.FieldFileLink=scil.extend(scil.FieldFileBase,{item2Xml:function(n){return n==null||n.path==null||n.path==""||n.filename==null||n.filename==""?"":"<file path='"+n.path+"'>"+scil.Utils.escXmlValue(n.filename)+"<\/file>"},xml2Item:function(n){return n==null?null:{path:n.getAttribute("path"),filename:scil.Utils.unescXmlValue(n.text||n.textContent)}},getDataItems:function(){return this.getItems(["path","filename"])},download:function(n){if(n==null){if(!this.options.viewonly)if(this.options.onupload!=null)this.options.onupload(this);else this.upload()}else if(this.options.ondownload!=null)this.options.ondownload(n,this);else this.downloadUrl(n)},downloadUrl:function(n){var t=this.getDownloadUrl(n);t!=null&&window.open(t)},getDownloadUrl:function(n){var t=this.options.downloadurl,i,r;return scil.Utils.isNullOrEmpty(t)&&(i=this.getDefaultOptions(),i.downloadurl!=null&&(t=i.downloadurl)),scil.Utils.isNullOrEmpty(t)&&JSDrawServices!=null&&(t=JSDrawServices.url+"?cmd="+this.options.cmd+".download&path={path}&source={source}"),r=this.options.source,t==null?null:t.replace("{path}",escape(n.path)).replace("{filename}",escape(n.filename)).replace("{source}",escape(r))},preview:function(n){if(n!=null)if(this.options.onpreview!=null)this.options.onpreview(n,this);else{var t=this.getDefaultOptions();if(t.onpreview!=null)t.onpreview(n,this)}},upload:function(){this.options.cmd=="filepath"?this.uploadInput():this.uploadSelect()},uploadSelect:function(){var n={source:this.options.source},t;if(this.options.onbeforeselect!=null)this.options.onbeforeselect(n,this);t=this;scil.Utils.jsonp(this.getListUrl(),function(n){t.showList(n)},n)},getListUrl:function(){var n=this.options.listurl,t;return scil.Utils.isNullOrEmpty(n)&&(t=this.getDefaultOptions(),t.listurl!=null&&(n=t.listurl)),scil.Utils.isNullOrEmpty(n)&&JSDrawServices!=null&&(n=JSDrawServices.url+"?cmd="+this.options.cmd+".list"),n},showList:function(n){if(this.selectdlg==null){var t=this;this.selectdlg=scil.Form.createDlgForm("Add Files",{list:{type:"table",columns:{filename:{label:"File Name",width:200},path:{label:"Path",width:400}},options:{rowcheck:!0}}},{label:"Add Selected File(s)",onclick:function(){t.addselectedfiles()}},{viewonly:!0,hidelabel:!0})}this.selectdlg.show();this.selectdlg.form.fields.list.jsd.setData(n);this.selectdlg.moveCenter()},addselectedfiles:function(){var t=this.selectdlg.form.fields.list.jsd.getCheckedRowData(),n;if(t!=null)for(n=0;n<t.length;++n)this.addItem(t[n]);this.selectdlg.hide()},uploadInput:function(){var n=this;scil.Utils.prompt2({caption:"Add File Link",message:"Please input the file path:<br>(e.g. \\serverpathXyz.docx)<br>",callback:function(t){var i=t.lastIndexOf("\\"),r;i<=0&&(i=t.lastIndexOf("/"));i<=0?scil.Utils.alert("Invalid file"):(r=t.substr(i+1),n.addItem({filename:r,path:t}))}})},getTitle:function(){return"File Link"},getAddIcon:function(){return"add_link"},renderItem:function(n,t){return scil.FieldFileLink.renderFile(this,n,t)},getDefaultOptions:function(){return scil.FieldFileLink.defaultoptions}});scil.apply(scil.FieldFileLink,{defaultoptions:{},renderFile:function(n,t,i){var r,u;return i==null||i.path==null||i.path==""||i.filename==null||i.filename==""?!1:(t.setAttribute("path",i.path),t.setAttribute("filename",i.filename),r=i.filename,n.options.shortdisplay!=!1&&scil.FieldFileLink.defaultoptions.shortdisplay!=!1&&(r=i.filename.length>scil.FieldFile.kDisplayLength?i.filename.substr(0,scil.FieldFile.kDisplayLength-3)+"...":i.filename),u=scil.Form.getFileIcon(i.filename),n.options.activelink==!1?(scil.icon(t,u),scil.create(t,"span",r,{background:"#fff",background:"gray"},{title:i.filename})):(scil.Utils.createButton(t,{svg:u,label:r,type:"a",title:i.filename,onclick:function(){n.download(i)}}),(n.options.onpreview!=null||n.getDefaultOptions().onpreview!=null)&&(n.prev=scil.Utils.createButton(t,{svg:"preview",title:"Preview",type:"a",onclick:function(){n.preview(i)}}))),!0)}});scil.FieldImage=scil.extend(scil.FieldFileBase,{getTitle:function(){return"Image"},getAddIcon:function(){return"image"},renderItem:function(n,t){var i,r,u;if(this.options.activelink==!1)return scil.FieldFile.renderFile(this,n,t);if((t.contents=="undefined"||t.contents=="null")&&(t.contents=null),t==null||scil.Utils.isNullOrEmpty(t.fileid)&&scil.Utils.isNullOrEmpty(t.contents)||scil.Utils.isNullOrEmpty(t.filename))return!1;n.setAttribute("filename",t.filename);t.fileid==null?n.removeAttribute("fileid"):n.setAttribute("fileid",t.fileid);t.contents==null?n.removeAttribute("contents"):n.setAttribute("contents",t.contents);i={maxWidth:"100%",borderRadius:"1px"};this.options.viewonly&&(i.display="block");this.options.vertical?(r=this.options.width>30?this.options.width:200,this.options.viewonly||(r-=16),i.width=r):(u=this.options.height>5?this.options.height:50,i.height=u);var o=this,f=this.getDownloadUrl(t),e=scil.Utils.createElement(n,"img",null,i,{src:f});return e.setAttribute("title","Double click to view large image"),scil.connect(e,"ondblclick",function(){scil.FilePreviewer.show(null,{previewurl:f})}),!0},getDefaultOptions:function(){return scil.FieldImage.defaultoptions},createDnD:function(n){var i=this,t=this.getUploadArgs();return new scil.DnDFile(n,{url:t.uploadurl,imageonly:!0,onupload:function(n){scil.apply(n,t.params)},callback:function(n){i.upload2(n)}})}});scil.apply(scil.FieldImage,{defaultoptions:{}});scil.FieldCurve=scil.extend(scil._base,{constructor:function(n,t){var i,r;typeof n=="string"&&(n=scil.byId(n));i=this;this.options=t==null?{}:t;this.parent=n;r=JSDrawServices.url;this.options.width>0||(this.options.width=200);this.options.height>0||(this.options.height=120);var u=scil.Utils.createTable(n,0,0),f=scil.Utils.createElement(u,"tr"),e=scil.Utils.createElement(scil.Utils.createElement(f,"td"),"div",null,{border:"solid 1px #eee"});this.jsd=new JSDraw2.Editor(e,{viewonly:!0,allowqccurve:this.options.allowqccurve,onfitresult:function(n){i.onfitresult(n)},width:this.options.width,height:this.options.height});this.clear()},onfitresult:function(n){if(this.options.onfitresult!=null)this.options.onfitresult(n,this)},clear:function(){this.jsd.setXml(null)},setXml:function(n){this.jsd.setXml(n)},getXml:function(){return this.jsd.getXml()}});scil.FieldCheck3=scil.extend(scil._base,{constructor:function(n,t){if(typeof n=="string"&&(n=scil.byId(n)),this.options=t==null?{}:t,this.dom=scil.Utils.createElement(n,"img",null,{width:20,verticalAlign:"middle"},{src:scil.Utils.imgSrc("img/check-.gif")}),!this.options.viewonly){var i=this;scil.connect(this.dom,"onclick",function(){i.click()})}},click:function(){var n=this.getValue();if(n=n==!0?!1:n==!1?null:!0,this.setValue(n),this.options.onchange!=null)this.options.onchange(this)},getValue:function(){var n=this.dom.src;return n.indexOf("check0.gif")>0?!1:n.indexOf("check1.gif")>0?!0:null},setValue:function(n){var t="check-.gif";scil.Utils.isTrue(n)?t="check1.gif":scil.Utils.isFalse(n)&&(t="check0.gif");this.dom.src=scil.Utils.imgSrc("img/"+t)},clear:function(){this.setValue(null)}});scil.FieldNumber=scil.extend(scil._base,{constructor:function(n,t){var r,u,e,f,i;typeof n=="string"&&(n=scil.byId(n));this.options=t==null?{}:t;this.input=n;this.unit=null;this.prefix=null;i=this;r=this.options.viewonly||this.input.disabled||this.input.readOnly;this.options.allowoperator&&!r&&(this.auto=new scil.DropdownInput(n,{items:this.options.items==null?["","≥","≤","&lt;","&gt;","±","~","∞"]:this.options.items,onSetValue:function(n,t){i.onSetOperator(n,t)}}));this.options.units==null&&this.options.prefixes==null||r||(e=JSDraw2.Skin.kBigRadius,f=scil.Utils.createTable(null,0,0,{border:"solid 1px #ccc",borderRadius:e}),this.input.parentNode.insertBefore(f.parentNode,this.input),u=scil.Utils.createElement(f,"tr"),this.options.prefixes!=null&&(this.prefix=scil.Utils.createElement(scil.Utils.createElement(u,"td",null),"select"),scil.Utils.listOptions(this.prefix,this.options.prefixes,null,!0,!0),scil.connect(this.prefix,"onchange",function(){scil.Utils.fireEvent(i.input,"change")})),scil.Utils.createElement(u,"td").appendChild(this.input),this.options.units!=null&&(this.unit=scil.Utils.createElement(scil.Utils.createElement(u,"td",null,{borderLeft:"solid 1px #ccc"}),"select",null,{width:this.options.unitwidth}),scil.FieldNumber.handleMicroUnits(this.options.units),scil.Utils.listOptions(this.unit,this.options.units,null,!0,!1),scil.connect(this.unit,"onchange",function(){scil.Utils.fireEvent(i.input,"change")}),this.unit.style.border="none"),this.input.style.border="none");i=this;r||scil.connect(n,"onchange",function(){var t=n.value;t==""||t==null||i.options.accepts!=null&&new RegExp(i.options.accepts).test(t)||i.options.isnumber==!1||scil.Utils.isNumber(t,i.options.allowoperator)?(i.prefix==null||scil.Utils.isNullOrEmpty(i.prefix.value)||(t=i.prefix.value+" "+t),i.unit==null||scil.Utils.isNullOrEmpty(i.unit.value)||(t+=i.unit.value),i.setValue(t)):(n.value="",scil.Utils.alert("A valid number is required!"))});r||this.options.mobiledata==null||(i=this,new scil.MobileData(n,{weighstation:!0,url:scil.MobileData.getDefaultUrl(!0),onresult:function(t){return i.setValue(t.barcode),scil.MobileData.markRecieved(n),!0}}),scil.Utils.createButton(scil.Utils.createElement(u,"td"),{label:"&#9878;",title:"Select Weigh Station",type:"a",onclick:function(){scil.MobileData.selectWeighstation()}}))},onSetOperator:function(n,t){var i,r;if(t!="")if(i=scil.Utils.trim(n.value),t=="±"){if(i.indexOf("±")>=0)return;n.value=i+" ±"}else t=="∞"?n.value=i=="-"?"-∞":"∞":(r=i.length>0?i.substr(0,1):null,(r=="≥"||r=="≤"||r==">"||r=="<")&&(i=i.substr(1)),n.value=t+i)},clear:function(){this.setDisplayValue("")},setValue:function(n){var t,i;if(this.prefix!=null&&(scil.Utils.selectOption(this.prefix,"",!0),n!=null&&(t=n.indexOf(" "),t>0&&(scil.Utils.selectOption(this.prefix,n.substr(0,t),!0),n=n.substr(t+1)))),n=n==null?null:JSDraw2.Table==null?{value:n}:JSDraw2.Table.splitUnit(n+""),n==null){this.setDisplayValue("");return}this.options.scale>0&&!isNaN(n.value)&&(n.value*=this.options.scale);this.options.decimal>0&&(n.value=scil.Utils.round(n.value,this.options.decimal));n.unit2==null&&(n.unit2=this.options.defaultunit);i=(n.op==null?"":n.op)+n.value;this.options.viewonly&&this.unit==null&&n.unit!=null&&(i+=n.unit);this.setDisplayValue(i);this.unit!=null?scil.Utils.selectOption(this.unit,n.unit2,!0):JSDraw2.ColorCoding!=null&&JSDraw2.ColorCoding.show(this.input,n.value,this.options)},setDisplayValue:function(n){n==null&&(n="");this.input.tagName=="INPUT"?this.input.value=n:this.input.innerHTML=n},getDisplayValue:function(){return this.input.tagName=="INPUT"?this.input.value:scil.Utils.getInnerText(this.input)},getValue:function(){var n=scil.Utils.trim(this.getDisplayValue());return scil.Utils.isNullOrEmpty(n)||isNaN(n)||(this.options.scale>0&&(n/=this.options.scale),this.prefix==null||scil.Utils.isNullOrEmpty(this.prefix.value)||(n=this.prefix.value+" "+n),this.unit!=null&&(n=n+this.unit.value)),n}});scil.apply(scil.FieldNumber,{microunits:{ug:"μg",uL:"μL",uM:"μM"},handleMicroUnits:function(n){var t,r,u,i,f;if(n!=null)for(t=0;t<n.length;++t)if(n[t]!=null)if(this.microunits[n[t]]!=null)n[t]=this.microunits[n[t]];else if(r=n[t].split("/"),r.length>0){for(u="",i=0;i<r.length;++i)i>0&&(u+="/"),f=this.microunits[r[i]],u+=f!=null?f:r[i];n[t]=u}}});scil.FieldTextBase=scil.extend(scil.FieldItemBase,{getTitle:function(){return"Text"},renderItem:function(n,t){var r,i,u;return t.data==null||t.data==""?!1:(n.setAttribute("data",t.data),r=this.options.previewlength>0?this.options.previewlength:10,i=scil.Utils.ltrim(this.html2Text(t.data)),i=i.length>r?i.substr(0,r-3)+"...":i,u=this,scil.Utils.createElement(n,"span",scil.Utils.escXmlValue(i),{color:"blue",padding:"0 2px 0 2px"}),this.preview!=null&&scil.Utils.createButton(n,{svg:"preview",title:"Preview",type:"a",onclick:function(){u.preview(n)}}),this.renderItem2!=null&&this.renderItem2(n,t),!0)},item2Xml:function(n){return n==null||n.data==null||n.data==""?"":"<file>"+scil.Utils.escXmlValue(n.data)+"<\/file>"},xml2Item:function(n){return n==null?null:{data:scil.Utils.unescXmlValue(n.text||n.textContent)}},getDataItems:function(){return this.getItems(["data"])},getValue:function(){var n=this.getDataItems();return n!=null&&n.length>0?n[0].data:null},preview:function(n){var t=n.getAttribute("data"),i;scil.Utils.isNullOrEmpty(t)||(i="<div style='min-width:400px'>"+this.formatText(t)+"<\/div>",scil.Utils.alert2(i,"Preview"))}});scil.apply(scil.FieldTextBase,{text2Xml:function(n){return scil.Utils.isNullOrEmpty(n)?"":"<files><file>"+scil.Utils.escXmlValue(n)+"<\/file><\/files>"},xml2Text:function(n){var u=scil.Utils.parseXml("<t>"+n+"<\/t>"),i=u==null?null:u.getElementsByTagName("file"),r,t;if(i==null)return[];for(r=[],t=0;t<i.length;++t)r.push(scil.Utils.unescXmlValue(i[t].text||i[t].textContent));return r}});scil.FieldTabText=scil.extend(scil.FieldTextBase,{html2Text:function(n){return n},formatText:function(n){return scil.FieldTabText.table2Html(n)},upload:function(){if(!this.options.viewonly){var n=this;scil.Utils.prompt2({caption:"Paste Table Data",defaultvalue:this.getValue(),message:"Please paste the data from Excel",multiline:!0,height:300,callback:function(t){n.addItem({data:t})}})}},renderItem2:function(n){var t=this;!this.options.viewonly&&this.options.maskdatapoints&&scil.Utils.createButton(n,{svg:"blur3",title:"Exclude Data Points",type:"a",onclick:function(){t.maskDataPoints(n)}})},maskDataPoints:function(n){var i=n.getAttribute("data"),r,t;scil.Utils.isNullOrEmpty(i)||(r=this,t=new JSDraw2.Matrix(i),JSDraw2.Matrix.maskDataPoints(t,function(){var i=t.toCSV();n.setAttribute("data",i);r.markChanged("mask")}))}});scil.apply(scil.FieldTabText,{table2Html:function(n,t,i){if(scil.Utils.isNullOrEmpty(n))return"";var r=new JSDraw2.Matrix(n,t);return r.html(i)}});scil.FieldMultiText=scil.extend(scil.FieldTextBase,{preview:null,defaultcount:function(){return 0},html2Text:function(n){return n},formatText:function(n){return n},parseValue:function(n){var u=this.options.dataseparator==null?",":this.options.dataseparator,i,r,t;if(typeof n!="string")return null;for(i=n.split(u),r=[],t=0;t<i.length;++t)r.push({text:i[t]});return r},renderAddButton:function(n){var t=this;return this.options.addbutton!=!1?null:(this.input=scil.create(n,"input",{width:this.options.width}),(this.options.autosuggesturl!=null||this.options.items)&&new scil.EditableSelect(this.input,{listurl:this.options.autosuggesturl,items:this.options.items,onclickitem:function(){t.addOne()}}),scil.connect(this.input,"onkeydown",function(n){n.keyCode==13&&(t.addOne(),n.preventDefault())}),this.input)},addOne:function(){var n=this.input.value;this.verify(n)&&(this.addItem({data:n}),this.input.value="")},verify:function(n){return this.options.items==null?!0:scil.Utils.indexOf(this.options.items,n)>=0?!0:(scil.Message.show("Invalid value: "+n),!1)},upload:function(){if(!this.options.viewonly){this.options.maxcount>1||(this.options.maxcount=0);var n=this,t=this.options.autosuggesturl;this.options.items!=null&&(t="data:"+scil.Utils.array2str(this.options.items));scil.Utils.prompt2({caption:"Add New ...",defaultvalue:this.getValue(),autosuggesturl:t,callback:function(t){if(!n.verify(t)){scil.Message.show("Invalid Value: "+t);return}n.addItem({data:t})}})}}});scil.FieldRichText=scil.extend(scil.FieldTextBase,{html2Text:function(n){return scil.Utils.html2Text(n)},formatText:function(n){return n},upload:function(){if(!this.options.viewonly){var n=this,t=this.getValue();scil.Richtext.showDlg({text:t,callback:function(t){n.addItem({data:t})}})}}});scil.FieldSketches=scil.extend(scil.FieldItemBase,{getTitle:function(){return"Sketch"},upload:function(){this.addItem({})},renderItem:function(n,t){var r=this.options.width>30?this.options.width:80,u,i,f;return this.options.viewonly||(r-=16),u=this.options.height>5?this.options.height:40,i={width:r,height:u},this.options.viewonly?i.viewonly=!0:i.popup=!0,f=scil.Utils.createElement(n,"div"),n.jsd=new JSDraw2.Editor(f,i),t.data!=null&&n.jsd.setXml(t.data),!0},getDataItems:function(){var i=this.getItems(),r,n,t;if(i==null)return null;for(r=[],n=0;n<i.length;++n)t=i[n].jsd.getXml(),t!=null&&t!=""&&r.push({data:t});return r},item2Xml:function(n){return n==null||n.data==null||n.data==""?"":"<file>"+n.data+"<\/file>"},xml2Item:function(n){var t=n==null?null:n.getElementsByTagName("div");return t==null||t.length==0?null:{data:t[0]}}});scil.FieldPlainText=scil.extend(scil.FieldTextBase,{html2Text:function(n){return n},formatText:function(n){return scil.Utils.escXmlValue(n)},upload:function(){if(!this.options.viewonly){var n=this;scil.Utils.prompt2({caption:"Paste Plain Text",defaultvalue:this.getValue(),message:"Please paste plain text",multiline:!0,height:300,callback:function(t){n.addItem({data:t})}})}}});scil.apply(scil.FieldTabText,{table2Html:function(n,t,i){if(scil.Utils.isNullOrEmpty(n))return"";var r=new JSDraw2.Matrix(n,t);return r.html(i)}});scil.FieldCode=scil.extend(scil._base,{constructor:function(n,t){if(typeof n=="string"&&(n=scil.byId(n)),this.options=t==null?{}:t,this.options.viewonly&&(this.options.readOnly=!0),this.options.width>0||(this.options.width=600),this.options.height>0||(this.options.height=80),this.options.mode=="xml"&&(this.options.mode="text/html"),this.options.lineNumbers=!0,this.options.extraKeys={F11:function(n){n.setOption("fullScreen",!n.getOption("fullScreen"))}},typeof CodeMirror=="undefined")this.textarea=scil.Utils.createElement(n,"textarea",null,{width:this.options.width,height:this.options.height});else{var i=scil.Utils.createElement(n,"div",null,{width:this.options.width,height:this.options.height,border:"solid 1px gray",marginBottom:"2px"});this.cm=CodeMirror(scil.Utils.createElement(i,"div"),this.options);this.cm.setSize(this.options.width,this.options.height)}},autoFormat:function(){if(this.cm!=null&&this.cm.autoFormatRange!=null){var n=this.cm.lineCount();this.cm.autoFormatRange({line:0,ch:0},{line:n})}},getValue:function(){return this.cm==null?this.textarea.value:this.cm.getValue()},setValue:function(n){n==null&&(n="");this.cm==null?this.textarea.value=n:this.cm.setValue(n);this.options.autoformat&&this.autoFormat()},clear:function(){this.setValue(null)}});scil.FileShelf=scil.extend(scil._base,{constructor:function(n,t){var i,r,u,f,e;typeof n=="string"&&(n=scil.byId(n));f=this;this.options=t==null?{}:t;i=this.options.width;i==null&&(i=600);r=JSDrawServices.url;u=this.options.group;this.options.listurl==null&&(this.options.listurl=r+"?cmd=fileshelf.list&group="+escape(u)+"&q={q}");this.options.downloadurl==null&&(this.options.downloadurl=r+"?cmd=fileshelf.download&group="+escape(u)+"&path={fileid}");this.options.previewajaxurl==null&&(this.options.previewajaxurl=r+"?cmd=fileshelf.preview&group="+escape(u)+"&path={path}");this.options.previewpageurl==null&&(this.options.previewpageurl=r+"?cmd=fileshelf.previewpage&group="+escape(u)+"&path={path}");f=this;e={filename:{label:"File Name",type:"file",width:i==0||this.options.compact?null:i*.6,render:function(n,t){return"<files><file fileid='"+scil.Utils.escXmlValue(t.path)+"'>"+scil.Utils.escXmlValue(n)+"<\/file><\/files>"},options:{shortdisplay:!1,downloadurl:this.options.downloadurl,onpreview:function(n){var t=n.fileid;scil.FilePreviewer.show(t,{url:f.options.previewajaxurl.replace("{path}",escape(t)),previewurl:f.options.previewpageurl.replace("{path}",escape(t))})}}}};this.options.compact||(e.filesize={label:"File Size",width:i==0?null:i*.2,render:scil.Utils.formatFilesize},e.created={label:"Created Date",type:"date",width:i==0?null:i*.2});this.table=new scil.Table(!0,this.options.showheader!=!1);this.table.render(n,e);this.list(this.options.q)},list:function(n){this.table.clear();var t=this;n!=null&&n!=""&&scil.Utils.jsonp(this.options.listurl.replace("{q}",n),function(n){n!="null"&&t.table.setData(n)})}});scil.FieldSubform=scil.extend(scil._base,{constructor:function(n,t,i){if(typeof n=="string"&&(n=scil.byId(n)),this.parent=n,this.owner=i,this.options=t==null?{}:t,this.options.oncreatesubform!=null)this.options.oncreatesubform(this,i);var r=this,u=this.options.viewonly?null:{svg:"table",width:16,title:"Edit",onclick:function(){r.edit()}};this.options.preview!=!1&&(this.previewspan=scil.Utils.createElement(n,"i",null,{color:"blue",fontSize:"80%"}),new scil.TooltipForm(this.previewspan,{caption:"View "+(this.options.caption==null?"Data":this.options.caption),ongetfields:function(){return r.getFields()},ongetkey:function(){return r._valuecount+""},ongetdata:function(){return r.xmldata}}));scil.Utils.createButton(n,u);this.dlg=null;this.xmldata=null;this.fields=null;this._valuecount=0},edit:function(){if(this.options.onedit!=null&&!this.options.viewonly)this.options.onedit(this);if(this.dlg==null&&(this.dlg=this.createDlg(this.options.viewonly)),this.dlg.show(),this.dlg.form.setXml(this.xmldata),this.dlg.moveCenter(),this.options.onsetdata!=null)this.options.onsetdata(this)},createDlg:function(n){var i=this,r=(n?"View":"Edit")+" "+(this.options.caption==null?"Data":this.options.caption),u={label:n?"Dismiss":"Save",onclick:function(){i.save()}},t;if(this.fields!=null&&typeof this.fields=="object"&&(this.fields=scil.Utils.json2str(this.fields)),t=this.getFields(),t==null){scil.Utils.alert("No fields defined");return}return scil.Form.createDlgForm(r,t,u,n?{modal:!1,noclose:!0,hidelabel:!0,viewonly:!0}:null)},getFields:function(){var n=this.fields!=null?this.fields:this.options.fields;return typeof n=="string"?scil.Utils.eval(n):scil.clone(n)},save:function(){if(this.options.viewonly){this.dlg.hide();return}if(this.xmldata=this.dlg.form.getXml(),this.dlg.hide(),++this._valuecount,this.options.onchange!=null)this.options.onchange(this);if(this.previewspan!=null&&!scil.Utils.isNullOrEmpty(this.xmldata)){var n=scil.Utils.parseXml(this.xmldata);this.preview(scil.Utils.getInnerText(n))}},getXml:function(){var t="",n;return(this.fields!=null&&(n=this.fields,typeof n=="object"&&(n=scil.Utils.json2str(n)),t=" fields='"+scil.Utils.escXmlValue(n)+"'"),scil.Utils.isNullOrEmpty(t)&&scil.Utils.isNullOrEmpty(this.xmldata))?null:"<v"+t+">"+(this.xmldata==null?"":this.xmldata)+"<\/v>"},setXml:function(n){this.clear();var t=this.parseXml(n);(t==null&&typeof n=="string"&&(t=this.parseXml(scil.Utils.unescXmlValue(n))),t!=null)&&(this.fields=t.getAttribute("fields"),this.xmldata=scil.Utils.getInnerXml(t),this.preview(scil.Utils.getInnerText(t)))},preview:function(n){if(this.previewspan!=null){if(n==null)n="";else{var t=this.options.previewlength;t>0||(t=20);n.length>t&&(n=n.substr(0,t-3)+"...");n+=" "}this.previewspan.innerHTML=n}},clear:function(){this.fields=null;this.xmldata=null;++this._valuecount},parseXml:function(n){if(typeof n=="string"&&(n=scil.Utils.parseXml(n)),n==null||n.tagName=="v")return n;var t=n.getElementsByTagName("v");return t!=null?t[0]:null}});scil.FieldSignature=scil.extend(scil._base,{constructor:function(n,t){if(typeof n=="string"&&(n=scil.byId(n)),this.options=t==null?{}:t,this.signature=scil.Utils.createElement(n,"i",null,{fontSize:"85%",background:"#ddd"}),this.dlg=null,!this.options.viewonly){var i=this;scil.Utils.createElement(n,"span","&nbsp;");scil.Utils.createButton(n,{svg:"sign",label:"Sign",onclick:function(){i.sign()}})}},sign:function(){if(this.dlg==null){var n=this,t={note:{type:"html",template:"Please type your password:"},password:{type:"password",width:400,onenter:function(){n.sign2()}}};this.dlg=scil.Form.createDlgForm("Signature",t,{label:"Sign",onclick:function(){n.sign2()}},{hidelabel:!0})}this.dlg.show();this.dlg.form.setData({})},sign2:function(){var i=this.dlg.form.getData(),n=this.options.url,t;n==null&&(n="ajax.ashx?cmd=user.signature");t=this;scil.Utils.ajax(n,function(n){t.setValue(n.signature);t.dlg.hide()},{password:i.password})},setValue:function(n){this.signature.innerHTML=n==null?"":n},getValue:function(){return this.signature.innerHTML}});scil.FieldTemplateText=scil.extend(scil._base,{constructor:function(n,t){var r,i;typeof n=="string"&&(n=scil.byId(n));r=this;this.options=t==null?{}:t;this.selector=this.options.selector;typeof this.selector!="function"&&(this.selector=function(n){return r.defaultselector(n)});i=this.options.style==null?{}:this.options.style;this.options.width>0&&(i.width=this.options.width);this.options.height>0&&(i.height=this.options.height);this.div=scil.Utils.createElement(n,"div",null,i)},defaultselector:function(n){if(n==null)return!1;var t=n.style.backgroundColor;return t=t.toLowerCase(),t=="yellow"||t=="#ffff00"||t=="#ff0"||t=="rgb(255, 255, 0)"},onchange:function(n){if(this.options.onchange!=null)this.options.onchange(this,n)},getValue:function(){this.makeEditable(this.div,!1);var n=this.div.innerHTML;return this.makeEditable(this.div,!0),n},setValue:function(n){this.div.innerHTML=n==null?"":n;this.makeEditable(this.div,!0)},getXml:function(){return this.getValue()},setXml:function(n){this.getValue(n)},makeEditable:function(n,t){var u,i,r;if(!this.options.viewonly&&n!=null&&n.tagName!=null&&n.style!=null){if(u=this,t){if(this.selector(n)){n.setAttribute("contenteditable","true");scil.connect(n,"onkeyup",function(n){u.onchange(n)});return}}else if(n.getAttribute("contenteditable")=="true"){n.removeAttribute("contenteditable");return}if(i=n.childNodes,i!=null)for(r=0;r<i.length;++r)this.makeEditable(i[r],t)}}});scil.ConfigEditor={dlg:null,url:null,show:function(n){this.url=n==null?"JSDraw/Service.aspx?cmd=":n;this.create();this.dlg.show();this.load()},load:function(){var n=this;scil.Utils.ajax(this.url+"config.load",function(t){n.setXml(t)})},setXml:function(n){this.dlg.form.tabs.currenttab.getAttribute("key")=="tableview"?this.setXmlToTable(n):this.setXmlToTextbox(n)},getXml:function(){return this.dlg.form.tabs.currenttab.getAttribute("key")=="tableview"?this.getXmlFromTable():this.getXmlFromTextbox()},setXmlToTextbox:function(n){var t=this.dlg.form.tabs.findTab("textview");t.form.fields.text.jsd.setValue(n)},getXmlFromTextbox:function(){var i=this.dlg.form.tabs.findTab("textview"),t=i.form.fields.text.jsd.getValue(),n;return scil.Utils.isNullOrEmpty(t)?"":(n=scil.Utils.parseXml2(t),n!=null&&n.error!=null)?(scil.Utils.alert("Error: "+n.error),null):t},setXmlToTable:function(n){var s=this.dlg.form.tabs.findTab("tableview"),e=s.form.fields.table.jsd,r,t,i;if((e.clear(),r=scil.Utils.parseXml(n),r==null)||(t=r.getElementsByTagName("add"),t==null))return 0;for(i=0;i<t.length;++i){var o=t[i],u=o.getAttribute("key"),f=o.getAttribute("value");(u!=""&&u!=null||f!=""&&f!=null)&&e.insert(null,{key:u,value:f})}return t.length},getXmlFromTable:function(){for(var i,r,f=this.dlg.form.tabs.findTab("tableview"),t=f.form.fields.table.jsd,u="<configuration>\n<appSettings>\n",n=0;n<t.getRowCount();++n)i=scil.Utils.trim(t.getCellValue(n,"key")),r=scil.Utils.trim(t.getCellValue(n,"value")),i!=""&&r!=""&&(u+="<add key='"+scil.Utils.escXmlValue(i)+"' value='"+scil.Utils.escXmlValue(r)+"'/>\n");return u+"<\/appSettings>\n<\/configuration>"},save:function(){var n=this.getXml();n!=null&&scil.Utils.ajax(this.url+"config.save",function(){scil.Utils.alert("Configuration saved")},{xml:n})},restart:function(){var n=this;scil.Utils.confirmYes("Restart the application?",function(){n.restart2(10)})},restart2:function(n){if(n<0){scil.Utils.alert("Refresh the browser page");return}var i=(new Date).getTime(),t=this;scil.Utils.ajax(t.url+"config.restart",function(){(new Date).getTime()-i>500?t.restart2(-1):t.restart2(n-1)})},create:function(){if(this.dlg==null){var n=this,t={tabs:{textview:{caption:"Text View",fields:{text:{type:"code",mode:"xml",width:800,height:500}},hidelabel:!0},tableview:{caption:"Table View",fields:{table:{type:"jsdraw.table",options:{columns:[{caption:"key",width:200},{caption:"value",width:600}]}}},hidelabel:!0}},buttons:[{label:"Save",onclick:function(){n.save()}},{label:"Restart App",onclick:function(){n.restart()}}],onbeforeshowtab:function(t,i){return n.onshowtab(t,i)}};this.dlg=scil.Form.createTabDlgForm("Config Editor",t)}},onshowtab:function(n){var t,r,i;if(this.dlg!=null&&this.dlg.form!=null&&this.dlg.form.tabs!=null){if(t=this.dlg.form.tabs.findTab("tableview"),r=this.dlg.form.tabs.findTab("textview"),n==t){if(i=this.getXmlFromTextbox(),i==null)return!1;this.setXmlToTable(this.getXmlFromTextbox())}else this.setXmlToTextbox(this.getXmlFromTable());return!0}}};scil.FloatingBox={targets:[],kFloatingSpeed:30,_hasinner:typeof innerWidth=="number",_haselement:typeof document.documentElement=="object"&&typeof document.documentElement.clientWidth=="number",simpleFloating:function(n,t){if(t>0){setTimeout(function(){scil.FloatingBox.simpleFloating(n)},t);return}if(typeof n=="string"&&(n=scil.byId(n)),n!=null){var i=scil.Utils.getOffset(n,!1),r=scil.Utils.createElement(null,"div",null,{width:n.offsetWidth,height:n.offsetHeight});n.parentNode.insertBefore(r,n);n.style.position="fixed";n.style.left=i.x+"px";n.style.top=i.y+"px";n.style.zIndex=1}},add:function(n,t){t!=null&&(typeof n=="string"&&(n=scil.byId(n)),n.style.position="absolute",this.targets.push({obj:n,targetLeft:t.left,targetRight:t.right,targetTop:t.top,targetBottom:t.bottom,minLeft:t.minLeft,minTop:t.minTop,centerX:t.centerX,centerY:t.centerY,lockX:t.lockX,lockY:t.lockY,distance:t.distance!=undefined?t.distance:.07,snap:t.snap,ignoreParentDimensions:t.ignoreParentDimensions,updateParentHeight:t.updateParentHeight==undefined?!1:t.updateParentHeight,confinementArea:t.confinementArea,confinementAreaId:t.confinementArea!=undefined&&t.confinementArea.substring(0,1)=="#"?t.confinementArea.substring(1):undefined,confinementAreaClassRegexp:t.confinementArea!=undefined&&t.confinementArea.substring(0,1)=="."?new RegExp("(^|\\s)"+t.confinementArea.substring(1)+"(\\s|$)"):undefined}))},move:function(n){n.lockX||(n.obj.style.left=(n.minLeft!=null&&n.nextX<n.minLeft?n.minLeft:n.nextX)+"px",n.obj.style.right="");n.lockY||(n.obj.style.top=(n.minTop!=null&&n.nextY<n.minTop?n.minTop:n.nextY)+"px",n.obj.style.bottom="")},scrollLeft:function(){var n=window.top;return this._hasinner?n.pageXOffset:this._haselement?n.document.documentElement.scrollLeft:n.document.body.scrollLeft},scrollTop:function(){var n=window.top;return this._hasinner?n.pageYOffset:this._haselement?n.document.documentElement.scrollTop:n.document.body.scrollTop},windowWidth:function(){return this._haselement?document.documentElement.clientWidth:document.body.clientWidth},windowHeight:function(){return this._haselement&&this._hasinner?document.documentElement.clientHeight>window.innerHeight?window.innerHeight:document.documentElement.clientHeight:this._haselement?document.documentElement.clientHeight:document.body.clientHeight},documentHeight:function(){var i=this._hasinner?window.innerHeight:0,t=document.body,n=document.documentElement;return Math.max(t.scrollHeight,t.offsetHeight,n.clientHeight,n.scrollHeight,n.offsetHeight,i)},documentWidth:function(){var i=this._hasinner?window.innerWidth:0,t=document.body,n=document.documentElement;return Math.max(t.scrollWidth,t.offsetWidth,n.clientWidth,n.scrollWidth,n.offsetWidth,i)},calcCornerX:function(n){var i=n.obj.offsetWidth,t=this.scrollLeft(n)-n.parentLeft;return t+=n.centerX?(this.windowWidth()-i)/2:n.targetLeft==undefined?this.windowWidth()-n.targetRight-i:n.targetLeft,document.body!=n.obj.parentNode&&t+i>=n.confinedWidthReserve&&(t=n.confinedWidthReserve-i),t<0&&(t=0),t},calcCornerY:function(n){var i=n.obj.offsetHeight,t=this.scrollTop(n)-n.parentTop;return t+=n.centerY?(this.windowHeight()-i)/2:n.targetTop===undefined?this.windowHeight()-n.targetBottom-i:n.targetTop,document.body!=n.obj.parentNode&&t+i>=n.confinedHeightReserve&&(t=n.confinedHeightReserve-i),t<0&&(t=0),t},isConfinementArea:function(n,t){return n.confinementAreaId!=undefined&&t.id==n.confinementAreaId||n.confinementAreaClassRegexp!=undefined&&t.className&&n.confinementAreaClassRegexp.test(t.className)},computeParent:function(n){var u,i,t,r;if(n.ignoreParentDimensions){n.confinedHeightReserve=this.documentHeight();n.confinedWidthReserver=this.documentWidth();n.parentLeft=0;n.parentTop=0;return}if(u=n.obj.parentNode,i=this.offsets(u,n),n.parentLeft=i.left,n.parentTop=i.top,n.confinedWidthReserve=u.clientWidth,t=u,r=this.offsets(t,n),n.confinementArea==undefined)while(t.clientHeight+r.top<n.obj.scrollHeight+i.top||n.obj.parentNode==t&&n.updateParentHeight&&t.clientHeight+r.top==n.obj.scrollHeight+i.top)t=t.parentNode,r=this.offsets(t,n);else while(t.parentNode!=undefined&&!this.isConfinementArea(n,t))t=t.parentNode,r=this.offsets(t,n);n.confinedHeightReserve=t.clientHeight-(i.top-r.top)},offsets:function(n){var i={left:0,top:0},r,t;if(window==window.top)return i;for(r=window.top.document.body.getElementsByTagName("IFRAME"),t=0;t<r.length;t++)if(r[t].contentWindow==window)for(n=r[t];n.offsetParent;)i.left+=n.offsetLeft,i.top+=n.offsetTop,n=n.offsetParent;return i},doFloatSingle:function(n){var r,u,t,i;return(n.updateParentHeight&&(n.obj.parentNode.style.minHeight=n.obj.scrollHeight+"px"),this.computeParent(n),r=this.calcCornerX(n),u=this.calcCornerY(n),n.distance==0)?(n.nextX=r,n.nextY=u,this.move(n),!1):(t=(r-n.nextX)*n.distance,(Math.abs(t)<.5&&n.snap||Math.abs(r-n.nextX)<=1)&&(t=r-n.nextX),i=(u-n.nextY)*n.distance,(Math.abs(i)<.5&&n.snap||Math.abs(u-n.nextY)<=1)&&(i=u-n.nextY),Math.abs(t)>0||Math.abs(i)>0)?(n.nextX+=t,n.nextY+=i,this.move(n),!0):!1},doFloat:function(){var t,n,i;if(!this.started)for(this.started=!0,n=0;n<this.targets.length;n++)this.initOneBox(this.targets[n]);for(t=!1,n=0;n<this.targets.length;n++)this.doFloatSingle(this.targets[n])&&(t=!0);t&&(i=this,setTimeout(function(){i.doFloat()},t?this.kFloatingSpeed:1e3))},initOneBox:function(n){this.computeParent(n);n.nextX=this.calcCornerX(n);n.nextY=this.calcCornerY(n);this.move(n)}};scil.connect(window,"onscroll",function(){scil.FloatingBox.doFloat()});scil.ready(function(){if(!scil.Utils.isAndroid&&!scil.Utils.isIpad&&scil.FloatingBox.fixapptoolbar!=!1){var n=scil.byId("__scil_toolbar"),t=n==null?null:n.getAttribute("skin");t!="7.0"&&scil.FloatingBox.simpleFloating("__scil_toolbar",3e3)}});scil.BusinessDay={weekholidays:{},weekendworkdays:{},addBusinessDays:function(n,t){for(var r=Math.abs(t),i=0,u=t<0?-1:1,f=u*864e5;i<r;)n.setTime(n.getTime()+f),this.isWorkday(n)&&++i;return n},getBusinessDays:function(n,t){var i=new Date(n.getFullYear(),n.getMonth(),n.getDate()),r=new Date(t.getFullYear(),t.getMonth(),t.getDate()),e=r>=i,o,u,f;for(e||(o=r,r=i,i=o),u=0,f=864e5,i.setTime(i.getTime()+f);i<=r;)this.isWorkday(i)&&++u,i.setTime(i.getTime()+f);return u*(e?1:-1)},isWorkday:function(n){if(n==null)return!1;var t=n.getDay();return t==0||t==6?this.isWeekendWorkday(n):!this.isWeekHoliday(n)},getHolidays:function(n){return(n=n||(new Date).getFullYear(),this.weekholidays[n+""])?this.weekholidays[n+""]:null},isWeekHoliday:function(n){var r=n.getFullYear(),t=r+"",i,u;return this.weekholidays[t]||(this.weekholidays[t]=this.getHolidays(r)),i=this.weekholidays[t],u=n.getMonth()+1+"-"+n.getDate(),i!=null&&i[u]!=null},isWeekendWorkday:function(n){var i=n.getFullYear(),t=this.weekendworkdays[i+""],r=n.getMonth()+1+"-"+n.getDate();return t!=null&&t[r]!=null}};scil.Calendar=scil.extend(scil._base,{constructor:function(n,t){typeof n=="string"&&(n=scil.byId(n));this.parent=n;this.options=t==null?{}:t;this.options.cellwidth==null&&(this.options.cellwidth=100);this.options.cellheight==null&&(this.options.cellheight=65);this.date=new Date;this.events=this.options.events;this.monthview=new scil.Calendar.MonthView(this);this.yearview=new scil.Calendar.YearView(this);this.refresh(this.monthview)},setEvents:function(n){this.events=n;this.refresh()},refresh:function(n,t){n==this.monthview?(this.monthview.parent.style.display="",this.yearview.parent.style.display="none",t>0&&this.date.setFullYear(t),this.curview=n):n==this.yearview&&(this.monthview.parent.style.display="none",this.yearview.parent.style.display="",this.curview=n);this.curview!=null&&this.curview.refresh()}});scil.apply(scil.Calendar,{border:"solid 1px #ccc",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]});scil.Calendar.MonthView=scil.extend(scil._base,{constructor:function(n){var e,r,u,t;this.cur=null;this.parent=null;this.calendar=n;var h=this.calendar.parent,i=this,f=scil.Utils.createTable(h,0,1,{border:"solid 1px #eee",textAlign:"center"});this.parent=f.parentNode;e=JsUtils.createElement(JsUtils.createElement(f,"tr"),"td");this.area=scil.Utils.createTable(e,0,0,{backgroundColor:"#fff"});scil.connect(this.area.parentNode,"onclick",function(n){i.click(n)});scil.connect(this.area.parentNode,"ondblclick",function(n){i.dblclick(n)});var c=JsUtils.createElement(JsUtils.createElement(this.area,"tr",null,{backgroundColor:"#ddd"}),"td",null,{padding:"5px"},{colSpan:7}),o={width:this.calendar.options.cellwidth,borderRight:scil.Calendar.border,borderBottom:scil.Calendar.border,fontWeight:"bold"},s=scil.clone(o);for(s.background="#eee",r=JsUtils.createElement(this.area,"tr"),u=0;u<7;++u)JsUtils.createElement(r,"td",JSDraw2.Language.res(scil.Calendar.weekdays[u]),u==0||u==6?s:o);this.header=scil.Utils.createTable(c,0,0,{width:"100%"});r=JsUtils.createElement(this.header,"tr");t=scil.Utils.createElement(r,"td",null,{textAlign:"left"});scil.Utils.createButton(t,{label:"Previous Year",type:"a",onclick:function(){i.nextYear(-1)}});scil.Utils.createElement(t,"span"," | ");scil.Utils.createButton(t,{label:"Previous Month",type:"a",onclick:function(){i.nextMonth(-1)}});scil.Utils.createElement(t,"span"," | ");scil.Utils.createButton(t,{label:"Today",type:"a",color:"gray",onclick:function(){i.setToday()}});this.title=JsUtils.createElement(r,"td",null,{textAlign:"center",fontWeight:"bold",fontSize:"125%"});t=scil.Utils.createElement(r,"td",null,{textAlign:"right"});this.calendar.options.yearview&&(scil.Utils.createButton(t,{label:"Year View",type:"a",color:"gray",onclick:function(){i.yearview()}}),scil.Utils.createElement(t,"span"," | "));scil.Utils.createButton(t,{label:"Next Month",type:"a",onclick:function(){i.nextMonth(1)}});scil.Utils.createElement(t,"span"," | ");scil.Utils.createButton(t,{label:"Next Year",type:"a",onclick:function(){i.nextYear(1)}})},setToday:function(){if(this.calendar.date=new Date,this.calendar.options.onSetToday!=null)this.calendar.options.onSetToday(this.calendar.date);else this.refresh()},yearview:function(){this.calendar.refresh(this.calendar.yearview)},nextYear:function(n){if(n==1||n==-1)if(this.calendar.date=new Date(this.calendar.date.getFullYear()+n,this.calendar.date.getMonth(),this.calendar.date.getDate()),this.calendar.options.onNextYear!=null)this.calendar.options.onNextYear(this.calendar.date);else this.refresh()},nextMonth:function(n){if(n==1||n==-1){var i=this.calendar.date.getFullYear(),t=this.calendar.date.getMonth()+n;if(t<0&&(t+=12,--i),t>11&&(t-=12,++i),this.calendar.date=new Date(i,t,this.calendar.date.getDate()),this.calendar.options.onNextMonth!=null)this.calendar.options.onNextMonth(this.calendar.date);else this.refresh()}},getObj:function(n){var t=n.target||srcElement,i,r,u;return t==null||t.tagName!="DIV"?null:(i=t.getAttribute("cal"),i!="area"&&i!="top"&&i!="evt")?null:(r=i=="evt"?t.getAttribute("key"):null,u=scil.Utils.getParent(t,"TD"),{cal:i,date:u.getAttribute("date"),src:t,key:r})},click:function(n){var t=this.getObj(n);if(t==null)return null;if(t.cal=="area"&&(this.cur!=null&&(this.cur.style.background=""),this.cur=t.src,this.cur!=null&&(this.cur.style.background=scil.App.config.frame)),n.preventDefault(),this.calendar.options.onclick!=null)this.calendar.options.onclick(t.date,t.cal,t.key)},dblclick:function(n){var t=this.getObj(n);if(t==null)return null;if(n.preventDefault(),this.calendar.options.ondblclick!=null)this.calendar.options.ondblclick(t.date,t.cal,t.key)},refresh:function(){for(var r,s,f,e,h,l,c,o=this.calendar.date,i=o.getFullYear(),t=o.getMonth(),u=this.area,n=u.childNodes.length-1;n>=2;--n)u.removeChild(u.childNodes[n]);for(r=new Date,s=r.getFullYear()==i&&r.getMonth()==t?r.getDate():null,r.setFullYear(i,t,1),f=r.getDay(),e=new Date,e.setFullYear(t==11?i+1:i,t==11?0:t+1,1),h=Math.round((e.getTime()-r.getTime())/864e5),n=0;n<f;++n)this.loadDay(null,!1,n==f-1);for(l=0,c=i+"-"+(t+1)+"-",n=0;n<h;++n)this.loadDay(new Date(i,t,n+1),s==n+1,null,this.getEvents(c+(n+1)));this.title.innerHTML=JSDraw2.Language.res(scil.Calendar.months[t])+", "+i},getEvents:function(n){var r,i,t;if(this.calendar.events==null)return null;for(r=[],i=this.calendar.events,t=0;t<i.length;++t)i[t].date==n&&r.push(i[t]);return r},loadDay:function(n,t,i,r){var h=this.area,c=h.childNodes[h.childNodes.length-1],e,o,p,l,a,s,f,u,v,y;if(c.childNodes.length==7&&(c=JsUtils.createElement(h,"tr")),e={borderRight:n==null?null:scil.Calendar.border,borderBottom:scil.Calendar.border},i&&(e.borderRight=scil.Calendar.border),o=!1,n!=null&&(scil.BusinessDay.isWorkday(n)?o=!0:e.background="#eee"),p=n==null?null:n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate(),l=JsUtils.createElement(c,"td",null,e,{date:p}),scil.Utils.createElement(l,"div",n==null?null:n.getDate(),{background:t?"#5f5":"#eee",textAlign:"right"},o?{cal:"top"}:null),a=scil.Utils.createElement(l,"div",null,{height:this.calendar.options.cellheight,overflow:"hidden"},o?{cal:"area"}:null),r!=null&&r.length>0)for(s={cursor:"pointer",fontSize:"80%",width:this.calendar.options.cellwidth,border:"solid 1px #aaf",whiteSpace:"nowrap",textAlign:"left"},f=0;f<r.length;++f)if(u=r[f],this.calendar.options.onrenderevent!=null)this.calendar.options.onrenderevent(u,width);else s.background=scil.Utils.isNullOrEmpty(u.color)?"#ffa":u.color,f>0&&(s.borderTop="none"),v=u.time!=null?"["+u.time+"] ":"",v+=scil.Utils.isNullOrEmpty(u.label)?"Unnamed":u.label,y=scil.Utils.createElement(a,"div",v,s,{cal:"evt",key:u.key}),scil.Utils.isNullOrEmpty(u.popup)?scil.Utils.isNullOrEmpty(u.title)||y.setAttribute("title",u.title):new scil.Popup(y,{html:u.popup});else a.innerHTML="&nbsp;"}});scil.Calendar.YearView=scil.extend(scil._base,{constructor:function(n){var u,f,t;this.cur=null;this.parent=null;this.calendar=n;var e=this.calendar.parent,i=this,r=scil.Utils.createTable(e,0,1,{border:"solid 1px #eee",textAlign:"center"});this.parent=r.parentNode;u=JsUtils.createElement(JsUtils.createElement(r,"tr"),"td");this.area=scil.Utils.createTable(u,0,0,{backgroundColor:"#fff"});scil.connect(this.area,"ondblclick",function(n){i.dblclick(n)});f=JsUtils.createElement(JsUtils.createElement(this.area,"tr",null,{backgroundColor:"#ddd"}),"td",null,{padding:"5px"},{colSpan:6});this.header=scil.Utils.createTable(f,0,0,{width:"100%"});tr=JsUtils.createElement(this.header,"tr");t=scil.Utils.createElement(tr,"td",null,{textAlign:"left"});scil.Utils.createButton(t,{label:"Prev",type:"a",onclick:function(){i.nextPage(-1)}});this.title=JsUtils.createElement(tr,"td",null,{textAlign:"center",fontWeight:"bold",fontSize:"125%"});t=scil.Utils.createElement(tr,"td",null,{textAlign:"right"});scil.Utils.createButton(t,{label:"Month View",type:"a",color:"gray",onclick:function(){i.monthview()}});scil.Utils.createElement(t,"span"," | ");scil.Utils.createButton(t,{label:"Next",type:"a",onclick:function(){i.nextPage(1)}})},monthview:function(){this.calendar.refresh(this.calendar.monthview)},nextPage:function(){},dblclick:function(n){var t=n.target||n.srcElement,i=scil.Utils.getParent(t,"TD"),r=parseInt(i.getAttribute("year"));this.calendar.refresh(this.calendar.monthview,r)},refresh:function(){for(var t,e,o,u,f,s=this.calendar.date,i=s.getFullYear(),r=this.area,n=r.childNodes.length-1;n>=1;--n)r.removeChild(r.childNodes[n]);for(t=i-10,e={border:scil.Calendar.border,margin:"5px",width:this.calendar.options.cellwidth,float:"left"},n=0;n<4;++n)for(o=scil.Utils.createElement(this.area,"tr"),u=0;u<6;++u)f=scil.Utils.createElement(scil.Utils.createElement(o,"td"),"div",null,e,{year:t}),scil.Utils.createElement(f,"div",t,{background:i==t?"#5f5":"#eee",textAlign:"right"}),scil.Utils.createElement(f,"div","&nbsp;",{background:"#fff",textAlign:"right",height:this.calendar.options.cellheight}),++t;this.title.innerHTML=JSDraw2.Language.res("Year")+" "+(i-10)+" - "+(t-1)}});scil.Calendar.WeekView=scil.extend(scil._base,{constructor:function(n){var u,f,t;this.cur=null;this.parent=null;this.calendar=n;var e=this.calendar.parent,i=this,r=scil.Utils.createTable(e,0,1,{border:"solid 1px #eee",textAlign:"center"});this.parent=r.parentNode;u=JsUtils.createElement(JsUtils.createElement(r,"tr"),"td");this.area=scil.Utils.createTable(u,0,0,{backgroundColor:"#fff"});scil.connect(this.area,"ondblclick",function(n){i.dblclick(n)});f=JsUtils.createElement(JsUtils.createElement(this.area,"tr",null,{backgroundColor:"#ddd"}),"td",null,{padding:"5px"},{colSpan:6});this.header=scil.Utils.createTable(f,0,0,{width:"100%"});tr=JsUtils.createElement(this.header,"tr");t=scil.Utils.createElement(tr,"td",null,{textAlign:"left"});scil.Utils.createButton(t,{label:"Prev",type:"a",onclick:function(){i.nextPage(-1)}});this.title=JsUtils.createElement(tr,"td",null,{textAlign:"center",fontWeight:"bold",fontSize:"125%"});t=scil.Utils.createElement(tr,"td",null,{textAlign:"right"});scil.Utils.createButton(t,{label:"Month View",type:"a",color:"gray",onclick:function(){i.monthview()}});scil.Utils.createElement(t,"span"," | ");scil.Utils.createButton(t,{label:"Next",type:"a",onclick:function(){i.nextPage(1)}})},monthview:function(){this.calendar.refresh(this.calendar.monthview)},nextPage:function(){},dblclick:function(n){var t=n.target||n.srcElement,i=scil.Utils.getParent(t,"TD"),r=parseInt(i.getAttribute("year"));this.calendar.refresh(this.calendar.monthview,r)},refresh:function(){for(var t,e,o,u,f,s=this.calendar.date,i=s.getFullYear(),r=this.area,n=r.childNodes.length-1;n>=1;--n)r.removeChild(r.childNodes[n]);for(t=i-10,e={border:scil.Calendar.border,margin:"5px",width:this.calendar.options.cellwidth,float:"left"},n=0;n<4;++n)for(o=scil.Utils.createElement(this.area,"tr"),u=0;u<6;++u)f=scil.Utils.createElement(scil.Utils.createElement(o,"td"),"div",null,e,{year:t}),scil.Utils.createElement(f,"div",t,{background:i==t?"#5f5":"#eee",textAlign:"right"}),scil.Utils.createElement(f,"div","&nbsp;",{background:"#fff",textAlign:"right",height:this.calendar.options.cellheight}),++t;this.title.innerHTML=JSDraw2.Language.res("Year")+" "+(i-10)+" - "+(t-1)}});scil.FormDesigner={kWidth:1200,kWidthControl:900,kHeight:600,divControl:null,textAreaCode:null,divControlBox:null,divProperty:null,controlsDropDownList:null,id:1,form:null,dlg:null,callback:null,viewonly:!1,show:function(n,t){if(this.dlg==null){var r=this,i=scil.Utils.createElement(null,"div");scil.FormDesigner.init(i);scil.Utils.createButton(scil.Utils.createElement(i,"div",null,{textAlign:"center",paddingTop:"10px"}),{svg:"save",label:"Save",onclick:function(){r.onsave()}});this.dlg=new scil.Dialog("Form Designer",i)}this.callback=t;this.dlg.show();this.setCode(n)},onsave:function(){this.callback!=null&&this.callback(this.getCode());this.dlg.hide()},setCode:function(n){this.textAreaCode.value=n==null?"":n;this.convertCodeToControl()},getCode:function(){return this.textAreaCode.value},init:function(n){var t=this;typeof n=="string"&&(n=scil.byId(n));var o=JsUtils.createElement(n,"table",null,{width:t.kWidth,height:t.kHeight,border:"1px solid #000000",borderCollapse:"collapse"}),i=JsUtils.createElement(o,"tr"),r=JsUtils.createElement(i,"td",null,{border:"1px solid #000000"});t.divControl=JsUtils.createElement(r,"div",null,{width:t.kWidthControl,height:t.kHeight*2/3});t.divControl.style.position="relative";t.divControl.style.float="top";t.divControl.style.overflowY="auto";t.divControl.style.overflowX="auto";t.textAreaCode=JsUtils.createElement(r,"textarea",null,{width:t.kWidthControl-5,height:t.kHeight/3-5});t.textAreaCode.onblur=function(){var n=t.controlsDropDownList.value;t.convertCodeToControl();this.form!=null&&this.form.selectrow(n)};var s=JsUtils.createElement(i,"td",null,{border:"1px solid #000000"},{valign:"top"}),u=new scil.Tabs(s,{onShowTab:function(n){if(n.getAttribute("key")=="properties"){var i=t.controlsDropDownList.value;t.insertItem();t.selectedIsExitItem(t.controlsDropDownList,i)?(t.addProperty(t.controlsDropDownList.value),t.controlsDropDownList.value=i):t.propertyParent!=null&&(t.propertyParent.innerHTML="")}}}),h=u.addTab({caption:"Controls",tabkey:"controls"}),c=u.addTab({caption:"Properties",tabkey:"properties"}),f=t.kWidth-t.kWidthControl+1,e=t.kHeight-20;t.createControlBox(f,e,h.clientarea);t.createProperty(f,e,c.clientarea)},createControlBox:function(n,t,i){var f=this,r,o,c,h;f.divControlBox=JsUtils.createElement(i,"div",null,{overflow:"auto",width:n,height:t,border:"1px solid #000000"});r=JsUtils.createTable(this.divControlBox,null,null,{width:"100%"});r.parentNode.style.borderCollapse="collapse";scil.connect(r.parentNode,"onmouseover",function(){r.parentNode.style.cursor="default"});for(o in f.controls){var e=f.controls[o],u=JsUtils.createElement(r,"tr"),s=JsUtils.createElement(u,"td");if(e==null||e=="-"){s.colSpan=2;s.innerHTML="<hr style='margin:2px 0 2px 0'>";continue}c=scil.icon(s,e.icon);h=JsUtils.createElement(u,"td");h.innerHTML=e.label;u.setAttribute("key",o);scil.connect(u,"ondblclick",function(n){var r=n.target||n.srcElement,t=scil.Utils.getParent(r,"TR"),i;t!=null&&(i=t.getAttribute("key"),f.createControl(i))});scil.connect(u,"onclick",function(n){for(var t,i=0;i<r.childNodes.length;i++)r.childNodes[i].style.backgroundColor="#fff";t=n.target||n.srcElement;t.tagName=="IMG"?t=t.parentNode.parentNode:t.tagName=="TD"&&(t=t.parentNode);t.tagName=="TR"&&(t.style.backgroundColor="#51b4fc")})}},createControl:function(n){var n,t,r,i,o,u,f,s,e;if(this.controls&&(n=n.replace(/^\n+|\n+$/g,""),n)){for(t=this.getFormJS(this.textAreaCode.value),t||(t={}),r={},i=n.replace(".","_")+ ++this.id;t[i]!=null;)i=n+ ++this.id;o=this.controls[n];for(u in o)u!="attributes"&&u!="icon"&&(r[u]=o[u]);r.type=n;f={};s=!1;for(e in t)f[e]=t[e],this.controlsDropDownList.value==e&&(f[i]=r,s=!0);s||(f[i]=r);this.changeProperties(f,i)}},changeProperties:function(n,t){this.textAreaCode.value=scil.Utils.json2str(n,!0,null,!0);this.convertCodeToControl();t&&(this.controlsDropDownList.value=t,this.form.selectrow(t))},createProperty:function(n,t,i){var r=this;r.divProperty=JsUtils.createElement(i,"div","&nbsp;",{overflow:"auto",width:n,height:t,border:"1px solid #000000"});r.controlsDropDownList=JsUtils.createElement(r.divProperty,"select",null,{width:n});scil.connect(r.controlsDropDownList,"onchange",function(){r.selectedKeyChanged()})},selectedKeyChanged:function(){var t=this.controlsDropDownList.selectedIndex,n;if(t==0){this.form.selectedIndex=-1;this.propertyParent!=null&&(this.propertyParent.innerHTML="");return}n=this.controlsDropDownList.options[t].value;this.addProperty(n);this.form!=null&&this.form.selectrow(n)},insertItem:function(){var r=this.getFormJS(this.textAreaCode.value),n=[],u,f,t,i,e,o;for(u in r)n.push(u);if(this.controlsDropDownList.options.length=0,f=new Option("\n","\n"),this.controlsDropDownList.options.add(f),n)for(t=0;t<n.length;t++)i=n[t],e=r[n[t]].label,this.selectedIsExitItem(this.controlsDropDownList,i)||(o=new Option(e,i),this.controlsDropDownList.options.add(o))},selectedIsExitItem:function(n,t){for(var r=!1,i=0;i<n.options.length;i++)if(n.options[i].value==t){r=!0;break}return r},addProperty:function(n){var t=this,i=this.getFormJS(this.textAreaCode.value),r,u;i&&i[n]&&(this.propertyParent==null?this.propertyParent=JsUtils.createElement(this.divProperty,"div"):this.propertyParent.innerHTML="",t.createMoveToolBar(this.propertyParent),r=t.getProperty(n,i[n]),r)&&(u=new scil.Form({viewonly:!1}),u.render(this.propertyParent,r,{buttons:{label:"Save",width:75,height:25,onclick:function(){var n=u.getData(!0);t.getChangeValues(n)}},immediately:!0}))},createMoveToolBar:function(n){var i=JsUtils.createElement(n,"div");i.style.background="#f5f5f5";var r=JsUtils.createElement(i,"img",null,{marginLeft:"5px",marginTop:"5px"},{title:JSDraw2.Language.res("Move Up"),src:scil.Utils.imgSrc("img/controls/moveup3.gif")}),u=JsUtils.createElement(i,"img",null,{marginLeft:"5px",marginTop:"5px"},{title:JSDraw2.Language.res("Move Down"),src:scil.Utils.imgSrc("img/controls/movedown3.gif")}),f=JsUtils.createElement(i,"img",null,{marginLeft:"5px",marginTop:"5px"},{title:JSDraw2.Language.res("Move to Top"),src:scil.Utils.imgSrc("img/controls/movetop3.gif")}),e=JsUtils.createElement(i,"img",null,{marginLeft:"5px",marginTop:"5px"},{title:JSDraw2.Language.res("Move to Bottom"),src:scil.Utils.imgSrc("img/controls/movebottom3.gif")}),o=JsUtils.createElement(i,"img",null,{marginLeft:"5px",marginTop:"5px"},{title:JSDraw2.Language.res("Delete"),src:scil.Utils.imgSrc("img/controls/close.gif")}),t=this;scil.connect(r,"onclick",function(){var n=t.controlsDropDownList.value;t.moveItems(n,-1);r.style.border="#1px solid #000"});scil.connect(u,"onclick",function(){var n=t.controlsDropDownList.value;t.moveItems(n,1)});scil.connect(f,"onclick",function(){var n=t.controlsDropDownList.value;t.moveItems(n,"top")});scil.connect(e,"onclick",function(){var n=t.controlsDropDownList.value;t.moveItems(n,"bottom")});scil.connect(o,"onclick",function(){JsUtils.confirmYes("Delete this item?",function(){var n=t.controlsDropDownList.value;t.moveItems(n,0)})})},moveItems:function(n,t){var l=n.replace(/^\n+|\n+$/g,""),s,r,c,e,o,u,f,h,i;if(l){s=this.getFormJS(this.textAreaCode.value);r=[];for(c in s)r.push(c);if(t==-1){for(i=0;i<r.length;i++)if(r[i]==n&&i>0){e=r[i];o=r[i+t];r[i+t]=e;r[i]=o;break}}else if(t==1){for(i=0;i<r.length;i++)if(r[i]==n&&i<r.length-1){e=r[i];o=r[i+t];r[i+t]=e;r[i]=o;break}}else if(t=="top"){for(f=r.indexOf(n),r.splice(f,1),u=[],u.push(n),i=0;i<r.length;i++)u.push(r[i]);r=u}else if(t=="bottom"){for(f=r.indexOf(n),r.splice(f,1),u=[],i=0;i<r.length;i++)u.push(r[i]);u.push(n);r=u}else t==0&&(f=r.indexOf(n),r.splice(f,1));for(h={},i=0;i<r.length;i++)h[r[i]]=s[r[i]];this.changeProperties(h,n);t==0&&this.propertyParent!=null&&(this.propertyParent.innerHTML="")}},getProperty:function(n,t){var h=this,e,u,f,i,r,o,s;if(type=this.realType(t.type),!this.controls[type]){alert("This control is not in the control box.");return}if(e={},u=scil.clone(this.controls[type].attributes),type!="group"&&(u.splice(0,0,{name:"key",label:"Key",type:"input"}),u.push({name:"colspan",label:"Colspan",type:"number"})),this.controls[type].attributes)for(f=0;f<u.length;f++){i={};r=u[f].name;for(o in u[f])i[o]=u[f][o];switch(r){case"key":i.value=n;break;case"type":i.items=this.getTypes();i.value=type;break;case"unit":i.items=this.getUnits();i.value=t[r];break;case"items":case"units":if(type=="select"||type=="dropdowninput"||type=="editableselect"||type=="dropdowncheck"||type=="multiselect"||type=="number"){i.value="";for(s in t[r])i.value+=t[r][s],s<t[r].length-1&&(i.value+="\n")}else type=="table"?i.button={label:"...",onclick:function(){h.setTable()}}:type=="jsdraw.table"&&(i.button={label:"...",onclick:function(){h.setJsDrawTable()}});break;default:i.value=t[r]}i.type!="checkbox"&&(i.width=160);e[r]=i}return e},getChangeValues:function(n){var i=this.getFormJS(this.textAreaCode.value),u,o,r,t,f,e,s;if(i&&(u=this.controlsDropDownList.value,u=u.replace(/^\n+|\n+$/g,""),u)){o=i[u].type;r=n.key;for(t in n)switch(t){case"key":i=this.changeKeyValue(i,u,r);break;case"type":i[r][t]=this.realType(n[t]);break;case"items":case"units":if(scil.Utils.isNullOrEmpty(n[t]))i[r][t]=null;else if(type=="select"||type=="dropdowninput"||type=="editableselect"||type=="dropdowncheck"||type=="multiselect"||type=="number"){f=scil.Utils.trim(n[t]).split("\n");e=[];for(s in f)e.push(scil.Utils.trim(f[s]));i[r][t]=e}break;default:n[t]?i[r][t]=n[t]:t=="required"&&(i[r][t]=null)}this.changeProperties(i,u);o!=i[r].type&&this.addProperty(r)}},changeKeyValue:function(n,t,i){var u={};for(var r in n)r==t?u[i]=n[r]:u[r]=n[r];return u},getTableColTypes:function(){var i=[],n,t;for(n in scil.FormDesigner.controls)(t=scil.FormDesigner.controls[n],n=="note"||n=="group"||t=="-"||t==null||scil.Utils.startswith(n,"jsdraw"))||i.push(n);return i},setTable:function(){var c=this,l=this.controlsDropDownList.value,f=l.replace(/^\n+|\n+$/g,""),i,o,n,s,u,a,h;if(f&&(i=this.getFormJS(this.textAreaCode.value),i&&i[f])){var e=JsUtils.createElement(null,"div"),v=JsUtils.createElement(e,"div"),y={key:{label:"Column Key",type:"input",width:120},label:{label:"Column Label",type:"input",width:120},type:{label:"Type",type:"select",options:this.getTableColTypes(),width:120,onchange:function(n){c.selectInTableOnChange(r,n)}},width:{label:"Width",type:"input",width:120},items:{label:"Items",type:"input",width:300},viewonly:{label:"View Only",type:"checkbox",width:50}},t=i[f].columns,r=new scilligence.Table(!1,!0);r.render(v,y);o=[];for(n in t){if(s="",t[n].type=="select"&&t[n].items)for(u in t[n].items)s+=u==0?t[n].items[u]:","+t[n].items[u];o.push({key:n,label:t[n].label,type:t[n].type,items:s,width:t[n].width,viewonly:t[n].viewonly})}r.setData(o);a=JsUtils.createElement(JsUtils.createElement(e,"div",null,{textAlign:"center"}),"button","OK",{width:"100px"});h=new scilligence.Dialog("Setting",e);scil.connect(a,"onclick",function(){c.buildTable(r,l);h.hide()});h.show()}},setJsDrawTable:function(){var n=this.controlsDropDownList.value,t=this.form.fields[n],i;t!=null&&t.jsd!=null&&(i=this,t.jsd.defineCols(function(){var r=i.getFormJS(i.textAreaCode.value);r&&r[n]&&(r[n].options.columns=scil.clone(t.jsd.columns),i.changeProperties(r,n))}))},selectInTableOnChange:function(){},buildTable:function(n,t){var u=n.getData(),e,f,i,o,r;if(u!=null&&u.length!=0){for(e={},f=0;f<u.length;++f)(i=scil.clone(u[f]),scil.Utils.isNullOrEmpty(i.key))||(o=null,scil.Utils.isNullOrEmpty(i.items)||(o=i.items.split(",")),e[i.key]={label:i.label,type:i.type,width:i.width,viewonly:i.viewonly,items:o});(r=this.getFormJS(this.textAreaCode.value),r&&r[t])&&(r[t].columns=e,this.changeProperties(r,t))}},buildJsDrawTable:function(n,t){for(var i,r,f=n.tbody,e={},u=1;u<f.childNodes.length;++u)(i=f.childNodes[u],i.childNodes[0].firstChild.value!="")&&(e[i.childNodes[0].firstChild.value]={label:i.childNodes[0].firstChild.value,type:i.childNodes[1].firstChild.value,width:i.childNodes[2].firstChild.value,viewonly:i.childNodes[3].firstChild.value});(r=this.getFormJS(this.textAreaCode.value),r&&r[t])&&(r[t].options.columns=e,this.changeProperties(r,t))},setCodeToStr:function(n){var i="{\n",f=0,r,u,t;for(r in n){f++>0&&(i+=",\n");i+=r+": { ";u=0;for(t in n[r])u++>0&&(i+=", "),t=="items"?i+="items: ["+n[r][t]+"]":t=="required"?i+="required:"+n[r][t]:t=="columns"?i+=this.tableToCode(n[r][t]):t=="options"||(i+=t+': "'+n[r][t]+'"');i+=" }"}return i+"\n}"},tableToCode:function(n){var t="",u,r,f,i,e,o;t+="columns: {\n";u=0;for(r in n){u++>0&&(t+=",\n");t+=r+": { ";f=0;for(i in n[r])if(f++>0&&(t+=", "),i=="items"){t+="items: [";e=0;for(o in n[r][i])e++>0&&(t+=","),t+=scil.Utils.json2str(o)+'"';t+="]"}else t+=i=="required"?"required:"+n[r][i]:i=="columns"?this.tableToCode(n[r][i]):i+': "'+n[r][i]+'"';t+="}"}return t+"}"},convertCodeToControl:function(){var n=this,t;this.divControl.innerHTML="";t=this.getFormJS(this.textAreaCode.value);this.form=new scil.Form({viewonly:n.viewonly,viewonly:!1,onselectrow:function(t){for(var i in n.form.items)n.form.items[i]==t&&(n.controlsDropDownList.value=i,n.selectedKeyChanged())}});this.form.render(this.divControl,t,{immediately:!0});t&&this.insertItem()},getFormJS:function(n){if(n!=null&&n!="")try{return eval("var temp="+n),form=temp}catch(t){scil.Utils.alert("ERROR: "+t)}},getUnits:function(){var n=[];return n.push("ug"),n.push("mg"),n.push("g"),n.push("kg"),n.push("uL"),n.push("mL"),n.push("L"),n.push("cm"),n.push("dm"),n.push("m"),n.push("km"),n.push("°C"),n.push("°F"),n.push("g/mL"),n.push("M"),n},realType:function(n){return n||(n="input"),n},getTypes:function(){var n=[];for(var t in this.controls)n.push(t);return n}};scil.FormDesigner.controls={input:{label:"Inputbox",icon:"input",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"}]},number:{label:"Number",icon:"straighten",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"unit",label:"Unit",type:"dropdowninput"},{name:"units",label:"Unit Options",type:"textarea",height:100},{name:"min",label:"Min Value",type:"number"},{name:"max",label:"Max Value",type:"number"},{name:"allowoperator",label:"Allow Operator",type:"checkbox"}]},checkbox:{label:"CheckBox",icon:"checked",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"}]},textarea:{label:"Multiline Text",icon:"notes",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},htmltext:{label:"Html Editor",icon:"assign",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"},{name:"value",label:"Value",type:"textarea"}]},sep4:"-",richtext:{label:"Rich Text",icon:"storages",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},tabtext:{label:"Tab Text",icon:"list_box",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},plaintext:{label:"Plain Text",icon:"lines",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},html:{label:"Html",icon:"file-code",attributes:[{name:"label",label:"Label",type:"input"},{name:"template",label:"Template",type:"input"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"},{name:"value",label:"Value",type:"textarea"}]},note:{label:"Note",icon:"note",attributes:[{name:"label",label:"Text",type:"textarea"},{name:"color",label:"Color",type:"color"}]},group:{label:"Group",icon:"view_agenda",attributes:[{name:"label",label:"Label",type:"input"}]},sep5:"-",radio:{label:"Radio",icon:"radio_checked",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"}]},hidden:{label:"Hidden",icon:"texture",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"}]},color:{label:"Color",icon:"water",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"}]},date:{label:"Date",icon:"calendar",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"}]},table:{label:"Table",icon:"table",columns:{column1:{label:"Input",type:"input",width:150},column3:{label:"Select",type:"select",width:150,items:["Items1","Items2","Items3"]},column4:{label:"Checkbox",type:"checkbox",width:50}},attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"},{name:"items",label:"Items",type:"text"}]},sep3:"-",select:{label:"Select",icon:"arrow2_down",items:["Items1","Items2","Items3"],attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"items",label:"Items",type:"textarea",height:100}]},editableselect:{label:"Editable Select",icon:"drop_down",items:["Items1","Items2","Items3"],attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"items",label:"Items",type:"textarea",height:100}]},multiselect:{label:"Multi Select",icon:"rule",items:["Items1","Items2","Items3"],attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"items",label:"Items",type:"textarea",height:100}]},dropdowninput:{label:"Dropdown Input",icon:"select",items:["Items1","Items2","Items3"],attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"items",label:"Items",type:"textarea",height:100}]},dropdowncheck:{label:"Dropdown Check",icon:"rule",items:["Items1","Items2","Items3"],attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"items",label:"Items",type:"textarea",height:100}]},sep2:"-",jsdraw:{label:"JSDraw Editor",icon:"file-jsdraw",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"},{name:"biology",label:"Biology Features",type:"checkbox"},{name:"rxn",label:"Reaction Features",type:"checkbox"},{name:"scale",label:"Scale",type:"number"},{name:"skin",label:"Skin",type:"select",items:["","w8","si"]},{name:"showcarbon",label:"Show Carbon",type:"select",items:["","terminal","all"]},{name:"showimplicithydrogens",label:"Show Implicit Hydrogens",type:"checkbox"},{name:"sendquery",label:"Send Query",type:"checkbox"},{name:"inktools",label:"Ink Tools",type:"checkbox"},{name:"background",label:"Background Color",type:"color"},]},"jsdraw.table":{label:"JSDraw Table",icon:"table2",options:{searchable:!0,columns:[{key:"input",caption:"Input",type:"input",width:150},{key:"date",caption:"Date",type:"date",width:150},{key:"f",caption:"F",type:"checkbox",width:50}],appendingmode:!0},attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"},{name:"items",label:"Items",type:"text"}]},"jsdraw.se":{label:"JSDraw Sequence Editor",icon:"peptide",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},sketches:{label:"Sketches",icon:"helm_mex",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},plate:{label:"Assay Plate",icon:"plate",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"size",label:"Size",type:"select",items:["","24","96","384"]},{name:"rows",label:"Rows",type:"number"},{name:"cols",label:"Cols",type:"number"}]},plates:{label:"Assay Plates",icon:"plates",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"size",label:"Size",type:"select",items:["","24","96","384"]},{name:"rows",label:"Rows",type:"number"},{name:"cols",label:"Cols",type:"number"},{name:"showtable",label:"Show Table",type:"checkbox"}]},sep1:"-",file:{label:"File",icon:"file",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"maxcount",label:"Max Count",type:"number"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},filelink:{label:"File Link",icon:"link",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"maxcount",label:"Max Count",type:"number"},{name:"source",label:"Source",type:"input"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},filedblink:{label:"File DB Link",icon:"db",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"maxcount",label:"Max Count",type:"number"},{name:"source",label:"Source",type:"input"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},filepath:{label:"File Path",icon:"files",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"maxcount",label:"Max Count",type:"number"},{name:"source",label:"Source",type:"input"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},image:{label:"Image",icon:"image",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"maxcount",label:"Max Count",type:"number"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]}};scil.Chart=scil.extend(scil._base,{constructor:function(n,t){if(t!=null&&t.type=="clusteredcolumn"&&(t.type="bar"),t!=null&&t.ajax!=null){var i=this;scil.Utils.jsonp(t.ajax.url,function(r){new scil.Viz(n,i.getOptions(t,r),r)},t.ajax.data)}else new scil.Viz(n,this.getOptions(t,null),t.series[0].data)},getOptions:function(n,t){var i=scil.clone(n),e=i.xastext,r=i.xkey,o=null,s,u,f;if(t!=null){s=0;o=[];for(u in t[0])++s==1?(r==null&&(r=u),!e&&scil.Math.isNaN(t[u])&&(e=!0)):o.push({key:u,color:scil.Viz.colors[s%scil.Viz.colors.length]})}return i.xkey=r,i.xastext=e,i.series=o,f=this,i.ontooltip==null&&(i.ontooltip=function(n){if(i.type=="pie")return n.data.label+": "+f.format(n.data.value,i.numberformat);var t="";return scil.Utils.isNullOrEmpty(r)?scil.Utils.isNullOrEmpty(n.data._s)||(t+=n.data._s+"<br>"):(r!="x"&&(t+=r+": "),t+=(scil.Utils.isNullOrEmpty(n.data._s)?f.format(n.data[r],i.numberformat):n.data._s)+"<br>"),n.ser.key!="y"&&(t+=n.ser.key+": "),t+f.format(n.data[n.ser.key],i.numberformat)}),i},format:function(n,t){return scil.Utils.isNullOrEmpty(t)||scil.Math.isNaN(n)?n:scil.Math.formatNumber(n,t)}});scil.Graph=scil.extend(scil._base,{constructor:function(n,t){this.parent=typeof n=="string"?scil.byId(n):n;this.options=t==null?{}:t;this.cy=null;this.render()},getNode:function(n){return this.cy==null?null:this.cy.getElementById(n)},render:function(){var t,i,n;if(typeof cytoscape!="undefined"){if(this.cy!=null){this.cy.layout();return}if(this.options.width>0&&(this.parent.style.width=this.options.width+(typeof this.options.width=="number"?"px":"")),this.options.height>0&&(this.parent.style.height=this.options.height+(typeof this.options.height=="number"?"px":"")),this.options.border!=null&&(this.parent.style.border=this.options.border),t={name:scil.Utils.isNullOrEmpty(this.options.layout)?"cose-bilkent":this.options.layout,rows:1},t.animate=this.options.animate?!0:!1,i={container:this.parent,style:this._getStyle(),elements:{nodes:this.options.nodes,edges:this.options.edges},layout:t},this.options.args!=null&&scil.apply(i,this.options.args),this.cy=cytoscape(i),this.cy.nodes().ungrabify(),n=this,this.options.ontap!=null)this.cy.on("tap",function(t){n.options.ontap(t.cyTarget.data(),n,t)});if(this.options.onclick!=null)this.cy.on("click",function(t){n.options.onclick(t.cyTarget.data(),n,t)});if(this.options.onmouseover!=null)this.cy.on("mousemove","node",function(t){n.options.onmouseover(t.cyTarget.data(),n,t)});if(this.options.onmouseout!=null)this.cy.on("mouseout","node",function(t){n.options.onmouseout(t.cyTarget.data(),n,t)})}},_getStyle:function(){var n=this.options.bordercolor==null?"blue":this.options.bordercolor,t=this.options.edgecolor==null?n:this.options.edgecolor,i=this.options.nodesize!=null?this.options.nodesize:60,r=this.options.bordersize!=null?this.options.bordersize:4;return cytoscape.stylesheet().selector("node").css({height:i,width:i,"font-size":this.options.nodelabelfontsize,color:this.options.nodelabelcolor,"background-fit":"cover","border-color":n,"border-width":r/2,"border-opacity":.5,label:"data(title)","background-color":"white","background-image":"data(icon)"}).selector("edge").css({width:r,"font-size":this.options.edgelabelfontsize,color:this.options.edgelabelcolor,"target-arrow-shape":"triangle","line-color":t,label:"data(title)","target-arrow-color":t}).selector(".autorotate").css({"edge-text-rotation":"autorotate"})}});scil.apply(scil.Graph,{connectOrphans:function(n,t,i,r,u){for(var l,a,h,o,e={},f=0;f<n.length;++f)e[n[f].data.id]=n[f].data;for(f=0;f<t.length;++f)l=t[f].data.source,a=t[f].data.target,e[l].__orphan=!1,e[a].__orphan=!1,t[f].data[i]=r;var v=0,s=null,c=null;for(h in e)e[h].__orphan!=!1&&(s!=null?(o={source:s.id,target:e[h].id},o[i]=u,t.push({data:o}),++v):c=e[h],s=e[h]);c!=s&&v>1&&(o={source:s.id,target:c.id},o[i]=u,t.push({data:o}))}});scil.CDSSearch=scil.extend(scil._base,{constructor:function(n){var i;typeof n=="string"&&(n=scil.byId(n));this.tabs=new scil.Tabs(n);var r=this.tabs.addTab({caption:"Query",tabkey:"query"}),t=this.tabs.addTab({caption:"Search Results",tabkey:"results"}),u=this;this.searchform=new scil.Form;this.searchform.render(r.clientarea,{q:{label:"Structure",type:"jsdraw",width:700,height:260},searchtype:{label:"Search Type",type:"select",items:["","Substructure","Full-structure","Exact Full-structure","Similarity 95%","Similarity 90%","Similarity 80%","Similarity 60%"]},prefered:{label:"Vendor",type:"checkbox",str:"Search Perfered Vendors Only"},status:{label:"Status",type:"html"}},{immediately:!0,buttons:{svg:"search",label:"Search",onclick:function(){u.search()}}});this.pagetop=scil.Utils.createElement(t.clientarea,"div");scil.CDSSearch.columns.structureid.template="<img style='display:block' title='Click to View Live Structure' onclick='scil.CDSSearch.showStructure({?})' src='"+scil.CDSSearch.site+scil.CDSSearch.img+"'>";this.resulttable=new scil.Table({viewonly:!0,header:!0});this.resulttable.render(t.clientarea,scil.CDSSearch.columns);this.pagebottom=scil.Utils.createElement(t.clientarea,"div");this.norecords=scil.Utils.createElement(t.clientarea,"div","No Records Found",{color:"red",display:"none"});i=scil.Utils.readCookie("__cds_query");this.setQuery(i,"Substructure",!0)},setQuery:function(n,t,i){this.tabs.showTab("query");this.searchform.setData({q:n,searchtype:"Substructure",prefered:i,status:null})},search:function(n){var i=this.searchform.getData(),t;scil.Utils.createCookie("__cds_query",i.q,90);i.q=this.searchform.fields.q.jsd.getSmiles();i.page=n;t=this;this.showStatus(scil.Utils.imgTag("animatorsmall.gif")+"Searching ...");scil.Utils.jsonp(scil.CDSSearch.site+scil.CDSSearch.url+"public.searchall",function(n){var i=t.combineResults(n.rows);t.resulttable.setData(i);t.tabs.showTab("results");scil.Table.listPages(t.pagetop,n.page,n.pages,function(n){t.search(n)});scil.Table.listPages(t.pagebottom,n.page,n.pages,function(n){t.search(n)});t.norecords.style.display=n.rows==null||n.rows.length==0?"":"none";t.showStatus(null)},i,{onErr:function(n){t.showStatus(n)}})},showStatus:function(n){this.searchform.fields.status.innerHTML=n==null?"":"<div style='color:red'>"+n+"<\/div>"},combineResults:function(n){var i,u,r,t;if(n==null)return null;for(i=null,u=[],r=0;r<n.length;++r)t=n[r],(i==null||i.structureid!=t.structureid)&&(i={structureid:t.structureid,catano:"",company:"",price:"",amount:"",status:""},u.push(i)),i.catano+="<div>"+(scil.Utils.isNullOrEmpty(t.catano)?"&nbsp;":t.catano)+"<\/div>",i.company+="<div>"+(scil.Utils.isNullOrEmpty(t.company)?"&nbsp;":t.company)+"<\/div>",i.amount+="<div>"+(scil.Utils.isNullOrEmpty(t.amount)||t.amount==0?"&nbsp;":this.formatNumber(t.amount,null,"g"))+"<\/div>",i.price+="<div>"+(scil.Utils.isNullOrEmpty(t.price)||t.amount==0?"&nbsp;":this.formatNumber(t.price,2,null,"$"))+"<\/div>",i.status+="<div>"+(scil.Utils.isNullOrEmpty(t.status)?"&nbsp;":t.status)+"<\/div>",last=t.structureid;return u},formatNumber:function(n,t,i,r){var u=JSDraw2.Table.formatValue(n,i,t);return u!=null&&r!=null&&(u=r+u),u}});scil.apply(scil.CDSSearch,{site:"https://carbon.scilligence.com/compounds/",url:"ajax.ashx?cmd=",img:"go.axd/structure/width=200,height=70/{?}/m.png",columns:{structureid:{label:"Structure",type:"html",attributes:{valign:"top"}},catano:{label:"Catalog No",width:200,attributes:{valign:"top"}},company:{label:"Vendor",width:200,attributes:{valign:"top"}},amount:{label:"Amount",width:200,attributes:{valign:"top",align:"right"}},price:{label:"Price",width:200,attributes:{valign:"top",align:"right"}},status:{label:"Status",width:200,attributes:{valign:"top"}}},showFromTable:function(n){var t=n.getCellValue(n.currow==null?0:n.currow,"structure",!0);this.show(t)},show:function(n){this.create();this.dlg.show();this.dlg.moveCenter();n!=null&&this.cds.setQuery(n)},create:function(){if(this.dlg==null){var n=scil.Utils.createElement(null,"div");this.dlg=new scil.Dialog("CDS Search",n);this.dlg.show();this.cds=new scil.CDSSearch(n)}},showStructure:function(n){scil.Utils.jsonp(scil.CDSSearch.site+scil.CDSSearch.url+"public.getstructure",function(n){JSDraw2.Editor.showPopup("View Structure","Dismiss",null,{value:n,format:"xml"})},{structureid:n})}});scil.Clipboard={copy:function(n){return n!=null&&typeof n=="object"&&n.tagName!=null?this.copyImage(n):this.copyText(n)},copyText:function(n){var t,i;if(scil.Utils.isNullOrEmpty(n))return!1;t=scil.Utils.createElement(document.body,"textarea",null,{position:"fixed",top:0,left:0,width:"2px",height:"2px",padding:0,border:"none",outline:"none",boxShadow:"none",background:"transparent"});t.value=n;t.select();i=!1;try{i=document.execCommand("copy")}catch(r){}return document.body.removeChild(t),i},copyHtml:function(n){if(n!=null&&typeof n=="object"&&n.tagName!=null)return this.copyImage(n);var t=!1;try{n.select();t=document.execCommand("copy")}catch(i){}return t},copyImage:function(n,t){if(typeof html2canvas!="undefined"){var i=scil.Utils.createElement(document.body,"div",null,{display:"none"});html2canvas(n).then(function(n){i.appendChild(n);n.toBlob(function(n){var t=new ClipboardItem({"image/png":n});navigator.clipboard.write([t])});document.body.removeChild(i);t!=null&&t()})}},retrieveImageFromClipboardAsBase64:function(n,t,i){var r,u,o;for(n.clipboardData==!1&&typeof t=="function"&&t(undefined),r=n.clipboardData.items,r==undefined&&typeof t=="function"&&t(undefined),u=0;u<r.length;u++)if(r[u].type.indexOf("image")!=-1){var s=r[u].getAsFile(),f=document.createElement("canvas"),h=f.getContext("2d"),e=new Image;e.onload=function(){f.width=this.width;f.height=this.height;h.drawImage(e,0,0);typeof t=="function"&&t(f.toDataURL(i||"image/png"))};o=window.URL||window.webkitURL;e.src=o.createObjectURL(s)}}};scil.TooltipForm=scil.extend(scil._base,{constructor:function(n,t){if(this.options=t,this.key=null,this.a=n,this.a!=null){var i=this;scil.connect(this.a,"onmouseout",function(){i.hide()});scil.connect(this.a,"onmousemove",function(n){i.mousemove(n)})}},show:function(n,t){var u,r,f,i;t!=null&&(this.create(),u=scil.Utils.getZindex(this.input)+1,this.dlg.show(null,u,!1,!0),r=scil.Utils.scrollOffset(),this.dlg.moveTo(n.clientX+r.x+10,n.clientY+r.y+10));this.key!=t&&(this.key=t,t==null?this.dlg!=null&&this.dlg.hide():(this.options.ongetcaption!=null&&(f=this.options.ongetcaption(t),this.dlg.setTitle("<div style='text-align:center'>"+f+"<\/div>")),this.options.ongetdata!=null&&(i=this.options.ongetdata(t),typeof i=="string"?this.dlg.form.setXml(i):this.dlg.form.setData(i))))},hide:function(){this.dlg!=null&&this.dlg.hide()},mousemove:function(n){if(this.options!=null){var t=this.options.ongetkey(n);this.show(n,t)}},create:function(){if(this.dlg==null){var n=this.options.ongetfields!=null?this.options.ongetfields(this):this.options.fields;this.dlg=scil.Form.createDlgForm(this.options.caption,n,null,{modal:!1,viewonly:!0,noclose:!0});this.dlg.hide()}}});scil.DnD=scil.extend(scil._base,{constructor:function(n,t){this.src=null;this.copy=null;this.dragging=!1;this.disabled=!1;this.options=t;typeof n=="string"&&(n=scil.byId(n));var i=this;scil.connect(n,"onmousedown",function(n){i.disabled||i.mousedown(n)});scil.connect(document.body,"onmousemove",function(n){i.disabled||i.mousemove(n)});scil.connect(document.body,"onmouseup",function(n){i.disabled||i.mouseup(n)})},isDragging:function(){return this.dragging},cancel:function(){if(this.src!=null&&this.options.oncancel!=null)this.options.oncancel(this);this.src=null;this.copy=null;this.dragging=!1},mousedown:function(n){this.options.onstartdrag!=null&&(this.src=this.options.onstartdrag(n,this),this.startpos={x:n.clientX,y:n.clientY})},mousemove:function(n){if(this.src!=null){if(this.copy==null&&(Math.abs(n.clientX-this.startpos.x)>10||Math.abs(n.clientY-this.startpos.y)>10)&&this.options.oncreatecopy!=null&&(this.copy=this.options.oncreatecopy(n,this)),this.copy!=null){var t=scil.Utils.scrollOffset();this.copy.style.left=n.clientX+t.x+2+"px";this.copy.style.top=n.clientY+t.y+2+"px";this.dragging=!0}if(this.options.ondragover!=null)this.options.ondragover(n,this)}},mouseup:function(n){if(this.options.onmouseup!=null)this.options.onmouseup(n,this);if(this.src!=null&&this.options.ondrop!=null)this.options.ondrop(n,this);this.src=null;this.copy=null;this.dragging=!1}});scil.Resizable=scil.extend(scil._base,{constructor:function(n,t){typeof n=="string"&&(n=scil.byId(n));this.options=t==null?{}:t;this.resizing=null;this.handle=n;this.bgcolor=this.handle.style.backgroundColor;this.options.direction=="y"?n.style.cursor="ns-resize":this.options.direction=="x"&&(n.style.cursor="ew-resize");var i=this;scil.connect(n,"onmousedown",function(n){i.start(n)});scil.connect(document.body,"onmousemove",function(n){i.resize(n)&&n.preventDefault()});scil.connect(document.body,"onmouseup",function(){i.resizing=null});this.options.mouseovercolor!=null&&(scil.connect(n,"onmouseover",function(){i.handle.style.backgroundColor=i.options.mouseovercolor}),scil.connect(n,"onmouseout",function(){i.handle.style.backgroundColor=i.bgcolor}))},resize:function(n){var t,i;return this.resizing==null?!1:(t=this.options.direction=="y"?n.clientY-this.resizing.y:n.clientX-this.resizing.x,t==0)?!0:(i=!1,this.options.onresize!=null&&(i=this.options.onresize(t,this)),i&&(this.options.direction=="y"?this.resizing.y=n.clientY:this.resizing.x=n.clientX),!0)},start:function(n){this.options.direction=="y"?this.resizing={y:n.clientY}:this.options.direction=="x"&&(this.resizing={x:n.clientX})}});scil.Favorite=scil.extend(scil._base,{constructor:function(n,t){this.key=n;this.items=null;this.onAddFavorite=t;this.changed=!1},getList:function(n){return this._load(),this.items[n]},contains:function(n,t){this._load();var i=this.items[t];return i==null?!1:scil.Utils.indexOf(i,n)>=0},add:function(n,t,i){var r,u;if(this._load(),r=this.items[i],r==null?t&&(this.items[i]=[n],this.changed=!0):(u=scil.Utils.indexOf(r,n),u<0&&t?(r.push(n),this.changed=!0):u>=0&&!t&&(r.splice(u,1),this.changed=!0)),this.onAddFavorite!=null)this.onAddFavorite(n,t,i);this.changed&&this._save()},_save:function(){if(this.items!=null){var n=scil.Utils.json2str(this.items);scil.Utils.createCookie("scil_helm_favorites_"+this.key,n)}},_load:function(){if(this.items==null){var t=scil.Utils.readCookie("scil_helm_favorites_"+this.key),n=scil.Utils.eval(t);this.items=n==null?{}:n}}});scil.WeighStation={dlg:null,kDefaultLastMinutes:10,kNote:"Note",kTimes:["","8:00","9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","##:##"],show:function(n,t){this.callback=n;this.jss=t;this.dlg==null?this.create():this.dlg.show()},useData:function(){var r=this.dlg.form.fields.data.jsd.getCheckedRowData(),f,t,n,i,e,o,u,s;if(r==null||r.length==0){scil.Utils.alert("Please select a row first");return}for(r.sort(function(n,t){return n.dataid<t.dataid?-1:1}),f=0;f<r.length;++f)if(t=r[f],n={dataid:t.dataid,weight:t.weight,stats:t.stats,deviceid:t.deviceid,ip:t.ip,dt:t.dt,note:t.note},typeof n.dt=="string"&&(n.dt=parseInt(n.dt)),n.weight=="-"&&(n.weight=""),this.callback!=null)this.callback(n);else if(this.jss!=null){for(i=null,e=null,o=0;o<this.jss.columns.length;++o)if(u=this.jss.columns[o],u.type=="mass"){i=u;break}else u.key=="weight"&&(e=u);i==null&&e!=null&&(i=e);i!=null&&(s={},s[i.key]=n.weight,this.jss.appendRow(s),this.jss.setWeighingTag(i,n,this.jss.getRowCount()-1))}this.dlg.hide()},onSelectScale:function(){this.dlg.form.fields.data.jsd.clear();this.loadData()},loadData:function(){var n,t,i;this.timer!=null&&(clearTimeout(this.timer),this.timer=null);n=this.dlg.form.getData();n.data=null;t=this;i=scil.MobileData.getDefaultUrl(!0,"list");scil.Utils.jsonp(i,function(n){t.dlg.form.fields.data.jsd.setData(n)},n)},create:function(){if(this.dlg==null){var n=this;if(this.onGetStations!=null)this.onGetStations(function(t){n.create2(t)});else this.create2(JSDraw2.weighstations)}},create2:function(n){var t=this,i={deviceid:{label:"Select Balance",type:"select",width:200,items:n,sort:!1,onchange:function(){t.onSelectScale()}},note:{label:this.kNote,width:200},lastminutes:{label:"Last Minutes",type:"int",width:200,value:scil.WeighStation.kDefaultLastMinutes,onenter:function(){t.clearValues(!0);t.onSelectScale()}},startdate:{label:"Start Date",type:"date",width:200,onenter:function(){t.clearValues(!1);t.onSelectScale()}},starttime:{label:"Start Time",type:"dropdowninput",items:scil.WeighStation.kTimes,width:200,onenter:function(){t.clearValues(!1);t.onSelectScale()}},enddate:{label:"End Date",type:"date",width:200,onenter:function(){t.clearValues(!1);t.onSelectScale()}},endtime:{label:"End Time",type:"dropdowninput",items:scil.WeighStation.kTimes,width:200,onenter:function(){t.clearValues(!1);t.onSelectScale()}},data:{label:"Data",type:"table",viewonly:!0,rowcheck:!0,columns:{dataid:{label:"DataID",width:70},deviceid:{label:"Balance",width:120},weight:{label:"Weight",width:80},stats:{label:"Stats",width:300,whitespace:""},dt:{label:"Time",width:100,render:function(n){return scil.Utils.timeStr(n,!0)}},ip:{label:"IP Address",width:100},note:{label:this.kNote,width:150}}}},t=this,r=[{svg:"done",label:"Use Data",onclick:function(){t.useData()}}," ",{svg:"refresh",label:"Refresh",onclick:function(){t.onSelectScale()}},];this.dlg=scil.Form.createDlgForm(scil.Lang.res("Weigh Station"),i,r)},clearValues:function(n){var t=this.dlg.form.fields;n?(t.startdate.value="",t.starttime.value="",t.enddate.value="",t.endtime.value=""):t.lastminutes.value=""}};scil.WeighRecords={dlg:null,show:function(){this.create();this.dlg.show()},onSelectScale:function(){this.dlg.form.fields.data.jsd.clear();this.loadData()},loadData:function(){var n,t,i;this.timer!=null&&(clearTimeout(this.timer),this.timer=null);n=this.dlg.form.getData();n.data=null;t=this;i=scil.MobileData.getDefaultUrl(!0,"list");scil.Utils.jsonp(i,function(n){t.dlg.form.fields.data.jsd.setData(n)},n)},create:function(){if(this.dlg==null){var n=this;if(scil.WeighStation.onGetStations!=null)scil.WeighStation.onGetStations(function(t){n.create2(t)});else this.create2(JSDraw2.weighstations)}},create2:function(n){var t=this,i={deviceid:{label:"Select Balance",type:"select",width:200,items:n,onchange:function(){t.onSelectScale()}},note:{label:scil.WeighStation.kNote,width:200},lastminutes:{label:"Last Minutes",type:"int",width:200,value:10,onenter:function(){t.clearValues(!0);t.onSelectScale()}},startdate:{label:"Start Date",type:"date",width:200,onenter:function(){t.clearValues(!1);t.onSelectScale()}},starttime:{label:"Start Time",type:"dropdowninput",items:["","8:00","9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","##:##"],width:200,onenter:function(){t.clearValues(!1);t.onSelectScale()}},enddate:{label:"End Date",type:"date",width:200,onenter:function(){t.clearValues(!1);t.onSelectScale()}},endtime:{label:"End Time",type:"dropdowninput",items:["","8:00","9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","##:##"],width:200,onenter:function(){t.clearValues(!1);t.onSelectScale()}},data:{label:"Data",type:"table",viewonly:!0,options:{rowcheck:!0},columns:{dataid:{label:"DataID",width:100},deviceid:{label:"Balance",width:200},weight:{label:"Weight",width:100},stats:{label:"Stats",width:160},dt:{label:"Time",width:150,type:"date",timeformat:"HH:MM:SS"},ip:{label:"IP Address",width:150},note:{label:scil.WeighStation.kNote,width:250}}}},t=this,r=[{svg:"printer",label:"Print",onclick:function(){new scil.Table.Print(t.dlg.form.fields.data.jsd,{checkedonly:!0})}}," ",{svg:"refresh",label:"Refresh",onclick:function(){t.onSelectScale()}},];this.dlg=scil.Form.createDlgForm(scil.Lang.res("Weigh Records"),i,r)},clearValues:function(n){var t=this.dlg.form.fields;n?(t.startdate.value="",t.starttime.value="",t.enddate.value="",t.endtime.value=""):t.lastminutes.value=""}};scil.DnDFile=scil.extend(scil._base,{constructor:function(n,t){if(scil.DnDFile.disabled!=!0&&(!scil.Utils.isIE||!(scil.Utils.isIE<9))){typeof n=="string"&&(n=scil.byId(n));this.div=n;this.options=t==null?{}:t;this.disabled=!1;this.oldbackgroundcolor=this.div.style.backgroundColor;this.oldheight=this.div.style.height;var i=this;this.div.addEventListener("dragenter",function(n){if(!i.disabled)i.ondragenter(n)},!1);this.div.addEventListener("dragleave",function(n){if(!i.disabled)i.ondragleave(n)},!1);this.div.addEventListener("dragover",function(n){if(!i.disabled)i.ondragover(n)},!1);this.div.addEventListener("drop",function(n){if(!i.disabled)i.ondrop(n)},!1)}},ondragover:function(n){n.stopPropagation();n.preventDefault();n.dataTransfer.dropEffect="copy"},ondragenter:function(){this.div.style.backgroundColor="#99ff99";scil.Utils.isIE&&scil.Utils.isNullOrEmpty(this.div.style.height)&&this.div.offsetHeight>0&&(this.div.style.height=this.div.offsetHeight+"px")},ondragleave:function(){this.div.style.backgroundColor=this.oldbackgroundcolor;scil.Utils.isIE&&(this.div.style.height=this.oldheight)},ondrop:function(n){var i,f,r,t,u;for(n.stopPropagation(),n.preventDefault(),this.ondragleave(),i=this,f=n.dataTransfer.files,r=0;t=f[r];r++)if(!this.disabled&&(!this.options.imageonly||t.type.match("image.*"))&&(this.options.type==null||t.type.match(this.options.type)))if(this.options.ondropfile!=null)this.options.ondropfile(t,this);else u=new FileReader,u.onload=function(n){return function(t){var r=t.target.result,f=r.indexOf(","),u={contents:r.substr(f+1),filename:n.name,lastmodifieddate:n.lastModifiedDate.getTime()};(i.options.onupload==null||i.options.onupload(u,this)!=!1)&&scil.Utils.ajax(i.options.url,function(n){i.options.callback(n)},u,{showprogress:!0})}}(t),u.readAsDataURL(t)}});scil.MobileData=scil.extend(scil._base,{constructor:function(n,t){if(this.timer=null,this.count=0,this.input=n,this.lastbarcode=null,this.options=t==null?{}:t,this.options.interval>0||(this.options.interval=scil.MobileData.kInterval),this.options.maxcount>0||(this.options.maxcount=scil.MobileData.kMaxCount),this.options.lastminutes>0||(this.options.lastminutes=1),this.input!=null&&this.options.connectevents!=!1){var i=this;scil.connect(this.input,"onfocus",function(){i.start()});scil.connect(this.input,"onblur",function(){i.end()})}},start:function(){if(this.endTimer(),this.count=0,!this.isDisabled()){if(this.startTimer(),this.options.onstart!=null)this.options.onstart(this);this.lastbarcode=null;this.input!=null&&(this.previousColor=this.input.style.backgroundColor,this.input.style.backgroundColor="yellow")}},isDisabled:function(){return this.options.weighstation&&scil.Utils.isNullOrEmpty(scil.MobileData.weighstation)||scil.MobileData.disabled},startTimer:function(){if((this.endTimer(),!this.isDisabled())&&(this.options.onstarttimer==null||this.options.onstarttimer(this))){var n=this;this.timer=setTimeout(function(){n.watch()},this.options.interval)}},end:function(){if(this.endTimer(),this.options.onend!=null)this.options.onend(this);this.input!=null&&(this.input.style.backgroundColor=this.previousColor==null?"":this.previousColor)},endTimer:function(){this.timer!=null&&(clearTimeout(this.timer),this.timer=null)},watch:function(){var t={category:this.options.category,deviceid:scil.MobileData.weighstation,lastminutes:this.options.lastminutes,except:this.lastbarcode},n;if(this.options.onsenddata!=null)this.options.onsenddata(t,this);n=this;scil.Utils.ajax(this.options.url,function(t){t!=null&&(t.barcode==null&&(t.barcode=t.weight),t.barcode!=null?n.lastbarcode=t.barcode:t.dbnotconfigured&&n.end());n.onResult(t);++n.count;n.count<=n.options.maxcount?n.startTimer():n.end()},t)},onResult:function(n){n.barcode!=null&&(this.options.onresult==null||this.options.onresult(n)!=!0)&&this.input!=null&&this.input.style.display!="none"&&(this.input.value=n.barcode,scil.MobileData.markRecieved(this.input),this.options.sendenter&&scil.Utils.fireEvent(this.input,"keydown",!1,!0,{keyCode:13}))}});scil.apply(scil.MobileData,{kMaxCount:240,kInterval:500,disabled:!1,markRecieved:function(n){n.select();n.focus();n.style.backgroundColor="lime"},selectWeighstation:function(){var n,t;if(JSDraw2.weighstations==null||JSDraw2.weighstations.length==0){scil.Utils.alert("Weigh station is not configured");return}n=this;this.weighDlg==null&&(t={note:{type:"html",template:"Please select a weigh station"},list:{type:"select",items:JSDraw2.weighstations,width:400}},this.weighDlg=scil.Form.createDlgForm("Select Weigh Station",t,{label:"Select",onclick:function(){n.weighstation=n.weighDlg.form.fields.list.value;n.weighDlg.hide()}},{hidelabel:!0}));this.weighDlg.show();this.weighDlg.form.setData({list:n.weighstation})},getDefaultUrl:function(n,t){t==null&&(t="getlast");var i=n?"weight":"mobile";return scil.App.config==null?JSDrawServices.url+"?cmd="+i+"."+t:"ajax.ashx?cmd="+i+"."+t},enable:function(){this.disabled=!this.disabled;scil.App.updateRightToolbar(scil.App.__user)},getMenuitems:function(){return[{label:"Mobile"+(this.disabled?"(Mute)":"(Live)"),onclick:function(){scil.MobileData.enable()}},"-",{label:"Weigh Records",onclick:function(){scil.WeighRecords.show()}},"-",{label:"Scan Settings",onclick:function(){scil.MobileData.showSettingDialog()}},"-",{label:"Download App",url:"http://apps.scilligence.com",target:"_blank"},]},showSettingDialog:function(){if(this.settingDlg==null){var t=scil.Utils.scriptUrl(),n=scil.App.getUserEmail(),i="<div style='text-align:center'>Click *Scan Settings* button in Settings page to scan:<br><img src='jsdraw/service.aspx?cmd=barcode&logo=4&color=purple&barcode={succeed:true,ret:{url:%27"+t+"%27,email:%27"+(n==null?"":n)+"%27}}&scale=2&wrapper=raw&type=qr2'><\/div>",r=scil.Utils.createElement(null,"div",i);this.settingDlg=new scil.Dialog("Scan Settings",r)}this.settingDlg.show()},createImageList:function(n,t){var r={dataid:{label:"DataID",width:80,iskey:!0},filename:{label:"File Name",width:200,type:"html",template:"<a target='_blank' href='"+JSDrawServices.url+"?cmd=mobile.previewimage&wrapper=raw&dataid={{dataid}}'>{?}<\/a>"},category:{label:"Category",width:100},deviceid:{label:"Device",width:100},dt:{label:"Uploaded",type:"date",width:80},note:{label:"Notes",width:200}},i=new scil.Table({viewonly:!0,rowcheck:t?!0:"radio"});return i.render(n,r),i},listImages:function(n,t){n.clear();scil.Utils.ajax(this.getDefaultUrl(!1,"listimages"),function(t){n.setData(t)},t)},getSelectedImages:function(n){var t=n==null?null:n.getCheckedKeys();return t==null||t.length==0?null:scil.Utils.array2str(t,",")},getSelectedImageNames:function(n,t){var i,r;if(n!=null&&(i=n.getCheckedRowData(),i!=null))for(r=0;r<i.length;++r)t.push(i[r].filename)}});scil.Hazard={show:function(n,t){var r,e;if(!scil.Utils.isNullOrEmpty(n)){var u=this.getPhrases(),f={i:0},i="";if(typeof n=="string")i+=this._makeRows(u,null,n,f);else for(r in n)i+=this._makeRows(u,r,n[r],f);scil.Utils.isNullOrEmpty(i)||(i="<table cellspacing=0>"+i+"<\/table>",this.dlg==null&&(e=scil.Utils.createElement(null,"div",null,{width:800}),this.dlg=new scil.Dialog("Hazard Phrases",e)),this.dlg.body.innerHTML=i,this.dlg.show(t),this.dlg.moveCenter())}},_makeRows:function(n,t,i,r){var f,u,e;if(scil.Utils.isNullOrEmpty(i))return"";var o="",s=i.split(","),h={};for(f=0;f<s.length;++f)(u=scil.Utils.trim(s[f]),u!=""&&h[u]==null)&&(++r.i,h[u]=!0,e=n[u],o+="<tr"+(r.i%2==1?" style='background:#ddd'":"")+"><td style='width:5%;border-right:1px solid #fff;padding-right:10px;'>"+(t==null?"":t)+"<\/td><td style='width:5%;border-right:1px solid #fff;padding-right:10px;'>"+u+":<\/td><td><div style='padding:4px;max-width:800px;min-width:400px'>"+(e==null?"":e.s)+"<\/div><\/td><\/tr>");return o},filterFlags:function(n){return n},renderFlags:function(n){var f,i,r;if(scil.Hazard.filterFlags!=null&&(n=scil.Hazard.filterFlags(n)),scil.Utils.isNullOrEmpty(n))return"";var u=!1,o=scil.Hazard.getPhrases(),t="",e=typeof n=="string"?n.split(","):n;for(f=0;f<e.length;++f)(i=e[f],i!=""&&i!=" ")&&(r=o[i],r==null?(t!=""&&u&&(t+=","),t+=i,u=!0):r.c==null||scil.Icons["ghs-"+r.c]==null?(t!=""&&u&&(t+=","),t+="<u title='"+i+" - "+r.s+"'>"+i+"<\/u>",u=!0):(t+=scil.SVG.getRawXml("ghs-"+r.c,16),u=!1));return t},getPhrases:function(){var i=null,n,t;for(n in scil.Lang)if(n!="current"&&scil.Lang[n]==scil.Lang.current){i=n;break}return t=i==null?null:this[n],t==null&&(t=this.phrases),t},getListOptions:function(n){var i,r,t;if(n!=null){i={"":""};for(t in n)i[t]=t+" - "+n[t];return i}i={"":""};r=this.getPhrases();for(t in r)i[t]=t+" - "+this.phrases[t].s;return i},phrases:{H200:{s:"Unstable explosive",c:"explosive"},H201:{s:"Explosive; mass explosion hazard",c:"explosive"},H202:{s:"Explosive; severe projection hazard",c:"explosive"},H203:{s:"Explosive; fire, blast or projection hazard",c:"explosive"},H204:{s:"Fire or projection hazard",c:null},H205:{s:"May mass explode in fire",c:"explosive"},H220:{s:"Extremely flammable gas",c:"flammable"},H221:{s:"Flammable gas",c:"flammable"},H222:{s:"Extremely flammable aerosol",c:"flammable"},H223:{s:"Flammable aerosol",c:"flammable"},H224:{s:"Extremely flammable liquid and vapour",c:"flammable"},H225:{s:"Highly flammable liquid and vapour",c:"flammable"},H226:{s:"Flammable liquid and vapour",c:"flammable"},H227:{s:"Combustible liquid",c:"flammable"},H228:{s:"Flammable solid",c:"flammable"},H229:{s:"Pressurized container: may burst if heated",c:null},H230:{s:"May react explosively even in the absence of air",c:null},H231:{s:"May react explosively even in the absence of air at elevated pressure and/or temperature",c:null},H240:{s:"Heating may cause an explosion",c:null},H241:{s:"Heating may cause a fire or explosion",c:null},H242:{s:"Heating may cause a fire",c:null},H250:{s:"Catches fire spontaneously if exposed to air",c:null},H251:{s:"Self-heating; may catch fire",c:null},H252:{s:"Self-heating in large quantities; may catch fire",c:null},H260:{s:"In contact with water releases flammable gases which may ignite spontaneously",c:null},H261:{s:"In contact with water releases flammable gas",c:null},H270:{s:"May cause or intensify fire; oxidizer",c:"oxidizing"},H271:{s:"May cause fire or explosion; strong oxidizer",c:"oxidizing"},H272:{s:"May intensify fire; oxidizer",c:"oxidizing"},H280:{s:"Contains gas under pressure; may explode if heated",c:"compressedgas"},H281:{s:"Contains refrigerated gas; may cause cryogenic burns or injury",c:null},H290:{s:"May be corrosive to metals",c:"corrosive"},H300:{s:"Fatal if swallowed",c:null},H301:{s:"Toxic if swallowed",c:"toxic"},H302:{s:"Harmful if swallowed",c:"toxic"},H303:{s:"May be harmful if swallowed",c:null},H304:{s:"May be fatal if swallowed and enters airways",c:null},H305:{s:"May be harmful if swallowed and enters airways",c:null},H310:{s:"Fatal in contact with skin",c:null},H311:{s:"Toxic in contact with skin",c:"toxic"},H312:{s:"Harmful in contact with skin",c:null},H313:{s:"May be harmful in contact with skin",c:null},H314:{s:"Causes severe skin burns and eye damage",c:null},H315:{s:"Causes skin irritation",c:null},H316:{s:"Causes mild skin irritation",c:null},H317:{s:"May cause an allergic skin reaction",c:null},H318:{s:"Causes serious eye damage",c:null},H319:{s:"Causes serious eye irritation",c:null},H320:{s:"Causes eye irritation",c:null},H330:{s:"Fatal if inhaled",c:null},H331:{s:"Toxic if inhaled",c:"toxic"},H332:{s:"Harmful if inhaled",c:null},H333:{s:"May be harmful if inhaled",c:null},H334:{s:"May cause allergy or asthma symptoms or breathing difficulties if inhaled",c:null},H335:{s:"May cause respiratory irritation",c:null},H336:{s:"May cause drowsiness or dizziness",c:null},H340:{s:"May cause genetic defects",c:null},H341:{s:"Suspected of causing genetic defects",c:null},H350:{s:"May cause cancer",c:null},H351:{s:"Suspected of causing cancer",c:null},H360:{s:"May damage fertility or the unborn child",c:null},H361:{s:"Suspected of damaging fertility or the unborn child",c:null},H361d:{s:"Suspected of damaging the unborn child",c:null},H362:{s:"May cause harm to breast-fed children",c:null},H370:{s:"Causes damage to organs",c:null},H371:{s:"May cause damage to organs",c:null},H372:{s:"Causes damage to organs through prolonged or repeated exposure",c:null},H373:{s:"May cause damage to organs through prolonged or repeated exposure",c:null},H400:{s:"Very toxic to aquatic life",c:"toxic"},H401:{s:"Toxic to aquatic life",c:"toxic"},H402:{s:"Harmful to aquatic life",c:null},H410:{s:"Very toxic to aquatic life with long-lasting effects",c:"toxic"},H411:{s:"Toxic to aquatic life with long-lasting effects",c:"toxic"},H412:{s:"Harmful to aquatic life with long-lasting effects",c:null},H413:{s:"May cause long-lasting harmful effects to aquatic life",c:null},H420:{s:"Harms public health and the environment by destroying ozone in the upper atmosphere",c:null}},precautionary:{P101:"If medical advice is needed, have product container or label at hand.",P102:"Keep out of reach of children.",P103:"Read label before use.",P201:"Obtain special instructions before use.",P202:"Do not handle until all safety precautions have been read and understood.",P210:"Keep away from heat, hot surfaces, sparks, open flames and other ignition sources. No smoking. [As modified by IV ATP[5]]",P211:"Do not spray on an open flame or other ignition source.",P220:"Keep/Store away from clothing/…/combustible materials.",P221:"Take any precaution to avoid mixing with combustibles.",P222:"Do not allow contact with air.",P223:"Do not allow contact with water.",P230:"Keep wetted with …",P231:"Handle under inert gas.",P232:"Protect from moisture.",P233:"Keep container tightly closed.",P234:"Keep only in original container.",P235:"Keep cool..",P240:"Ground/bond container and receiving equipment.",P241:"Use explosion-proof electrical/ventilating/light/…/equipment.",P242:"Use only non-sparking tools.",P243:"Take precautionary measures against static discharge.",P244:"Keep valves and fittings free from oil and grease.",P250:"Do not subject to grinding/shock/…/friction.",P251:"Do not pierce or burn, even after use.",P260:"Do not breathe dust/fumes/gas/mist/vapours/spray.",P261:"Avoid breathing dust/fumes/gas/mist/vapours/spray.",P262:"Do not get in eyes, on skin, or on clothing.",P263:"Avoid contact during pregnancy/while nursing.",P264:"Wash … thoroughly after handling.",P270:"Do not eat, drink or smoke when using this product.",P271:"Use only outdoors or in a well-ventilated area.",P272:"Contaminated work clothing should not be allowed out of the workplace.",P273:"Avoid release to the environment.",P280:"Wear protective gloves/protective clothing/eye protection/face protection.",P281:"[Deleted by IV ATP]",P282:"Wear cold insulating gloves/face shield/eye protection.",P283:"Wear fire/flame resistant/retardant clothing.",P284:"[In case of inadequate ventilation] wear respiratory protection.",P285:"[Deleted by IV ATP]","P231+232":"Handle under inert gas. Protect from moisture","P235+410":"Keep cool. Protect from sunlight",P301:"IF SWALLOWED",P302:"IF ON SKIN",P303:"IF ON SKIN (or hair)",P304:"IF INHALED",P305:"IF IN EYES",P306:"IF ON CLOTHING",P307:"[Deleted by IV ATP]",P308:"If exposed or concerned",P309:"[Deleted by IV ATP]",P310:"Immediately call a POISON CENTER/doctor/…",P311:"Call a POISON CENTER/ doctor/…",P312:"Call a POISON CENTER/ doctor/…/if you feel unwell.",P313:"Get medical advice/attention.",P314:"Get medical advice/attention if you feel unwell.",P315:"Get immediate medical advice/attention.",P320:"Specific treatment is urgent (see … on this label).",P321:"Specific treatment (see … on this label).",P322:"[Deleted by IV ATP]",P330:"Rinse mouth.",P331:"Do NOT induce vomiting.",P332:"If skin irritation occurs",P333:"If skin irritation or a rash occurs",P334:"Immerse in cool water/wrap in wet bandages.",P335:"Brush off loose particles from skin.",P336:"Thaw frosted parts with lukewarm water. Do not rub affected areas.",P337:"If eye irritation persists",P338:"Remove contact lenses if present and easy to do. Continue rinsing.",P340:"Remove person to fresh air and keep comfortable for breathing.",P341:"[Deleted by IV ATP]",P342:"If experiencing respiratory symptoms",P350:"[Deleted by IV ATP]",P351:"Rinse cautiously with water for several minutes.",P352:"Wash with plenty of water/…",P353:"Rinse skin with water/shower.",P360:"Rinse immediately contaminated clothing and skin with plenty of water before removing clothes.",P361:"Take off immediately all contaminated clothing.",P362:"Take off contaminated clothing.",P363:"Wash contaminated clothing before reuse.",P364:"And wash it before reuse. [Added by IV ATP]",P370:"In case of fire",P371:"In case of major fire and large quantities",P372:"Explosion risk in case of fire.",P373:"DO NOT fight fire when fire reaches explosives.",P374:"Fight fire with normal precautions from a reasonable distance.",P375:"Fight fire remotely due to the risk of explosion.",P376:"Stop leak if safe to do so.",P377:"Leaking gas fire – do not extinguish unless leak can be stopped safely.",P378:"Use … to extinguish.",P380:"Evacuate area.",P381:"Eliminate all ignition sources if safe to do so.",P391:"Collect spillage.","P301+310":"IF SWALLOWED: Immediately call a POISON CENTER/doctor/…","P301+312":"IF SWALLOWED: Call a POISON CENTER/doctor/…/if you feel unwell.","P301+330+331":"IF SWALLOWED: Rinse mouth. Do NOT induce vomiting.","P302+334":"IF ON SKIN: Immerse in cool water/wrap in wet bandages.","P302+350":"[Deleted by IV ATP]","P302+352":"IF ON SKIN: Wash with plenty of water/…","P303+361+353":"IF ON SKIN (or hair): Take off immediately all contaminated clothing. Rinse skin with water/ shower.","P304+312":"IF INHALED: Call a POISON CENTER or doctor/physician if you feel unwell.","P304+340":"IF INHALED: Remove person to fresh air and keep comfortable for breathing.","P304+341":"[Deleted by IV ATP]","P305+351+338":"IF IN EYES: Rinse cautiously with water for several minutes. Remove contact lenses if present and easy to do – continue rinsing.","P306+360":"IF ON CLOTHING: Rinse immediately contaminated clothing and skin with plenty of water before removing clothes.","P307+311":"[Deleted by IV ATP]","P308+311":"If exposed or concerned: Call a POISON CENTER/ doctor/… [Added by IV ATP]","P308+313":"If exposed: Call a POISON CENTER or doctor/physician.","P309+311":"[Deleted by IV ATP]","P332+313":"If skin irritation occurs: Get medical advice/attention.","P333+313":"If skin irritation or a rash occurs: Get medical advice/attention.","P335+334":"Brush off loose particles from skin. Immerse in cool water/wrap in wet bandages.","P337+313":"If eye irritation persists get medical advice/attention.","P342+311":"If experiencing respiratory symptoms: Call a POISON CENTER/doctor/…","P361+364":"Take off immediately all contaminated clothing and wash it before reuse. [Added by IV ATP]","P362+364":"Take off contaminated clothing and wash it before reuse. [Added by IV ATP]","P370+376":"In case of fire: Stop leak if safe to do so.","P370+378":"In case of fire: Use … to extinguish.","P370+380":"In case of fire: Evacuate area.","P370+380+375":"In case of fire: Evacuate area. Fight fire remotely due to the risk of explosion.","P371+380+375":"In case of major fire and large quantities: Evacuate area. Fight fire remotely due to the risk of explosion.",P401:"Store …",P402:"Store in a dry place.",P403:"Store in a well ventilated place.",P404:"Store in a closed container.",P405:"Store locked up.",P406:"Store in a corrosive resistant/… container with a resistant inner liner.",P407:"Maintain air gap between stacks/pallets.",P410:"Protect from sunlight.",P411:"Store at temperatures not exceeding … °C/… °F.",P412:"Do not expose to temperatures exceeding 50 °C/122 °F.",P413:"Store bulk masses greater than … kg/… lbs at temperatures not exceeding … °C/… °F.",P420:"Store away from other materials.",P422:"Store contents under …","P402+404":"Store in a dry place. Store in a closed container.","P403+233":"Store in a well ventilated place. Keep container tightly closed.","P403+235":"Store in a well ventilated place. Keep cool.","P410+403":"Protect from sunlight. Store in a well-ventilated place.","P410+412":"Protect from sunlight. Do not expose to temperatures exceeding 50 °C/122 °F.","P411+235":"Store at temperatures not exceeding … °C/… °F. Keep cool.",P501:"Dispose of contents/container to … [… in accordance with local/regional/national/international regulation (to be specified)]."}};scil.UMDB={molcategories:["","Organic","Inorganic","Catalyst","Polymer","Peptide","RNA","Protein","Others"],namecategories:["","CATALOG","CAS","IUPAC","SYNONYM","SYSTEM","TRADE","MFCD"],currencies:["","USD","EUR","RMB","JPY","AUD","CAD"],units:["","g","mg","kg","mL","L"],jsdraw:null,init:function(n,t){var i=this,u,r;this.page=new scil.Page(n,null);this.buttons=["-",{type:"button",svg:"import",title:"Import from CSV/SDF file",onclick:function(){i.importFile()}},{type:"button",svg:"save",title:"Export SDF",onclick:function(){i.exportFile("umdb.sdf")}},"-",{type:"button",svg:"highlight",title:"Set Hazard Flags by CAS NOs",onclick:function(){i.setHazardFlags()}},{type:"button",svg:"searched",title:"Search by Structure",onclick:function(){i.searchStructure()}},"-",{type:"input",key:"source",label:"Source",styles:{width:100},autosuggesturl:"ajax.ashx?cmd=umdb.suggestsource",onenter:function(){i.refresh()}},{type:"select",key:"category",label:"Category",items:this.molcategories,onchange:function(){i.refresh()}},{type:"input",key:"name",label:"Name",styles:{width:100},autosuggesturl:"ajax.ashx?cmd=umdb.suggest",onenter:function(){i.refresh()}},{type:"select",label:"Controlled",key:"controlled",items:{"":"","true":"Controlled"},onchange:function(){i.refresh()}},{type:"select",key:"hazardflag",label:"Hazard",items:scil.Hazard.getListOptions(),onchange:function(){i.refresh()}},"-",{type:"select",key:"countperpage",label:"Count",items:["",10,25,50,100],onchange:function(){i.refresh()}}];u=300;this.list=this.page.addForm({caption:"Molecules",key:"moleculeid",object:"umdb",buttons:this.buttons,onbeforerefresh:function(n){i.onbeforerefresh(n)},columns:{moleculeid:{type:"hidden",iskey:!0},source:{label:"Source",width:100},cas:{label:"CAS",width:100},name:{label:"Name",width:100},category:{label:"Category",width:100},density:{label:"Density",type:"number",unit:"g/mL",width:80},bp:{label:"B.P.",type:"number",unit:"°C",width:80},mp:{label:"M.P.",type:"number",unit:"°C",width:80},logp:{label:"LogP",type:"number",width:80},hazardflags:{label:"Hazard Flags",width:20,type:"html",render:scil.Hazard.renderFlags},controlled:{label:"Controlled",type:"checkbox",width:50}},formcaption:"Molecule",fields:{moleculeid:{type:"hidden",iskey:!0},source:{label:"Source",width:800},category:{label:"Category",width:800},density:{label:"Density",type:"number",unit:"g/mL",width:120},bp:{label:"B.P.",type:"number",unit:"°C",width:120},mp:{label:"M.P.",type:"number",unit:"°C",width:120},logp:{label:"LogP",type:"number",unit:"°C",width:120},hazardflags:{label:"Hazard Flags",type:"multiselect",items:scil.Hazard.getListOptions(),width:800},controlled:{label:"Controlled",type:"checkbox"},jsdraw:{label:"Structure",type:"jsdraw",width:800,height:300}}},null);r=this.page.addTabs();this.addCatalogList(this,r,this.list,!0);this.addNameList(this,r,this.list,!0);this.addDetailForm(this,r,this.list,!0);this.list.refresh(null,{moleculeid:t})},getCatalogFields:function(n){var t={packageid:{type:"hidden",iskey:!0},nameid:{type:"hidden",iskey:!0},moleculeid:{label:"UMID",width:100},source:{label:"Source",width:100},name:{label:"Catalog No",width:200},productname:{label:"Product Name",width:200,render:function(n){return n!=null&&n.length>30?n.substr(0,30)+"...":n}},cas:n=="list"?{label:"CAS",width:120}:null,packagecount:{label:"Packages",width:100},size:{label:"Size",width:100},price:{label:"Price",width:150,render:function(n,t){return scil.Utils.isNullOrEmpty(n)?"":n+(t.currency==null?"":t.currency)}},pricepergram:{label:"Price/g",width:150,render:function(n,t){return scil.Utils.isNullOrEmpty(n)?"":n+(t.currency==null?"":t.currency)}},purity:{label:"Purity",width:100,render:function(n){return n==null?null:n+"%"}},grade:{label:"Grade",width:100},expiration:{label:"Expiration",type:"date",width:100},rating:{label:"Rating",width:100},status:{label:"Status",width:100},note:{label:"Note",width:150},currency:{label:"Currency",type:"select",items:this.currencies},updatedate:{label:"Update Dt.",type:"date",viewonly:!0},packages:{label:"Packages",type:"table",columns:{size:{label:"Size",width:100,type:"number",units:this.units},price:{label:"Price",width:100,type:"number"}}}};return n=="list"?(t.size=t.price=t.currency=t.packages=null,t.packageid=null):n=="catalog"?(t.packagecount=t.currency=t.packages=null,t.nameid=null):n=="edit"&&(t.size=t.price=t.packagecount=t.updatedate=null,t.packageid=null),t},searchStructure:function(){var n=this;JSDraw2.Editor.showPopup("Search by Structure","Search",function(t){var i=t.getXml();scil.Utils.isNullOrEmpty(i)||(n.jsdraw=t.getXml(),n.refresh())})},setHazardFlags:function(){if(this.hazardDlg==null){var n=this,t={hazardflag:{label:"Hazard Flag",type:"select",items:scil.Hazard.getListOptions()},casnos:{label:"CAS NOs",type:"textarea",width:800,height:100}};this.hazardDlg=scil.Form.createDlgForm("Set Hazard Flags by CAS NOs",t,{label:"Save",onclick:function(){n.setHazardFlags2()}})}this.hazardDlg.show();this.hazardDlg.form.setData({})},setHazardFlags2:function(){var n=this;scil.Utils.ajax("ajax.ashx?cmd=umdb.sethazardflag",function(){n.hazardDlg.hide()},this.hazardDlg.form.getData())},exportFile:function(n){var t={filename:n};this.onbeforerefresh(t);scil.Utils.post("ajax.ashx?cmd=umdb.export",t,"_blank")},importFile:function(){var n=this;this.importDlg=scil.Form.createDlgForm("Import File",{source:{label:"Vendor",attributes:{name:"source"}},appending:{label:"Appending",type:"checkbox",str:"Appending Mode",attributes:{name:"appending"}},file:{label:"File",attributes:{name:"file"},type:"rawfile",str:"(Supporting CSV/SDF files)"}},{label:"Import",onclick:function(){n.importFile2()}},{usepostform:!0})},importFile2:function(){this.importDlg.form.postForm("ajax.ashx?cmd=umdb.import",null,function(n){scil.Utils.alert(n)})},refresh:function(){this.list.refresh()},onbeforerefresh:function(n){this.jsdraw!=null?n.jsdraw=this.jsdraw:scil.Form.getButtonValuesByKey(this.buttons,["name","controlled","category","source","hazardflag","countperpage"],n);this.jsdraw=null},addCatalogList:function(n,t,i){var r=this;n.catalogs=t.addForm({object:"umdb.catalog",tabkey:"name",key:"nameid",caption:"Catalogs",columns:this.getCatalogFields("list"),formcaption:"Name",fields:this.getCatalogFields("edit")},i)},addNameList:function(n,t,i){var r=this;n.names=t.addForm({object:"umdb.name",tabkey:"name",key:"nameid",caption:"Names",columns:{nameid:{type:"hidden",iskey:!0},source:{label:"Source",width:100},category:{label:"Category",width:100},name:{label:"Name",width:300}},formcaption:"Name",fields:{nameid:{type:"hidden"},moleculeid:{label:"UMID",viewonly:!0,width:200},source:{label:"Source",width:200},category:{label:"Category",type:"select",items:this.namecategories,width:200},name:{label:"Name",width:600}}},i)},addDetailForm:function(n,t,i){n.detail=t.addForm({type:"form",object:"umdb",caption:"Molecule",fields:{jsdraw:{label:"Structure",type:"jsdraw",width:800,height:400}}},i)}};scil.UMDB.Search={dlg:null,ajax:"ajax.ashx?cmd=",scopes:{"./":"Internal"},init:function(n,t){var i=this,r,u;this.page=new scil.Page(n);this.buttons=["-",{svg:"cart",title:"Purchase",onclick:function(){i.purchaseSelected()}},"-",{type:"select",key:"scope",label:"Database",items:this.scopes},"-",{type:"select",key:"category",label:"Category",items:this.molcategories,onchange:function(){i.refresh()}},{type:"select",key:"packageonly",label:"Package",items:{"0":"All Catalog","1":"Package Only"},onchange:function(){i.refresh()}},{type:"input",key:"source",label:"Source",styles:{width:100},autosuggesturl:"ajax.ashx?cmd=",onsuggest:function(n,t,r){i.onsuggest(r,"umdb.suggestsource")},onenter:function(){i.refresh()}},{type:"input",key:"name",label:"Name",styles:{width:100},autosuggesturl:"ajax.ashx?cmd=",onsuggest:function(n,t,r){i.onsuggest(r,"umdb.suggest")},onenter:function(){i.refresh()}},"-",{type:"select",key:"countperpage",label:"Count",items:["",10,25,50,100],onchange:function(){i.refresh()}}];r=scil.UMDB.getCatalogFields("catalog");r.moleculeid.type="html";r.moleculeid.template="<u>{?}<\/u>";u=t!=null&&t.issearch;this.list=this.page.addForm({caption:u?null:"Catalog",key:"nameid",object:"umdb.search",rowcheck:!0,jsonp:!0,buttons:this.buttons,onbeforerefresh:function(n){i.onbeforerefresh(n)},columns:r});i=this;new scil.Popup(this.list.table.tbody.parentNode,{caption:"UMDB",ongethtml2:function(n,t){var r=t.srcElement||t.target;return r.tagName=="U"?"<img src='"+i.getUrl("Chem2Image.aspx?source=umdb&q=")+r.innerHTML+"'/>":null}})},onsuggest:function(n,t){n.url=this.getUrl(this.ajax)+t},purchaseSelected:function(){var t=this.list.table.getCheckedKeys(),n;if(t==null||t.length==0){scil.Utils.alert("No items selected");return}n=this;scil.Utils.jsonp(this.getUrl(this.ajax)+"umdb.loadpackages",function(t){n.callback!=null&&n.callback(t,n)},{packageids:scil.Utils.array2str(t,",")})},refresh:function(){this.list.refresh()},onbeforerefresh:function(n){scil.Form.getButtonValuesByKey(this.buttons,["name","category","source","countperpage","packageonly"],n);this.page.url=this.getUrl(this.ajax)},getUrl:function(n){var t=scil.Form.getButtonValueByKey(this.buttons,"scope");return scil.Utils.isNullOrEmpty(t)?n:t+(scil.Utils.endswith(t,"/")?"":"/")+n},setSource:function(n){scil.Form.setButtonValueByKey(this.buttons,"source",n)},showDlg:function(n,t){if(this.dlg==null){var i=scil.Utils.createElement(null,"div",null,{width:t!=null&&t.width>0?t.width:1100});this.dlg=new scil.Dialog("Search Commerical Compounds",i);this.dlg.show();t==null&&(t={});t.issearch=!0;this.init(this.dlg,t)}else this.dlg.show();t.source!=null&&this.setSource(t.source);this.dlg.moveCenter();this.callback=n}};scil.Courier={url:"jsdraw/service.aspx",track:function(n,t){var i=this;scil.Utils.ajax(this.url+"?cmd=tracker.track",function(n){i.create();i.show(n)},{carrier:n,trackno:t})},create:function(){if(this.dlg==null)this.dlg=scil.Form.createDlgForm("Tracking",{trackno:{label:"Tracking No",viewonly:!0},details:{label:"Details",viewonly:!0,type:"table",columns:{datetime:{label:"Date/Time",width:100},activity:{label:"Activity",width:400},location:{label:"Location",width:150}}}})},show:function(n){this.dlg.show();this.dlg.form.setData(n);this.dlg.moveCenter()}};scil.Math={kPreferEUNumber:!1,selectValue:function(n,t){var r,i;if(t==null)return n;if(n==null)return null;for(r=[],i=0;i<n.length;++i)r.push(n[i][t]);return r},sum:function(n,t){var r,i;for(n=this.selectValue(n,t),r=0,i=0;i<n.length;++i)r+=n[i];return r},concat:function(n,t,i){var r,e,f,u;for(n=this.selectValue(n,t),r="",e={},f=0;f<n.length;++f)if(u=n[f],!scil.Utils.isNullOrEmpty(u)){if(i){if(e[u])continue;e[u]=!0}r!=""&&(r+=",");r+=u}return r},geometricMean:function(n,t){var r,i;if(n=this.selectValue(n,t),n==null||n.length==0)return null;for(r=[],i=0;i<n.length;++i)r[i]=Math.log(n[i]);return Math.exp(this.avg(r))},geomean:function(n,t){return this.geometricMean(n,t)},average:function(n,t){return this.avg(n,t)},harmonicMean:function(n,t){var r,i;for(n=this.selectValue(n,t),r=0,i=0;i<n.length;++i)r=1/n[i];return n.length/r},arithmeticMean:function(n,t){return this.avg(n,t)},round:function(n,t){if(n==null||isNaN(n))return null;var i=Math.pow(10,t);return Math.round(n*i)/i},isRange:function(n){if(scil.Utils.isNullOrEmpty(n)||typeof n!="string"||(n=scil.Utils.trim(n),n==""))return!1;var t=n.indexOf("~");return(t<0&&(t=n.indexOf("-",1)),t<0)?!1:!this.isNaN(n.substr(0,t))&&!this.isNaN(n.substr(t+1))},transform:function(n,t){var r,i;if(n==null)return null;for(r=[],i=0;i<n.length;++i)r[i]=t(n[i]);return r},min:function(n,t){var i,r;for(n=this.selectValue(n,t),i=null,r=0;r<n.length;++r)(i==null||n[r]<i)&&(i=n[r]);return i},max:function(n,t){var i,r;for(n=this.selectValue(n,t),i=null,r=0;r<n.length;++r)(i==null||n[r]>i)&&(i=n[r]);return i},isNaN:function(n){return n==null||isNaN(n)||!isFinite(n)},median:function(n,t){if(n=this.selectValue(n,t),n==null||n.length==0)return null;if(n.length==1)return n[0];if(n.sort(),n.length%2==1)return n[(n.length-1)/2];var i=n.length/2;return(n[i]+n[i-1])/2},avg:function(n,t){return n=this.selectValue(n,t),scil.Math.sum(n)/n.length},stdev:function(n,t){var r,u,i;for(n=this.selectValue(n,t),r=0,u=scil.Math.avg(n),i=0;i<n.length;++i)r+=(n[i]-u)*(n[i]-u);return Math.sqrt(r/(n.length-1))},cv:function(n,t){return n=this.selectValue(n,t),this.stdev(n)*100/this.avg(n)},rsd:function(n,t){return n=this.selectValue(n,t),scil.Math.stdev(n)/scil.Math.avg(n)},ad:function(n,t){var r,u,i;for(n=this.selectValue(n,t),r=0,u=scil.Math.avg(n),i=0;i<n.length;++i)r+=Math.abs(n[i]-u);return r/n.length},rd:function(n,t){var r,u,i;for(n=this.selectValue(n,t),r=0,u=scil.Math.avg(n),i=0;i<n.length;++i)r+=Math.abs(n[i]-u);return r/u},log10:function(n){return Math.log(n)/Math.LN10},ln:function(n){return Math.log(n)},roundToSignificantDigits:function(n,t){var i,r,u;if(n==0||isNaN(n))return n;if((i=Math.floor(this.log10(Math.abs(n)))+1,i<0)||t-i>=0)return this.roundStr(n,t-i);for(r=this.roundStr(n,0),u=0;u<i-t-1;++u)r+="0";return r},formatNumber:function(n,t){var r,i,f,u;if(scil.Utils.isNullOrEmpty(t))return n+"";if(r=null,i=t.toLowerCase().indexOf("e"),i>0&&(r=t.substr(i,1),t.substr(0,i)),i=t.indexOf("."),i>=0&&i+1<t.length)t=t.substr(i+1);else return n+"";return f=t.substr(0,1)=="0",r!=null?(u=Math.floor(scil.Math.log10(n)),scil.Utils.roundStr(n*Math.pow(10,-u),t.length-1,t.length)+r+u):f?n.toFixed(t.length):scil.Math.round(n,t.length)+""},roundStr:function(n,t,i,r){var f,u,e,s,o,c,h;if(n==null||isNaN(n))return"";if(n==0)return"0";if(f=Math.pow(10,t),u=Math.round(n*f)/f+"",r!=!1&&(u=="0"&&n!=0||t>0&&(Math.abs(n)<1/f||n<1&&u.length<(n+"").length))&&(e=Math.floor(this.log10(n)),e<1))return s=this.roundStr(n*Math.pow(10,-e),t,i)+"e"+e,parseFloat(s)==parseFloat(u)?u:s;if(i==!1||t<=0)return u;for(o=u.indexOf("."),o<0&&(u+=".",o=u.length-1),c=u.length-1-o,h=c;h<t;++h)u+="0";return u},lsfit:function(n,t,i,r){var s=0,y=0,b=0,k=0,h=0,u=0,e=0,c=n.length,f,o,p,w;if(c!=t.length)throw new Error("The parameters values_x and values_y need to have same size!");if(c===0)return null;for(f=0;f<c;f++)u=n[f],e=t[f],s+=u,y+=e,k+=u*u,b+=u*e,h++;var l=(h*b-s*y)/(h*k-s*s),a=y/h-l*s/h,v=[];for(f=0;f<c;f++)u=n[f],e=u*l+a,v.push(e);var d=0,g=0,nt=scil.Math.avg(t);for(o=0;o<v.length;++o)p=v[o]-t[o],w=t[o]-nt,d+=p*p,g+=w*w;var tt=1-d/g,u="x",e="y";return scil.Utils.isNullOrEmpty(i)||i=="linear"||(u=i+"("+u+")"),scil.Utils.isNullOrEmpty(r)||r=="linear"||(e=r+"("+e+")"),{yvalues:v,r2:tt,slope:l,delta:a,formula:e+" = "+scil.Utils.roundStr(l,2)+" "+u+" "+(a<0?"-":"+")+" "+scil.Utils.roundStr(Math.abs(a),2)}},lsfit2x:function(n,t){return(t-n.delta)/n.slope},lsfit2y:function(n,t){return n.delta+n.slope*t},toFloat:function(n){return typeof n&&(n=this.convertNumberEU2US(n)),scil.Utils.isNullOrEmpty(n)||isNaN(n)?NaN:parseFloat(n)},convertNumberEU2US:function(n){return(n=scil.Utils.trim(n),scil.Utils.isNullOrEmpty(n))?null:n.indexOf(",")>=0&&n.indexOf(".")<0?/^[+|-]?([0-9]{1,3}([ ][0-9]{3}){1,50})([,][0-9]{1,100})?$/.test(n)?n.replace(/[,]/g,".").replace(/[ ]/g,""):/^[+|-]?([0-9]{1,3}([,][0-9]{3}){1,50})$/.test(n)?this.kPreferEUNumber?n.replace(/[,]/g,"."):n.replace(/[,]/g,""):n.replace(/[,]/g,"."):n.replace(/[,]/g,"")}};scil.Dictionary={init:function(n){this.page=new scil.Page(n,{caption:"Categories",key:"category",name:"category",object:"dictionary",root:{selectable:!0,name:"Categories",svg:"categories"}});this.words=this.page.addForm(this.tableForm(),this.page.tree);this.words.refresh()},refresh:function(){this.words.refresh()},tableForm:function(){var n=this,t=scil.User.isAdmin();return this.buttons=["-"],t&&(this.buttons.push({svg:"import",title:"Import",onclick:function(){n.importText()}}),this.buttons.push("-")),this.buttons.push({type:"select",key:"countperpage",label:"Count",items:["",10,25,50,100],onchange:function(){n.refresh()}}),this.buttons.push({type:"input",key:"q",label:"Search",styles:{width:100},autosuggesturl:"ajax.ashx?cmd=dictionary.suggest",onenter:function(){n.refresh()}}),{caption:"Words",key:"wordid",object:"dictionary",buttons:this.buttons,canadd:t,canedit:t,download:!0,columns:{wordid:{type:"hidden",iskey:!0},word:{label:"Word",width:200},data:{label:"Data",width:400}},formcaption:"Word",fields:{wordid:{type:"hidden"},word:{label:"Word",width:400},data:{label:"Data",width:400},category:{label:"Category",width:400}}}},importText:function(){var n=this;scil.Utils.prompt2({caption:"Import Words",message:"Paste Words below, one word per line",multiline:!0,height:300,callback:function(t){scil.Utils.ajax("ajax.ashx?cmd=dictionary.import",function(){n.refresh()},{category:n.words.args.category,text:t})}})}};scil.Animation={enabled:!scil.Utils.isIE&&typeof anime!="undefined",expandX:function(n,t,i){this.expandXY(n,t,null,i)},expandY:function(n,t,i){this.expandXY(n,null,t,i)},makeExpandable:function(n,t,i){n.style.overflow="hidden";t!=null&&(n.style.maxWidth=t);i!=null&&(n.style.maxHeight=i);n.style.display="block"},expandXY:function(n,t,i,r){var u=t!=null&&scil.Utils.isNullOrEmpty(n.style.maxWidth),f=i!=null&&scil.Utils.isNullOrEmpty(n.style.maxHeight),e;u||f?(u&&(n.style.maxWidth=(n.offsetWidth==null?0:n.offsetWidth)+"px"),f&&(n.style.maxHeight=(n.offsetHeight==null?0:n.offsetHeight)+"px"),e=this,setTimeout(function(){e._expandxy(n,t,i,r)})):this._expandxy(n,t,i,r)},_expandxy:function(n,t,i,r){var f=500,u="";t!=null&&(u+=(u==""?"":",")+"max-width "+f/1e3+"s");i!=null&&(u+=(u==""?"":",")+"max-height "+f/1e3+"s");n.style.WebkitTransition=u;n.style.transition=u;this.makeExpandable(n,t==null?null:t+"px",i==null?null:i+"px");setTimeout(function(){t===0||i===0?n.style.display="none":(t!=null&&(n.offsetWidth>=t&&(n.style.maxWidth=t+1e3+"px",n.style.display="visible"),n.style.maxWidth=n.offsetWidth+"px"),i!=null&&(n.offsetHeight>=i&&(n.style.maxHeight=i+1e3+"px",n.style.display="visible"),n.style.maxHeight=n.offsetHeight+"px"));r!=null&&r()},f)},flyin:function(n){var t=this.beginfly(n);this.run(n.div,{translateX:[{value:t.dx,duration:1e3}],translateY:[{value:t.dy,duration:1e3}],scale:[{value:.3,duration:1500}],opacity:[{value:.3,duration:1500}],easing:"easeInOutQuart"},null,function(){n.div.style.display="none"})},flyback:function(n){var t=this.beginfly(n);this.run(n.div,{translateX:[{value:t.dx,duration:500}],translateY:[{value:t.dy,duration:500}],scale:[{value:.3,duration:500}],easing:"easeInOutQuart",direction:"alternate"},null,function(){n.div.style.display="none"})},beginfly:function(n){var i=scil.Utils.getOffset(n.src).offset(n.src.offsetWidth/2,n.src.offsetHeight/2),t=scil.Utils.getOffset(n.dest);switch(n.destalign.align){case"left":t.offset(0,n.dest.offsetHeight/2);break;case"right":t.offset(n.dest.offsetWidth,n.dest.offsetHeight/2);break;case"top":t.offset(n.dest.offsetWidth/2,0);break;case"bottom":t.offset(n.dest.offsetWidth/2,n.dest.offsetHeight);break;default:t.offset(n.dest.offsetWidth/2,n.dest.offsetHeight/2)}return t.offset(n.destalign.dx==null?0:n.destalign.dx,n.destalign.dy==null?0:n.destalign.dy),n.useimg||scil.apply(n.div.style,{width:n.src.offsetWidth+"px",height:n.src.offsetHeight+"px"}),scil.apply(n.div.style,{display:"",transform:"",left:i.x-n.imgwidth/2+"px",top:i.y-n.imgheight/2+"px"}),{dx:t.x-i.x,dy:t.y-i.y}},destoryflyer:function(n){n.div!=null&&(n.div.parentNode.removeChild(n.div),n.div=null)},makeflyer:function(n,t,i,r,u,f){var e,o,s;return typeof n=="string"&&(n=scil.byId(n)),typeof t=="string"&&(t=scil.byId(t)),e=null,e=typeof i=="string"?scil.Utils.createElement(document.body,"img",null,{position:"absolute",zIndex:1e6,display:"none"},{src:i}):i,o=e!=null,o||(s=75,e=scil.Utils.createElement(document.body,"div",null,{position:"absolute",border:"solid 1px blue",background:"yellow",opacity:s/100,filter:"alpha(opacity="+s+")",zIndex:1e6,display:"none"})),r==null&&(r=50),u==null&&(u=50),{div:e,useimg:o,src:n,dest:t,imgwidth:r,imgheight:u,destalign:f==null?{}:f}},shake:function(n,t){if(!this.enabled){t!=null&&t();return}anime.timeline().add({targets:n,translateX:30,duration:50,easing:"easeInOutQuart"}).add({targets:n,translateX:-30,duration:50,easing:"easeInOutQuart"}).add({targets:n,translateX:30,duration:50,easing:"easeInOutQuart"}).add({targets:n,translateX:0,duration:50,easing:"easeInOutQuart",complete:function(){t!=null&&t()}})},translateX:function(n,t,i,r){t==null&&(t=500);i==null&&(i=1e3);var e=this,f={mode:n.style.position,left:n.style.left,top:n.style.top,transform:""},u=f.mode;scil.Utils.isNullOrEmpty(u)&&(u="relative");this.run(n,{translateX:[{value:t,duration:i}]},{mode:u,dx:t},function(){e._setposition(n,f);r!=null&&r()})},translateY:function(n,t,i,r){t==null&&(t=500);i==null&&(i=1e3);var e=this,f={mode:n.style.position,left:n.style.left,top:n.style.top,transform:""},u=f.mode;scil.Utils.isNullOrEmpty(u)&&(u="relative");this.run(n,{translateY:[{value:t,duration:i}]},{mode:u,dy:t},function(){e._setposition(n,f);r!=null&&r()})},zoomin:function(n,t,i){t==null&&(t=1e3);var r=this,u={mode:"scale",transform:""};this.run(n,{scale:[{value:1,duration:t,easing:"easeInOutQuart"}]},{mode:"scale",scale:0},function(){r._setposition(n,u);i!=null&&i()})},zoomout:function(n,t,i){t==null&&(t=500);var r=this,u={mode:"scale",transform:""};this.run(n,{scale:[{value:0,duration:t,easing:"easeInOutQuart"}]},{mode:"scale",scale:1},function(){r._setposition(n,u);i!=null&&i()})},run:function(n,t,i,r){var f,e,s,o,u;if(!this.enabled){r!=null&&r();return}if(f=null,e=null,i!=null&&(i.mode=="scale"?i.scale!=null&&this._setposition(n,{mode:i.mode,transform:"scale("+i.scale+")"}):(i.dx!=null&&(f=scil.Utils.parsePixel(n.style.left,0)),i.dy!=null&&(e=scil.Utils.parsePixel(n.style.top,0)),this._setposition(n,{mode:i.mode,left:f==null?null:f-i.dx+"px",top:e==null?null:e-i.dy+"px",transform:""}))),s=this,t.length>0)for(o=anime.timeline(),u=0;u<t.length;++u)t[u].targets=n,u==t.length-1&&r!=null&&(t[u].complete=r),o.add(t[u]);else t.targets=n,r&&(t.complete=r),anime(t)},_setposition:function(n,t){t.mode!="scale"&&(n.style.position=t.mode=="relative"?"relative":t.mode=="absolute"?"absolute":t.mode==null?"":t.mode,t.left!=null&&(n.style.left=t.left),t.top!=null&&(n.style.top=t.top));t.transform!=null&&(n.style.transform=t.transform)}};scil.CardView=scil.extend(scil._base,{kCardBgColor:"#d7d7d7",constructor:function(n){this.currow=null;this.options=n==null?{}:n;this.options.imgwidth>0||(this.options.imgwidth=300);this.options.imgheight>0||(this.options.imgheight=120)},clear:function(){for(var n=0;n<this.parent.childNodes.length;++n)delete this.parent.childNodes[n].data;scil.Utils.removeAll(this.parent);this.currow=null},autoHideColumns:function(){},showAllColumns:function(){},setXml:function(n){this.setData(scil.Table.xml2rows(n))},setData:function(n,t,i){if(i!=!1&&this.clear(),n!=null)for(var r=0;r<n.length;++r)this.addRow(n[r])},showFilterRow:function(){},hasFilter:function(n){return this.items[n]!=null&&this.items[n].filter!=null&&this.items[n].filter&&this.items[n].filter.b!=null},setFilterValue:function(){},getFilterValue:function(){},setFilterValues:function(){},getFilterValues:function(){},hasFilterValues:function(){return!1},clearFilterValues:function(){},render:function(n,t){typeof n=="string"&&(n=scil.byId(n));this.parent=scil.Utils.createElement(n,"div",null,{clear:"left"});this.items={};for(var i in t)t[i]!=null&&(this.items[i]=t[i],t[i].iskey&&(this.key=i))},getCurrentKey:function(){if(this.currow==null)return null;var n=this.currow.getAttribute("key");return n==""?null:n},getRowData:function(n){return n==null?null:typeof n=="number"&&(n=this.parent.childNodes[n],n==null)?null:n.data},getCurrentRowData:function(){return this.getRowData(this.currow)},getCheckedKeys:function(n){for(var t,i=[],u=this.parent.childNodes,r=0;r<u.length;++r)this._isChecked(u[r])&&(t=u[r].getAttribute("key"),scil.Utils.isNullOrEmpty(t)||i.push(t));return i.length==0&&n&&(t=this.getCurrentKey(),t!=null&&i.push(t)),i},selectFirstRow:function(){var n=this.parent.childNodes[0];this.selectRow(n)},getCheckedKeys2:function(){return this.getCheckedKeys(!0)},checkRows:function(n){var i,t,r;if(n!=null)for(i=this.parent.childNodes,t=0;t<i.length;++t)r=i[t].getAttribute("key"),!scil.Utils.isNullOrEmpty(r)&&scil.Utils.indexOf(n,r)>=0&&this.checkRow(i[t],!0)},getCheckedRows:function(n){for(var i=[],r=this.parent.childNodes,t=0;t<r.length;++t)this._isChecked(r[t])&&i.push(t);if(i.length==0&&n)for(t=0;t<r.length;++t)if(r[t]==this.currow){i.push(t);break}return i},getCheckedRows2:function(){return this.getCheckedRows(!0)},getCheckedRowData2:function(){return this.getCheckedRowData(!0)},getCheckedRowData:function(n){for(var u,t=[],r=this.parent.childNodes,i=0;i<r.length;++i)this._isChecked(r[i])&&t.push(this.getRowData(r[i]));return t.length==0&&n&&(u=this.getCurrentRowData(),u!=null&&t.push(u)),t},delRow:function(n){for(var i=this.parent.childNodes,t=0;t<i.length;++t)if(i[t].getAttribute("key")==n){if(delete i[t].data,this.parent.removeChild(i[t]),this.options.onchange!=null)this.options.onchange(this);return this.dirty=!0,!0}return!1},updateRow:function(n,t){for(var r,f,u=this.parent.childNodes,i=0;i<u.length;++i)if(u[i].getAttribute("key")==n)return r=u[i],t==null&&(t={}),f=this.addRow(t,null,r),this.parent.removeChild(r),this.currow==r&&this.selectRow(f),!0;return!1},findRow:function(n){for(var i=this.parent.childNodes,t=0;t<i.length;++t)if(i[t].getAttribute("key")==n)return i[t];return null},selectRow:function(n){if(typeof n=="string"&&(n=this.findRow(n)),this.currow!=n){var t=this.currow;if(this.currow!=null&&(this.currow.style.background="",this.currow.children[0].children[0].children.length>1&&(this.currow.children[0].children[0].children[1].children[0].style.backgroundColor=this.kCardBgColor)),n!=null&&(n.style.background=scil.App.config.button,n.children[0].children[0].children.length>1&&(n.children[0].children[0].children[1].children[0].style.backgroundColor=scil.App.config.button)),this.currow=n,this.options.onselectrow!=null)this.options.onselectrow(this.currow,t)}},ondblclick:function(n){if(this.options.ondblclick!=null)this.options.ondblclick(n,this)},selectColumns:function(n,t,i){scil.Table.selectColumns(this,n,t,i)},allColsForDownload:function(){return scil.Table.allColsForDownload(this)},_getvalue:function(n,t){if(t==null)return null;var i=n[t],r=this.items[t];return r!=null&&r.render!=null&&(i=r.render(i,n,this)),i},addRow:function(n,t,i){var l=this,f={boxShadow:"2px 2px 6px 2px rgba(0,0,0,0.2)",background:"#fff",margin:"2px",textAlign:"center",width:this.options.width,overflowX:"hidden",border:"solid 1px gray"},r,h,a,v,u,y,k,p,e,w,c,s,o,b;if(this.options.type!="column"&&scil.apply(f,{display:"table",float:"left"}),r=scil.Utils.createElement(null,"div",null,f),i=="top"?this.parent.insertBefore(r,this.parent.firstChild):i==null?this.parent.appendChild(r):this.parent.insertBefore(r,i),scil.connect(r,"onclick",function(){l.selectRow(r)}),scil.connect(r,"ondblclick",function(){l.ondblclick(r)}),e=scil.Utils.createTable(r,0,0,{width:"100%"}),h=this.options.imgkey,h!=null&&(o=scil.Utils.createElement(e,"tr"),a=scil.Utils.createElement(o,"td",null,{padding:"2px"}),this.options.renderimg!=null?this.options.renderimg(a,value,this):(v="100%",u=this._getvalue(n,h),scil.Utils.isNullOrEmpty(u)&&(v="",typeof this.options.imgempty=="function"?u=this.options.imgempty(n):this.options.imgempty!=null&&(u=this.options.imgempty)),y=null,this.options.showtexts||this.options.imgtitlekey==null||n==null||(y=n[this.options.imgtitlekey]),f={color:"#ccc",display:"block",position:"relative",width:this.options.imgwidth,height:this.options.imgheight,backgroundColor:"#fff",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:v},typeof u=="string"?f.backgroundImage="url('"+u+"')":(f.backgroundImage="url('"+u.img+"')",u.style!=null&&scil.apply(f,u.style)),k=scil.Utils.createElement(a,"div",y,f),this.options.rowcheck&&(r.check=scil.SVG.createIcon(k,"card-unchecked",{position:"absolute",left:this.options.imgwidth-32+"px",top:"0",cursor:"pointer",width:32,height:32},{title:"Select"},function(){l.checkRow(r)})))),this.options.showtexts!=!1){p=null;p=this.options.horizontal?scil.Utils.createElement(o,"td",null,{borderLeft:"solid 1px gray",backgroundColor:this.kCardBgColor}):scil.Utils.createElement(scil.Utils.createElement(e,"tr"),"td",null,{borderTop:"solid 1px gray",backgroundColor:this.kCardBgColor});e=scil.Utils.createTable(scil.Utils.createElement(p,"div",null,{width:this.options.imgwidth,overflow:"hidden"}));e.parentNode.setAttribute("align","center");w=this.options.ondisplayitems==null?this.items:this.options.ondisplayitems(this.items);for(c in w)(s=w[c],c!=h&&s.type!="hidden")&&(o=scil.Utils.createElement(e,"tr"),scil.Utils.createElement(o,"td",scil.Lang.res(s.label)+": ",{textAlign:"left",whiteSpace:"nowrap",fontSize:"14px",fontWeight:"bold"}),b=scil.Utils.createElement(o,"td",null,{textAlign:"right",fontSize:"12px"}),b.field=scil.Form.createField(b,s,!0,n==null?s.value:n[c],n,!0,"card"))}return r.data=n,this.key!=null&&n[this.key]!=null&&r.setAttribute("key",n[this.key]),r},checkRow:function(n,t){this.options.rowcheck&&(typeof n=="string"?n=this._findByKey(n):typeof n=="number"&&(n=this.parent.childNodes[n]),n!=null)&&(t==null&&(t=!this._isChecked(n)),t?(n.check!=null&&scil.SVG.replaceContent(n.check,"card-checked","orange"),n.setAttribute("checked","1")):(n.check!=null&&scil.SVG.replaceContent(n.check,"card-unchecked",""),n.removeAttribute("checked")))},showColumn:function(){},_isChecked:function(n){return n.getAttribute("checked")=="1"},_findByKey:function(n){for(var i=this.parent.childNodes,t=0;t<i.length;++t)if(i[t].getAttribute("key")==n)return i[t];return null}});scil.FileUploader={kEnterPassword:!1,current:null,upload:function(n){var i,t,r,u;if(n.dlg==null){i={};n.multiple&&(i.multiple="multiple");t={};n.message!=null&&(t.message={type:"html",template:n.message});t.file={label:i.multiple?"Files":"File",type:"rawfile",attributes:i};scil.apply(t,n.fields);r=n.enterpassword==null?this.kEnterPassword:n.enterpassword;r&&(t.filepassword={label:"File Password",type:"password"});scil.MobileData.disabled||n.frommobile==!1||(u=this,t.mobileimages={type:"hidden"},t.mobileimagediv={label:"From Mobile",type:"div",style:{maxWidth:"400px"},button:{label:"Show",type:"a",onclick:function(){u.showImageList(n)}}});var u=this,f=n.caption==null?"Upload File":n.caption,e=n.buttonlabel==null?"Upload":n.buttonlabel;n.dlg=scil.Form.createDlgForm(f,t,{label:e,onclick:function(t){t.preventDefault();scil.FileUploader.upload2(n)}},{usepostform:!0})}n.dlg.show();this.current=n},getFilenames:function(n){for(var t=[],r=n.dlg.form.fields.file.files,i=0;i<r.length;++i)t.push(r[i].name);return scil.MobileData.getSelectedImageNames(n.mobileimagelist,t),t},showImageList:function(n){n.mobileimagelist==null&&(n.mobileimagelist=scil.MobileData.createImageList(n.dlg.form.fields.mobileimagediv,n.multiple));scil.MobileData.listImages(n.mobileimagelist,n.data)},upload2:function(n){if(n.dlg.form.fields.mobileimages!=null&&n.mobileimagelist!=null&&(n.dlg.form.fields.mobileimages.value=scil.MobileData.getSelectedImages(n.mobileimagelist)),n.onupload!=null)n.onupload(n,this);else this.upload3(n)},upload3:function(n){n.dlg.form.post(n.url,n.data,function(t){n.callback(t,n)!=!1&&n.dlg.hide()})},mapData:function(n,t){var r=this,i=this.current;i.dlg.form.post(n,i.data,function(n){r.showMap(n,t)})},showMap:function(n,t){var f={"":""},u,s,i,l;for(i in t)f[i]=t[i].label;u={};s=n[0];for(i in s)u[i]={label:i};var a={note:{type:"html",template:"Preview for the first 5 rows:"},table:{type:"table",viewonly:!0,columns:u}},v=this,e={},r=null;r=scil.Form.createDlgForm("Data Mapping",a,{label:"Save Mapping",onclick:function(){v.saveMap(e);r.hide()}},{hidelabel:!0});r.show();r.form.setData({table:n});var o=scil.Utils.eval(this.current.dlg.form.getFieldValue("__mapping")),h=r.form.fields.table.jsd.tbody,c=scil.Utils.createElement(null,"tr");h.insertBefore(c,h.firstChild.nextSibling.nextSibling);for(i in u)l=scil.Utils.createElement(c,"td"),e[i]=scil.Utils.createElement(l,"select"),scil.Utils.listOptions(e[i],f,o==null||o[i]==null?this.findKeyByValue(f,i):o[i],!0,!0)},findKeyByValue:function(n,t){if(n==null)return t;for(var i in n)if(n[i]==t)return i;return t},saveMap:function(n){var r={},i,t;for(i in n)t=n[i].value,t!=""&&(r[i]=t);t=scil.Utils.json2str(r);this.current.dlg.form.setFieldValue("__mapping",t)}};scil.AutoShrink=scil.extend(scilligence._base,{constructor:function(n,t,i){var u,r;scil.AutoShrink.disabled||(typeof n=="string"&&(n=scil.byId(n)),n!=null&&(n.tagName=="INPUT"||n.tagName=="SELECT"))&&(u=t.styles!=null&&t.styles.width!=null?t.styles.width:t.width,u>0||(u=100),r=t.shrinkwidth,r>0||(r=20),scil.connect(n,"onfocus",function(){n.style.width=u+"px"}),scil.connect(n,"onblur",function(){scil.Utils.isNullOrEmpty(n.value)&&(n.style.width=r+"px")}),i&&scil.Utils.isNullOrEmpty(n.value)&&(n.style.width=r+"px"))}});scil.SampleReceiver={instruments:{"":"","http://192.168.1.1:8012/?cmd=sendsample":"HPLC-001 (Test)"},send:function(n,t){if(this.dlg==null){var i=this,r={url:{label:"Instrument",type:"select",items:this.instruments}};this.dlg=scil.Form.createDlgForm("Send Samples",r,{label:"Send",onclick:function(){i.send2()}})}this.key=t;this.field=n;this.dlg.show()},send2:function(){var n=this.dlg.form.getFieldValue("url"),t,i;if(scil.Utils.isNullOrEmpty(n)){scil.Utils.alert("Please select an instrument first");return}this.dlg.hide();t=scil.eln.User.me==null?null:scil.eln.User.me.name;i={jss:this.field.jss,key:this.key,url:n,i:0,n:0,fileno:this.field.form.fileno,owner:t};this.sendNext(null,i)},sendNext:function(n,t){var i,r,u,f;for(n!=null&&++t.n,i=t.i;i<t.jss.getRowCount();++i)if(r=t.jss.getRowValues(i),r.select){u=this;f={sampleid:r[t.key==null?"sampleid":t.key],experimentno:t.fileno,owner:t.owner,note:r.note||r.comment};scil.Utils.jsonp(t.url,function(n){t.i=i+1;u.sendNext(n,t)},f);return}t.n==0?scil.Utils.alert("No sample sent."):scil.Utils.alert(t.n+" sample(s) sent successfully.")}};scil.Annotator={disabled:!0,dlg:null,ed:null,callback:null,kColor:"#fffe00",changed:!1,kSeparator:"\n----------------\n",show:function(n,t){if(!scil.Annotator.disabled){if(this.eddlg==null){var i=this,r={btn:{type:"html",template:"<div title='"+scil.Lang.res("Annotate")+"' onclick='scil.Annotator.annotate()' style='background:#ddd; padding: 0 0 0 5px; border: solid 1px gray;'><img valign='middle' src='img/comment.gif'><\/div>"},ed:{type:"htmltext",width:800,height:400,readonly:!0,hidetoolbar:!0}};this.eddlg=scil.Form.createDlgForm("Annotation",r,{label:"Save",onclick:function(){i.save()}},{hidelabel:!0})}this.changed=!1;this.callback=t;this.eddlg.show();this.eddlg.form.setData({ed:n})}},save:function(){if(this.changed){var n=this,t=this.eddlg.form.getData();this.callback(t.ed,function(){n.eddlg.hide()})}else this.eddlg.hide()},annotate:function(){var n=scil.Form.getEd(this.eddlg.form.fields.ed);this.edit(n)},edit:function(n){var i,r,t,u;this.ed=n;scil.Utils.isIE&&scil.eln.Richtext.saveBookmark(this.ed);i=this.ed.selection.getNode();r=this.getAnnSpan(i);this.dlg==null&&(t=this,u={annid:{type:"hidden"},oldnote:{type:"textarea",viewonly:!0},note:{type:"textarea",width:500,height:50}},this.dlg=scil.Form.createDlgForm("Inline Annotation",u,[{label:"Save",onclick:function(){t.saveAnn()}}," ",{label:"Delete",onclick:function(){t.delAnn()}}],{hidelabel:!0}));this.dlg.show();this.dlg.form.setData(r)},getAnnSpan:function(n){for(var r=n.getAttribute("annid"),t,f,u,e,i;n!=null&&r==null;)n=scil.Utils.getParent(n.parentNode,"SPAN"),r=n==null?null:n.getAttribute("annid");return scil.Utils.startswith(r,"ann")?(t=n.getAttribute("title"),f=n.getAttribute("userid"),f!=scil.User.getAuthorID())?{annid:r,userid:f,oldnote:t}:(u="",i=t.lastIndexOf(this.kSeparator),i>0?(u=t.substr(i+this.kSeparator.length),t=t.substr(0,i)):(u=t,t=null),e=null,i=u.lastIndexOf("\n(by "),i>0&&(e=u.substr(0,i)),{annid:r,userid:f,oldnote:t,note:e}):null},isAnnColor:function(n){return n==this.kColor||n=="rgb(255, 254, 0)"},saveAnn:function(){var i=this.dlg.form.getData(),e,f,r,t,n;this.dlg.hide();e=this.ed.settings.readonly;e&&this.ed.setMode("design");scil.Utils.isIE&&scil.eln.Richtext.restoreBookmark(this.ed);var o=new Date,s="ann"+o.getTime(),h=scil.User.getAuthorID(),u=(scil.Utils.isNullOrEmpty(i.note)?scil.Lang.res("[No Comments]"):i.note)+"\n(by "+scil.User.getAuthorName()+" at "+scil.Utils.timeStr(o,!0)+")";if(scil.Utils.isNullOrEmpty(i.oldnote)||(u=i.oldnote+this.kSeparator+u),f=0,scil.Utils.isNullOrEmpty(i.annid))for(this.ed.execCommand("HiliteColor",!1,this.kColor),r=this.ed.dom.doc.getElementsByTagName("span"),t=0;t<r.length;++t)n=r[t],this.isAnnColor(n.style.backgroundColor)&&scil.Utils.isNullOrEmpty(n.getAttribute("annid"))&&(n.style.backgroundColor=this.kColor,n.setAttribute("annid",s),n.setAttribute("userid",h),n.setAttribute("title",u),++f);else for(r=this.ed.dom.doc.getElementsByTagName("span"),t=0;t<r.length;++t)n=r[t],n.getAttribute("annid")==i.annid&&(n.style.backgroundColor=this.kColor,n.setAttribute("annid",s),n.setAttribute("userid",h),n.setAttribute("title",u),++f);e&&this.ed.setMode("readonly");this.changed=f>0;this.changed&&this.ed.fire("change")},delAnn:function(){var u=this.dlg.form.getData(),i,r,t,n;if(this.dlg.hide(),!scil.Utils.isNullOrEmpty(u.annid)){for(i=0,r=this.ed.dom.doc.getElementsByTagName("span"),t=0;t<r.length;++t)n=r[t],n.getAttribute("annid")==u.annid&&(n.style.backgroundColor="",n.removeAttribute("annid"),n.removeAttribute("name"),n.removeAttribute("title"),n.removeAttribute("data-mce-style"),++i);this.changed=i>0;this.changed&&this.ed.fire("change")}}};scil.FieldOKTA=scil.extend(scil._base,{constructor:function(n,t){if(typeof n=="string"&&(n=scil.byId(n)),this.options=t==null?{}:t,this.dlg=null,this.email=null,this.token=scil.Utils.createElement(n,"password",null,this.options,scil.FieldOKTA.kReadOnly?{readonly:"readonly"}:null),!this.options.viewonly){var i=this;scil.Utils.createElement(n,"span","&nbsp;");scil.Utils.createButton(n,{label:"Ext Auth",onclick:function(){i.show()}})}},show:function(){if(scil.OktaUI.enabled){var n=this;scil.OktaUI.show(function(t,i){if(n.token.value=t,n.options.emailfield!=null&&n.parentform!=null&&n.parentform.setFieldValue(n.options.emailfield,i),n.options.onfinish!=null)n.options.onfinish(t,n)},scil.Utils.isNullOrEmpty(this.email)?this.options.email:this.email,this.options.emailviewonly,this.options.esignature);return}},setValue:function(n){this.email=n;this.token.value=""},getValue:function(){return this.token.value}});scil.OktaUI={enabled:!1,kUrl:"https://scilligence3.okta.com",kPage:"tools/okta/",dlg:null,callback:null,email:null,emailviewonly:!1,oninit:function(){},onfinish:function(n){var t,i;if(this.dlg.hide(),t=n.user.profile.login,this.email!=null&&this.emailviewonly&&this.email.toLowerCase()!=t.toLowerCase()){scil.Utils.alert("Please sign in with: "+this.email);return}i=this;scil.Utils.ajax("jsdraw/service.aspx?cmd=okta.validatetoken",function(r){i.callback!=null&&i.callback(r.oktatoken,t,n)},{email:t,token:n.session.token})},show:function(n,t,i){this.email=t;this.emailviewonly=i;this.create();this.dlg.show();this.callback=n;this.iframe.setAttribute("src",this.kPage+"?tm="+(new Date).getTime());this.iframe.contentWindow.window.init!=null&&this.iframe.contentWindow.window.init()},create:function(){if(this.dlg==null){var t=this,n=scil.Utils.createElement(null,"div");this.iframe=scil.Utils.createElement(n,"iframe",null,{width:450,height:520},{frameborder:0});this.dlg=new scilligence.Dialog("OKTA Authentication",n)}}};scil.FieldAzure=scil.extend(scil._base,{constructor:function(n,t){if(typeof n=="string"&&(n=scil.byId(n)),this.options=t==null?{}:t,this.dlg=null,this.email=null,this.token=scil.Utils.createElement(n,"password",null,this.options,scil.FieldAzure.kReadOnly?{readonly:"readonly"}:null),!this.options.viewonly){var i=this;scil.Utils.createElement(n,"span","&nbsp;");scil.Utils.createButton(n,{label:"Ext Auth",onclick:function(){i.show()}})}},show:function(){if(scil.AzureUI.enabled){var n=this;scil.AzureUI.show(function(t,i){if(n.token.value=t,n.options.emailfield!=null&&n.parentform!=null&&n.parentform.setFieldValue(n.options.emailfield,i),n.options.onfinish!=null)n.options.onfinish(t,n)},scil.Utils.isNullOrEmpty(this.email)?this.options.email:this.email,this.options.emailviewonly,this.options.esignature);return}},setValue:function(n){this.email=n;this.token.value=""},getValue:function(){return this.token.value}});scil.AzureUI={enabled:!1,kPage:"tools/azure/",kInstance:"https://login.microsoftonline.com/",kTenant:"tyuanscilligence.onmicrosoft.com",kClientID:"b2587d24-51a7-44a1-a9f8-26c36522ec94",dlg:null,callback:null,email:null,emailviewonly:!1,oninit:function(){},onfinish:function(n){var t,i;if(this.dlg.hide(),t=n.userName,this.email!=null&&this.emailviewonly&&this.email.toLowerCase()!=t.toLowerCase()){scil.Utils.alert("Please sign in with: "+this.email);return}i=this;scil.Utils.ajax("jsdraw/service.aspx?cmd=azure.validatetoken",function(r){i.callback!=null&&i.callback(r.azuretoken,t,n)},{email:t,token:(n.idToken||n.profile).exp})},show:function(n,t,i,r){this.email=t;this.emailviewonly=i;this.create();this.dlg.show();this.callback=n;this.iframe.setAttribute("src",this.kPage+"?tm="+(new Date).getTime()+(r?"&relogin=1":""))},create:function(){if(this.dlg==null){var t=this,n=scil.Utils.createElement(null,"div");this.iframe=scil.Utils.createElement(n,"iframe",null,{width:450,height:520},{frameborder:0});this.dlg=new scilligence.Dialog("Azure Authentication",n)}}};scil.PKCE={generate:function(){var n=this.generateRandomString(128),t=this.generateCodeChallenge(n);return{verifier:n,challenge:t}},generateRandomString:function(n){for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<n;r++)t+=i.charAt(Math.floor(Math.random()*i.length));return t},generateCodeChallenge:function(n){return code_challenge=this.base64URL(CryptoJS.SHA256(n))},base64URL:function(n){return n.toString(CryptoJS.enc.Base64).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}};scil.ColorCoding=scil.extend(scil._base,{constructor:function(n){this.options=n==null?{}:n},getColor:function(n){var t=this.options;if(scil.Utils.isNullOrEmpty(n))return n;if(typeof n=="string"&&(n=parseFloat(n)),isNaN(n))return null;n<t.min.value&&(n=t.min.value);n>t.max.value&&(n=t.max.value);var i=this.str2color(t.min.color),r=this.str2color(t.max.color),u=i.r+(r.r-i.r)*(n-t.min.value)/(t.max.value-t.min.value),f=i.g+(r.g-i.g)*(n-t.min.value)/(t.max.value-t.min.value),e=i.b+(r.b-i.b)*(n-t.min.value)/(t.max.value-t.min.value);return this.color2str(u,f,e)},str2color:function(n){if(typeof n=="number")return n|0;typeof n=="string"&&n[0]==="#"&&(n=n.slice(1));var t=parseInt(n,16);return{r:(t&16711680)>>16,g:(t&65280)>>8,b:t&255}},color2str:function(n,t,i){return n=Math.round(n).toString(16),t=Math.round(t).toString(16),i=Math.round(i).toString(16),"#"+(n.length==1?"0"+n:n)+(t.length==1?"0"+t:t)+(i.length==1?"0"+i:i)}});scil.CSV={parseAsArray:function(n,t){var u,f;t=t||",";for(var e=new RegExp("(\\"+t+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+t+"\\r\\n]*))","gi"),r=[[]],i=!1;i=e.exec(n);)u=i[1],u.length&&u!==t&&r.push([]),f=i[2]?i[2].replace(new RegExp('""',"g"),'"'):i[3],r[r.length-1].push(f);return r},parse:function(n,t){var f,s,e,h,c,v,l,r;if(scil.Utils.isNullOrEmpty(n))return null;for((t==null||t=="")&&(t=this.detectSeparator(n)),f=[],s=n.split("\n"),r=0;r<s.length;++r){for(var a=[],u=0,o=null,i=s[r];u<i.length;){if(i[u]=='"'){e=u+1;h=!1;do h=!1,c=i.indexOf('"'+t,e),c>0?(o=i.substr(e,c-e),u=c+2):i[i.length-1]=='"'&&i.length-e-1>=0?(o=i.substr(e,i.length-e-1),u=i.length):(v=s[++r],v==null&&(o=i.substr(e),u=i.length),i+="|"+v,h=!0);while(h)}else l=i.indexOf(t,u),l<0?(o=i.substr(u),u=i.length):(o=i.substr(u,l-u),u=l+1);a.push(o)}i[i.length-1]==t&&a.push("");f.push(a)}for(r=f.length-1;r>=0;--r)(f[r]==null||f[r].length==0||f[r].length==1&&scil.Utils.isNullOrEmpty(f[r][0]))&&f.splice(r,1);return f},detectSeparator:function(n){return n.indexOf("\t")>=0?"\t":","},splitLine:function(n,t){var r,u;if(n==null)return null;var e=[],i="",f=!1;for(r=0;r<n.length;++r)u=n.substr(r,1),u!=t||f?u=='"'?f?r==n.length-1||r<n.length-1&&n.substr(r+1,1)==t?f=!1:i+=u:i==""?f=!0:i+=u:i+=u:(e.push(i),i="");return e.push(i),e}};scil.FieldChecklist=scil.extend(scil._base,{constructor:function(n,t){typeof n=="string"&&(n=scil.byId(n));this.options=t==null?{}:t;this.tbody=scil.Utils.createTable(n,0,0);this.options.width>0&&(this.tbody.parentNode.style.width=this.options.width+"");this.setData(this.options.items);var i=this;this.options.editable&&!this.options.viewonly&&scil.Utils.createButton(n,{svg:"pen",title:"Edit",onclick:function(){i.edit()}})},edit:function(){if(this.editDlg==null){var n=this;this.editDlg=scil.Form.createDlgForm("Edit Checklist",{table:{type:"table",columns:{checked:{type:"checkbox"},text:{label:"Text",width:400}}}},{label:"Save",onclick:function(){n.save()}},{hidelabel:!0})}this.editDlg.show();this.editDlg.form.fields.table.jsd.setData(this.getData())},save:function(){var n=this.editDlg.form.fields.table.jsd.getData();this.setData(n);this.editDlg.hide()},addItem:function(n,t){if(!scil.Utils.isNullOrEmpty(n)){var u=this,r=scil.Utils.createElement(this.tbody,"tr"),f=scil.Utils.createElement(r,"td",null,{verticalAlign:"top"},{width:"1%"}),i=scil.Utils.createElement(f,"checkbox");scil.Utils.createElement(r,"td",n,null,{width:"99%"});this.options.viewonly?i.disabled=!0:scil.connect(i,"onchange",function(n){u.checkItem(n.target||n.srcElement)});i.checked=scil.Utils.isTrue(t);this.checkItem(i,t)}},checkItem:function(n){var t=scil.Utils.getParent(n,"TR");t!=null&&(t.style.background=n.checked?"lime":"")},getXml:function(){var n=this.getData();return scil.Table.rows2xml(n)},setXml:function(n){var t=scil.Table.xml2rows(n);this.setData(t)},getData:function(){for(var t=[],n=0;n<this.tbody.childNodes.length;++n){var i=this.tbody.childNodes[n],r=i.childNodes[0].childNodes[0].checked,u=scil.Utils.getInnerText(i.childNodes[1]);t.push({checked:r,text:u})}return t},setData:function(n){var i,t;if(this.clear(),n!=null)for(i=0;i<n.length;++i)t=n[i],typeof t=="string"?this.addItem(t):this.addItem(t.text,t.checked)},clear:function(){scil.Utils.removeAll(this.tbody)}});scil.Message={dlg:null,message:null,button:null,alert:function(n,t){this.show(n,null,t)},warning:function(n,t){this.show(n,"warning",t)},error:function(n,t){this.show(n,"error",t)},success:function(n,t){this.show(n,"success",t)},succeed:function(n,t){this.show(n,"succeed",t)},show:function(n,t,i,r,u){var f,e;this.hide();f=JSDraw2.Skin.dialog.bkcolor;switch((t+"").toLowerCase()){case"error":f="red";r==null&&r=="Error";break;case"warning":f="orange";r==null&&r=="Warning";break;case"succeed":case"success":f="green";r==null&&r=="Succeed";i==null&&(i=!0);u==null&&(u=!0);break;case"info":r==null&&r=="Message";i==null&&(i=!0);u==null&&(u=!0);break;default:f=t;r==null&&r=="Message"}this.create(r);this.dlg.show(r);this.dlg.dialog.style.backgroundColor=f;this.message.innerHTML=n;this.dlg.moveCenter(null,u?50:null);i&&(i>200||(i=1e3),e=this,this.timer=setTimeout(function(){e.hide()},i))},hide:function(){this.dlg!=null&&this.dlg.hide();this.timer!=null&&(clearTimeout(this.timer),this.timer=null)},ok:function(){this.dlg.hide()},create:function(){if(this.dlg==null){var t=this,n=scil.Utils.createElement(null,"div");this.message=scil.Utils.createElement(n,"div",null,{minWidth:"400px",maxWidth:"900px",padding:"10px",overflowWrap:"break-word"});this.button=scil.Utils.createButton(scil.Utils.createElement(n,"div",null,{textAlign:"center"}),{label:"OK",onclick:function(){t.ok()}});this.dlg=new scilligence.Dialog("Message",n,{noclose:!0})}}};scil.RegMolChooseParent={dlg:null,tbody:null,callback:null,caches:[],othercols:null,index:null,onfinished:null,kWidth:250,kHeight:150,kRegMolUrl:"../reg/",kIDPrefix:"_regmol_chooseparent_",kBatchFields:{compoundid:"Batch",experimentno:"Exp. No",retentiontime:"R.T.",notes:"Notes"},getUrl:function(){return scil.Registration==null?this.kRegMolUrl:""},pushCache:function(n,t,i,r){return this.caches.push({parents:n,data:t,jss:i,i:r}),this.caches.length-1},show:function(n,t,i,r,u,f){var e,o;this.index=n;e=this.caches[n];this.shownext=e.jss!=null;this.create();this.dlg.show();this.callback=t!=null?t:function(n){var t=r==null?null:JSDraw2.Table.get(r),e;t!=null&&t.elnfield!=null?(t.setCellValue(u,f,n.compoundid),t.elnfield.form.setDirty(!0)):(e=scil.Utils.getParent(i,"div"),e.innerHTML=n.compoundid)};this.shownext?(o=this,scil.Utils.ajax(this.getUrl()+"ajax.ashx?cmd=structure.chooseparent",function(n){e.parents=n.parents;o.list(e.parents)},{parentno:e.parents[0].part},{showprogress:!0})):this.list(e.parents)},create:function(){var i,n,t;this.dlg==null&&(i=this,n=scil.Utils.createElement(null,"div"),this.tbody=scil.Utils.createTable(n),t=scil.Utils.createElement(n,"div",null,{textAlign:"center",paddingTop:"10px"}),scil.Utils.createButton(t,{label:"Register",onclick:function(){i.registerAgain()}}),this.shownext&&(scil.Utils.createElement(t,"span"," "),scil.Utils.createButton(t,{label:"Next",onclick:function(){i.next()}})),this.dlg=new scilligence.Dialog("Choose Parent",n))},next:function(){for(var t,n=this.index+1;n<this.caches.length;++n)if(t=scil.byId(this.kIDPrefix+n),t!=null){this.show(n,null,t);return}for(n=0;n<this.index;++n)if(t=scil.byId(this.kIDPrefix+n),t!=null){this.show(n,null,t);return}if(scil.Message.show("No more record left","warning",3e3),this.dlg.hide(),this.onfinished!=null)this.onfinished(this)},registerAgain:function(n){for(var u,t,i,n=null,f=this.tbody.getElementsByTagName("INPUT"),r=0;r<f.length;++r)u=f[r],u.checked&&(n=u.getAttribute("pid"));if(n==null){alert("Please select an Existing Parent of choose NEW");return}t=this;i=this.caches[this.index].data;i.selectparentid=n;scil.Utils.ajax(this.getUrl()+"ajax.ashx?cmd=batch.saveafterspecifyingparent",function(n){t.caches[t.index]=null;t.callback(n,i);t.shownext?t.next():t.dlg.hide()},i,{showprogress:!0})},list:function(n){var e,r,t,u,f,i,o,s,h;scil.Utils.removeAll(this.tbody);e=scil.clone(n);e.splice(0,0,{part:"new"});var i=scil.Utils.createElement(this.tbody,"tr"),c=scil.create(i,"td",null,{verticalAlign:"top",padding:"5px"}),l=scil.create(i,"td",null,{verticalAlign:"top"}),a=scil.Utils.createTable(scil.create(l,"div",null,{height:500,overflowY:"scroll"}));for(r=0;r<e.length;++r){if(t=e[r],r==0?u=f=c:(i=scil.create(a,"tr"),u=scil.create(i,"td",null,{verticalAlign:"top"}),f=scil.create(i,"td",null,{verticalAlign:"top"})),t.structureid>0?scil.Utils.createElement(u,"img",null,{border:"solid 1px #ddd"},{src:this.getUrl()+"go.axd/structure/width="+this.kWidth+",height="+this.kHeight+"/"+t.structureid+"/m.png"}):scil.Utils.createElement(u,"div"," ",{border:"solid 1px #ddd",width:this.kWidth,height:this.kHeight,textAlign:"center",verticalAlign:"middle"}),this.onshowcustomfields!=null)this.onshowcustomfields(td,t);else{if(this.othercols!=null)for(o=0;o<this.othercols.length;++o)scil.Utils.createElement(f,"div",t[this.othercols[o]],{textAlign:"center"});s=scil.Utils.parseXml(t.bs);s!=null&&this.listBatches(f,s)}d=scil.Utils.createElement(f,"div",null,{textAlign:"center"});h=t.part;t.structureid>0&&(h="<a target=_blank href='"+this.getUrl()+"Structure.aspx?structureid="+t.structureid+"'>"+t.part+"<\/a>");scil.Utils.createElement(u,"radio",h,null,{name:"_chooseparent",pid:t.part})}this.dlg.moveCenter()},listBatches:function(n,t){var f,u,r;if(t!=null){var e=this.kBatchFields,o=t.getElementsByTagName("r"),i="<table border=1 style='border-collapse:collapse;width:100%'><tr style='background:#eee'>";for(u in e)i+="<td style='white-space:nowrap'>"+e[u]+"<\/td>";for(i+="<\/tr >",f=0;f<o.length;++f){i+="<tr>";for(u in e)r=o[f].getElementsByTagName(u),r=r==null?null:r[0],i+="<td style='white-space:nowrap'>"+(scil.Utils.isNullOrEmpty(r)?"":scil.Utils.getInnerText(r))+"<\/td>";i+="<\/tr>"}i+="<\/table>";scil.Utils.createElement(n,"div",i)}}};scil.PDFViewer=scil.extend(scil._base,{constructor:function(n,t,i){this.iframe=scil.Utils.createElement(n,"iframe",null,{display:"block",width:t,height:i},{frameborder:0})},loadUrl:function(n){n==null||scil.Utils.startswith(n,"http://",!0)||scil.Utils.startswith(n,"https://",!0)||scil.Utils.startswith(n,"/")||(n="../../../"+n);this.iframe.setAttribute("src","tools/pdf.js/web/viewer.html?file="+scil.PDFViewer.escape(n))}});scil.apply(scil.PDFViewer,{kEnabled:!0,kModalDialog:!0,dlg:null,iframe:null,data:null,isPDFViewable:function(n){var i=n.lastIndexOf("."),t=n.substr(i+1);return scil.Utils.isPDF(t)||scil.Utils.isOfficeFile(t)},show:function(n,t,i){var r,f,u,e;this.data=t;i==null&&(i=n);n==null||scil.Utils.startswith(n,"http://",!0)||scil.Utils.startswith(n,"https://",!0)||scil.Utils.startswith(n,"/")||(n="../../../"+n);r=scil.Utils.getBox();this.dlg==null&&(f={frameborder:0},scil.Utils.isNullOrEmpty(n)||(f.src="tools/pdf.js/web/viewer.html?file="+this.escape(n),n="loaded"),this.iframe=scil.Utils.createElement(null,"iframe",null,{display:"block",width:r.w-80,height:r.h-80},f),this.dlg=new scil.Dialog("PDF Viewer",this.iframe,{bodystyle:{padding:0}}),u=this,this.iframe.addEventListener("load",function(){u.loadBase64(u.data);u.data=null},!0));e=r.w>100?1e3:r.w-30;this.iframe.style.width=e+"px";this.iframe.style.height=r.h-80+"px";this.dlg.show("PDF Viewer: "+i,null,this.kModalDialog);n==null?this.iframe.setAttribute("src","tools/pdf.js/web/viewer.html?ticks="+(new Date).getTime()):n!="loaded"&&this.iframe.setAttribute("src","tools/pdf.js/web/viewer.html?file="+this.escape(n))},loadBase64:function(n){if(n!=null){var t=this.base64ToUint8Array(n);this.iframe.contentWindow.loadData(t)}},base64ToUint8Array:function(n){for(var i=atob(n),r=new Uint8Array(i.length),t=0;t<i.length;t++)r[t]=i.charCodeAt(t);return r},escape:function(n){return n==null?"":n.replace(/[?|=|&]/g,function(n){return escape(n)})}});scil.CAS={kCASAgreement:"https://www.cas.org/sites/default/files/documents/CASContent-Scilligence-Modules-terms.pdf",isCASNo:function(n){return scil.Utils.isNullOrEmpty(n)||typeof n!="string"?!1:/[0-9]+[-][0-9][0-9][-][0-9]/.test(n)},search:function(n){this.search2(function(t){n(t.mol)})},search2:function(n){var i=scil.Utils.readCookie("__scil_cas_aggreement");if(i=="agreed"){this._search(n);return}if(this.callback=n,this.dlg==null){var t=this,i="<br>By using Scilligence with CAS, you agree to <a target=_blank href='"+this.kCASAgreement+"'>the Terms and Conditions<\/a> of this application",r={s:{template:i,type:"html"}};this.dlg=scil.Form.createDlgForm("CAS Agreement",r,{label:"I Agree",onclick:function(){t.dlg.hide();scil.Utils.createCookie("__scil_cas_aggreement","agreed",1e3);t._search(t.callback)}},{centerbuttons:!0,hidelabel:!0})}this.dlg.show()},_search:function(n){scil.Utils.prompt2({message:"Enter CAS Registry Number(CAS RN) or CAS Name:",caption:"CAS Registry Number®/ CAS Name to Structure",button:"Convert",svg:"cas",callback:function(t){scil.Utils.ajax("jsdraw/service.aspx?cmd=cassearch.name2mol",function(t){scil.Utils.isNullOrEmpty(t.mol)?scil.Utils.isNullOrEmpty(t.error)?scil.Message.show("Cannot find this name/CAS RN® in CAS database: "+t.q,"warning",2e3):scil.Message.show(t.error,"warning",2e3):n(t)},{q:t},{showprogress:!0})}})}};scil.Countries=["","Afghanistan","Albania","Algeria","American Samoa","Andorra","Angola","Anguilla","Antarctica","Antigua and Barbuda","Arctic Ocean","Argentina","Armenia","Aruba","Ashmore and Cartier Islands","Atlantic Ocean","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Baltic Sea","Baker Island","Bangladesh","Barbados","Bassas da India","Belarus","Belgium","Belize","Benin","Bermuda","Bhutan","Bolivia","Borneo","Bosnia and Herzegovina","Botswana","Bouvet Island","Brazil","British Virgin Islands","Brunei","Bulgaria","Burkina Faso","Burundi","Cambodia","Cameroon","Canada","Cape Verde","Cayman Islands","Central African Republic","Chad","Chile","China","Christmas Island","Clipperton Island","Cocos Islands","Colombia","Comoros","Cook Islands","Coral Sea Islands","Costa Rica","Cote d'Ivoire","Croatia","Cuba","Cyprus","Czech Republic","Democratic Republic of the Congo","Denmark","Djibouti","Dominica","Dominican Republic","East Timor","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Ethiopia","Europa Island","Falkland Islands (Islas Malvinas)","Faroe Islands","Fiji","Finland","France","French Guiana","French Polynesia","French Southern and Antarctic Lands","Gabon","Gambia","Gaza Strip","Georgia","Germany","Ghana","Gibraltar","Glorioso Islands","Greece","Greenland","Grenada","Guadeloupe","Guam","Guatemala","Guernsey","Guinea","Guinea-Bissau","Guyana","Haiti","Heard Island and McDonald Islands","Honduras","Hong Kong","Howland Island","Hungary","Iceland","India","Indian Ocean","Indonesia","Iran","Iraq","Ireland","Isle of Man","Israel","Italy","Jamaica","Jan Mayen","Japan","Jarvis Island","Jersey","Johnston Atoll","Jordan","Juan de Nova Island","Kazakhstan","Kenya","Kerguelen Archipelago","Kingman Reef","Kiribati","Kosovo","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Macau","Macedonia","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands","Martinique","Mauritania","Mauritius","Mayotte","Mediterranean Sea","Mexico","Micronesia","Midway Islands","Moldova","Monaco","Mongolia","Montenegro","Montserrat","Morocco","Mozambique","Myanmar","Namibia","Nauru","Navassa Island","Nepal","Netherlands","Netherlands Antilles","New Caledonia","New Zealand","Nicaragua","Niger","Nigeria","Niue","Norfolk Island","North Korea","North Sea","Northern Mariana Islands","Norway","Oman","Pacific Ocean","Pakistan","Palau","Palmyra Atoll","Panama","Papua New Guinea","Paracel Islands","Paraguay","Peru","Philippines","Pitcairn Islands","Poland","Portugal","Puerto Rico","Qatar","Republic of the Congo","Reunion","Romania","Ross Sea","Russia","Rwanda","Saint Helena","Saint Kitts and Nevis","Saint Lucia","Saint Pierre and Miquelon","Saint Vincent and the Grenadines","Samoa","San Marino","Sao Tome and Principe","Saudi Arabia","Senegal","Serbia","Seychelles","Sierra Leone","Singapore","Slovakia","Slovenia","Solomon Islands","Somalia","South Africa","South Georgia and the South Sandwich Islands","South Korea","Southern Ocean","Spain","Spratly Islands","Sri Lanka","Sudan","Suriname","Svalbard","Swaziland","Sweden","Switzerland","Syria","Taiwan","Tajikistan","Tanzania","Tasman Sea","Thailand","Togo","Tokelau","Tonga","Trinidad and Tobago","Tromelin Island","Tunisia","Turkey","Turkmenistan","Turks and Caicos Islands","Tuvalu","Uganda","Ukraine","United Arab Emirates","United Kingdom","Uruguay","USA","Uzbekistan","Vanuatu","Venezuela","Viet Nam","Virgin Islands","Wake Island","Wallis and Futuna","West Bank","Western Sahara","Yemen","Zambia","Zimbabwe"];scil.Diff={result:null,left:null,right:null,styles:[{},{textDecoration:"none",color:"limegreen",background:"#eaf2c2"},{textDecoration:"line-through",color:"red",background:"#fadad7"}],show:function(n,t,i,r){this.create();this.dlg.show(i);this.onsave=r;n!=null&&(this.left.value=n);t!=null&&(this.right.value=t);this.update()},hide:function(){this.dlg.hide()},save:function(){if(this.onsave!=null)this.onsave(this.left.value)},loadFile:function(){var n=this;scil.FileUploader.upload({caption:"Upload File",url:"JSDraw/Service.aspx?cmd=openfile",callback:function(t){n.right.value=JSDraw2.Base64.decode(t.base64);n.update()}})},update:function(){var i,u,f,n,e,t,o,r;if(scil.Utils.removeAll(this.summary),scil.Utils.removeAll(this.result),this.diff=null,!scil.Utils.isNullOrEmpty(this.left.value)&&!scil.Utils.isNullOrEmpty(this.right.value)){for(scil.Utils.createElement(this.summary,"span","Differences: "),i=0,u=0,this.diff=JsDiff.diffLines(this.left.value,this.right.value),f=document.createDocumentFragment(),n=0;n<this.diff.length;n++)this.diff[n].added&&this.diff[n+1]&&this.diff[n+1].removed&&(e=this.diff[n],this.diff[n]=this.diff[n+1],this.diff[n+1]=e),t=0,this.diff[n].added?t=1:this.diff[n].removed&&(t=2),o=this.diff[n].value.replace(/&/g,"&amp;").replace(/[ ]/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/[\n]/g,"<br>"),r=scil.Utils.createElement(f,"div",o,this.styles[t]),(t==1||t==2)&&(r.setAttribute("idiff",n),r.setAttribute("title","Double click to apply this change")),t!=0&&(t==1&&u==2||(++i,i>1&&scil.Utils.createElement(this.summary,"span","&nbsp;"),scil.Utils.createElement(this.summary,"u",i,{color:"red",cursor:"pointer"})),r.setAttribute("n",i)),u=t;this.result.appendChild(f)}},scrollto:function(n){var r=scil.Utils.getInnerText(n.srcElement||n.target),t,i;if(!scil.Utils.isNullOrEmpty(r))for(t=0;t<this.result.childNodes.length;++t)if(i=this.result.childNodes[t],i.getAttribute("n")==r){this.result.scrollTop=i.offsetTop-50;break}},dblclick:function(n){var o=n.srcElement||n.target,f=parseInt(o.getAttribute("idiff")),r,u,e,s,t,i;if(this.diff[f],this.diff[f]!=null){if(r=-1,u=-1,this.diff[f].added)r=f,this.diff[r-1]!=null&&this.diff[r-1].removed&&(u=r-1);else if(this.diff[f].removed)u=f,this.diff[u+1]!=null&&this.diff[u+1].added&&(r=u+1);else return;for(e="",t=0;t<this.diff.length;t++)i=this.diff[t],i.added?r==t&&(e+=i.value,this.result.childNodes[t].style.background="",this.result.childNodes[t].style.color="green",this.result.childNodes[t].removeAttribute("title"),i.added=!1):i.removed?u!=t?e+=i.value:(this.result.childNodes[t].style.display="none",i.removed=!1,i.skip=!0):i.skip||(e+=i.value);for(this.left.value=e,s=o.getAttribute("n"),t=0;t<this.summary.childNodes.length;++t)if(i=this.summary.childNodes[t],scil.Utils.getInnerText(i)==s){i.style.color="green";break}}},create:function(){var u,f,n;if(this.dlg==null){var i=scil.Utils.getBox(),r=scil.Utils.createTable(null),t=scil.Utils.createElement(r,"tr");if(scil.Utils.createElement(t,"td","Source"),this.leftcontrol=scil.Utils.createElement(t,"td",null,{textAlign:"right",padding:"2px 30px 2px 0"}),scil.Utils.createButton(this.leftcontrol,{label:"Save",type:"a",onclick:function(){n.save()}}),scil.Utils.createElement(t,"td","Compare To"),this.rightcontrol=scil.Utils.createElement(t,"td",null,{textAlign:"right",padding:"2px 30px 2px 0"}),scil.Utils.createButton(this.rightcontrol,{label:"Load File",type:"a",onclick:function(){n.loadFile()}}),t=scil.Utils.createElement(r,"tr"),u=scil.Utils.createElement(t,"td",null,null,{colSpan:2}),this.left=scil.Utils.createElement(u,"textarea",null,{width:i.w/2-50,height:i.h/3-100,overflow:"scroll"},{wrap:"off"}),u=scil.Utils.createElement(t,"td",null,null,{colSpan:2}),this.right=scil.Utils.createElement(u,"textarea",null,{width:i.w/2-50,height:i.h/3-100,overflow:"scroll"},{wrap:"off"}),t=scil.Utils.createElement(r,"tr"),this.summary=scil.Utils.createElement(t,"td",null,null,{colSpan:4}),t=scil.Utils.createElement(r,"tr"),f={padding:"3px 4px",border:"1px solid transparent",verticalAlign:"top",font:"1em monospace",textAlign:"left",whiteSpace:"nowrap",width:i.w-80,height:i.h*2/3-50,overflow:"auto"},this.result=scil.Utils.createElement(scil.Utils.createElement(t,"td",null,{border:"solid 1px gray",background:"#eee"},{colSpan:4}),"div",null,f,{"class":"diff"}),this.dlg=new scilligence.Dialog("Code Comparison",r),n=this,scil.connect(this.left,"onchange",function(){n.update()}),scil.connect(this.right,"onchange",function(){n.update()}),scil.connect(this.summary,"onclick",function(t){n.scrollto(t)}),scil.connect(this.result,"ondblclick",function(t){n.dblclick(t)}),scil.connect(this.result,"onscroll",function(){n.left.scrollTop=n.result.scrollTop/n.result.scrollHeight*n.left.scrollHeight;n.right.scrollTop=n.result.scrollTop/n.result.scrollHeight*n.right.scrollHeight}),this.oncreate!=null)this.oncreate(this)}},addStylesheet:function(){this.stylesheetAdded||(this.stylesheetAdded=!0,scil.Utils.addCss(this.getCss()))}};scil.Json={basicAuth:function(n,t){return"Basic "+JSDraw2.Base64.encode(n+":"+t)},call:function(n,t,i,r){return r==null&&(r={}),r.ignoresucceedcheck=!0,r.postdata=typeof i=="string"?i:this.json2str(i),r["Content-Type"]==null&&(r["Content-Type"]="application/json"),scil.Utils.ajax(n,t,null,r)},ajax:function(n,t,i,r){return scil.Utils.ajax(n,t,i,r)},jsonp:function(n,t,i,r){return scil.Utils.jsonp(n,t,i,r)},post:function(n,t,i){return scil.Utils.post(n,t,i)},download:function(n,t){return scil.Utils.download(n,t)},parse:function(n){return scil.Utils.eval(n)},toString:function(n,t,i){return scil.Utils.json2str(n,t,i)},json2xml:function(n,t){return scil.Form.json2xml(n,t)},xml2json:function(n){return scil.Form.xml2Json(n)},rows2xml:function(n){return scil.Table.rows2xml(n)},xml2rows:function(n){return scil.Table.xml2rows(n)},xml2JssdfRows:function(n,t){return JSDraw2.Table.xml2Rows(n,t)},jssdfRows2xml:function(n,t){return JSDraw2.Table.rows2Xml(xml,t)}};scil.MyFavorite={save:function(n,t){var i=event.target||event.srcElement,r;i=scil.Utils.getParent(i,"svg").parentNode;r=!scil.Utils.isTrue(i.getAttribute("f"));scil.Utils.ajax("ajax.ashx?cmd=user.savefavorite",function(){scil.MyFavorite.renderStar(i,r)},{record:n,recordid:t,f:r})},clearAllStars:function(n){scil.Utils.confirmYes("Confirm to clear all stars?",function(){scil.Utils.ajax("ajax.ashx?cmd=user.clearfavorite",function(){n.markAllStar(!1)},{record:n.options.myfavorite})})},starChecked:function(n,t){var i=n.getCheckedKeys(),r;if(i==null||i.length==0){scil.Message.show("No record selected");return}r=t?"Mark all selected stars?":"Remove all selected stars?";scil.Utils.confirmYes(r,function(){scil.Utils.ajax("ajax.ashx?cmd=user.savefavorite",function(){n.markCheckedStar(t)},{record:n.options.myfavorite,recordid:scil.Utils.array2str(i,","),f:t})})},starAll:function(n,t){var r=t.getAllKeys(),i,u;if(r==null||r.length==0){scil.Message.show("No record found");return}i=!scil.Utils.isTrue(n.getAttribute("f"));u=i?"Mark all stars?":"Remove all stars?";scil.Utils.confirmYes(u,function(){scil.Utils.ajax("ajax.ashx?cmd=user.savefavorite",function(){t.markAllStar(i);scil.MyFavorite.renderStar(n,i)},{record:t.options.myfavorite,recordid:scil.Utils.array2str(r,","),f:i})})},getField:function(n,t){return{label:" ",width:10,renderTd:function(i,r,u){var f=u[t],e=scil.MyFavorite.renderStar(i,r);return scil.connect(e,"onclick",function(){scil.MyFavorite.save(n,f)}),!0}}},renderHeader:function(n,t){var r=this,i=this.renderStar(n,!1);scil.connect(i,"onclick",function(){r.starAll(i,t)})},renderStar:function(n,t){var i=scil.Utils.getFirstElement(n,"svg");if(i!=null)i.style.fill=t?"orange":"#ccc",i.parentNode.setAttribute("f",t);else return scil.icon(n,"star",{width:16,fill:t?"orange":"#ccc"},{f:t})}};scil.SVG={getRawXml:function(n,t){var e="",f,i,r,u;if(t==null)t="";else if(typeof t=="number")e='width="'+t+'" height="'+t+'" ',t="width:"+t+"px;height:"+t+"px",scil.App.config!=null&&(t+=";fill:"+scil.App.config.frame);else if(typeof t=="object"){t.fill==null&&(t.fill=t.color!=null?t.color:scil.App.config==null?null:scil.App.config.frame);f="";for(i in t)r=t[i],(i=="width"||i=="height")&&typeof r=="number"&&(r=r+"px"),i=i.replace(/[A-Z]/g,function(n){return"-"+n.toLowerCase()}),f+=i+":"+r+";";t=f}return u=scil.Icons[n],u==null&&(u=scil.Icons.angry,t+=";fill:red"),u.replace("<svg ",'<svg xmlns="http://www.w3.org/2000/svg" style="'+t+'" '+e)},replaceContent:function(n,t,i){var r=n.tagName=="svg"?n:scil.Utils.getFirstChild(n,"svg"),f=scil.SVG.getRawXml(t),u=scil.create(null,"svg",f);r.setAttribute("viewBox",u.firstChild.getAttribute("viewBox"));r.innerHTML=u.firstChild.innerHTML;i!=null&&(r.style.fill=i)},asBackground:function(n,t,i){var r=scil.SVG.getRawXml(n,typeof t=="string"?{fill:t}:t);return r="data:image/svg+xml;charset=utf-8,"+escape(r),i&&(r="url("+r+")"),r},createIcon:function(n,t,i,r,u){var f,e;return i==null&&(i={}),r==null&&(r={}),i.width>0||(i.width=i.size>0?i.size:24),i.height=i.width,r.height=r.width=i.width,scil.Utils.startswith(t,"file/")&&scil.Icons[t]==null&&(t="file/unknown"),i.fill==null&&(i.fill=i.color),scil.Utils.isNullOrEmpty(i.fill)&&scil.App.config!=null&&(i.fill="#666"),t!=null&&/^&#[0-9]+;$/.test(t)?(f=scil.Icons.average,f=f.replace("&#189;",t)):t!=null&&/^\([A-Z]\)$/.test(t)?(f=scil.Icons["(*)"],f=f.replace("*",t.substr(1,1))):f=scil.Icons[t],f==null&&(f=scil.Icons.angry,i.fill="red"),e=scil.Utils.create(n,"svg",f,i,r),u!=null&&scil.connect(e,"onclick",u),n.tagName=="BUTTON"&&(scil.connect(e.parentElement,"onmouseover",function(){e.firstChild.style.fill="#fff"}),scil.connect(e.parentElement,"onmouseout",function(){e.firstChild.style.fill=scil.App.config.frame})),e}};scil.CustomWebsocket=scil.extend(scil._base,{constructor:function(n){var r,t,i;this.params=n;this.callback=n.callbackfn;this.filename=n.filename;this.filetype=n.filetype;this.datatype=n.datatype;this.apitoken=n.apitoken||scil.CustomWebsocket.apitoken;this.content=n.content;r=window.document.location.href;t=window.document.location.pathname;this.origin=window.document.location.origin;this.hostname=window.document.location.hostname;i=t.substring(0,t.substr(1).indexOf("/")+1);this.baseurl=this.origin+i},editDocument:function(){var n=this;this.msidownloadurl=this.baseurl+"/tools/ScilligenceMSOfficeConnector.msi";this.dlg=new scil.EditWithLocalOffice({msidownloadurl:this.msidownloadurl,callback:function(t){n.closedlg(t)}});scil.Progress.show("Loading ...",!1,"Opening office software...",!1);this.params.transfermode=="api"?this.editWithApi():this.params.transfermode=="socket"&&this.editWithSocket()},editWithSocket:function(){var n,t;this.entity="s"+(new Date).getTime();n="filename="+this.filename+"&entityid="+this.entity+"&baseurl="+this.baseurl+"&transfermode="+this.params.transfermode+"&filetype="+this.filetype+"&datatype="+this.datatype+"&socketport="+scil.CustomWebsocket.socketport;n=encodeURIComponent(n);n=btoa(n);t=scil.CustomWebsocket.customprotocol+this.hostname+"?"+n;this.dlg.msgdiv.innerHTML="Edit with local Office";scil.EditWithLocalOffice.submit(this.dlg.form,t);this.sendMessage()},editWithApi:function(){var n=this;scil.Utils.ajax("ajax.ashx?cmd=office.generatetempfile",function(t){var r,u,i,f;t&&(r=t.filename,n.entity=t.entity,u=t.datatype,i="filename="+r+"&entityid="+n.entity+"&baseurl="+n.baseurl+"&transfermode="+this.params.transfermode+"&filetype="+n.filetype+"&datatype="+u+"&apitoken="+n.apitoken+"&socketport="+scil.CustomWebsocket.socketport,i=encodeURIComponent(i),i=btoa(i),f=scil.CustomWebsocket.customprotocol+n.hostname+"?"+i,n.dlg.msgdiv.innerHTML="Edit with local Office",scil.EditWithLocalOffice.submit(n.dlg.form,f),n.sendMessage(""))},{content:n.content,filetype:n.filetype,filename:n.filename,datatype:n.datatype})},initWS:function(){var n=this;this.ws=null;try{if("WebSocket"in window||"websocket"in window||"Websocket"in window)this.ws=new WebSocket("ws://127.0.0.1:8100/socket/"+this.entity+"/connector");else if("MozWebSocket"in window)this.ws=new MozMozWebSocket("ws://127.0.0.1:8100/socket/"+this.entity+"/connector");else return scil.Utils.alert2("Your browser does not support websocket"),null;this.ws&&(this.ws.onopen=function(){console.log("Openened connection to websocket");n.ws.send("{type:'webclientisconnection',result:'true'}")},this.ws.onclose=function(t){console.log("Close connection to websocket");console.log("websocket close: "+t.code+" "+t.reason+" "+t.wasClean);t.code==1006&&(n.dlg.msgdiv.innerHTML="<span style='display: inline-block;vertical-align: middle;line-height: 40px;'>It looks Scilligence MSOffice Connector is not installed. Please <a href='"+n.msidownloadurl+"' target='_blank'>click here<\/a> to install it.<\/span>",scil.Progress.hide())},this.ws.onerror=function(t){console.log("socket connect error");console.log(t);n.ws.close()})}catch(t){}return this.ws},sendMessage:function(){var n=this;setTimeout(function(){var t=n.initWS();t.onmessage=function(i){var r=JSON.parse(i.data);console.log(r.type);r.type!="checkfiletype"&&r.type!="checkoffice"||r.result?r.type=="applicationstarted"?(n.dlg.msgdiv.innerHTML="Opening office software...",t.send("{type:'checkcachefile',message:'"+n.content+"'}")):r.type=="fileincache"?t.send("{type:'editdocument',message:'edit in local office'}"):r.type=="openeddocument"?(n.dlg.msgdiv.innerHTML="Editing in Office...",scil.Progress.hide()):r.type=="editdocumentcompleted"?(n.dlg.msgdiv.innerHTML="Saving back in ELN...",t.send("{type:'uploaddocument'}")):r.type=="opendocumentfail"||r.type=="filenotexists"?(n.dlg.msgdiv.innerHTML=r.message,t&&(t.send("{type:'exit'}"),t.close())):r.type=="uploaddocumentcompleted"?n.transfermode=="api"?scil.Utils.ajax("ajax.ashx?cmd=office.getcontent",function(i){n.dlg.msgdiv.innerHTML="Edit completed";n.callback&&n.callback(i);t.send("{type:'deletedocumentfile'}");n.closedlg(n.dlg.dlg)},{filename:r.message,filetype:n.filetype}):r.message?(n.dlg.msgdiv.innerHTML="Edit completed",n.callback&&n.callback(r.message,function(){t.send("{type:'deletedocumentfile'}");n.closedlg(n.dlg.dlg)})):(n.dlg.msgdiv.innerHTML="Saving back in ELN Failed",t.send("{type:'deletedocumentfile'}")):r.type=="deletedocumentfilecompleted"&&t.send("{type:'exit'}"):(n.dlg.msgdiv.innerHTML=r.message,t&&t.close())}},5e3)},closedlg:function(n){n&&n.hide();this.ws&&this.ws.close()}});scil.apply(scil.CustomWebsocket,{customprotocol:"scioc://",socketport:8100,apitoken:""});scil.EditWithLocalOffice=scil.extend(scil._base,{constructor:function(n){this.mainid="_officeonline_div_";this.msidownloadurl=n.msidownloadurl;this.callback=n.callback;this.init()},init:function(){if(this.dlg=null,this.cleanBody(),this.dlg==null){var n=scil.Utils.createElement(null,"div",null,null,{id:this.mainid});this.initPage(n);this.dlg=new scil.Dialog("Edit in Office",n,{width:400,height:200,noclose:!0})}this.dlg.show()},initPage:function(n){var t=this;this.page=new scil.Page(n);this.body=this.page.addDiv(null,{textAlign:"center"});this.form=scil.Utils.createElement(this.body,"form",null,null,{id:"office_form",name:"office_form",target:"office_frame",action:"",method:"post"});this.div=scil.Utils.createElement(this.body,"div",null,{textAlign:"center"});this.msgdiv=scil.Utils.createElement(this.div,"div",null,{height:"120px",lineHeight:"120px",fontSize:"20px",color:"#64AFE8"},{id:"_officeedit_msg_div_"});scil.Utils.createButton(this.body,{svg:"close",label:"Cancel",onclick:function(){t.callback&&t.callback(t.dlg)}});scil.Utils.createElement(this.body,"div","<a style='text-decoration:none' href='"+t.msidownloadurl+"'>Download Installer<\/a>",{marginTop:"10px"});this.span=scil.Utils.createElement(this.body,"span",null,null,{id:"frameholder"});this.iframe=scil.Utils.createElement(this.span,"iframe",null,{display:"none"},{name:"office_frame",id:"office_frame",title:"Office Frame",allowfullscreen:!0,webkitallowfullscreen:!0,mozallowfullscreen:!0,sandbox:"allow-scripts allow-same-origin allow-forms allow-popups allow-top-navigation allow-popups-to-escape-sandbox"})},cleanBody:function(){var n=scil.byId(this.mainid);n&&n.parentNode.removeChild(n)}});scil.apply(scil.EditWithLocalOffice,{submit:function(n,t){n&&(n.action=t,n.submit())},closedlg:function(n){n&&n.hide()}});scil.Viz=scil.extend(scil._base,{constructor:function(n,t,i){var r,f,u;if(typeof n=="string"&&(n=scil.byId(n)),scil.Utils.unselectable(n),t==null&&(t={}),t.color==null&&(t.color="steelblue"),t.highlightcolor==null&&(t.highlightcolor="red"),t.selectcolor==null&&(t.selectcolor="red"),t.xkey==null&&(t.xkey="x"),t.type=="bar"||t.type=="line"?(t.width>0||(t.width=800),t.height>0||(t.height=400)):t.type=="pie"?(t.width>0||(t.width=400),t.height>0||(t.height=300),t.depth>0||(t.depth=20),t.xyratio>0||(t.xyratio=.8),t.radius>0||(t.radius=.4)):t.type=="scatterplot"&&(t.width>0||(t.width=800),t.height>0||(t.height=400),t.shape==null&&(t.shape="circle"),t.radius>0||(t.radius=8)),this.type=t.type,this.parent=n,this.options=t,this.plots=[],this.series=this.options.series!=null?this.options.series:[{key:"y"}],scil.Utils.isNullOrEmpty(this.series[0].color))for(r=0;r<this.series.length;++r)this.series[r].color=scil.Viz.colors[r%this.series.length];this.tooltip=null;this.options.ontooltip!=null&&(f=scil.Utils.createElement(null,"div"),this.tooltip=new scil.Dialog("",f,{notitle:!0}));this.root=null;this.selection=null;this.div=scil.Viz.createTitle(this.parent,this.options);this.svg=d3.select(this.div).append("svg:svg").attr("width",this.options.width).attr("height",this.options.height);this.data=this.normData(i);this.root=this.svg.append("g");this.type!="pie"&&this.initAxis();t.type!="bar"||t.barwidth>0||(u=Math.round(t.width/this.data.length/this.series.length/1.5),t.barwidth=u>6?u:6);this.redraw()},normData:function(n){var u,t,f,r,i;if(n==null)return null;if(u=!1,t=[],n.length>0){for(t=n,r=0;r<t.length;++r)if(f=t[r],scil.Math.isNaN(f[this.options.xkey])){u=!0;break}}else if(this.options.type=="pie"){r=0;for(i in n)t.push({label:i,value:n[i],color:scil.Viz.colors[r++%scil.Viz.colors.length]})}else for(i in n)!u&&scil.Math.isNaN(i)&&(u=!0),t.push({x:i,y:n[i]});return u&&this.options.xastext==null&&(this.options.xastext=!0),t},initAxis:function(){var e=!scil.Utils.isNullOrEmpty(this.options.xlabel),o=!scil.Utils.isNullOrEmpty(this.options.ylabel),i=this.options.margin==null?{}:this.options.margin,r,n,u,f,s,h,t;if(this.margin={},this.margin.left=i.left>0?i.left:e?60:20,this.margin.right=i.right>0?i.right:20,this.margin.top=i.top>0?i.top:20,this.margin.bottom=i.bottom>0?i.bottom:o?50:20,this.chartwidth=this.options.width-this.margin.left-this.margin.right,this.chartheight=this.options.height-this.margin.top-this.margin.bottom,this.root.attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.root.attr("width",this.chartwidth),this.root.attr("height",this.chartheight),this.options.xastext)for(this.data.push({}),r=0;r<this.data.length;++r)this.data[r]._s=this.data[r][this.options.xkey],this.data[r][this.options.xkey]=r+1;n=this;this.xfun=d3.scale.linear().domain([0,d3.max(this.data,function(t){return t[n.options.xkey]})]).range([0,n.chartwidth]);this.yfun=d3.scale.linear().domain([0,d3.max(this.data,function(t){return scil.Viz.maxOfSeries(t,n.options.series,n.options.stack)})]).range([n.chartheight,0]);u=d3.svg.axis().scale(this.xfun).orient("bottom").innerTickSize(-this.chartheight).outerTickSize(0).tickPadding(10);this.options.xastext&&u.tickFormat(function(t){return n.data[t-1]==null?null:n.data[t-1]._s});f=d3.svg.axis().scale(this.yfun).orient("left").innerTickSize(-this.chartwidth).outerTickSize(0).tickPadding(10);o||f.tickFormat(function(){return null});e||u.tickFormat(function(){return null});this.xaxis=this.root.append("g").classed("x axis",!0).attr("transform","translate(0,"+(this.chartheight+1)+")").attr("shape-rendering","crispEdges").attr("stroke","black").attr("fill","none").style("font-size","12px").call(u).selectAll(".tick line").style("opacity",.2);this.yaxis=this.root.append("g").classed("y axis",!0).attr("transform","translate(0,0)").attr("shape-rendering","crispEdges").attr("stroke","black").attr("fill","none").style("font-size","12px").call(f).selectAll(".tick line").style("opacity",.2);this.options.zoomable&&(s=function(){n.root.select(".x.axis").call(u).selectAll(".tick line").style("opacity",.2);n.root.select(".y.axis").call(f).selectAll(".tick line").style("opacity",.2);for(var t=0;t<n.plots.length;++t)n.transformPlot(n.plots[t])},h=d3.behavior.zoom().x(this.xfun).y(this.yfun).scaleExtent([0,500]).on("zoom",s),this.svg.call(h));e&&this.root.append("text").attr("text-anchor","middle").attr("transform","translate("+this.chartwidth/2+","+(this.chartheight+this.margin.bottom/1.5)+")").text(this.options.xlabel);o&&this.root.append("text").attr("text-anchor","middle").attr("transform","translate("+-this.margin.left/1.6+","+this.chartheight/2+")rotate(-90)").text(this.options.ylabel);this.options.selectable&&this.type=="scatterplot"&&(t=this.root.append("svg:rect"),t.attr("x",0),t.attr("y",0),t.attr("width",200),t.attr("height",200),t.attr("fill","lightblue"),t.attr("opacity","0.4"),t.style("stroke","darkblue"),t.style("stroke-width","1px"),t.style("display","none"),scil.connect(this.div,"onmousedown",function(i){n.onmousedown(t,i)}),scil.connect(document.body,"onmousemove",function(i){n.onmousemove(t,i)}),scil.connect(document.body,"onmouseup",function(i){n.onmouseup(t,i.shiftKey)}),this.selection=t)},addline:function(n,t,i,r){r==null&&(r="y");var u=this,f=d3.svg.line().x(function(n){return u.xfun(n[u.options.xkey])}).y(function(n){return u.yfun(n[r])});this.root.append("path").data([n]).attr("class","line").attr("d",f).style("fill","none").style("stroke",t==null?"yellow":t).style("stroke-width",(i>0?i:4)+"px")},redraw:function(){switch(this.type){case"scatter":case"scatterplot":this.drawScatterplot();break;case"line":this.drawLine();break;case"bar":this.drawBars();break;case"pie":this.drawPie()}this.options.legend!=!1&&this.showLegend()},showLegend:function(){var n,t;if(this.series!=null&&this.series.length!=0){n=this.options.legend==null?null:this.options.legend.left;t=this.options.top==null?null:this.options.legend.top;n>0||(n=this.margin.left+10);t>0||(t=this.margin.top/2);var i=this.svg.append("g").attr("class","legend").attr("transform","translate("+n+","+t+")"),r=this;i.selectAll("rect").data(this.series).enter().append("rect").attr("x",0).attr("y",function(n,t){return t*18}).attr("width",12).attr("height",12).attr("fill",function(n,t){return r.series[t].color});i.selectAll("text").data(this.series).enter().append("text").text(function(n){return n.key}).attr("x",18).attr("y",function(n,t){return t*18}).attr("text-anchor","start").attr("alignment-baseline","hanging")}},transformPlot:function(n){n.plot.attr("transform","translate("+this.xfun(n.data[this.options.xkey])+","+this.yfun(n.data[n.ser.key])+")")},polygon:function(n,t,i){var e=360/t,u=new JSDraw2.Point(n,0),r,f,o;for(u.rotate(-90),r=null,i&&(r=new JSDraw2.Point(n*(t==3?.3:.5),0),r.rotate(-90+e/2)),f=u.x+","+u.y,i&&(f+=" \n"+r.x+","+r.y),o=1;o<t;++o)u.rotate(e),f+=" \n"+u.x+","+u.y,i&&(r.rotate(e),f+=" \n"+r.x+","+r.y);return f},drawPie:function(){var t=this.root.append("g"),n;if(scil.Viz.Pie3D.draw(t,this.data,this.options.width/2,this.options.height/2,this.options.width/(3*this.options.xyratio),this.options.height/3,this.options.depth,this.options.radius,this.options.onlabel),n=this,this.options.onclick!=null)this.root.selectAll(".topSlice").on("click",function(t){n.options.onclick(t)});if(this.options.highlightcolor!="none"||this.tooltip!=null){this.root.selectAll(".topSlice").on("mouseover",function(t){var i,r;n.options.highlightcolor!="none"&&scil.Viz.Pie3D.highlight(t,n.root,n.options);n.tooltip!=null&&(i=n.options.ontooltip(t),scil.Utils.isNullOrEmpty(i)||(n.tooltip.show2({modal:!1,immediately:!0}),n.tooltip.body.innerHTML=i,r=scil.Utils.scrollOffset(),n.tooltip.moveTo(event.clientX+r.x+10,event.clientY+r.y+10)))});this.root.selectAll(".topSlice").on("mouseout",function(t){n.options.highlightcolor!="none"&&scil.Viz.Pie3D.highlight(t,n.root,null);n.tooltip!=null&&n.tooltip.hide()})}},drawScatterplot:function(){for(var t,e,r,o,f=0;f<this.data.length;++f)for(t=this.data[f],e=0;e<this.series.length;++e){var u=this.series[e],i=t.s==null?u.shape==null?this.options.shape:u.shape:t.s,n=t.r>0?t.r:u.radius>0?u.radius:this.options.radius,h=t.c!=null?t.c:u.color!=null?u.color:this.options.color;if(i==null&&(i="circle"),n>0||(n=1),i=="circle")s=this.root.append("svg:circle"),s.attr("r",n);else if(i=="square")s=this.root.append("svg:rect"),delta=-n,s.attr("x",-n),s.attr("y",-n),s.attr("width",n*2),s.attr("height",n*2);else if(scil.Utils.startswith(i,"polygon"))r=parseInt(i.substr(7)),r>=3||(r=3),s=this.root.append("svg:polygon"),s.attr("points",this.polygon(n,r,!1));else if(scil.Utils.startswith(i,"star"))r=parseInt(i.substr(4)),r>=3||(r=3),s=this.root.append("svg:polygon"),s.attr("points",this.polygon(n,r,!0));else continue;s.attr("class","plot");s.attr("fill",h);t.f&&(s.style("stroke",this.options.selectcolor),s.style("stroke-width","2px"));o={plot:s,data:t,ser:u,f:!1};this.plots.push(o);this.transformPlot(o);this.addEvent(o)}},drawBars:function(){for(var n,f,t,r,e,u=0;u<this.data.length;++u)for(n=this.data[u],f=0,t=0;t<this.series.length;++t){var i=this.series[t],o,h=this.yfun(n[i.key]),s=this.chartheight-this.yfun(n[i.key]);o=this.options.stack?this.xfun(n[this.options.xkey])-this.options.barwidth/2:this.xfun(n[this.options.xkey])-this.options.barwidth*this.series.length/2+t*this.options.barwidth;r=this.root.append("rect").attr("x",o+1).attr("y",h-f).attr("width",this.options.barwidth-2).attr("height",s).attr("class","bar").style("fill",i.color==null?this.options.color:i.color);r.style("stroke-width","1px");n.f?r.style("stroke",this.options.selectcolor):r.style("stroke","#fff");this.options.stack&&(f+=s);e={plot:r,data:n,ser:i,f:!1};this.plots.push(e);this.addEvent(e)}},drawLine:function(){for(var n,r,t=this,i=0;i<this.series.length;++i)n=this.series[i],r=d3.svg.line().x(function(n){return t.xfun(n[t.options.xkey])}).y(function(i){return t.yfun(i[n.key])}),this.root.append("path").data([this.data]).attr("class","line").attr("d",r).style("fill","none").style("stroke",n.color==null?this.options.color:n.color).style("stroke-width","2px")},selectAll:function(n){var i,t;for(n==null&&(n=!0),i=0,t=0;t<this.plots.length;++t)this.plots[t].f!=n&&(++i,this.updateSelect(this.plots[t],n));return i},updateSelect:function(n,t,i){n.f=t;n.f?n.plot.style("stroke",this.options.selectcolor):n.plot.style("stroke","none");n.plot.style("stroke-width",i+"px")},getSelected:function(){for(var t=[],n=0;n<this.plots.length;++n)this.plots[n].f&&t.push(this.plots[n].data);return t},onmousedown:function(n,t){var i=scil.Utils.getOffset(this.div);n.sel={x:i.x+this.margin.left,y:i.y+this.margin.top,p1:{x:t.clientX,y:t.clientY},p2:{x:t.clientX,y:t.clientY}}},onmousemove:function(n,t){if(n.sel!=null){var i=n.sel;i.p2={x:t.clientX,y:t.clientY};n.style("display","");n.attr("x",Math.min(i.p1.x,i.p2.x)-i.x);n.attr("y",Math.min(i.p1.y,i.p2.y)-i.y);n.attr("width",Math.abs(i.p1.x-i.p2.x));n.attr("height",Math.abs(i.p1.y-i.p2.y))}},onmouseup:function(n,t){var u;if(n.sel!=null){n.style("display","none");var i=n.sel,c=Math.min(i.p1.x,i.p2.x)-i.x,l=Math.max(i.p1.x,i.p2.x)-i.x,a=Math.min(i.p1.y,i.p2.y)-i.y,v=Math.max(i.p1.y,i.p2.y)-i.y,y=this,f=0;for(u=0;u<this.plots.length;++u){var r=this.plots[u],e=this.xfun(r.data[y.options.xkey]),o=this.yfun(r.data[r.ser.key]),s=e>c&&e<l&&o>a&&o<v,h=r.f==!0;s==h||t&&h||(++f,this.updateSelect(r,s,2))}f>0&&this.options.onselect!=null&&this.options.onselect();n.sel=null}},addEvent:function(n){var t=this,i=n.plot;i.on("click",function(){if(t.options.selectable){var r=event!=null&&event.shiftKey,i=0;r?(t.updateSelect(n,!n.f),++i):(i+=t.selectAll(!1),n.f||(t.updateSelect(n,!0),++i));i>0&&t.options.onselect!=null&&t.options.onselect()}if(t.options.onclick!=null)t.options.onclick(n)});i.on("mouseover",function(){var i,r;if(this.style.fill=t.options.highlightcolor,t.tooltip!=null&&event!=null&&(t.selection==null||t.selection.sel==null)&&(i=t.options.ontooltip(n),scil.Utils.isNullOrEmpty(i)||(t.tooltip.show2({modal:!1,immediately:!0}),t.tooltip.body.innerHTML=i,r=scil.Utils.scrollOffset(),t.tooltip.moveTo(event.clientX+r.x+10,event.clientY+r.y+10))),t.options.onmouseover!=null)t.options.onmouseover(n,event)});i.on("mouseout",function(){var i=n.data.c;if(i==null&&(i=n.ser.color),i==null&&(i=t.options.color),this.style.fill=i,t.tooltip!=null&&t.tooltip.hide(!0),t.options.onmouseout!=null)t.options.onmouseout(n,event)})}});scil.apply(scil.Viz,{colors:["#4682B4","#DEB887","#20B2AA","#D8BFD8","#FF8C00","#1E90FF","#BC8F8F","#3CB371","#BA55D3","#BDB76B","#0000CD","#B8860B","#90EE90","#9400D3","#87CEEB","#A0522D","#008000","#800080"],scatterplot:function(n,t,i){return i==null&&(i={}),i.type="scatterplot",new scil.Viz(n,i,t)},line:function(n,t,i){return i==null&&(i={}),i.type="line",new scil.Viz(n,i,t)},bar:function(n,t,i){return i==null&&(i={}),i.type="bar",new scil.Viz(n,i,t)},pie:function(n,t,i){return i==null&&(i={}),i.type="pie",new scil.Viz(n,i,t)},createTitle:function(n,t){if(scil.Utils.isNullOrEmpty(t.title))return n;var i=scil.Utils.createTable(n,0,0,{border:"solid 1px gray"}),r={textAlign:"center",background:"#eee",borderBottom:"solid 1px gray",padding:"3px"};return scil.apply(r,t.titlestyle),scil.Utils.createElement(scil.Utils.createElement(i,"tr"),"td",t.title,r),scil.Utils.createElement(scil.Utils.createElement(i,"tr"),"td")},maxOfSeries:function(n,t,i){var r,f,u;if(t==null)return n.y;for(r=null,f=0;f<t.length;++f)if(u=n[t[f].key],u!=null){if(r==null){r=u;continue}i?r+=u:u>r&&(r=u)}return r}});scil.viz=scil.Viz;scil.D3Chart=scil.Viz;scil.Viz.Pie3D={draw:function(n,t,i,r,u,f,e,o,s){var h=d3.layout.pie().sort(null).value(function(n){return n.value})(t),c=n.append("g").attr("transform","translate("+i+","+r+")"),l=this;c.selectAll(".innerSlice").data(h).enter().append("path").attr("class","innerSlice").style("fill",function(n){return d3.hsl(n.data.color).darker(.7)}).attr("d",function(n){return l.pieInner(n,u+.5,f+.5,e,o)});c.selectAll(".outerSlice").data(h).enter().append("path").attr("class","outerSlice").style("fill",function(n){return d3.hsl(n.data.color).darker(.7)}).attr("d",function(n){return l.pieOuter(n,u-.5,f-.5,e)});c.selectAll(".topSlice").data(h).enter().append("path").attr("class","topSlice").style("fill",function(n){return n.data.color}).attr("d",function(n){return l.pieTop(n,u,f,o)});s!=!1&&c.selectAll(".label").data(h).enter().append("text").attr("class","percent").attr("x",function(n){return.6*u*Math.cos(.5*(n.startAngle+n.endAngle))}).attr("y",function(n){return.6*f*Math.sin(.5*(n.startAngle+n.endAngle))}).style("fill","white").style("text-anchor","middle").style("font-size","12px").text(s!=null?s:scil.Viz.Pie3D.getLabel)},highlight:function(n,t,i){t.selectAll(".innerSlice").style("fill",function(t){return d3.hsl(t==n&&i!=null?i.highlightcolor:t.data.color).darker(.7)});t.selectAll(".outerSlice").style("fill",function(t){return d3.hsl(t==n&&i!=null?i.highlightcolor:t.data.color).darker(.7)});t.selectAll(".topSlice").style("fill",function(t){return t==n&&i!=null?i.highlightcolor:t.data.color})},pieTop:function(n,t,i,r){if(n.endAngle-n.startAngle==0)return"M 0 0";var f=t*Math.cos(n.startAngle),e=i*Math.sin(n.startAngle),o=t*Math.cos(n.endAngle),s=i*Math.sin(n.endAngle),u=[];return u.push("M",f,e,"A",t,i,"0",n.endAngle-n.startAngle>Math.PI?1:0,"1",o,s,"L",r*o,r*s),u.push("A",r*t,r*i,"0",n.endAngle-n.startAngle>Math.PI?1:0,"0",r*f,r*e,"z"),u.join(" ")},pieOuter:function(n,t,i,r){var u=n.startAngle>Math.PI?Math.PI:n.startAngle,f=n.endAngle>Math.PI?Math.PI:n.endAngle,e=t*Math.cos(u),o=i*Math.sin(u),s=t*Math.cos(f),h=i*Math.sin(f),c=[];return c.push("M",e,r+o,"A",t,i,"0 0 1",s,r+h,"L",s,h,"A",t,i,"0 0 0",e,o,"z"),c.join(" ")},pieInner:function(n,t,i,r,u){var f=n.startAngle<Math.PI?Math.PI:n.startAngle,e=n.endAngle<Math.PI?Math.PI:n.endAngle,o=u*t*Math.cos(f),s=u*i*Math.sin(f),h=u*t*Math.cos(e),c=u*i*Math.sin(e),l=[];return l.push("M",o,s,"A",u*t,u*i,"0 0 1",h,c,"L",h,r+c,"A",u*t,u*i,"0 0 0",o,r+s,"z"),l.join(" ")},getLabel:function(n){return n.data.label+" "+(n.endAngle-n.startAngle>.2?Math.round(1e3*(n.endAngle-n.startAngle)/(Math.PI*2))/10+"%":"")}};scil.Viz.Radar=scil.extend(scil._base,{constructor:function(n,t,i){var y,p,v,f,r,h,a,c,l,u,s;for(typeof n=="string"&&(n=scil.byId(n)),this.parent=n,this.options=i==null?{}:i,this.plots=[],this.options.highlightcolor==null&&(this.options.highlightcolor="red"),this.options.selectcolor==null&&(this.options.selectcolor="red"),this.options.headercolor==null&&(this.options.headercolor="#555"),this.options.size>0||(this.options.size=100),this.options.headersize>0||(this.options.headersize=30),y=this.options.size/2-5,this.pie=d3.layout.pie().value(function(){return 10}),this.tooltip=null,this.options.ontooltip!=null&&(p=scil.Utils.createElement(null,"div"),this.tooltip=new scil.Dialog("",p,{notitle:!0})),v=y/(this.options.assays.length+1),this.arcs=[],s=0;s<this.options.assays.length;++s)this.options.assays[s].arc=d3.svg.arc().innerRadius((s+1)*v).outerRadius((s+2)*v);if(this.div=scil.Viz.createTitle(this.parent,this.options),this.options.single){this.svg=d3.select(this.div).append("svg");this.svg.attr("width",this.options.size);this.svg.attr("height",this.options.size);l=this.options.size/2;a=this.options.size/2;this.draw(t,l,a);return}var w=this.groupData(t,this.options.xkey,this.options.ykey),e=this.options.headersize,o=this.options.headersize;for(this.svg=d3.select(this.div).append("svg"),this.svg.attr("width",this.options.size*this.cols.length+e+1),this.svg.attr("height",this.options.size*this.rows.length+o+1),f=this.options.size,this.svg.append("line").attr("x1",1).attr("y1",1).attr("x2",this.cols.length*f+e).attr("y2",1).attr("stroke","#aaa").attr("stroke-width","0.5px"),this.svg.append("line").attr("x1",1).attr("y1",1).attr("x2",1).attr("y2",this.rows.length*f+o).attr("stroke","#aaa").attr("stroke-width","0.5px"),this.options.xylabel!=null&&(u=this.options.xylabel,u!=null&&u.img!=null?(r=this.svg.append("image"),r.attr("xlink:href",u.img),r.attr("transform","translate("+(e/2-u.width/2)+","+(o/2-u.height/2)+")")):(r=this.svg.append("text"),r.attr("text-anchor","middle"),r.style("font-size","12px"),r.attr("transform","translate("+e/2+","+(o/2+6)+")"),r.text(u),r.attr("fill",this.options.headercolor),r.style("stroke",this.options.headercolor))),h=0;h<=this.rows.length;++h)a=this.options.size*h+this.options.size/2+o,u=this.rows[h],this.options.ylabels!=null&&this.options.ylabels[u]!=null&&(u=this.options.ylabels[u]),u!=null&&u.img!=null?(r=this.svg.append("image"),r.attr("xlink:href",u.img),r.attr("transform","translate("+(e/2-u.width/2)+","+(a-u.height/2)+")")):(r=this.svg.append("text"),r.attr("text-anchor","middle"),r.style("font-size","12px"),r.attr("transform","translate("+e/2+","+(a+6)+")"),r.text(u),r.attr("fill",this.options.headercolor),r.style("stroke",this.options.headercolor)),this.addEvent2(r),this.svg.append("line").attr("x1",0).attr("y1",h*f+o).attr("x2",this.cols.length*f+e).attr("y2",h*f+o).attr("stroke","#aaa").attr("stroke-width","0.5px");for(c=0;c<=this.cols.length;++c)l=this.options.size*c+this.options.size/2+e,u=this.cols[c],this.options.xlabels!=null&&this.options.xlabels[u]!=null&&(u=this.options.xlabels[u]),u!=null&&u.img!=null?(r=this.svg.append("image"),r.attr("xlink:href",u.img),r.attr("transform","translate("+(l-u.width/2)+","+(o/2-u.height/2)+")")):(r=this.svg.append("text"),r.attr("text-anchor","middle"),r.style("font-size","12px"),r.attr("transform","translate("+l+","+(o/2+6)+")"),r.text(u),r.attr("fill",this.options.headercolor),r.style("stroke",this.options.headercolor)),this.addEvent2(r),this.svg.append("line").attr("x1",c*f+e).attr("y1",0).attr("x2",c*f+e).attr("y2",this.rows.length*f+o).attr("stroke","#aaa").attr("stroke-width","0.5px");for(s=0;s<w.length;++s){var f=w[s],l=this.options.size*f.x+this.options.size/2+e,a=this.options.size*f.y+this.options.size/2+o;this.draw(f.data,l,a)}},groupData:function(n,t,i){for(var s,u,f={},h={},c={},r=0;r<n.length;++r){var l=n[r],e=l[t],o=l[i];h[e]==null&&(h[e]=!0);c[o]==null&&(c[o]=!0);s=e+","+o;f[s]==null&&(f[s]={x:e,y:o,data:[]});f[s].data.push(l)}for(this.rows=scil.Utils.getDictKeys(c),this.cols=scil.Utils.getDictKeys(h),this.rows.sort(),this.cols.sort(),u=scil.Utils.getDictValues(f),r=0;r<u.length;++r)u[r].x=scil.Utils.indexOf(this.cols,u[r].x),u[r].y=scil.Utils.indexOf(this.rows,u[r].y);return u},draw:function(n,t,i){var u=this.svg.append("g"),f,r;for(u.attr("transform","translate("+t+","+i+")"),f=this,r=0;r<this.options.assays.length;++r)this.addAssay(u,n,this.options.assays[r],"path"+r)},addAssay:function(n,t,i,r){for(var t,u,s=this,o=n.datum(t).selectAll(r).data(this.pie).enter().append("path").attr("class","plot").attr("stroke","#fff").attr("d",i.arc),e=o[0],f=0;f<e.length;++f)t=e[f].__data__.data,u={plot:d3.select(e[f]),data:t,color:this.oncolor(t,i),assay:i,f:!1},u.plot.attr("fill",u.color==null?"#ddd":u.color),u.plot.attr("stroke","#fff"),this.plots.push(u),this.addEvent(u)},addEvent2:function(n){var t=this;n.on("click",function(){if(t.options.onheaderclick!=null)t.options.onheaderclick(this)});n.on("mouseover",function(){if(this.style.fill=t.options.highlightcolor,this.style.stroke=t.options.highlightcolor,t.options.onheadermouseover!=null)t.options.onheadermouseover(this,event)});n.on("mouseout",function(){if(this.style.fill=t.options.headercolor,this.style.stroke=t.options.headercolor,t.options.onheadermouseout!=null)t.options.onheadermouseout(this,event)})},addEvent:function(n){var t=this,i=n.plot;i.on("click",function(){if(n.color!=null){if(t.options.selectable){var r=event!=null&&event.shiftKey,i=0;r?(t.updateSelect(n,!n.f),++i):(i+=t.selectAll(!1),n.f||(t.updateSelect(n,!0),++i));i>0&&t.options.onselect!=null&&t.options.onselect()}if(t.options.onclick!=null)t.options.onclick(n)}});i.on("mouseover",function(){var i,r;if(n.color!=null&&(this.style.fill=t.options.highlightcolor,t.tooltip!=null&&event!=null&&(i=t.options.ontooltip(n),scil.Utils.isNullOrEmpty(i)||(t.tooltip.show2({modal:!1,immediately:!0}),t.tooltip.body.innerHTML="<div style='white-space:nowrap'>"+i+"<\/div>",r=scil.Utils.scrollOffset(),t.tooltip.moveTo(event.clientX+r.x+10,event.clientY+r.y+10))),t.options.onmouseover!=null))t.options.onmouseover(n,event)});i.on("mouseout",function(){if(n.color!=null&&(this.style.fill=n.color==null?"#ddd":n.color,t.tooltip!=null&&t.tooltip.hide(!0),t.options.onmouseout!=null))t.options.onmouseout(n,event)})},selectAll:function(n){var i,t;for(n==null&&(n=!0),i=0,t=0;t<this.plots.length;++t)this.plots[t].f!=n&&(++i,this.updateSelect(this.plots[t],n));return i},updateSelect:function(n,t){n.f=t;n.f?n.plot.style("stroke",this.options.selectcolor):n.plot.style("stroke","none")},getSelected:function(){for(var t=[],n=0;n<this.plots.length;++n)this.plots[n].f&&t.push(this.plots[n].data);return t},oncolor:function(n,t){var i,f,e,r,u;return t.oncolor!=null?t.oncolor(n,t):(i=n[t.key],i==null)?null:(f=Math.min(t.red,t.green),e=Math.max(t.red,t.green),i=Math.round((i-f)*(255/(e-f))),i<0?i=0:i>255&&(i=255),f==t.red?(r=255-i,u=i):(u=255-i,r=i),u=u.toString(16),r=r.toString(16),"#"+(r.length==1?"0"+r:r)+(u.length==1?"0"+u:u)+"00")}});scil.Viz.Heatmap=scil.extend(scil._base,{constructor:function(n,t,i){function k(n){var t=d3.select(this).selectAll(".cell").data(n.filter(function(n){return n.z})).enter().append("rect").attr("class","cell").attr("x",function(n){return r(n.x)}).attr("width",r.rangeBand()).attr("height",r.rangeBand()).style("fill-opacity",function(n){return w(n.z)}).style("fill",function(n){return u[n.x].group==u[n.y].group?b(u[n.x].group):null}).on("mouseover",d).on("mouseout",g)}function d(n){d3.selectAll(".row text").attr("fill",function(t,i){return i==n.y?"red":""});d3.selectAll(".column text").attr("fill",function(t,i){return i==n.x?"red":""})}function g(){d3.selectAll("text").attr("fill","")}function y(n){r.domain(c[n]);var t=s.transition().duration(2500);t.selectAll(".row").delay(function(n,t){return r(t)*4}).attr("transform",function(n,t){return"translate(0,"+r(t)+")"}).selectAll(".cell").delay(function(n){return r(n.x)*4}).attr("x",function(n){return r(n.x)});t.selectAll(".column").delay(function(n,t){return r(t)*4}).attr("transform",function(n,t){return"translate("+r(t)+")rotate(-90)"})}var c,l,a,p;typeof n=="string"&&(n=scil.byId(n));this.div=n;this.options=i==null?{}:i;this.data=t;this.options.width>0||(this.options.width=800);this.options.height>0||(this.options.height=600);var f={top:80,right:0,bottom:10,left:80},o=this.options.width,v=this.options.height,r=d3.scale.ordinal().rangeBands([0,o]),w=d3.scale.linear().domain([0,4]).clamp(!0),b=d3.scale.category10().domain(d3.range(10)),s=d3.select(this.div).append("svg").attr("width",o+f.left+f.right).attr("height",v+f.top+f.bottom).style("margin-left",-f.left+"px").append("g").attr("transform","translate("+f.left+","+f.top+")"),e=[],u=t.nodes,h=u.length;u.forEach(function(n,t){n.index=t;n.count=0;e[t]=d3.range(h).map(function(n){return{x:n,y:t,z:0}})});t.links.forEach(function(n){e[n.source][n.target].z+=n.value;e[n.target][n.source].z+=n.value;e[n.source][n.source].z+=n.value;e[n.target][n.target].z+=n.value;u[n.source].count+=n.value;u[n.target].count+=n.value});c={name:d3.range(h).sort(function(n,t){return d3.ascending(u[n].name,u[t].name)}),count:d3.range(h).sort(function(n,t){return u[t].count-u[n].count}),group:d3.range(h).sort(function(n,t){return u[t].group-u[n].group})};r.domain(c.name);s.append("rect").attr("fill","#eee").attr("width",o).attr("height",v);l=s.selectAll(".row").data(e).enter().append("g").attr("class","row").attr("transform",function(n,t){return"translate(0,"+r(t)+")"}).each(k);l.append("line").attr("x2",o).attr("stroke","#fff");l.append("text").attr("x",-6).attr("y",r.rangeBand()/2).attr("dy",".32em").attr("text-anchor","end").style("font-size","10px").text(function(n,t){return u[t].name});a=s.selectAll(".column").data(e).enter().append("g").attr("class","column").attr("transform",function(n,t){return"translate("+r(t)+")rotate(-90)"});a.append("line").attr("x1",-o);a.append("text").attr("x",6).attr("y",r.rangeBand()/2).attr("dy",".32em").attr("text-anchor","start").style("font-size","10px").text(function(n,t){return u[t].name});d3.select("#order").on("change",function(){clearTimeout(p);y(this.value)});p=setTimeout(function(){y("group");var n=d3.select("#order").property("selectedIndex",2).node();n!=null&&n.focus()},5e3)}});scil.Viz.OrgChart=scil.extend(scil._base,{constructor:function(n,t){typeof n=="string"&&(n=scil.byId(n));t==null&&(t={});t.width>0||(t.width=500);t.height>0||(t.height=300);t.boxwidth>0||(t.boxwidth=150);t.boxheight>0||(t.boxheight=50);t.spacing>0||(t.spacing=20);t.depth>0||(t.depth=80);this.parent=n;this.options=t;n.style.width=t.width+"px";n.style.height=t.height+"px";++scil.Viz.OrgChart.__id;t.id=scil.Utils.isNullOrEmpty(n.id)?"#orgchart"+scil.Viz.OrgChart.__id:"#"+n.id;this._root={};this._nodes=[];this._counter=0;this._svgroot=null;this._svg=null;this._tree=null;this._diagonal=null;this._lineFunction=null;this._duration=750;this._mode="line";this._callerNode=null;this._callerMode=0;this.initTree(t)},initTree:function(n){var f=scil.apply({id:"",data:{},modus:"line",loadFunc:function(){}},n),e,t,i,o,u,s,l;id=f.id;this._mode=f.modus;this._root=f.data;this.parent.innerHTML="";e=this.options.width;t=this.options.height;this._tree=d3.layout.tree().nodeSize([this.options.boxwidth+this.options.spacing,this.options.boxheight+this.options.spacing]);i=this;this._diagonal=d3.svg.diagonal().projection(function(n){return[n.x+i.options.boxwidth/2,n.y+i.options.boxheight/2]});this._lineFunction=d3.svg.line().x(function(n){return n.x}).y(function(n){return n.y}).interpolate("linear");var h=this._root.children.length,c=2,a=h*this.options.boxwidth+(h-1)*this.options.spacing,v=c*this.options.boxwidth+(c-1)*this.options.spacing*1.5,r={x:(e-a)/2,y:(t-v)/2};if(this._svgroot=d3.select(id).append("svg").attr("width",e).attr("height",t).call(zm=d3.behavior.zoom().scaleExtent([.15,3]).on("zoom",function(){i.redraw()})),this._svg=this._svgroot.append("g").attr("transform","translate("+r.x+","+r.y+")"),o=[{offset:"0%",color:"#03A9F4",opacity:1},{offset:"100%",color:"#0288D1",opacity:1}],this.options.fills!=null)for(u in this.options.fills)s=this.options.fills[u],l=[{offset:"0%",color:s.color1,opacity:1},{offset:"100%",color:s.color2,opacity:1}],this.defLinearGradient(u,"0%","0%","0%","100%",l),u=="main"&&(def=null);o!=null&&this.defLinearGradient("main","0%","0%","0%","100%",o);this.defBoxShadow("boxShadow");zm.translate([r.x,r.y]);this._root.x0=0;this._root.y0=t/2;this._root.children.forEach(function(n){i.collapse(n)});this.update(this._root);d3.select(id).style("height",t)},defLinearGradient:function(n,t,i,r,u,f){var s=this._svgroot.append("svg:defs").append("svg:linearGradient").attr("id",n).attr("x1",t).attr("y1",i).attr("x2",r).attr("y2",u).attr("spreadMethod","pad"),o,e;for(o in f)e=f[o],s.append("svg:stop").attr("offset",e.offset).attr("stop-color",e.color).attr("stop-opacity",e.opacity)},defBoxShadow:function(n){var t=this._svgroot.append("svg:defs").append("svg:filter").attr("id",n).attr("height","150%").attr("width","150%");t.append("svg:feOffset").attr("dx","2").attr("dy","2").attr("result","offOut");t.append("svg:feGaussianBlur").attr("in","offOut").attr("result","blurOut").attr("stdDeviation","2");t.append("svg:feBlend").attr("in","SourceGraphic").attr("in2","blurOut").attr("mode","normal")},collapse:function(n){var t=this;n.children&&(n._children=n.children,n._children.forEach(function(n){t.collapse(n)}),n.children=null)},update:function(n){var t=this,f,r,u,e,o,i;this._nodes=this._tree.nodes(this._root).reverse();f=this._tree.links(this._nodes);t=this;this._nodes.forEach(function(n){n.y=n.depth*t.options.depth});r=this._svg.selectAll("g.node").data(this._nodes,function(n){return n.id||(n.id=++t._counter)});u=r.enter().append("g").attr("class","node").attr("transform",function(){return"translate("+n.x0+","+n.y0+")"}).attr("key",function(n){return n.id}).on("click",function(n){t.nodeclick(this,n)});u.append("rect").attr("width",this.options.boxwidth).attr("height",this.options.boxheight).attr("fill","#898989").attr("filter","url(#boxShadow)");u.append("rect").attr("width",this.options.boxwidth).attr("height",this.options.boxheight).attr("id",function(n){return n.id}).attr("fill",function(n){return"url(#"+(n.fill==null?"main":n.fill)+")"}).style("cursor",function(n){return n.children||n._children||n.hasChild?"pointer":"default"}).attr("class","box");u.append("text").attr("x",this.options.boxwidth/2).attr("y",this.options.boxheight/2).attr("dy",".35em").attr("text-anchor","middle").style("cursor",function(n){return n.children||n._children||n.hasChild?"pointer":"default"}).text(function(n){return t.wrapLabel(n.label,n._children==null)});e=r.transition().duration(this._duration).attr("transform",function(n){return"translate("+n.x+","+n.y+")"});e.select("rect.box").attr("fill",function(n){return"url(#"+(n.fill==null?"main":n.fill)+")"});o=r.exit().transition();o.duration(this._duration).attr("transform",function(){return"translate("+n.x+","+n.y+")"}).remove();i=this._svg.selectAll("path.link").data(f,function(n){return n.target.id});this._mode==="line"?(i.enter().append("path","g").attr("class","link").attr("d",function(n){return t.draw1(n)}).style("fill","none").style("stroke","#424242").style("stroke-width","1.5px"),i.transition().duration(this._duration).attr("d",function(n){return t.draw2(n)}),i.exit().transition().duration(this._duration).attr("d",function(n){return t.draw3(n)}).each("end",function(){t._callerNode=null})):this._mode==="diagonal"&&(i.enter().insert("path","g").attr("class","link").attr("x",this.options.boxwidth/2).attr("y",this.options.boxheight/2).attr("d",function(){var i={x:n.x0,y:n.y0};return t._diagonal({source:i,target:i})}),i.transition().duration(this._duration).attr("d",this._diagonal),i.exit().transition().duration(this._duration).attr("d",function(){var i={x:n.x,y:n.y};return t._diagonal({source:i,target:i})}).remove());this._nodes.forEach(function(n){n.x0=n.x;n.y0=n.y})},wrapLabel:function(n,t){return t?n:"("+n+")"},draw1:function(n){var t=this,i=function(n){return[{x:n.source.x0+parseInt(t.options.boxwidth/2),y:n.source.y0+t.options.boxheight+2},{x:n.source.x0+parseInt(t.options.boxwidth/2),y:n.source.y0+t.options.boxheight+2},{x:n.source.x0+parseInt(t.options.boxwidth/2),y:n.source.y0+t.options.boxheight+2},{x:n.source.x0+parseInt(t.options.boxwidth/2),y:n.source.y0+t.options.boxheight+2}]}(n);return this._lineFunction(i)},draw2:function(n){var t=this,i=function(n){return[{x:n.source.x+parseInt(t.options.boxwidth/2),y:n.source.y+t.options.boxheight},{x:n.source.x+parseInt(t.options.boxwidth/2),y:n.target.y-t.options.spacing/2},{x:n.target.x+parseInt(t.options.boxwidth/2),y:n.target.y-t.options.spacing/2},{x:n.target.x+parseInt(t.options.boxwidth/2),y:n.target.y}]}(n);return this._lineFunction(i)},draw3:function(n){var t=this,i=function(){return[{x:t._callerNode.x+parseInt(t.options.boxwidth/2),y:t._callerNode.y+t.options.boxheight+2},{x:t._callerNode.x+parseInt(t.options.boxwidth/2),y:t._callerNode.y+t.options.boxheight+2},{x:t._callerNode.x+parseInt(t.options.boxwidth/2),y:t._callerNode.y+t.options.boxheight+2},{x:t._callerNode.x+parseInt(t.options.boxwidth/2),y:t._callerNode.y+t.options.boxheight+2}]}(n);return this._lineFunction(i)},nodeclick:function(n,t){var i=this;t.children||t._children||!t.hasChild?(t.children?(i._callerNode=t,i._callerMode=0,t._children=t.children,t.children=null):(i._callerNode=t,i._callerMode=1,t.children=t._children,t._children=null),i.update(t)):this._loadFunction(t,function(n){var r={id:t.id,desc:t.label,children:n.result};r.children.forEach(function(n){i._tree.nodes(t)[0]._children||(i._tree.nodes(t)[0]._children=[]);n.x=t.x;n.y=t.y;n.x0=t.x0;n.y0=t.y0;i._tree.nodes(t)[0]._children.push(n)});t.children?(i._callerNode=t,i._callerMode=0,t._children=t.children,t.children=null):(i._callerNode=null,i._callerMode=1,t.children=t._children,t._children=null);i.update(t)});n.lastElementChild.innerHTML=this.wrapLabel(t.label,i._callerMode==1)},redraw:function(){this._svg.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale.toFixed(1)+")")},moveCenter:function(){for(var u=this._svg,i=u.getBoundingClientRect(),r=null,t=u.childNodes,n=0;n<t.length;++n)if(t[n].tagName=="g"&&t[n].getAttribute("key")==this._root.id){r=t[n];break}if(r!=null){var o=r.getBoundingClientRect(),f=(this.options.width-i.width)/2+(o.x-i.x),e=(this.options.height-i.height)/2;this._svg.attr("transform","translate("+f+","+e+") scale(1)");zm.translate([f,e])}}});scil.Viz.OrgChart.__id=0;scil.Page=scil.extend(scil._base,{constructor:function(n,t,i,r,u){var f,o,e;if(f=i!=null&&i.length>0||r!=null||u!=null?{middle:r,onRefreshReceivers:u,forms:i}:i==null?{}:i,t==null&&f.left==null&&(f.left=!1),t!=null&&(f.onresize=t.onresizetree),n.__isdialog&&(n=n.body),this.onRefreshReceivers=f.onRefreshReceivers,typeof n=="string"&&(n=scil.byId(n)),this.rootparent=n,this.explorer=new scil.Page.Explorer(n,f),t!=null&&t.root!=null&&t.root.children!=null&&t.translate)for(e=0;e<t.root.children.length;++e)t.root.children[e].name=scil.Lang.res(t.root.children[e].name);if(this.tree=null,t!=null&&(t.type=="table"||t.type=="block"||t.type=="column"?this.table=new scil.Page.Table(this,t,this.explorer.left):t.type=="form"?this.form=new scil.Page.Form(this,t,this.explorer.left):this.tree=new scil.Page.Tree(this,t,this.explorer.left)),f.forms!=null)for(o=this.tree==null?this.form:this.tree,e=0;e<f.forms.length;++e)o=this.addForm(f.forms[e],o)},fillscreen:function(){var t,n,i;scil.App.skin=="7.0"?(t=scil.byId("__scil_rightarea"),t.style.overflowY="hidden",t.style.overflowX="hidden"):(document.body.style.overflowY="hidden",document.body.style.overflowX="hidden");n=scil.Utils.getBox();this.tree!=null&&this.tree.form!=null?this.tree.form.fillscreen(n.h):this.table!=null&&this.table.form!=null&&this.table.form.fillscreen(n.h);this.lastright!=null&&(this.lastright.form!=null?this.lastright.form.fillscreen(n.h):this.lastright.fillscreen(n.h));i=this;window.onresize=function(){i.fillscreen()}},addTabs:function(n){var t=new scil.Page.Tab(this,n,this.explorer.right);return(n!=null&&n.visible==!1||n==!1)&&t.hide(),this.lastright=t,t},addDiv:function(n,t){return this.lastright=null,scil.Utils.createElement(this.explorer.right,"div",n,t)},addForm:function(n,t,i,r){var u=scil.Page.addForm(this,n,t,i,r);return this.lastright=u,u},addResizeHandle:function(n,t){var i=this.addDiv();return i.style.height=(t>0?t:scil.Page.kHandleWidth)+"px",i.style.marginBottom="2px",new scil.Resizable(i,{direction:"y",mouseovercolor:scil.Page.kHandleColor,onresize:n}),i},removeForm:function(n){var t=n.form.root;t.parentNode.removeChild(t)},receiverRefresh:function(n,t){if(this.onRefreshReceivers!=null)this.onRefreshReceivers(t,n);for(var i=0;i<n.receivers.length;++i)n.receivers[i].refresh(n,t)},receiverClear:function(n){for(var t=0;t<n.receivers.length;++t)n.receivers[t].clear()}});scil.apply(scil.Page,{kHandleWidth:5,kHandleColor:"#aaf",addForm:function(n,t,i,r,u){r==null&&(r=u?n.explorer.left:n.explorer.right);var f=null;return f=t.type=="form"?new scil.Page.Form(n,t,r):t.type=="custom"?new scil.Page.Custom(n,t,r):t.type=="html"?new scil.Page.Html(n,t,r):t.type=="gantt"?new scil.Page.Gantt(n,t,r):t.type=="calendar"?new scil.Page.Calendar(n,t,r):new scil.Page.Table(n,t,r),i!=null&&i.receivers.push(f),scil.Page.setBorder(f.form),t.form=f,f},setBorder:function(n){n.toolbar.style.borderLeftColor=scil.App.config.line;n.toolbar.style.borderRightColor=scil.App.config.line;n.main.style.borderLeftColor=scil.App.config.line;n.main.style.borderRightColor=scil.App.config.line;n.main.style.borderBottomColor=scil.App.config.line},getFilterKeys:function(n,t){var u=n.options.buttons,f,r,i;if(u==null)return null;for(f=[],r=0;r<u.length;++r)i=u[r],i==null||scil.Utils.isNullOrEmpty(i.key)||(f.push(i.key),t!=null&&i.cookiekey!=null&&(t[i.key]=i.cookiekey));return f},clearFilterValues:function(n){var t=n.options.buttons;t!=null&&(scil.Form.setButtonValuesByKey(t,{},{countperpage:!0,sortby:!0}),n.table!=null&&n.table.clearFilterValues!=null&&n.table.clearFilterValues(),n.refresh({action:"filter",field:null}))},setFilterValues:function(n,t){var i=n.options.buttons;i!=null&&(t==null&&(t={}),scil.Form.setButtonValuesByKey(i,t,{countperpage:!0,sortby:!0}),n.table!=null&&n.table.setFilterValues!=null&&n.table.setFilterValues(t))},getFilterArgs:function(n){var t=n.args,r,i,u,f;if((t==null&&(t={}),r=n.options.buttons,r==null)||(i={},u=this.getFilterKeys(n,i),u==null))return t;scil.Form.getButtonValuesByKey(r,u,t);n.table!=null&&n.table.getFilterValues!=null&&n.table.getFilterValues(t);for(f in i)scil.Utils.createCookie("scil_pagetable_"+i[f],t[f]);return t},addCss:function(){if(!this.cssadded){this.cssadded=!0;var n=window.document.styleSheets[0];try{n.insertRule(".smallscroll::-webkit-scrollbar {width:8px;height:8px;}",n.cssRules.length);n.insertRule(".smallscroll::-webkit-scrollbar-button{background:#d0d0d0;height:0;width:0}",n.cssRules.length);n.insertRule(".smallscroll::-webkit-scrollbar-track-piece{background:#eee}",n.cssRules.length);n.insertRule(".smallscroll::-webkit-scrollbar-thumb{background:#d0d0d0;border-radius:4px;}",n.cssRules.length)}catch(t){}}}});window.onpopstate=function(n){scil.History.state=n.state};scil.Page.Explorer=scil.extend(scil._base,{constructor:function(n,t){var r,i,f,e;if(typeof n=="string"&&(n=scil.byId(n)),this.options=t,this.resizing=null,t.resizable==null&&(t.resizable=!0),r=scil.Utils.createTable(n,0,0,{width:"100%"}),i=scil.Utils.createElement(r,"tr"),t.left==!1)this.left=null,this.middle=null;else{var u=t.leftwidth>0?t.leftwidth:200,o=scil.Utils.createElement(i,"td",null,{width:"1%",paddingRight:"1px"},{vAlign:"top"}),s=scil.Utils.createTable(o,0,0,t.resizable?null:{width:u}),h=scil.Utils.createElement(s,"tr"),c=scil.Utils.createElement(h,"td");this.left=scil.Utils.createElement(c,"div",null,t.resizable?{width:u,overflow:"hidden"}:null);t.middle!=!1&&(this.middle=scil.Utils.createElement(i,"td"),f=scil.Utils.createElement(this.middle,"div",null,{width:scil.Page.kHandleWidth}),scil.Utils.unselectable(this.middle),scil.Utils.unselectable(f));t.resizable&&(e=this,new scil.Resizable(this.middle,{direction:"x",mouseovercolor:scil.Page.kHandleColor,onresize:function(n){return e.onresize(n)}}))}this.right=t.right==!1?null:scil.Utils.createElement(i,"td",null,{width:"99%",paddingLeft:t.left==!1?null:"1px"},{vAlign:"top"})},onresize:function(n){var t=scil.Utils.parsePixel(this.left.style.width)+n;if(t>20){if(this.left.style.width=t+"px",this.options.onresize!=null)this.options.onresize(t,this);return!0}return!1}});scil.Page.ExplorerForm=scil.extend(scil._base,{constructor:function(n,t,i){var u,o,e,s,f;this.options=scil.Page.ExplorerForm.cloneArgs(t.options,i);this.form=t;typeof n=="string"&&(n=scil.byId(n));this.parent=n;var h=this.options.forecolor==null?scil.Form.kForeColor:this.options.forecolor,c=t.page.layout,r=scil.Utils.createTable(this.parent,0,0,{width:"100%",tableLayout:c,color:h});this.dom=this.root=r.parentNode;this.options.visible==!1&&(this.root.style.display="none");this.options.caption==null?(r.parentNode.style.borderTop="solid 1px "+scil.Page.ExplorerForm.kHeaderStyle.background,this.title=null):(u=scil.Page.ExplorerForm.kHeaderStyle,u.border="1px solid "+scil.App.config.line,u.borderRadius=JSDraw2.Skin.kBorderRadius+" "+JSDraw2.Skin.kBorderRadius+" 0 0",o=scil.App.config==null?"gray":scil.App.config.frame,scil.apply(u,{backgroundImage:scil.SVG.asBackground("arrow2_down","#fff",!0),backgroundSize:"18px",backgroundPosition:"left",backgroundRepeat:"no-repeat"}),scil.Page.ExplorerForm.kHeaderStyle.nobackground&&(u.background=null),e=scil.Lang.res(this.options.caption),this.options.icon!=null&&(e="<img src='"+this.options.icon+"'>"+e),s=scil.Utils.createElement(r,"tr",null,{backgroundColor:o,color:"#fff"}),this.title=scil.Utils.createElement(s,"td",e,u));this.toolbar=scil.Utils.createElement(scil.Utils.createElement(r,"tr"),"td",null,scil.Page.ExplorerForm.kToolbarStyle);this.options.toolbarvisible==!1&&(this.toolbar.style.display="none");this.toolbar.style.whiteSpace="nowrap";this.main=scil.Utils.createElement(scil.Utils.createElement(r,"tr"),"td",null,scil.Page.ExplorerForm.kAreaStyle);this.div=scil.Utils.createElement(this.main,"div");this.table=r.parentNode;this.recreateToolbar(this.options.buttons);this.title!=null&&this.options.expandable!=!1&&(f=this,scil.connect(this.title,"onclick",function(){var n=!f.isExpanded();if(f.expand(n),f.options.onexpandform!=null)f.options.onexpandform(n)}),this.options.expanded==!1&&this.expand(!1));this.options.marginTop!=null&&(this.table.style.marginTop=this.options.marginTop);this.table.style.marginBottom=this.options.marginBottom==null?"25px":this.options.marginBottom},initButtons:function(n,t){var o,u,r,i,f,e;if(t!=null&&n!=null){for(o=[],u=n.options.filtervalues,r=0;r<t.length;++r)if(i=t[r],i!=null){if(typeof i=="object"&&(i.form=n),scil.Utils.isNullOrEmpty(i.key))continue;o.push(i);scil.Page.ExplorerForm.connetFilterEvent(i,n);i.styles==null&&(i.styles={});i.styles.border="solid 1px #ddd";u!=null&&(f=u[i.key],f!=null&&(i.value=f))}e=t[t.length-1];n.options.clearfilter!=!1&&(e==null||e.clearfilter!="clear")&&scil.Utils.isNullOrEmpty(n.options.savequery)&&(t.push("|"),t.push({clearfilter:"clear",svg:"search_off",title:"Clear Filter",onclick:function(){scil.Page.clearFilterValues(n)}}))}},fillscreen:function(n){var t,i;n>0&&(t=scil.Utils.getOffset(this.div),this.div.style.height=n-t.y-8+"px",this.div.style.overflowX="auto",this.div.style.overflowY="auto",this.dom.style.tableLayout="fixed",this.scrollconnected||(this.scrollconnected=!0,i=this,scil.connect(this.div,"onscroll",function(n){scil.Utils.fireEvent(document,"scrollinside",null,null,n)})))},recreateToolbar:function(n){this.initButtons(this.form,n);this.toolbar.style.display="";scil.Utils.removeAll(this.toolbar);n==null||n.length==0?this.toolbar.style.display="none":scil.Form.createToolbarButtons(this.toolbar,n)},isVisible:function(){return scil.Utils.isAllParentVisible(this.root)},show:function(){this.isVisible()||(this.root.style.display="",this.host!=null&&this.host.refresh!=null&&this.host.refreshneeded&&this.host.refresh())},hide:function(){this.root.style.display="none"},collapse:function(){this.expand(!1)},expanded:!0,expandedheight:null,expandedwidth:null,expand:function(n){var t,i;(n==null&&(n=!0),this.expanded!=n)&&(t=this.options.collapsedwidth>0?this.parent:this.dom,this.expanded&&(this.expandedheight=t.offsetHeight,this.expandedwidth=t.offsetWidth),i=this,this.options.collapsedwidth>0?scil.Animation.expandXY(t,n?this.expandedwidth:this.options.collapsedwidth,n?this.expandedheight:this.title.offsetHeight,function(){i.onexpanded(n)}):scil.Animation.expandY(t,n?this.expandedheight:this.title.offsetHeight,function(){i.onexpanded(n)}),this.expanded=n)},onexpanded:function(n){var t,i;n&&(t=this.options.collapsedwidth>0?this.parent:this.dom,t.style.maxHeight="",t.style.maxWidth="",this.host!=null&&this.host.refresh!=null&&this.host.refreshneeded&&this.host.refresh());i=scil.App.config==null?"gray":scil.App.config.frame;this.title.style.backgroundImage=scil.SVG.asBackground(n?"arrow2_right":"arrow2_down","#fff",!0);this.title.style.backgroundRepeat="no-repeat";this.title.style.backgroundPosition="left center"},isExpanded:function(){return this.expanded}});scil.apply(scil.Page.ExplorerForm,{kHeaderStyle:{nobackground:!0,border:"solid 1px",fontSize:"18px",padding:"8px 10px 8px 16px",whiteSpace:"nowrap",borderTopLeftRadius:JSDraw2.Skin.kBorderRadius,borderTopRightRadius:JSDraw2.Skin.kBorderRadius},kToolbarStyle:{background:"#f5f5f5",border:"solid 1px #f5f5f5",padding:"1px 0 0 3px",overflowX:"hidden",borderBottom:"solid 1px #ccc"},kAreaStyle:{border:"solid 1px #f5f5f5",padding:"5px",background:"#fff"},connetFilterEvent:function(n,t){n!=null&&((n.type=="select"||n.type=="check3"||n.type=="checkbox")&&n.onchange==null?(n.onchange=function(){t.refresh({action:"filter",field:n})},n.addblank=!0):(n.type=="input"||n.type=="date")&&n.onenter==null&&(n.onenter=function(){t.refresh({action:"filter",field:n})}))},cloneArgs:function(n,t){var i={toolbarvisible:n.toolbarvisible,expandable:n.expandable,caption:n.caption,visible:n.visible,marginTop:n.marginTop,marginBottom:n.marginBottom,expanded:n.expanded,onexpand:n.onexpand};return t!=null&&scil.apply(i,t),i}});scil.Page.Tab=scil.extend(scil._base,{constructor:function(n,t,i){this.page=n;this.options=t==null?{}:t;this.onShowTab2=this.options.onShowTab;var r=this;this.options.onShowTab=function(n,t){if(t!=null&&t.form!=null&&t.form.hide(),n.form!=null&&(n.form.show(),n.form.form.fillscreen(r.screenheight)),r.onShowTab2!=null)r.onShowTab2(n,t);if(r.options.trackhistory!=null&&t!=null){var i=n.getAttribute("key");scil.Utils.isNullOrEmpty(i)||scil.History.update(r.options.trackhistory,i)}};this.options.forpage=!0;this.tabs=new scil.Tabs(i,this.options)},fillscreen:function(n){this.tabs.currenttab!=null&&this.tabs.currenttab.form.form.fillscreen(n);this.screenheight=n},addForm:function(n,t){var u=scil.Page.Tab.getTabKey(n.tabkey),i=this.tabs.addTab(n,u),f=n.captions,r;return n.caption=null,i.form=scil.Page.addForm(this.page,n,t,i.clientarea),n.caption=f,scil.Page.setBorder(i.form.form),i.form.form.fillscreen(this.screenheight),this.options.trackhistory!=null&&(r=scil.History.get(this.options.trackhistory),scil.Utils.isNullOrEmpty(r)||r!=u||this.tabs.showTab(i)),i.form},removeTab:function(n){return this.tabs.removeTab(n)},closeTab:function(n){return this.tabs.closeTab(n)},findTab:function(n){return this.tabs.findTab(n)},showTab:function(n){this.tabs.showTab(n)},show:function(){this.tabs.show()},hide:function(){this.tabs.hide()}});scil.apply(scil.Page.Tab,{_tabindex:0,getTabKey:function(n){return scil.Utils.isNullOrEmpty(n)&&(n="#tabindex"+ ++this._tabindex),n}});scil.Page.Form=scil.extend(scil._base,{constructor:function(n,t,i){var u=this,r,f;this.refreshneeded=!0;this.page=n;this.options=t;this.receivers=[];this.ajaxurl=this.options.ajaxurl==null?"ajax.ashx?cmd=":this.options.ajaxurl;r=[];t.norefresh==!1&&r.push({svg:"refresh",title:"Refresh",onclick:function(){u.refresh()}});(t.toggleautohiderows==null&&scil.Page.Form.toggleautohiderows||t.toggleautohiderows)&&r.push({svg:"columns",title:"Show/Hide Blank Rows",onclick:function(){u.toggleAutoHideRows(!0)}});this.options.buttons!=null&&(r=r.concat(this.options.buttons));t.editable&&r.push({svg:"edit",title:"Edit",onclick:function(){u.edit()}});t.viewonly==null&&(t.viewonly=!0);this.form=new scil.Page.ExplorerForm(i,this,{buttons:r});this.form.host=this;this.options.usetabs!=null?(f={tabs:this.options.fields,viewonly:t.viewonly,border:!0,onchange:this.options.onformchange},this.table=new scil.TabbedForm(f).render(this.form.div)):(this.table=new scil.Form({autohiderows:this.options.autohiderows,alternativeforms:this.options.alternativeforms,viewonly:t.viewonly,onchange:this.options.onformchange}),this.table.render(this.form.div,this.options.fields,{immediately:!0,hidelabel:t.hidelabel}))},toggleAutoHideRows:function(n){var t;this.table!=null?(t=!this.table.options.autohiderows,this.table.options.autohiderows=t):(t=!this.options.autohiderows,this.options.autohiderows=t);n&&this.refresh()},show:function(){this.form.show()},hide:function(){this.form.hide()},refresh:function(n,t){if(t!=null&&(this.args=t),!this.form.isVisible()||!this.form.isExpanded()){this.refreshneeded=!0;return}scil.Utils.isDictEmpty(this.args)||this.load(this.table,!1)},load:function(n,t){var r,i;(n.setData({}),this.refreshneeded=!1,r=scil.Page.getFilterArgs(this),this.options.onbeforerefresh==null||this.options.onbeforerefresh(r,t,"load",this)!="cancel")&&(this.page.receiverClear(this),i=this,scil.Utils.ajax(this.ajaxurl+this.options.object+".load",function(t){if((t==null||t=="")&&(t=r),i.options.onsetdata!=null)i.options.onsetdata(n,t);else i.options.savedoc&&t.doc!=null&&t.doc!=""?(n.setXml(t.doc),n.setData(t,!0)):n.setData(t);if(i.options.onformloaded!=null)i.options.onformloaded(t,"form",i)},r))},clear:function(){this.table.setData({});this.page.receiverClear(this)},edit:function(){var n=this;this.dlg==null&&(this.dlg=scil.Form.createDlgForm(this.options.caption,this.options.fields,{label:"Save",onclick:function(){n.save()}}));this.dlg.show();this.load(this.dlg.form,!0)},save:function(){if(this.dlg.form.checkRequiredFields()>0){scil.Utils.alert("Some required field(s) are blank");return}var n=this,t=this.dlg.form.getData();if(this.options.savedoc&&(t.doc=this.dlg.form.getXml()),this.options.onbeforesave&&this.options.onbeforesave(t,this.args,this.dlg.form)==!1)return!1;scil.Utils.ajax(this.ajaxurl+this.options.object+".save",function(t){if(n.dlg.hide(),n.refresh(),n.options.onaftersave)n.options.onaftersave(t,n)},t,{showprogress:!0})}});scil.apply(scil.Page.Form,{toggleautohiderows:!0});scil.Page.Table=scil.extend(scil._base,{constructor:function(n,t,i){var u=this,r,y,h,e,c,o,l,p,f,s,w,a,v;if(this.refreshneeded=!0,this.page=n,this.options=t,this.receivers=[],this.ajaxurl=this.options.ajaxurl==null?"ajax.ashx?cmd=":this.options.ajaxurl,r=[],t.norefresh||r.push({svg:"refresh",title:"Refresh",onclick:function(){u.refresh()}}),(t.toggleautohidecolumns==null&&scil.Page.Table.toggleautohidecolumns||t.toggleautohidecolumns)&&r.push({svg:"autocols",title:"Show/Hide Blank Columns",onclick:function(){u.toggleAutoHideColumns(!0)}}),(this.options.columnhideable||this.options.columnhidable)&&r.push({svg:"hidecols",title:"Show/Hide Columns",onclick:function(){u.table.showHideColumns()}}),this.options.issearch?(y=t.uselabel==null?"Use":t.uselabel,r.push({label:y,onclick:function(){u.searchselected()}}),this.options.fields=null,this.options.rowcheck=this.options.multiselect?!0:"radio"):(this.options.fields!=null&&(r.push("-"),this.options.canadd!=!1&&r.push({svg:"add",title:"New",onclick:function(){u.add()}}),this.options.canedit!=!1&&r.push({svg:"edit",title:"Edit",onclick:function(){u.edit()}}),this.options.bulkedit!=null&&r.push({svg:"table",title:"Bulk Edit",onclick:function(){u.bulkedit()}}),this.options.allowcopy&&r.push({svg:"copy",title:"Copy",onclick:function(){u.edit(null,!0)}})),this.options.delmany&&r.push({svg:"del",title:"Delete Selected",onclick:function(){u.delSelected()}}),(this.options["import"]||this.options.download)&&(r.push("-"),this.options["import"]&&r.push({svg:"upload",title:"Import data from files",onclick:function(){u.importData()}}),this.options.download=="advanced"?r.push({svg:"download",title:"Download",items:[{label:"All Columns",onclick:function(){u.selectDownload("all")}},{label:"Select Columns",onclick:function(){u.selectDownload()}}]}):this.options.download&&r.push({svg:"download",title:"Download",onclick:function(){u.download()}}))),this.options.copyas){if(r.push("-"),h=[this.copyasbutton("CSV"),this.copyasbutton("JSON"),this.copyasbutton("XML"),"-",this.copyasbutton("Image")],e=this.options.copyasothers,e!=null&&e.length>0)for(h.push("-"),f=0;f<e.length;++f)h.push(this.copyasbutton(e[f]));r.push({svg:"copy_file",title:"Copy As",items:h})}if(this.options.buttons!=null&&!scil.Utils.isNullOrEmpty(this.options.myfavorite)){for(c=this.options.buttons.length,f=0;f<this.options.buttons.length;++f)if(o=this.options.buttons[f],o!=null&&(o.type=="select"||o.type=="input"||o.type=="date")){c=f;break}this.options.buttons.splice(c,0,{label:"Star",key:"star",type:"select",items:["","Yes"]})}if(this.options.buttons!=null&&(r=r.concat(this.options.buttons)),scil.Utils.isNullOrEmpty(this.options.savequery)||(l=this.options.savequery,p=this.options.savehits,r.push({label:"Query",type:"a",items:[],onclick:function(n,t){scil.Page.ToolbarQuery.selectQuery(u,l,n,t)},onshowdropdown:function(n){return scil.Page.ToolbarQuery.onshowdropdown(l,n,p)}})),this.options.filterrow)for(r.push("|"),r.push({svg:"filter",title:"Show/Hide Filter Row",onclick:function(){u.table!=null&&u.table.showFilterRow()}}),f=r.length-1;f>=0;--f)s=r[f].key,scil.Utils.isNullOrEmpty(s)||this.options.columns[s]==null||this.options.columns[s].filter!=!1&&r[f].onclicklabel==null&&(this.options.columns[s].filter=r[f],r.splice(f,1));this.restoreCookieKeys(r);this.form=new scil.Page.ExplorerForm(i,this,{buttons:r});this.form.host=this;this.form.main.style.padding="0";(JSDraw2.Skin.kPagesLocation=="top"||JSDraw2.Skin.kPagesLocation=="topbottom")&&(this.toppages=scil.Utils.createElement(this.form.div,"div",null,{backgroundColor:"#eee"}));this.tablediv=scil.Utils.createElement(this.form.div,"div",null,{borderRight:"solid 1px "+scil.App.config.line});this.options.display!=null&&this.switchView(this.options.display);this.options.createtablelater||this.recreateTable();(JSDraw2.Skin.kPagesLocation=="bottom"||JSDraw2.Skin.kPagesLocation=="topbottom")&&(this.bottompages=scil.Utils.createElement(this.form.div,"div",null,{padding:"10px 10px 10px 30px",backgroundColor:"#eee"}));this.msg=scil.Utils.createElement(this.form.div,"div");this.options.loadmore&&(w=scil.Utils.createElement(this.form.div,"div",null,{clear:"left"}),this.loadmorebutton=scil.Utils.createButton(w,{label:"Load More",type:"a",onclick:function(){u.loadMore()}}),this.loadmorebutton.style.display="none");this.options.filtervalues!=null&&scil.Page.setFilterValues(this,this.options.filtervalues);scil.App.isOsDarkmode()&&(a=scil.byId("__title"),v=scil.byId("instructions"),a&&(a.style.color="#fff"),v&&(v.style.color="#fff"))},copyasbutton:function(n){var t=this;return{label:n,onclick:function(){t.copyas(n)}}},copyas:function(n){if(this.options.oncopyas==null||this.options.oncopyas(n,this)!="cancel"){var t=this;switch(n){case"CSV":scil.Clipboard.copy(t.table.getCsv("\t"));break;case"JSON":scil.Clipboard.copy(scil.Json.toString(t.table.getData(),!0,!0));break;case"XML":scil.Clipboard.copy(t.table.getXml());break;case"Image":scil.Clipboard.copyImage(t.table.tbody.parentNode)}}},initFieldFilters:function(){var t,n;if(this.options.filterrow){if(this.options.filterrow=="all")for(t in this.options.columns)(n=this.options.columns[t],n!=null)&&(n.type=="hidden"&&(n.filter=!1),n.filter==!1||scil.Utils.isNullOrEmpty(t)||n.filter!=null||(n.filter=this._makeFilter(n,t)));else for(t in this.options.columns)n=this.options.columns[t],n==null||n.filter!=!0||scil.Utils.isNullOrEmpty(t)||(n.filter=this._makeFilter(n,t));for(t in this.options.columns)n=this.options.columns[t],n!=null&&n.filter!=null&&(n.filter.type==null&&(n.filter.type="input"),scil.Page.ExplorerForm.connetFilterEvent(n.filter,this))}},_makeFilter:function(n,t){switch(n.type){case"checkbox":return{type:"select",items:["","Y","N"]};case"select":case"editableselect":case"dropdowninput":return{type:n.type,items:n.items||n.options};case"date":case"color":return{type:n.type};default:return t=="star"?null:{type:"input",autosuggestionurl:n.autosuggesturl}}},delSelected:function(){var t=this.table.getCheckedKeys(),n;if(t==null||t.length==0){scil.Utils.alert("No row checked");return}n=this;scil.Utils.confirmYes("Delete selected records?",function(){(n.options.onDelSelected==null||n.options.onDelSelected(t,n)!="cancel")&&scil.Utils.ajax(n.ajaxurl+n.options.object+".delmany",function(){n.refresh()},{_keys:scil.Utils.array2str(t,",")})})},toggleAutoHideColumns:function(n){var t;this.table!=null?(t=!this.table.options.autohidecolumns,this.table.options.autohidecolumns=t):(t=!this.options.autohidecolumns,this.options.autohidecolumns=t);n&&this.refresh(null,null,null,this.args==null?null:this.args.page)},searchselected:function(){var n=this.table.getCheckedRowData();if(this.options.onsearchselect!=null)this.options.onsearchselect(n)},addSubform:function(n,t){t>0&&(this.form.dom.style.marginBottom=t+"px");scil.Page.addForm(this.page,n,this,this.form.dom.parentNode)},getKey:function(n){for(var t in n)if(n[t]!=null&&n[t].iskey)return t;return null},recreateTable:function(){var t,i,r,n;if(this.initFieldFilters(),scil.Utils.removeAll(this.tablediv),i=null,scil.Utils.isNullOrEmpty(this.options.myfavorite)||(i=this.getKey(this.options.columns)),i==null?t=this.options.columns:(t={star:scil.MyFavorite.getField(this.options.myfavorite,i)},scil.apply(t,this.options.columns)),r=this,n=scil.clone(this.options),n.selectrow=!0,n.onselectrow=function(n){r.selectrow(n)},n.pushleft==null&&(n.pushleft=scil.Page.Table.pushleft),n.autohidecolumns==null&&(n.autohidecolumns=scil.Page.Table.autohidecolumns),n.onsort=function(n){r.refresh({action:"sort",field:n})},n.onshowhidecolumns=function(){r.showhidefilters()},this.options.type=="block"?(this.table=new scil.CardView(n),this.table.render(this.tablediv,t)):this.options.type=="column"?(this.table=new scil.CardView(n),this.table.render(this.tablediv,t)):(this.table=new scil.Table(!0,null,n),this.table.render(this.tablediv,t),this.table.tbody.parentNode.style.width="100%"),this.recreateneeded=!1,this.options.oncreatetable!=null)this.options.oncreatetable(this);this.options.showfilterrow?this.table.showFilterRow(!0):this.table.showFilterRow("auto")},showhidefilters:function(){var i=this.options.buttons,r,t,n;if(i!=null&&i.length!=0&&this.table.hasColumnHidden!=null)for(r=0;r<i.length;++r)t=i[r],t==null||t.b==null||scil.Utils.isNullOrEmpty(t.key)||(n=t.key,(scil.Utils.endswith(n,".min")||scil.Utils.endswith(n,".max"))&&(n=n.substr(0,n.length-4)),this.showhidefilters2(t,n))},showhidefilters2:function(n,t){var i=this.table.hasColumnHidden(t);n.b.style.display=i?"none":"";n.blabel!=null&&(n.blabel.style.display=i?"none":"")},switchView:function(n){if(n==this.display)return!1;var t=this.options.displays[n];return t==null?!1:(this.options.rowcheck&&this.table!=null&&(this.selectedkeys=this.table.getCheckedKeys()),this.display=n,scil.apply(this.options,t),this.setRecreate(),!0)},selectFirstRow:function(){this.table.selectFirstRow()},show:function(){this.form.show()},hide:function(){this.form.hide()},clear:function(){scil.Utils.removeAll(this.toppages);scil.Utils.removeAll(this.bottompages);scil.Utils.removeAll(this.msg);this.table!=null&&this.table.setData({});this.page.receiverClear(this)},selectrow:function(n){var r=n==null?null:n.getAttribute("key"),t=null,i;if(t={},t[this.options.key]=r,i=this.table.getRowData(n),this.options.name!=null&&i!=null&&(t[this.options.name]=i[this.options.name]),this.options.onpushdata!=null)this.options.onpushdata(t,i,this);if(this.page.receiverRefresh(this,t),this.options.onselectrow!=null)this.options.onselectrow(n,t)},loadPage:function(n){if(this.args==null&&(this.args={}),this.options.onloadpage!=null)this.options.onloadpage(this.args,n,this);this.refresh(null,null,null,n)},setRecreate:function(){this.recreateneeded=!0},list:function(n,t){var r,i,u;if(this.options.onbeforelist!=null)this.options.onbeforelist(n,t,this);if((this.recreateneeded&&this.recreateTable(),this.table!=null)&&(r=this,n==null&&(n={}),i=n.rows==null?n:n.rows,this.table.setData(i,null,t?!1:!0),this.loadmorebutton==null?(scil.Table.listPages(this.toppages,n.page,n.pages,function(n){r.loadPage(n)},this,n.rows==null?0:n.rows.length),scil.Table.listPages(this.bottompages,n.page,n.pages,function(n){r.loadPage(n)},this,n.rows==null?0:n.rows.length),i==null||i.length==0?this.msg.innerHTML="<div style='color:#FF8C00;padding:5px;'>"+scil.Lang.res("No Records Found")+"<\/div>":scil.Utils.removeAll(this.msg)):i==null||i.length==0||n.page!=null&&n.page>=n.pages?this.loadmorebutton.style.display="none":(u=n.page!=null&&n.pages!=null?scil.Lang.res("Load page")+" "+(n.page+1)+"/"+n.pages:scil.Lang.res("Load More"),this.loadmorebutton.innerHTML=u,this.loadmorebutton.style.display=""),this.table!=null&&this.table.autoHideColumns(),this.options.onafterlist!=null))this.options.onafterlist(n,t,this)},importData:function(n){var i=this,t=this.options.importfields,r;(this.options.bulkupdate||n)&&(t==null&&(t={}),t.__updatemode={label:"Update Mode",type:"checkbox",viewonly:n,value:n,str:"Update data by primary key"});this.options.datamapping&&(t==null&&(t={}),r=this.ajaxurl+this.options.object+".importpreview",t.__mapping={label:"Data Mapping",viewonly:!0,attributes:{name:"__mapping"},width:50,button2:{label:"Preview & Mapping",type:"a",onclick:function(n){scil.FileUploader.mapData(r,i.options.columns);n.preventDefault()}}});var u=this.ajaxurl+this.options.object+".import",f=this.options.importcaption==null?"Import Data":this.options.importcaption,e=this.options.onimportdata==null?this.args:this.options.onimportdata(this);scil.FileUploader.upload({caption:f,multiple:!0,fields:t,data:e,url:u,callback:function(n){i.importData2(n)}})},importData2:function(n){if(this.options.onimported!=null)this.options.onimported(n);else n.message!=null&&scil.Utils.alert(n.message);this.refresh()},restoreCookieKeys:function(n){var i,t,r;if(n!=null)for(this.options.trackhistory!=null&&(this._historyargs=scil.History.get(this.options.trackhistory)),i=n.length-1;i>=0;--i)if(t=n[i],t!=null&&!scil.Utils.isNullOrEmpty(t.key)){if(t.key=="countperpage"){this.options.perpagecounts==null&&(this.options.perpagecounts=t.items||t.options);n.splice(i,1);continue}t.cookiekey!=null&&(r=scil.Utils.readCookie("scil_pagetable_"+t.cookiekey),scil.Utils.isNullOrEmpty(r)||(t.value=r));this._historyargs!=null&&this._historyargs[t.key]!=null&&(t.value=this._historyargs[t.key])}},download:function(n,t){var i=scil.Page.getFilterArgs(this);this.table.options.rowcheck&&(i._keys=scil.Utils.array2str(this.table.getCheckedKeys(),","));i._columns=scil.Table.rows2xml(n);i._fileformat=t;(this.options.onbeforerefresh==null||this.options.onbeforerefresh(i,null,"download",this)!="cancel")&&this.download2(i)},download2:function(n){if(this.options.downloadformats==null){this.download3(n);return}if(this.extDlg==null){var t=this,i={_fileformat:{label:"Select File Format",type:"select",items:this.options.downloadformats}};this.extDlg=scil.Form.createDlgForm("Download",i,{label:"Download",onclick:function(){t.download3()}})}this.extDlg.show();this.extDlg.params=n},download3:function(n){if(n==null){var t=this.extDlg.form.getData();n=this.extDlg.params;n._fileformat=t._fileformat}scil.Utils.post(this.ajaxurl+this.options.object+".download",n,"_blank");this.extDlg!=null&&this.extDlg.hide()},selectDownload:function(n){if(n)this.download(this.table.allColsForDownload());else{var t=this;this.table.selectColumns("Select Columns",function(n){t.download(n)},function(){return!0})}},refresh:function(n,t,i,r,u){if(this.options.onrefresh==null||this.options.onrefresh(n,t,this)!="cancel"){if(this._historyargs!=null?(this.args=t!=null?t:this._historyargs,this._historyargs=null):(t!=null?this.args=t:this.args==null?this.args={}:delete this.args._keys,this.args.page=r),this.options.extraparams!=null&&scil.apply(this.args,this.options.extraparams,!1),!this.form.isVisible()||!this.form.isExpanded()){this.refreshneeded=!0;return}this.page.receiverClear(this);this.refreshneeded=!1;var f=scil.Page.getFilterArgs(this);f!=null&&f.display!=null&&this.options.displays!=null&&this.switchView(f.display);this.table!=null&&(f.sortkey_=this.table.sortkey,f.sortdirection_=this.table.sortdirection);this.pagejumpto!=null&&parseInt(this.pagejumpto.value)>0&&(f.page=this.pagejumpto.value);this.countperpage!=null&&parseInt(this.countperpage.value)>0&&(f.countperpage=this.countperpage.value);(this.options.onbeforerefresh==null||this.options.onbeforerefresh(f,i,"refresh",this)!="cancel")&&(this.refresh2(f,i,null,u),this.options.trackhistory!=null&&scil.History.update(this.options.trackhistory,f))}},loadMore:function(){this.moreparams==null&&(this.moreparams={});this.moreparams.page==null&&(this.moreparams.page=1);++this.moreparams.page;this.refresh2(this.moreparams,null,"loadmore")},refresh2:function(n,t,i,r){var u=this,f=this.options.jsonp?scil.Utils.jsonp:scil.Utils.ajax;f(this.ajaxurl+this.options.object+".list",function(r){u.refresh3(r,t,i);u.moreparams=n},n,{showprogress:this.options.showprogress||r})},refresh3:function(n,t,i){if(this.options.onbeforelisting!=null)this.options.onbeforelisting(n,this);if(t)this.list(n,i),this.table!=null&&this.table.selectFirstRow();else{var r=this.table==null?null:this.table.getCurrentKey();this.list(n,i);r!=null&&this.table!=null&&this.table.selectRow(r)}if(this.options.onrefreshed!=null)this.options.onrefreshed(this);this.selectedkeys!=null&&(this.table!=null&&this.table.checkRows(this.selectedkeys),this.selectedkeys=null)},add:function(n){(this.options.onAddNew==null||this.options.onAddNew(this.args)!=!1)&&this.add2(n,"create")},add2:function(n,t){if(this.create(),this.dlg.show(),this.options.usetabs&&this.dlg.form.tabs.showTab(0),this.options.onshowform!=null)this.options.onshowform(this.dlg,this.args,t);var i=n!=null?n:this.options.defaultvalues==null?{}:this.options.defaultvalues;if(this.applyArgs(i,!0),this.options.key!=null&&(i[this.options.key]=null),this.options.onloaddata)this.options.onloaddata(i,this.args,this.dlg);this.dlg.form.setData(i);this.dlg.editkey=null;this.setButtons(t)},copyNew:function(n){if(n==null&&(n=this.table.key),n!=null){var t=this;this.edit(function(i){i[n]="";t.dlg.editkey=null},!0)}},fields2BulkeditCols:function(){var n;return n=scil.clone(this.options.fields),n[this.options.key]==null&&(n[this.options.key]={label:"Key",viewonly:!0}),n},bulkedit:function(){var n,t,i;this.options.bulkedit!=null&&(n={},this.options.bulkedit==!0?n.columns=this.fields2BulkeditCols():(n=scil.clone(this.options.bulkedit),n.columns=n.columns==null?this.fields2BulkeditCols():scil.clone(n.columns)),t=null,this.table.options.rowcheck&&(t=this.table.getCheckedKeys()),(t==null||t.length==0)&&(t=this.table.getAllKeys()),i=this,scil.apply(n,{toolbar:!1,rowid:!1,translate:!0,key:this.options.key,selectbox:!0,headerstyle:this.options.bulkeditHeaderstyle,ajaxurl:this.ajaxurl+this.options.object,onsaved:function(){i.refresh()}},!1),scil.Page.BulkUpdate.show(n,t))},edit:function(n,t){if(this.table.currow==null){scil.Utils.alert("Please select a row first");return}this.add2(null,t?"copy":"save");var i=this,r={};if(r[this.options.key]=this.table.currow.getAttribute("key"),this.dlg.editkey=t?null:r[this.options.key],!t&&this.options.onEdit!=null&&this.options.onEdit(r,this)=="stop"){this.dlg.hide();return}r._iscopying=t;scil.Utils.ajax(this.ajaxurl+this.options.object+".load",function(r){if(i.options.onloaddata&&i.options.onloaddata(r,i.args,i.dlg,t)=="stop"){i.dlg.hide();return}if(n!=null&&n(r,i),i.dlg._iscopying=t,i.dlg._copyingfrom=null,t&&(i.dlg._copyingfrom=r[i.table.key],r[i.table.key]=null),i.options.savedoc&&r.doc!=null&&r.doc!=""?(i.dlg.form.setXml(r.doc),i.dlg.form.setData(r,!0)):i.dlg.form.setData(r),i.options.onformloaded!=null)i.options.onformloaded(r,"table",i)},r)},applyArgs:function(n,t){var r,i,u;if(this.args!=null){r=t?scil.Page.getFilterKeys(this):null;for(i in this.args)r!=null&&scil.Utils.indexOf(r,i)>=0||(u=this.args[i],scil.Utils.isNullOrEmpty(u)||(n[i]=u))}},cancel:function(){this.dlg!=null&&this.dlg.hide()},save:function(){if(this.dlg.form.checkRequiredFields()>0){scil.Utils.alert("Some required field(s) are blank");return}var n=this,t=this.dlg.form.getData();if(this.options.savedoc&&(t.doc=this.dlg.form.getXml()),this.options.onbeforesave&&this.options.onbeforesave(t,this.args,this.dlg.form)==!1)return!1;t._iscopying=this.dlg._iscopying;this.dlg._iscopying&&(t._copyingfrom=this.dlg._copyingfrom,t[this.table.key]=null);scil.Utils.ajax(this.ajaxurl+this.options.object+".save",function(t){if(n.dlg.hide(),t!=null&&t.rows!=null&&t.rows.length>0){for(var i=0;i<t.rows.length;++i)n.dlg.editkey!=null?n.table.updateRow(n.dlg.editkey,t.rows[i]):n.table.addRow(t.rows[i]);scil.Utils.removeAll(n.msg)}else n.refresh();if(n.options.onaftersave)n.options.onaftersave(t,n);n.table!=null&&n.table.autoHideColumns()},t,{showprogress:!0})},del:function(){var n=this;scil.Utils.confirmYes("Delete this record?",function(){var t=n.dlg.form.getData();scil.Utils.ajax(n.ajaxurl+n.options.object+".del",function(){n.dlg.hide();n.refresh()},t)})},setButtons:function(n){var i,t,r;if(this.dlg!=null)for(i=0;i<this.dlg.form.buttons.length;++i)(t=this.dlg.form.buttons[i],t!=null)&&(r=t.getAttribute("key"),r=="delete"?t.style.display=n=="save"?"":"none":r=="save"?t.style.display=n!="copy"?"":"none":r=="copy"&&(t.style.display=n=="copy"?"":"none"))},create:function(){if(this.dlg==null){var t=this,n=[{svg:"save",label:"Save",key:"save",onclick:function(){t.save()}}];this.options.allowcopy&&(n.push(" "),n.push({svg:"copy",label:"Copy",key:"copy",onclick:function(){t.save()}}));this.options.candelete!=!1&&(n.push(" "),n.push({svg:"del",label:"Delete",key:"delete",onclick:function(){t.del()}}));n.push(" ");n.push({svg:"cancel",label:"Cancel",key:"cancel",onclick:function(){t.cancel()}});this.options.editbuttons!=null&&(this.options.editbuttons.length==null?n.push(this.options.editbuttons):n=n.concat(this.options.editbuttons));this.dlg=this.options.usetabs?scil.Form.createTabDlgForm(this.options.formcaption,{tabs:this.options.fields,buttons:n,border:!0,onchange:this.options.onformdatachange}):scil.Form.createDlgForm(this.options.formcaption,this.options.fields,n,{alternativeforms:this.options.alternativeforms,hidelabel:this.options.hidelabel,oncreated:this.options.oncreateform,onchange:this.options.onformdatachange})}}});scil.apply(scil.Page.Table,{pushleft:!0,autohidecolumns:!1,toggleautohidecolumns:!0});scil.Page.Tree=scil.extend(scil._base,{constructor:function(n,t,i){var u=this,r,f;if(this.refreshneeded=!0,this.page=n,this.options=t==null?{}:t,this.receivers=[],this.ajaxurl=this.options.ajaxurl==null?"ajax.ashx?cmd=":this.options.ajaxurl,r=[],this.options.onrender==null&&(t.norefresh||r.push({svg:"refresh",title:"Refresh",onclick:function(){u.refresh()}}),this.options.fields!=null&&(r.push("-"),r.push({svg:"add",title:"New",onclick:function(){u.add()}}),r.push({svg:"edit",title:"Edit",onclick:function(){u.edit()}}))),this.options.buttons!=null&&(r=r.concat(this.options.buttons)),f=null,this.options.object!=null&&(f={dropdown:this.options.dropdown,url:this.ajaxurl+this.options.object+".tree",icongap:"3px",key:this.options.key,translate:this.options.translate,onAddItem:this.options.onAddItem,onAfterAjaxCall:this.options.onAfterAjaxCall}),this.form=new scil.Page.ExplorerForm(i,this,{buttons:r,collapsedwidth:20}),this.form.host=this,this.options.onrender!=null)this.options.onrender(this.form.div,f);else this.tree=new scil.Tree(this.form.div,f),this.tree.onSelectItem=function(n){u.select(n)},this.tree.onExpandItem=function(n,t){if(u.options.onexpand!=null)return u.options.onexpand(n,t)},this.options.startrefresh!=!1&&this.refresh();this.form.main.style.padding=0;scil.Page.setBorder(this.form)},show:function(){this.form.show()},hide:function(){this.form.hide()},select:function(n){if(this.options.onselectitem==null||!this.options.onselectitem(n)){var t={};this.options.onBuildArgs!=null?t=this.options.onBuildArgs(n):n!=null&&n.item!=null&&(scil.Utils.isNullOrEmpty(this.options.key)||n.item[this.options.key]!=null)&&(t=scil.clone(n.item));this.page.receiverRefresh(this,t)}},refresh:function(n){if(!this.form.isVisible()){this.refreshneeded=!0;return}if(this.tree!=null){if(n){this.tree.reloadCur();return}if(this.refreshneeded=!1,this.tree.clear(),this.options.root!=null)if(this.options.root.selectable==null&&(this.options.root.selectable=!1),this.options.root.showroot==!1&&this.options.root.children!=null)for(var t=0;t<this.options.root.children.length;++t)this.tree.cur=this.tree.add(null,this.options.root.children[t]);else this.tree.cur=this.tree.add(null,this.options.root);this.options.object!=null&&this.options.object!=""&&this.tree.reloadCur()}},applyArgs:function(n){this.args!=null&&scil.apply(n,this.args)},add:function(){if(this.create(),this.dlg.show(),this.options.onshowform!=null)this.options.onshowform(this.dlg);this.dlg.form.setData(this.options.defaultvalues==null?{}:this.options.defaultvalues)},edit:function(){var n,t;this.add();n={};n[this.options.key]=this.tree.cur==null||this.tree.cur.item==null?null:this.tree.cur.item[this.options.key];n[this.options.key]!=null&&(t=this,scil.Utils.ajax(this.ajaxurl+this.options.object+".load",function(n){if(t.options.onloaddata)t.options.onloaddata(n);t.dlg.form.setData(n)},n))},save:function(){var n=this,t=this.dlg.form.getData(),i;if(this.options.onbeforesave&&(i={},i[this.options.key]=this.tree.cur==null||this.tree.cur.item==null?null:this.tree.cur.item[this.options.key],this.options.onbeforesave(t,i)==!1))return!1;scil.Utils.ajax(this.ajaxurl+this.options.object+".save",function(){if(n.dlg.hide(),n.options.onSaved!=null)n.options.onSaved(n,t);else n.refresh(!0)},t)},del:function(){var n=this,t=this.dlg.form.getData();scil.Utils.ajax(this.ajaxurl+this.options.object+".del",function(){n.dlg.hide();n.refresh()},t)},create:function(){if(this.dlg==null){var n=this,t=[{svg:"save",label:"Save",onclick:function(){n.save()}},{svg:"del",label:"Delete",onclick:function(){n.del()}}];if(this.dlg=scil.Form.createDlgForm(this.options.formcaption,this.options.fields,t),this.options.oncreateform!=null)this.options.oncreateform(this.dlg.form)}}});scil.Page.Custom=scil.extend(scil._base,{constructor:function(n,t,i){var f=this,r,u,e;if(this.refreshneeded=!0,this.page=n,this.options=t,this.receivers=[],this.ajaxurl=this.options.ajaxurl==null?"ajax.ashx?cmd=":this.options.ajaxurl,r=[],t.norefresh==!1&&r.push({svg:"refresh",title:"Refresh",onclick:function(){f.refresh()}}),this.options.buttons!=null&&(r=r.concat(this.options.buttons)),scil.Utils.isNullOrEmpty(this.options.savequery)||(u=this.options.savequery,e=this.options.savehits,r.push({label:"Query",type:"a",items:[],onclick:function(n,t){scil.Page.ToolbarQuery.selectQuery(f,u,n,t)},onshowdropdown:function(n){return scil.Page.ToolbarQuery.onshowdropdown(u,n,e)}})),this.form=new scil.Page.ExplorerForm(i,this,{buttons:r}),this.form.host=this,this.options.oncreate!=null)this.options.oncreate(this.form.div,this.options)},show:function(){this.form.show()},hide:function(){this.form.hide()},refresh:function(n,t){if(t!=null&&(this.args=t),!this.form.isVisible()){this.refreshneeded=!0;return}this.refreshneeded=!1;var i=scil.Page.getFilterArgs(this);if(this.options.onrefresh!=null)this.options.onrefresh(n,i,this)},clear:function(){if(this.options.onclear!=null)this.options.onclear(this)}});scil.Page.Calendar=scil.extend(scil._base,{constructor:function(n,t,i){var r=this,f,e,o,u;this.refreshneeded=!0;this.page=n;this.options=t;this.receivers=[];this.ajaxurl=this.options.ajaxurl==null?"ajax.ashx?cmd=":this.options.ajaxurl;f=[];t.norefresh==!1&&f.push({svg:"refresh",title:"Refresh",onclick:function(){r.refresh()}});this.options.buttons!=null&&(f=f.concat(this.options.buttons));this.form=new scil.Page.ExplorerForm(i,this,{buttons:f});this.form.host=this;e=scil.Utils.createTable(this.form.div);e.parentNode.setAttribute("align","center");o=scil.Utils.createElement(scil.Utils.createElement(e,"tr"),"td");u=scil.clone(this.options);u.onNextYear=function(){r.refresh()};u.onNextMonth=function(){r.refresh()};u.onSetToday=function(){r.refresh()};u.onclick=function(n,t,i){if(t=="evt"&&r.options.onclickevent!=null)r.options.onclickevent(i)};u.ondblclick=function(n,t){if(t=="area"&&r.options.ondblclick!=null)r.options.ondblclick(n)};this.table=new scil.Calendar(o,u)},show:function(){this.form.show()},hide:function(){this.form.hide()},refresh:function(n,t){var i,r;if(t!=null&&(this.args=t),!this.form.isVisible()||!this.form.isExpanded()){this.refreshneeded=!0;return}if(!scil.Utils.isDictEmpty(this.args)){if(i=this,this.refreshneeded=!1,r=this.args,r==null&&(r={}),i.options.onbeforerefresh!=null)i.options.onbeforerefresh(r);this.page.receiverClear(this);scil.Utils.ajax(this.ajaxurl+this.options.object+".calendar",function(n){if(i.options.onsetdata!=null)i.options.onsetdata(i.table,n)},r)}},clear:function(){this.table.setEvents(null);this.page.receiverClear(this)}});scil.Page.Gantt=scil.extend(scil._base,{constructor:function(n,t,i){var u,r;scil.Page.Gantt.initLib();u=this;this.refreshneeded=!0;this.page=n;this.gantt=null;this.options=t==null?{}:t;this.receivers=[];this.ajaxurl=this.options.ajaxurl==null?"ajax.ashx?cmd=":this.options.ajaxurl;this.data=null;this.edit=!1;this.canedit=!1;this.options.height>0||(this.options.height=500);this.options.view==null&&(this.options.view="Year");this.options.colors==null&&(this.options.colors={alert:"red",delayed:"#F1AA3E",notstarted:"#AAA",closed:"#055F05",milestone:"red",task:"#08BCD2",project:"#78F79D"});this.options.keys==null&&(this.options.keys={});this.options.keys.taskid==null&&(this.options.keys.taskid="taskid");this.options.keys.projectid==null&&(this.options.keys.projectid="projectid");this.options.keys.starteddt==null&&(this.options.keys.starteddt="starteddt");this.options.keys.finisheddt==null&&(this.options.keys.finisheddt="finisheddt");this.options.keys.timeline==null&&(this.options.keys.timeline="timeline");this.options.keys.title==null&&(this.options.keys.title="title");r=[];t.norefresh!=!1&&(r.push({svg:"refresh",title:"Refresh",onclick:function(){u.refresh()}}),r.push("|"));r.push({type:"select",label:"Scale",items:scil.Page.Gantt.kScales,onchange:function(n){u.setScale((n.srcElement||n.target).value)}});this.options.buttons!=null&&(r=r.concat(this.options.buttons));this.form=new scil.Page.ExplorerForm(i,this,{buttons:r});this.form.host=this;this.ganttdiv=scil.Utils.createElement(this.form.div,"div");this.controldiv=scil.Utils.createElement(this.ganttdiv,"div");this.parentdiv=scil.Utils.createElement(this.ganttdiv,"div",null,{height:this.options.height})},show:function(){this.form.show()},hide:function(){this.form.hide()},refresh:function(n,t){if(t!=null&&(this.args=t),!this.form.isVisible()){this.refreshneeded=!0;return}this.refreshneeded=!1;this.edit=!1;this.reloadChart()},clear:function(){this.options.onclear!=null&&this.options.onclear();this.selecteddata=null;this.gantt!=null&&(this.gantt.destroy(),this.gantt=null)},reloadChart:function(n){if(this.clear(),!scil.Utils.isDictEmpty(this.args)){var t=this;t.projectid=null;scil.Utils.ajax(this.ajaxurl+this.options.object+".gantt",function(i){t.projectid=t.args.projectid;t.taskid=t.args.taskid;t.canedit=i.canedit;i.canedit||(t.edit=!1);t.renderChart(i,t.args.projectid);n!=null&&n()},this.args,{showprogress:!0})}},editChart:function(n){if(!this.canedit){scil.Utils.alert("You don't have privilege to edit it");return}this.edit=n;this.reloadChart()},saveChart:function(){var i={},r=[],o,n,u,f,e,t,s;this._collectData(r,i,this.data,{});for(o in i)if(n=i[o],u=this.parseConnections(n,i),u!=null)for(f=0;f<u.length;++f)e=u[f],t=e.source,n.taskid>0&&t.taskid>0?r.push({staskid:t.taskid,ttaskid:n.taskid,lag:e.lag}):n.taskid>0||t.taskid>0||r.push({sprojectid:t.projectid,tprojectid:n.projectid,lag:e.lag});s=this;scil.pmf.ajax("gantt.savetimeline",function(){s.editChart(!1)},{projectid:this.projectid,taskid:this.taskid,xml:scil.Table.rows2xml(r)},{showprogress:!0})},parseConnections:function(n,t){var r,u,i,f;if(scil.Utils.isNullOrEmpty(n.predecessor))return null;for(r=[],u=n.predecessor.split(","),i=0;i<u.length;++i)f=this.parseOneConnection(u[i],n,t),f!=null&&r.push(f);return r},parseOneConnection:function(n,t,i){var e,u,f,r,o;return/FS([+|-]?[0-9]+[d|D])?$/.test(n)?(e=null,u=n.indexOf("FS"),u>0&&(e=n.substr(u+2,n.length-3),n=n.substr(0,u)),f=parseInt(n),r=i[f],r==null)?null:(o=Math.round((this._getDate(t.start_date)-this._getDate(r.end_date))/864e5)-1,{sourceid:f,name:r.name,source:r,target:t,lag:o}):null},editConnections:function(){var t,i,n,r,u;if(this.selecteddata==null){scil.Utils.alert("Please select the parent Project or Task first");return}(t={},i=[],this._collectData(i,t,this.data,{}),n=this.parseConnections(this.selecteddata,t),n!=null&&n.length!=0)&&(this.connectionDlg==null&&(r={table:{type:"table",addrow:!1,columns:{sourceid:{type:"hidden"},name:{label:"Name",viewonly:!0,width:300},lag:{label:"Lag",type:"number",unit:"Day",width:80}}}},u=this,this.connectionDlg=scil.Form.createDlgForm("Edit Connections",r,{label:"Save",onclick:function(){u.editConnections2()}},{hidelabel:!0})),this.connectionDlg.show(),this.connectionDlg.form.setData({table:n}))},editConnections2:function(){for(var i,r=this.connectionDlg.form.fields.table.jsd.getData(),n=null,t=0;t<r.length;++t)n==null?n="":n+=",",i=parseInt(r[t].lag),isNaN(i)&&(i=0),n+=this._renderLag(r[t].sourceid,i);this.selecteddata.predecessor=n;this.connectionDlg.hide();this.redrawChart()},addTask:function(n){if(this.selecteddata==null){scil.Utils.alert("Please select the parent Project or Task first");return}var i=this,t=this.selecteddata,r={projectcode:t.projectid==null?null:"#"+t.projectid,parenttaskid:t.taskid,category:n};scil.pmf.Task.createTask(r,function(n){var r=n.rows[0],u;r.name="Task#"+r.taskid;u=i.makeTask(r,"taskid",scil.Page.Gantt.kMaxProjectID);t.children.push(u);i.gantt.addRecord(u,"child");t.taskid>0?i.selectTask(t.taskid+scil.Page.Gantt.kMaxProjectID):i.selectTask(t.projectid)})},editTask:function(){var n=this.selecteddata,t,i;if(n==null||!(n.taskid>0)){scil.Utils.alert("Please select the Task first");return}t=this;i={taskid:n.taskid};scil.pmf.Task.createTask(i,function(){t.reloadChart(function(){t.selectTask(n.taskid+scil.Page.Gantt.kMaxProjectID)})})},selectTask:function(n){for(var i=-1,r=this.gantt.model.updatedRecords,t=0;t<r.length;++t)if(r[t].item.id==n){i=t;break}i>=0&&(this.gantt.option("selectedRowIndex",i),this.gantt._$treegridHelper.ejTreeGrid("updateScrollBar"))},makeTask:function(n,t,i){var r=n;if(r.id=i+r[t],r.children=[],r.milestone=n.category=="Milestone",r.start_date=n[this.options.keys.starteddt]==null?n.created:n[this.options.keys.starteddt],r.end_date=n.timeline,r.milestone?r.end_date=r.start_date:r.end_date==null&&(r.end_date=r.start_date),!r.milestone&&r.end_date-r.start_date<scil.Page.Gantt.kOneDayTicks&&(r.end_date=r.start_date+scil.Page.Gantt.kOneDayTicks),n[this.options.keys.finisheddt]>0&&n[this.options.keys.finisheddt]<this.today&&(r.progress=100),r.finisheddate=scil.Utils.dateStr(n[this.options.keys.finisheddt],!0,"yyyy-mm-dd"),r.state=r.status==null?"":r.status,r.title=this.options.onrendertitle!=null?this.options.onrendertitle(n,r):n.title,this.options.onmaketask!=null)this.options.onmaketask(r,n);return r},setScale:function(n){if(this.options.view!=n){this.options.view=n;switch(this.options.view){case"Day":this.gantt.model.scheduleHeaderSettings.timescaleUnitSize="100%";this.gantt.model.scheduleHeaderSettings.scheduleHeaderType=ej.Gantt.ScheduleHeaderType.Day;this.gantt.reRenderChart(ej.Gantt.ScheduleHeaderType.Day);break;case"Week":this.gantt.model.scheduleHeaderSettings.timescaleUnitSize="100%";this.gantt.model.scheduleHeaderSettings.scheduleHeaderType=ej.Gantt.ScheduleHeaderType.Week;this.gantt.reRenderChart(ej.Gantt.ScheduleHeaderType.Week);break;case"Month":this.gantt.model.scheduleHeaderSettings.timescaleUnitSize="100%";this.gantt.model.scheduleHeaderSettings.weekHeaderFormat="M/dd";this.gantt.model.scheduleHeaderSettings.scheduleHeaderType=ej.Gantt.ScheduleHeaderType.Month;this.gantt.reRenderChart(ej.Gantt.ScheduleHeaderType.Month);break;default:this.gantt.model.scheduleHeaderSettings.timescaleUnitSize=scil.Page.Gantt.kYearWidth;this.gantt.model.scheduleHeaderSettings.scheduleHeaderType=ej.Gantt.ScheduleHeaderType.Year;this.gantt.reRenderChart(ej.Gantt.ScheduleHeaderType.Year)}this.gantt=$("#"+this.parentdiv.id).data("ejGantt")}},_renderLag:function(n,t){return n+"FS"+(t!=0?(t>0?"+"+t:t)+"d":"")},renderChart:function(n){var s,r,t,l,i,h,c,u;if(this.clear(),s=0,r={},n.projects!=null)for(t=0;t<n.projects.items.length;++t)i=this.makeTask(n.projects.items[t],this.options.keys.projectid,0),i.pos=++s,r[i.id]=i;if(n.tasks!=null)for(t=0;t<n.tasks.items.length;++t)i=this.makeTask(n.tasks.items[t],this.options.keys.taskid,scil.Page.Gantt.kMaxProjectID),i.pos=++s,r[i.id]=i;if(n.projects!=null&&n.projects.relationships!=null)for(t=0;t<n.projects.relationships.length;++t){var e=n.projects.relationships[t],o=r[e.dependingon],f=r[e.projectid];o!=null&&dest!=null&&(f.predecessor==null?f.predecessor=o.id+"FS":f.predecessor+=","+o.id+"FS")}if(n.tasks!=null&&n.tasks.relationships!=null)for(t=0;t<n.tasks.relationships.length;++t){var e=n.tasks.relationships[t],o=r[scil.Page.Gantt.kMaxProjectID+e.dependingon],f=r[scil.Page.Gantt.kMaxProjectID+e.taskid];o!=null&&f!=null&&(f.predecessor==null?f.predecessor=this._renderLag(o.id,e.lag):f.predecessor+=","+this._renderLag(o.id,e.lag))}this.data=[];for(l in r)i=r[l],h=r[i.parentid],h!=null?h.children.push(i):this.data.push(i);this._sortPos(this.data);var v=this.getTooltipTemplate(),y=scil.Utils.dateStr(scil.Utils.time(),!0,"yyyy-mm-dd"),a={};a._ganttDateFormatter=function(n){var t=this.data[n];return t?ej.format(t,"yyyy-MM-dd"):""};$.views.helpers(a);u=this;c={dataSource:this.data,allowSelection:!0,allowColumnResize:!0,taskIdMapping:"id",taskNameMapping:"name",startDateMapping:"start_date",endDateMapping:"end_date",progressMapping:"progress",milestoneMapping:"milestone",childMapping:"children",treeColumnIndex:0,predecessorMapping:"predecessor",taskbarTooltipTemplate:v,allowGanttChartEditing:this.edit,allowDragAndDrop:this.edit,isResponsive:!0,stripLines:[{day:y,label:scil.Lang.res("Today"),lineStyle:"solid",lineColor:"orange",lineWidth:2}],scheduleHeaderSettings:{scheduleHeaderType:this.options.view.toLocaleLowerCase(),timescaleUnitSize:scil.Page.Gantt.kYearWidth},rowHeight:window.theme=="material"?48:window.theme=="office-365"?36:30,editSettings:{allowEditing:!1,allowAdding:!1,allowDeleting:!1,editMode:"cellEditing"},load:function(){u.onload(this)},rowSelected:function(n){u.selecteddata=n.data.item},queryTaskbarInfo:function(n){u.queryTaskbarInfo(n)},actionComplete:function(n){n.requestType=="validatePredecessor"&&n.predecessorValidation&&(n.predecessorValidation=n.predecessor.indexOf("FS")!=-1?!0:!1)}};scil.Lang.language=="cn"&&(c.locale="zh_CN");scil.Utils.isNullOrEmpty(this.parentdiv.id)&&(this.parentdiv.id="__scil_gantt"+ ++scil.Page.Gantt.__index);$("#"+this.parentdiv.id).ejGantt(c);this.gantt=$("#"+this.parentdiv.id).data("ejGantt");this.edit&&this.control==null&&(u=this,this.control=scil.Utils.createElement(this.controldiv,"div",null,{display:"none",padding:"5px",background:"yellow",border:"1px solid orange",borderBottom:"none",textAlign:"center"}),scil.Utils.createButton(this.control,{label:"Save",onclick:function(){u.saveChart(!0)}}),scil.Utils.createButton(this.control," "),scil.Utils.createButton(this.control,{label:"Cancel",onclick:function(){u.editChart(!1)}}),scil.Utils.createButton(this.control," "),scil.Utils.createButton(this.control,{label:"Edit Connections",onclick:function(){u.editConnections()}}));this.control!=null&&(this.control.style.display=this.edit?"":"none")},getTooltipTemplate:function(){return this.options.tooltipstemplate!=null?this.options.tooltipstemplate:"<table><tr><td colspan=2 style='padding:3px'><b>{{:taskName)}}<\/b><\/td><\/tr><tr><td style='padding:3px'><b>"+scil.Lang.res("Full Name")+":<\/b><\/td><td style='padding:3px'>{{:title)}}<\/td><\/tr><tr><td style='padding:3px'><b>"+scil.Lang.res("Owner")+":<\/b><\/td><td style='padding:3px'>{{:owner)}}<\/td><\/tr><tr><td style='padding:3px'><b>"+scil.Lang.res("Progress")+":<\/b><\/td><td style='padding:3px'>{{:progress)}}<\/td><\/tr><tr><td style='padding:3px'><b>"+scil.Lang.res("Start")+":<\/b><\/td><td style='padding:3px'>{{:~_ganttDateFormatter('startDate')}}<\/td><\/tr><tr><td style='padding:3px'><b>"+scil.Lang.res("Timeline")+":<\/b><\/td><td style='padding:3px'>{{:~_ganttDateFormatter('endDate')}}<\/td><\/tr><tr><td style='padding:3px'><b>"+scil.Lang.res("Status")+":<\/b><\/td><td style='padding:3px'>{{:state)}}<\/td><\/tr><tr><td style='padding:3px'><b>"+scil.Lang.res("Finished")+":<\/b><\/td><td style='padding:3px'>{{:finish}}<\/td><\/tr><\/table>"},onload:function(n){var t=n.getColumns(),i,r;if(t[0]=scil.clone(t[1]),t[0].headerText=scil.Lang.res("Project/Task"),t[0].width=100,t[1]=scil.clone(t[0]),t[1].field="title",t[1].mappingName="title",t[1].headerText=scil.Lang.res("Full Name"),t[1].width=150,t[2].headerText=scil.Lang.res("Start"),t[2].format="{0:yyyy-M-d}",t[2].width=80,t[3].headerText=scil.Lang.res("Timeline"),t[3].format="{0:yyyy-M-d}",t[3].width=80,t[4].field="progress",t[4].mappingName="progress",t[4].headerText=scil.Lang.res("Progress"),t[4].width=50,t[5]=scil.clone(t[4]),t[5].field="state",t[5].mappingName="state",t[5].headerText=scil.Lang.res("Status"),t[5].width=60,t[6].field="finish",t[6].mappingName="finisheddate",t[6].headerText=scil.Lang.res("Finished"),t[6].width=80,t[6].visible=!0,t[7]=scil.clone(t[0]),t[7].field="owner",t[7].mappingName="owner",t[7].headerText=scil.Lang.res("Owner"),t[7].width=80,t[7].visible=!0,this.options.columns!=null)for(i=0;i<this.options.columns.length;++i)r=this.options.columns[i],t[i]!=null&&r!=null&&scil.apply(t[i],r);if(this.options.onsetcolumns!=null)this.options.onsetcolumns(t)},queryTaskbarInfo:function(n){var t=n.data.item;t.taskid>0?t.milestone?(n.milestoneBackground=this.options.colors.milestone,t.status=="Closed"&&(n.milestoneBackground="green")):n.taskbarBackground=this.options.colors.task:n.taskbarBackground=this.options.colors.project;t.color!=null&&(n.taskbarBackground=t.color);n.progressbarBackground=t.progresscolor!=null?t.progresscolor:"green";n.parentTaskbarBackground=n.taskbarBackground;n.parentProgressbarBackground=n.progressbarBackground},_collectData:function(n,t,i,r){var f,u;if(i!=null&&i.length!=0)for(f=0;f<i.length;++f)u=i[f],u.taskid>0&&r.projectid>0&&(u.projectid=r.projectid),t[u.id]=u,n.push({projectid:u.projectid,taskid:u.taskid,parentprojectid:r.projectid,parenttaskid:r.taskid,starteddt:this._getTime(u.start_date),timeline:this._getTime(u.end_date),progress:u.progress}),this._collectData(n,t,u.children,u)},_sortPos:function(n){if(n!=null&&n.length!=0){n.sort(function(n,t){return n.pos<t.pos?-1:1});for(var t=0;t<n.length;++t)this._sortPos(n[t].children)}},_getTime:function(n){return typeof n=="number"?n:typeof n=="object"?n.getTime():n},_getDate:function(n){var i=this._getTime(n),t=new Date(i);return new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()},convertToLocalTime:function(n){return n},updateProgress:function(){var n,t,i;if(this.selecteddata==null){scil.Utils.alert("Please select the parent Project or Task first");return}n=this.selecteddata;this.esttimelineDlg==null&&(t=this,i={estimatedtimeline:{label:"Estimated Timeline",type:"date"},progress:{label:"Progress",type:"number",unit:"%"},note:{label:"Note",type:"textarea",width:600,height:50}},this.esttimelineDlg=scil.Form.createDlgForm("Update Progress",i,{label:"Save",onclick:function(){t.updateProgress2()}}));this.esttimelineDlg.item=n;this.esttimelineDlg.show();this.esttimelineDlg.form.setData(n)},updateProgress2:function(){var i=this,t=this.esttimelineDlg.form.getData(),n=this.esttimelineDlg.item;this.esttimelineDlg.hide();n.taskid>0?(t.taskid=n.taskid,scil.pmf.ajax("task.setprogress",function(t){i.updateProgress3(t,n)},t,{showprogress:!0})):n.projectid>0&&(t.projectid=n.projectid,scil.pmf.ajax("project.setprogress",function(t){i.updateProgress3(t,n)},t,{showprogress:!0}))},updateProgress3:function(n,t){t.starteddt=n.starteddt;t.estimatedtimeline=n.estimatedtimeline;t.progress=n.progress;this.redrawChart()},redrawChart:function(){this.gantt.reRenderChart();this.gantt=$("#"+this.parentdiv.id).data("ejGantt")},finish:function(){var n,t,i;if(this.selecteddata==null){scil.Utils.alert("Please select the parent Project or Task first");return}n=this.selecteddata;this.finishDlg==null&&(t=this,i={starteddt:{label:"Started Date",type:"date"},finisheddt:{label:"Finished Date",type:"date"},note:{label:"Note",type:"textarea",width:600,height:50}},this.finishDlg=scil.Form.createDlgForm("Finish",i,{label:"Save",onclick:function(){t.finish2()}}));this.finishDlg.item=n;this.finishDlg.show();this.finishDlg.form.setData({starteddt:n.start_date,finisheddt:(new Date).getTime()})},finish2:function(){var n=this.finishDlg.item,t=this.finishDlg.form.getData();this.finishDlg.hide();this.finish3(n,t)},finish3:function(n,t){var i=this;n.taskid>0?(t.taskid=n.taskid,scil.pmf.ajax("task.finish",function(t){i.finish4(t,n)},t,{showprogress:!0})):task.projectid>0&&(t.projectid=n.projectid,scil.pmf.ajax("project.finish",function(t){i.finish4(t,n)},t,{showprogress:!0}))},finish4:function(n,t){t.status=n.status;t.start_date=n.starteddt;t.end_date=n.finisheddt}});scil.apply(scil.Page.Gantt,{__index:0,kYearWidth:"70%",kMaxProjectID:1e9,kOneDayTicks:864e5,kScales:["Day","Week","Month","Year"],__initialized:!1,initLib:function(){this.__initialized||(this.__initialized=!0,typeof ej!="undefined"&&ej.addCulture("zh_CN",{name:"zh-CN",englishName:"Chinese (Simplified, China)",nativeName:"中文(中华人民共和国)",language:"zh-CHS",numberFormat:{pattern:["-n"],",":",",".":".",groupSizes:[3],NaN:"非数字",negativeInfinity:"负无穷大",positiveInfinity:"正无穷大",percent:{pattern:["-n%","n%"],groupSizes:[3],",":",",".":".",symbol:"%"},currency:{pattern:["$-n","$n"],groupSizes:[3],",":",",".":".",symbol:"¥"}},calendars:{standard:{firstDay:1,days:{names:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],namesAbbr:["日","一","二","三","四","五","六"],namesShort:["日","一","二","三","四","五","六"]},months:{names:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月",""],namesAbbr:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月",""]},AM:["上午","上午","上午"],PM:["下午","下午","下午"],patterns:{d:"yyyy/M/d",D:"yyyy'年'M'月'd'日'",t:"H:mm",T:"H:mm:ss",f:"yyyy'年'M'月'd'日' H:mm",F:"yyyy'年'M'月'd'日' H:mm:ss",M:"M'月'd'日'",Y:"yyyy'年'M'月'"}}}}))}});scil.Page.MyTable={searchers:{},searcher:null,querydata:null,formdata:null,oninit:null,kStructureSearchTypes:{"":"",full:"Full-Structure",sub:"Substructure",sim90:"Similarity - 90%",sim80:"Similarity - 80%",sim70:"Similarity - 70%"},kChartTypes:{"":"",clusteredcolumn:"Clustered Column",column:"Column",stackedcolumn:"Stacked Column",line:"Line",stackedline:"Stacked Line",area:"Area",stackedarea:"Stacked Area",pie:"Pie",scatter:"Scatter Plot",bubble:"Bubble"},init:function(n,t,i){var r,u,f;typeof t=="string"&&(t={table:t});t==null&&(t={});r=null;(typeof i=="number"||typeof i=="string")&&(r=i);u=this;this.querydata=t==null?{}:t;this.formdata=i;f=this.querydata.table;this.callDef(f,this.querydata.category,function(t){u.init2(n,t,u.querydata.id,f,r)})},init2:function(n,t,i,r,u){var e,f,o;if(t.accessdenied){typeof n=="string"&&(n=scil.byId(n));scil.Utils.createElement(n,"div","Access Denied",{color:"red"});return}if(scil.Utils.isNullOrEmpty(u)||(this.querydata[t.key]=u),this.oninit!=null)this.oninit(t,i,r);if(t.submitformonly){e=this;f=new scil.Form({viewonly:!1});f.render(n,t.fields,{buttons:{label:"Submit",onclick:function(){e.submitform(t,f)}}});typeof this.querydata.defaultvalues=="string"&&(this.querydata.defaultvalues=scil.Utils.eval(this.querydata.defaultvalues));this.querydata.defaultvalues!=null&&f.setData(this.querydata.defaultvalues);return}this.page=new scil.Page(n,t.tree,{resizable:t.resizable,leftwidth:t.leftwidth>0?t.leftwidth:320});t.mainlist!=!1&&(this.list=this.page.addForm(this.getOptions(t),this.page.tree));this.tabs=this.addTabs(t,this.list);o=scil.clone(this.querydata);this.list.refresh(null,o,t.selectfirstrow!=!1)},addTabs:function(n,t){var i=n==null?null:n.tabs,r,u;if(i!=null&&i.length!=0){for(pagetabs=this.page.addTabs({trackhistory:n.tracktabhistory}),r=0;r<i.length;++r)if(i[r].call)if(typeof i[r].call=="string")switch(i[r].call){case"chart":this.addChart(pagetabs,t,key,n.charting);break;case"workflow":this.addWorkflow(pagetabs,t,key);break;case"log":this.addLog(pagetabs,t,key,n.key)}else typeof(i[r].call=="function")&&i[r].call(pagetabs,t);else u=this,this.callDef2(i[r],function(n){var i=pagetabs.addForm(u.getOptions(n),t);u.addTabs(n,i)});return pagetabs}},submitform:function(n,t){if(t.checkRequiredFields()>0){scil.Message.show("Some required fields are not filled yet","warning",2e3);return}scil.Utils.ajax("ajax.ashx?cmd="+n.object+".submitform.save",function(){if(n.onsubmitform!=null)n.onsubmitform(t,n);else scil.Message.show("Data saved","succeed",3e3),t.setData({})},t.getData())},hasValue:function(n,t){if(n==null)return!1;if(scil.Utils.isNullOrEmpty(n[t]))return!0;var i=scil.Form.xml2Json(n.__advanced);return i!=null&&scil.Utils.isNullOrEmpty(i[t])},addForm:function(n,t,i,r,u){var f=this,e=i==null?null:new scil.Page.MyTable.Receiver(i);this.callDef(t,r,function(t){if(t!=null&&(t.oninit==null||t.oninit(t,f)!="stop")){var i=n.addForm(f.getOptions(t),null);e!=null&&e.setForm(i);u!=null&&u(i)}})},addWorkflow:function(n,t){var i=this;this.sql=n.addForm({caption:"Workflow",type:"custom",oncreate:function(n){i.workflowparent=n},onrefresh:function(n,t){scil.Workflow.Request.clear(i.workflowparent);t.requestid!=null&&scil.Workflow.Request.init(i.workflowparent,null,t.requestid)}},t)},addChart:function(n,t,i,r){var u=r.buttons,e,f;u==null&&(u=[]);u.push("|");u.push({key:"by",label:"Chart-By",type:"select",items:r.byitems});u.push({key:"groupby",label:"Time-By",type:"select",items:["","week","month","quarter","year"]});u.push({key:"charttype",label:"Chart Type",type:"select",items:this.kChartTypes});e=this;f={cmd:"mytable."+i+".chart",title:"Chart"};f.stats=n.addForm({caption:"Chart",object:"mytable."+i+".chart",type:"custom",norefresh:!1,buttons:u,onrefresh:function(n,t){e.refreshChart(f,t)}},t)},refreshChart:function(n,t){var i=n.stats.form.div,r;(scil.Utils.removeAll(i),scil.Utils.isNullOrEmpty(t.by)||scil.Utils.isNullOrEmpty(t.charttype))||(r=scil.Utils.createElement(i,"div"),new scil.Chart(r,{type:t.charttype,legend:!0,animate:!0,width:800,height:300,ymin:0,title:n.title,ajax:{url:"Ajax.ashx?cmd="+n.cmd,data:t}}))},addLog:function(n,t,i,r){this.sql=n.addForm({caption:"Log",object:"mytable."+i+".log",onbeforerefresh:function(n){n!=null&&(n.dataid=n[r])},columns:{logid:{label:"Log ID"},dataid:{label:"Data ID"},action:{label:"Action"},note:{label:"Note"},author:{label:"Author"},dt:{label:"Date",type:"date"}}},t)},callDef:function(n,t,i,r){var f="",u,e;scil.Utils.endswith(n,"$")&&(f=".submitform",n=n.substr(0,n.length-1));u=this.querydata==null?{}:scil.clone(this.querydata);u.category=t;r==null&&(r="ajax.ashx?cmd=");e=this;scil.Utils.ajax(r+"mytable."+n+".def"+f,function(n){e.callDef2(n,i)},u)},callDef2:function(n,t){if(n!=null&&n!=""){if(n.customjs!=null)try{eval(n.customjs)}catch(i){scil.Utils.alert("Error on Custom JS: "+i.message)}(n.oninit==null||n.oninit(n,this)!="stop")&&t(n)}},refresh:function(n){this.list!=null?this.list.refresh(null,n):this.searcher!=null&&this.searcher.refresh(n)},getOptions:function(n){return n.columns!=null&&n.columns[n.key]!=null&&(n.columns[n.key].iskey=!0),n},showSearch:function(n,t,i){if(this.searcher=this.searchers[n],this.searcher!=null){this.searcher.show(t);return}var r=this;ajaxurl=i==null?null:i.ajaxurl;this.callDef(n,null,function(u){r.search2(n,u,i,t)},ajaxurl)},search:function(n,t,i){if(this.searcher=this.searchers[n],this.searcher!=null){this.searcher.show(t);return}var r=this;scil.Utils.ajax(n,function(u){r.search2(n,u,i,t)})},search2:function(n,t,i,r){var u=this.getOptions(t);i!=null&&scil.apply(u,i);this.searcher=new scil.Page.Search(u);this.searchers[n]=this.searcher;this.searcher.show(r)},popupJSDraw:function(n,t){var r=this,t=t==null?this.list:t,i=t.options.buttons;JSDraw2.Editor.showPopup("Draw Query","Done",function(r){scil.Form.setButtonValueByKey(i,n,r.getSmiles());t.refresh(null,null,null,null,!0)})},showStructureSearch:function(n,t){if(this.ssDlg==null){var i=this,r={m:{label:"Structure",type:"jsdraw",width:800,height:300},t:{label:"Search Type",type:"select",items:this.kStructureSearchTypes}};this.ssDlg=scil.Form.createFormDlg("Structure Search",r,{label:"Search",onclick:function(){i.structureSearch()}})}this.ssDlg._button=n;this.ssDlg.show();scil.Utils.getParent(this.ssDlg.form.fields.t,"TR").style.display=t=="All"?"":"none"},structureSearch:function(){var t=this.ssDlg._button.key,n=this.ssDlg._button.form,i=n.options.buttons;scil.Form.setButtonValueByKey(i,t,this.ssDlg.form.getXml());this.ssDlg.hide();n.refresh(null,null,null,null,!0)}};scil.Page.MyTable.Receiver=scil.extend(scil._base,{constructor:function(n){this.form=null;this.cache=null;n.receivers.push(this)},setForm:function(n){this.form=n;this.cache!=null&&(this.form.refresh(this.cache.from,this.cache.args),this.cache=null)},refresh:function(n,t){this.form!=null?this.form.refresh(n,t):this.cache={from:n,args:t}},clear:function(){this.form!=null&&this.form.clear()}});scil.mytable={};scil.Page.MyTableBuilder={kCategories:["","System","Standard","Customization","Test"],kDataTypes:["","Text","Float","Long","Bool","Date","[user]","[created date]","[date]","[author]","[reference]","[tab]"],kDisplayTypes:["","input","number","checkbox","date","file","image","select","textarea","htmltext","html","table","jsdraw","jsdraw.se","jsdraw.table","signature","dropdowninput","editableselect","multiselect"],kFilterTypes:["","input","number","date","select","multiselect","range","like","structure","helm"],kDisplays:["","Yes","No","Viewonly","Hidden"],kFilterDisplays:["","Yes","No","Hidden"],kFieldCategories:["","System","Standard","Customization"],kAggregates:{"":"","avg(?)":"Average","dbo.Median(?)":"Median","dbo.Mode(?)":"Mode","dbo.Range(?)":"Range","max(?)":"Max","min(?)":"Min","sum(?)":"Sum","count(?)":"Count","exp(avg(log(?)))":"Geometric Mean","dbo.Concat(?)":"List","dbo.ConcatDistinct(?)":"List Unique"},testCode:function(n){scil.Utils.ajax("ajax.ashx?cmd=mytable.mytablemanager.test",function(n){n.succeed?scil.Utils.alert("All good!"):scil.Utils.alert(n.error)},{tableid:n.args.tableid})},addAPIs:function(n,t){var i=this;this.sql=n.addForm({caption:"APIs",type:"custom",norefresh:!1,onrefresh:function(n,i,r){var o=t.table.getCurrentRowData(),f=scil.Utils.isNullOrEmpty(o.alias)?o.dbtable:o.alias,e=window.location+"",u;p=e.lastIndexOf("/");e=e.substr(0,p+1);def=e+"ajax.ashx?cmd=mytable."+f+".def";e+="MyTable="+f;u="";u+="URLs:\r\n";u+="---------------------\r\n";u+="   MyTable: <a target=_blank href='"+e+"'>"+e+"<\/a>\r\n";u+="   Definition: <a target=_blank href='"+def+"'>"+def+"<\/a>\r\n";u+="\r\n";u+="AJAX Commands:\r\n";u+="---------------------\r\n";u+="   - mytable."+f+".chart\r\n";u+="   - mytable."+f+".def\r\n";u+="   - mytable."+f+".del\r\n";u+="   - mytable."+f+".download\r\n";u+="   - mytable."+f+".import\r\n";u+="   - mytable."+f+".list\r\n";u+="   - mytable."+f+".listall\r\n";u+="   - mytable."+f+".load\r\n";u+="   - mytable."+f+".save\r\n";u+="   - mytable."+f+".update\r\n";u+="   - mytable."+f+".suggest\r\n";u+="\r\n";u+="Example AJAX Call:\r\n";u+="---------------------\r\n";u+="   scil.Utils.ajax('ajax.ashx?cmd=mytable."+f+".load', function (ret) {\r\n";u+="      alert(ret.projectcode); \r\n";u+="   }, {projectid: 122}\r\n";u+="\r\n";u+="Workflow Callback APIs:\r\n";u+="---------------------\r\n";u+="   - long SaveToMyTable(string mytablekey, string database, long primarykey)\r\n";u+="   - long SaveToMyTable(string mytablekey, string database, long primarykey, string key, object value)\r\n";u+="   - Database.Row ReadFromMyTable(string mytablekey, string database, long primarykey)\r\n";r.form.div.innerHTML="<pre>"+u+"<\/pre>"}},t)},addSQL:function(n,t){this.sql=n.addForm({caption:"SQL",type:"custom",norefresh:!1,onrefresh:function(n,t,i){scil.Utils.ajax("ajax.ashx?cmd=mytable.mytablemanager.getsql",function(n){i.form.div.innerHTML="<pre>"+n+"<\/pre>"},{tableid:t.tableid})}},t)},addCS:function(n,t){var i=this;n.addForm({caption:"MyTable C#",type:"custom",buttons:[{svg:"play",title:"Test Code",onclick:function(n,t){i.testCode(t.form)}}],norefresh:!1,onrefresh:function(n,t,i){scil.Utils.ajax("ajax.ashx?cmd=mytable.mytablemanager.getcs",function(n){i.form.div.innerHTML="<pre>"+n+"<\/pre>"},{tableid:t.tableid})}},t)},addJSDrawForm:function(n,t){var i=this;n.addForm({caption:"JSDraw Form",type:"custom",norefresh:!1,onrefresh:function(n,t,i){scil.Utils.ajax("ajax.ashx?cmd=mytable.mytablemanager.getjsform",function(n){i.form.div.innerHTML="<pre>"+n+"<\/pre>"},{tableid:t.tableid})}},t)},addCustomJS:function(n,t){var i=this;n.addForm({caption:"Custom JavaScript",type:"form",object:"mytable.mytablemanager.customjs",editable:!0,hidelabel:!0,fields:{tableid:{type:"hidden"},customjs:{label:"Code",type:"textarea",width:800,height:400,mode:"javascript",allowhtml:!0}}},t)},addCustomCode:function(n,t){var i=this;n.addForm({caption:"Custom C#",type:"form",object:"mytable.mytablemanager.customcode",editable:!0,hidelabel:!0,buttons:[{svg:"play",title:"Test Code",onclick:function(n,t){i.testCode(t.form)}},"-"],fields:{tableid:{type:"hidden"},fun:{label:"Override",type:"select",items:scil.Utils.getDictKeys(this.kOverrides),onchange:function(n,t){i.addOverride(t)}},customcode:{label:"Code",type:"textarea",width:800,height:400,mode:"c#",allowhtml:!0}}},t)},addOverride:function(n){var i=n.fields.fun.value,t=this.kOverrides[i];t!=null&&(n.fields.customcode.value+=t.replace(/[|]/g,"\r\n"))},importView:function(n){var i,r,t;this.importViewDlg==null&&(t=this,i="<br><a href='javascript:scil.Page.MyTableBuilder.testConnection()'>Test Connection<\/a>",i+=" (<a href='javascript:scil.Page.MyTableBuilder.exampleConnStr()'>Example Connection String<\/a>)",r={tableid:{type:"hidden"},dbtype:{label:"Database System",type:"select",items:["","sqlserver","oracle","mysql","postgreSql"]},connection:{label:"Connection String",width:800,str:i},db:{label:"Database/Schema",width:400},view:{label:"View/Table",width:400,required:!0,type:"dropdowninput",button:{svg:"refresh",title:"Refresh",onclick2:function(n,i){t.listViews(i)}}},load:{text:"Load Definition",type:"button",onclick:function(){t.loadView()}},fields:{label:"Select Fields",candel:!1,canadd:!1,type:"table",columns:{column_name:{label:"Field Name",viewonly:!0},data_type:{label:"Date Type",viewonly:!0},maxlen:{label:"Max Length",viewonly:!0},defaultvalue:{label:"Default Value",viewonly:!0},checked:{label:"Import",type:"checkbox"},list:{label:"List",type:"checkbox"},filter:{label:"Filter",type:"checkbox"},displaytype:{label:"Display Type",type:"select",items:this.kDisplayTypes},pk:{label:"Primary Key",type:"radio",attributes:{name:"pk"}}}}},t=this,this.importViewDlg=scil.Form.createDlgForm("Import DB View/Table",r,{label:"Import",onclick:function(){t.importView2()}}));this.importViewDlg.soureform=n;this.importViewDlg.show();this.importViewDlg.form.setData({tableid:n.args.tableid})},listViews:function(n){n.fields.view.value="";var t=n.getData();scil.Utils.ajax("ajax.ashx?cmd=mytable.mytablemanager.import.listviews",function(t){n.fields.view.jsd.setItems(t)},{dbtype:t.dbtype,connection:t.connection,view:t.view,db:t.db})},importView2:function(){var t=this,n=this.importViewDlg.soureform,i=this.importViewDlg.form.getData();scil.Utils.ajax("ajax.ashx?cmd=mytable.mytablemanager.import.view",function(i){i.rows!=null&&i.rows.length==1?n.table.addRow(i.rows[0]):n.refresh();t.importViewDlg.hide()},i)},loadView:function(){var n=this,i=this.importViewDlg.soureform,t=this.importViewDlg.form.getData();scil.Utils.ajax("ajax.ashx?cmd=mytable.mytablemanager.import.readviewdefinition",function(t){for(var i,r=0;r<t.length;++r)i=t[r],i.checked=!0,i.maxlen==-1?i.maxlen="max":(i.list=!0,i.filter=!0),scil.Utils.startswith(i.defaultvalue,"((")&&scil.Utils.endswith(i.defaultvalue,"))")?i.defaultvalue=i.defaultvalue.substr(2,i.defaultvalue.length-4):scil.Utils.startswith(i.defaultvalue,"(")&&scil.Utils.endswith(i.defaultvalue,")")&&(i.defaultvalue=i.defaultvalue.substr(1,i.defaultvalue.length-2));n.importViewDlg.form.fields.fields.jsd.setData(t)},t)},testConnection:function(){var n=this.importViewDlg.form.getData();scil.Utils.ajax("ajax.ashx?cmd=mytable.mytablemanager.import.testconnection",function(){scil.Utils.alert2("Connection is good!")},{dbtype:n.dbtype,connection:n.connection})},exampleConnStr:function(){var n="Example Connection Strings:<br>";n+="<br>SQL Server:<div style='background:#eee'>Data Source=(local);Initial Catalog=DATBASENAME;User Id=sa;Password=********<\/div>";n+="<br>Oracle: <div style='background:#eee'>Data Source=(DESCRIPTION=(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=192.168.1.1)(PORT=1521)))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=orcl)));User Id=USERNAME;Password=*******<\/div>";n+="<br>MySQL: <div style='background:#eee'>server=127.0.0.1;uid=username;pwd=********;database=db<\/div>";n+="<br>PostgreSQL: <div style='background:#eee'>Server=127.0.0.1;Port=5432;User Id=joe;Password=*********;Database=joedata<\/div>";scil.Utils.alert2(n)},showOnSave:function(n){n.value="delegate (UserDB db, long id, Database.Row r, Database.Row input, Field f)\r\n{\r\n  return true;\r\n}"},onEditField:function(n,t){var i=t.table.getRowDataByKey(n.fieldid);if(i.locked)return scil.Utils.alert("Locked item cannot be edited"),"stop"},changeFieldOrder:function(n){var t=this;scil.Utils.ajax("ajax.ashx?cmd=mytable.mytablebuilder.listcols",function(i){t.changeFieldOrder2(n,i)},{tableid:n.args.tableid})},changeFieldOrder2:function(n,t){if(this.orderDlg==null){var i=this;this.orderDlg=scil.Form.createDlgForm("Change Order",{list:{type:"table",viewonly:!0,draggable:!0,columns:{fieldid:{type:"hidden"},move:{label:"Move",type:"html",template:"<div style='cursor:move;background:url(img/reorder.gif) no-repeat center'>&nbsp;<\/div>"},label:{label:"Label"},dbkey:{label:"dbkey"},list:{label:"List"},edit:{label:"Edit"}}}},{label:"Save",onclick:function(){i.changeFieldOrder3(n)}},{hidelabel:!0})}this.orderDlg.show();this.orderDlg.form.setData({list:t})},changeFieldOrder3:function(n){for(var u=this,i="",r=this.orderDlg.form.fields.list.jsd.getData(),t=0;t<r.length;++t)i+=r[t].fieldid+",";scil.Utils.ajax("ajax.ashx?cmd=mytable.mytablebuilder.saveposition",function(){u.orderDlg.hide();n.refresh()},{tableid:n.args.tableid,fieldids:i})},kOverrides:{OnInit:"|protected override void OnInit()|{|}|",CheckPermision:"|protected override void CheckPermision(UserDB db, Action action)|{|    base.CheckPermision(db, action);|}|",GetListCols:"|protected override string GetListCols(Action action)|{|    return base.GetListCols(action);|}|",GetSortBy:"|protected override string GetSortBy(UserDB db, Database.Row args)|{|    return base.GetSortBy(db, args);|}|",ListSql:"|protected override string ListSql(UserDB db, long id, Database.Row args, Scilligence.MolEngine.Common.Pair<string, string> paging, Action action)|{|    return base.ListSql(db, id, args, paging, action);|}|",OnAfterSave:"|protected override void OnAfterSave(UserDB db, long id, Database.Row r, bool isnew)|{|    base.OnAfterSave(db, id, r, isnew);|}|",OnCustomCmd:"|protected override bool OnCustomCmd(UserDB db, string cmd, System.IO.TextWriter w, System.Collections.Specialized.NameValueCollection items, out bool ret)|{|    return base.OnCustomCmd(db, cmd, w, items, out ret);|}|",OnImportFile:"|protected override Database.Row[] OnImportFile(UploadedFile file, Database.Row args)|{|    return base.OnImportFile(file, args);|}|",OnSave:"|protected override bool OnSave(UserDB db, long id, Database.Row r)|{|    return base.OnSave(db, id, r);|}|",OnWriteDef:"|protected override void OnWriteDef(UserDB db, string category, bool mollist)|{|    base.OnWriteDef(db, category, mollist);|}|",SqlFilter:"|protected override string SqlFilter(UserDB db, Database.Row args)|{|    return base.SqlFilter(db, args);|}|",TreeSql:"|protected override string TreeSql(UserDB db)|{|    return base.TreeSql(db);|}|"}};scil.Page.MolList={fullscreen:!0,init:function(n,t,i,r){var u=this;this.object=t;scil.Utils.ajax("ajax.ashx?cmd=mytable."+t+".def",function(t){u.init2(n,t,i)},{category:r,mollist:!0})},init2:function(n,t,i){var e,r,u,f;if(t.oninit!=null)t.oninit(t,this);if(e=this.getOptions(t.tree,t),this.page=new scil.Page(n,e,{resizable:!0,leftwidth:t.leftwidth>0?t.leftwidth:320}),r=t.tabs,r!=null&&r.length>0)for(this.tabs=this.page.addTabs(),u=0;u<r.length;++u)this.tabs.addForm(this.getOptions(r[u],t),this.page.table);else this.page.addForm(this.getOptions(t.details,t),this.page.table);scil.Page.MyTable.list=this.page.table;f=null;i!=null&&(f[t.key]=i);this.page.table.refresh(null,f,!0);t.fullscreen!=null&&(this.fullscreen=t.fullscreen);this.fullscreen&&this.page.fillscreen()},refresh:function(n){this.page.table!=null&&this.page.table.refresh(null,n)},getOptions:function(n,t){return n.columns!=null&&n.columns[n.key]!=null&&(n.columns[n.key].iskey=!0),t!=null&&(n.object==null&&(n.object=t.object),n.key==null&&(n.key=t.key),n.caption==null&&(n.caption=t.caption),n.filterrow==null&&(n.filterrow=t.filterrow),n.sortby="all"),n}};scil.Page.Search=scil.extend(scil._base,{constructor:function(n){this.dlg=null;this.callback=null;this.options=n;var t=scil.Utils.createElement(null,"div");this.dlg=new scil.Dialog("",t);this.dlg.show("Search "+(n.caption||n.formcaption));this.init(this.dlg,n)},show:function(n,t){this.dlg.show(t);this.callback=n;this.list.refresh()},init:function(n,t){var i=this;scil.apply(this.options,{issearch:!0,pushleft:!1,onsearchselect:function(n){i.onsearchselect(n)},onrefreshed:function(){i.onrefreshed()}});this.page=new scil.Page(n,null);this.list=this.page.addForm(t,null);this.list.refresh()},refresh:function(n){this.list.refresh(null,n)},onsearchselect:function(n){(this.callback==null||this.callback(n)!="cancel")&&this.dlg.hide()},onrefreshed:function(){this.dlg==null||this.moved||(this.moved=!0,this.dlg.moveCenter())}});scil.Page.Html=scil.extend(scil._base,{constructor:function(n,t,i){var u=this,r;this.refreshneeded=!0;this.page=n;this.options=t;this.receivers=[];this.ajaxurl=this.options.ajaxurl==null?"ajax.ashx?cmd=":this.options.ajaxurl;r=[];t.norefresh==!1&&r.push({svg:"refresh",title:"Refresh",onclick:function(){u.refresh()}});this.options.buttons!=null&&(r=r.concat(this.options.buttons));this.form=new scil.Page.ExplorerForm(i,this,{buttons:r});this.form.host=this},show:function(){this.form.show()},hide:function(){this.form.hide()},refresh:function(n,t){var r,i;if(t!=null&&(this.args=t),!this.form.isVisible()||!this.form.isExpanded()){this.refreshneeded=!0;return}if(!scil.Utils.isDictEmpty(this.args)){if(this.form.div.innerHTML="",r=this,this.refreshneeded=!1,i=this.args,i==null&&(i={}),r.options.onbeforerefresh!=null)r.options.onbeforerefresh(i);scil.Utils.ajax(this.ajaxurl+this.options.object+".load",function(n){var t=null;t=typeof n=="string"?n:n.html;r.form.div.innerHTML=t==null?null:t},i)}},clear:function(){this.form.div.innerHTML=""}});scil.Page.Query=scil.extend(scil._base,{constructor:function(){},show:function(n){this.button=n;this.create(this.button.fields);this.dlg.show();var t=this.button.key,i=this.button.form,r=i.options.buttons,u=scil.Form.getButtonValueByKey(r,t);this.dlg.form.setXml(u)},create:function(n){var i,t,u,r;this.dlg==null&&(i=this,t=[{label:"Search",onclick:function(){i.search()}}],this.button.savequery!=null&&(t.push(" "),u=this.button.form,r=this.button.savequery,t.push({label:"Query",items:[],onclick:function(n,t){scil.Page.ToolbarQuery.selectQuery(u,r,n,t,i)},onshowdropdown:function(n){return scil.Page.ToolbarQuery.onshowdropdown(r,n)}})),this.dlg=scil.Form.createDlgForm("Advanced Query",n,t))},search:function(){var t=this.button.key,n=this.button.form,i=n.options.buttons;scil.Form.setButtonValueByKey(i,t,this.dlg.form.getXml());this.dlg.hide();n.refresh()},clear:function(){this.dlg.form.clear()},getQueryValues:function(){return this.dlg.form.getData()},setQueryValues:function(n){return this.dlg.form.setData(n)}});scil.apply(scil.Page.Query,{queries:{},show:function(n){var t=this.queries[n.queryid];t==null&&(t=new scil.Page.Query,this.queries[n.queryid]=t);t.show(n)}});scil.Page.ToolbarQuery={onshowdropdown:function(n,t,i){if(!(t.options.items.length>0))return scil.Utils.ajax("ajax.ashx?cmd=mytable.toolbarquery.list",function(n){var r=[],u;if(r.push({label:"Save Query",key:"[savequery]"}),i&&r.push({label:"Save Hits",key:"[savehits]"}),r.push({label:"Clear Values",key:"[clear]"}),n.rows!=null&&n.rows.length>0)for(r.push({label:"Manage Queries",key:"[manage]"}),r.push("-"),u=0;u<n.rows.length;++u)r.push({label:n.rows[u].name,key:n.rows[u].queryid});t.resetItems(r);t.show2()},{place:n}),"cancel"},selectQuery:function(n,t,i,r,u){var f=this;i=="[savequery]"&&this.saveQuery(n,t,r,u);i=="[savehits]"?this.saveHits(n,t,r,u):i=="[clear]"?(this.setQueryValues(n),u!=null&&u.clear(),n.refresh()):i=="[manage]"?this.showDlg(t,r):scil.Utils.ajax("ajax.ashx?cmd=mytable.toolbarquery.load",function(t){var i=scil.Utils.eval(t.data);i!=null&&i.length>0?(f.setQueryValues(n,{},u),n.refresh(null,{_keys:scil.Utils.array2str(i)})):(f.setQueryValues(n,i,u),n.refresh())},{queryid:i})},saveQuery:function(n,t,i,r){var u=this.getQueryValues(n,r),f=scil.Utils.json2str(u);scil.Utils.prompt2({caption:"Save Query",message:"Please enter a name for this query",autosuggesturl:"ajax.ashx?cmd=mytable.toolbarquery.suggestname&place="+escape(t),callback:function(n){scil.Utils.ajax("ajax.ashx?cmd=mytable.toolbarquery.save",function(){i.jsd.resetItems([])},{name:n,data:f,place:t})}})},saveHits:function(n,t,i){var r=n.table.getCheckedKeys(),u;if(r==null||r.length==0){scil.Message.show("No items selected/checked.","warning");return}u=scil.Utils.json2str(r);scil.Utils.prompt2({caption:"Save Query",message:"Please enter a name for the hit list",autosuggesturl:"ajax.ashx?cmd=mytable.toolbarquery.suggestname&place="+escape(t),callback:function(n){scil.Utils.ajax("ajax.ashx?cmd=mytable.toolbarquery.save",function(){i.jsd.resetItems([])},{name:n,data:u,place:t})}})},getQueryValues:function(n,t){var i,f,e,r,u;if(t!=null)return t.getQueryValues();if(i=n.options.buttons,i==null)return null;for(f=[],e={},r=0;r<i.length;++r)u=i[r],u==null||scil.Utils.isNullOrEmpty(u.key)||f.push(u.key);return scil.Form.getButtonValuesByKey(i,f,e),e},setQueryValues:function(n,t,i){var r,f,u;if(i!=null&&i.setQueryValues(t),r=n.options.buttons,r!=null)for(t==null&&(t={}),f=0;f<r.length;++f)u=r[f],u==null||scil.Utils.isNullOrEmpty(u.key)||scil.Form.setButtonValueByKey(r,u.key,t[u.key])},showDlg:function(n,t){var i=this;this.button=t;scil.Utils.ajax("ajax.ashx?cmd=mytable.toolbarquery.list",function(n){i.showDlg2(n.rows)},{place:n})},showDlg2:function(n){if(this.dlg==null){var t=this;this.dlg=scil.Form.createDlgForm("Manage Queryies",{table:{type:"table",viewonly:!0,rowcheck:!0,columns:{queryid:{label:"QueryID",width:100,iskey:!0},name:{label:"Name",width:300}}}},{label:"Delete Selected",onclick:function(){t.delSelected()}},{hidelabel:!0})}this.dlg.show();this.dlg.form.setData({table:n})},delSelected:function(){var n=this,t=this.dlg.form.fields.table.jsd.getCheckedKeys();scil.Utils.ajax("ajax.ashx?cmd=mytable.toolbarquery.delmany",function(){n.button.jsd.resetItems([]);n.dlg.hide()},{_keys:scil.Utils.array2str(t)})}};scil.Page.BulkUpdate=scil.extend(scil._base,{constructor:function(n,t){this.options=t==null?{}:t;this.create(n)},load:function(n){var i=this,t={};t[this.options.key]=scil.Utils.array2str(n,",");scil.Utils.ajax(this.options.ajaxurl+".bulkload",function(n){i.jss.setJson(n)},t,{showprogress:!0})},save:function(n){var t=this,i=this.jss.getXml();scil.Utils.ajax(this.options.ajaxurl+".bulkupdate",function(){t.options.onsaved!=null&&t.options.onsaved();n!=null&&n()},{xml:i},{showprogress:!0})},create:function(n){this.jss==null&&(typeof n=="string"&&(n=scil.byId(n)),this.jss=new JSDraw2.Table(null,this.options,n))},destroy:function(){this.jss.destroy();this.jss=null}});scil.apply(scil.Page.BulkUpdate,{dlg:null,editor:null,show:function(n,t){var i=scil.Utils.createElement(null,"div"),f=scil.Utils.createElement(i,"div"),u=scil.Utils.createElement(i,"div",null,{textAlign:"center",marginTop:"15px"}),r=this;return this.dlg=new scilligence.Dialog("Bulk Edit",i),this.dlg.show(),scil.Utils.createButton(u,{label:"Save",onclick:function(){r.editor.save(function(){r.dlg.hide()})}}),scil.Utils.createButton(u,{label:"Cancel",onclick:function(){r.dlg.hide()}}),this.editor!=null&&this.editor.destroy(),this.editor=new scil.Page.BulkUpdate(f,n),this.editor.load(t),this.dlg.moveCenter(),this.dlg}});scil.History={disabled:!1,state:null,append:function(n,t,i){if(!this.disabled&&history!=null){var r=history.state==null?{}:history.state;r[n]=t;history.pushState(r,null,i==null?"":i)}},update:function(n,t,i){if(!this.disabled&&history!=null){var r=history.state==null?{}:history.state;r[n]=t;history.replaceState(r,null,i==null?"":i)}},get:function(n){return this.disabled||history==null||history.state==null?null:history.state[n]}};scil.connect(window,"onpopstate",function(n){scil.History.state=n.state});scil.card={Factory:{}};scil.card.Board=scil.extend(scil._base,{constructor:function(n,t){this.cards={};this.options=t==null?{}:t;var i=typeof n=="string"?scil.byId(n):n;this.parent=scil.Utils.createElement(i,"div",null,{position:"relative"});this.render()},render:function(){for(var n in this.options.cards)this.add(n,this.options.cards[n],this.options.viewonly,this.options.color)},getData:function(){var i={},n,t;for(n in this.options.cards)t=this.cards[n],t!=null&&(i[n]=t.getData());return i},add:function(n,t,i,r){t.viewonly=i;t.color=r;this.cards[n]=scil.card.Card.create(this,t)},clear:function(){this.load(null)},load:function(n){var t,i;n==null&&(n=this.makeData());for(t in this.cards)i=this.options.sources==null?null:this.options.sources[t],this.cards[t].load(n==null?null:n[t],i)},makeData:function(){var t={},n,u,i,r;for(n in this.cards)if(u=this.options.sources==null?null:this.options.sources[n],i=this.cards[n].keys,i!=null){t[n]={};for(r in i)t[n][r]=null}else t[n]=null;return t}});scil.card.Card=scil.extend(scil._base,{constructor:function(n,t){var i,r;this.options=t;this.color=this.options.color==null?"#55f":this.options.color;i={border:"solid 2px "+this.color,background:"#eef",position:"absolute",borderRadius:"3px"};t.left>0&&(i.left=t.left+(n.options.left>0?n.options.left:0)+"px");t.top>0&&(i.top=t.top+(n.options.top>0?n.options.top:0)+"px");t.width>0&&(i.width=t.width+"px");t.height>0&&t.type!="structure"&&(i.height=t.height+"px");r=scil.Utils.createElement(n.parent,"div",null,i);t.title!=null&&(this.title=scil.Utils.createElement(r,"div",t.title,{whiteSpace:"nowrap",padding:"5px 0 5px 2px",overflow:"hidden",color:"#fff",background:this.color}),this.title.style.backgroundColor=r.style.border.color);this.client=scil.Utils.createElement(r,"div");this.render()},getKeys:function(){var n=this.options.keys,i,t;if(n=="all"||n=="*"){n={};for(t in data)n[t]=t}else{i={};for(t in n)i[t.toLowerCase()]=n[t];n=i}return n},render:function(){},load:function(){},getData:function(){return null},renderValue:function(n,t){var i,r;return this.options.viewonly!=!1?i=scil.Utils.createElement(n,"td",t,{background:"#fff"}):(i=scil.Utils.createElement(n,"td",null,{background:"#fff"}),r=scil.Utils.createElement(i,"input",null,{width:60},{value:t})),r}});scil.apply(scil.card.Card,{create:function(n,t){var i=scil.card.Factory[t.type];return i==null&&(i=scil.card.Card),new i(n,t)}});scil.card.Factory.structure=scil.extend(scil.card.Card,{render:function(){var n={width:this.options.width,height:this.options.height-25};this.options.viewonly==!1?n.popup=!0:n.viewonly=!0;this.jsd=new JSDraw2.Editor(this.client,n)},getData:function(){return this.jsd.getXml()},load:function(n){switch(this.options.format){case"helm":this.jsd.setHelm(n);break;case"molfile":this.jsd.setMolfile(n);break;default:this.jsd.setXml(n)}}});scil.card.Factory.row=scil.extend(scil.card.Card,{render:function(){this.fields={};this.client.style.padding="3px";this.tbody=scil.Utils.createTable(this.client,0,2,{borderCollapse:"collapse",width:"100%",textAlign:"center"},1)},getData:function(){var i={},t,n;for(t in this.fields)n=this.fields[t],n==null||scil.Utils.isNullOrEmpty(n.value)||(i[t]=n.value);return i},load:function(n){var i,u,r,t;if(n==null&&(n={}),n.length>0&&(n=n.length==1?n[0]:this.avgRows(n)),scil.Utils.removeAll(this.tbody),i=this.getKeys(),this.fields={},this.options.vertical)for(t in i)r=scil.Utils.createElement(this.tbody,"tr"),scil.Utils.createElement(r,"td",i[t]),this.fields[t]=this.renderValue(r,n[t]);else{u=scil.Utils.createElement(this.tbody,"tr");r=scil.Utils.createElement(this.tbody,"tr");for(t in i)scil.Utils.createElement(u,"td",i[t]),this.fields[t]=this.renderValue(r,n[t])}},avgRows:function(n){var f={},e=n[0],i,r,t,u;for(i in e){for(r=[],t=0;t<n.length;++t)u=n[t][i],scil.Utils.isNullOrEmpty(u)||r.push(u);f[i]=this.avgValues(r)}return f},avgValues:function(n){var t,i,r;if(n.length==0)return null;if(n.length==1)return n[0];for(t=[],i=0;i<n[i];++i)if(r=n[i],typeof r=="number")t.push(r);else if(isNaN(r)){t=null;break}else t.push(parseFloat(r));return t==null?scil.Utils.array2str(n,","):scil.Math.avg(t)}});scil.card.Factory.table=scil.extend(scil.card.Card,{render:function(){this.fields={};this.client.style.padding="3px";this.tbody=scil.Utils.createTable(this.client,0,2,{borderCollapse:"collapse",width:"100%",textAlign:"center"},1)},getData:function(){var i={},t,n;for(t in this.fields)n=this.fields[t],n==null||scil.Utils.isNullOrEmpty(n.value)||(i[t]=n.value);return i},load:function(n){var f=this.getKeys(),t,r,u,i;n==null&&(n=this.options.viewonly!=!1?[]:[{}]);scil.Utils.removeAll(this.tbody);t=scil.Utils.createElement(this.tbody,"tr");scil.Utils.createElement(t,"td");for(i in f)scil.Utils.createElement(t,"td",f[i]);for(this.fields={},r=0;r<n.length;++r){u=n[r];u==null&&(u=[]);t=scil.Utils.createElement(this.tbody,"tr");scil.Utils.createElement(t,"td",r+1);for(i in f)this.fields[i]=this.renderValue(t,u[i])}}});scil.card.Factory.pivot=scil.extend(scil.card.Card,{render:function(){this.client.style.padding="3px";this.tbody=scil.Utils.createTable(this.client,0,2,{borderCollapse:"collapse",width:"100%",textAlign:"center"},1)},getData:function(){var u={},f=this.options.conditions,i,t,r,e,n;for(i in this.fields)if(t=this.fields[i],t!=null&&!scil.Utils.isNullOrEmpty(t.value))for(r=i.split("/"),e=u[r[0]]={".":t.value},n=0;n<f.length;++n)e[f[n]]=r[n+1];return u},load:function(n,t){var o=this.getKeys(),r=this.pivot(n,o,t),f,e,i,s,u;for(scil.Utils.removeAll(this.tbody),i=scil.Utils.createElement(this.tbody,"tr"),scil.Utils.createElement(i,"td"),f=0;f<r.cols.length;++f)scil.Utils.createElement(i,"td",r.cols[f]);this.fields={};for(e in r.rows)for(i=scil.Utils.createElement(this.tbody,"tr"),scil.Utils.createElement(i,"td",o[e]),s=r.rows[e],u=0;u<s.length;++u)this.fields[o[e]+"/"+r.cols[u]]=this.renderValue(i,s[u])},pivot:function(n,t,i){var y={},h={},l={rows:{},cols:[]},e=this.options.conditions,f,o,p,a,r,v,w,u,c,s;if(n==null||n.length==0){if(i==null||i.__conditions==null)return l;for(f=[],r=0;r<e.length;++r)if(o=i.__conditions[e[r]],o!=null&&o.length!=0)if(y[e[r]]=!0,f.length==0)f=o;else{for(p=[],a=0;a<o.length;++a)for(s=0;s<f.length;++s)p.push(f[s]+"/"+o[a]);f=p}for(r=0;r<f.length;++r)h[f[r]]={}}else{for(r=0;r<e.length;++r)y[e[r]]=!0;for(r=0;r<n.length;++r){for(c=n[r],v="",u=0;u<e.length;++u)w=c[e[u]],v+=(v==""?"":"/")+(w==null?"":w);h[v]=c}}for(u in h)l.cols.push(u);for(u in t)if(!y[u]){c=l.rows[u]=[];for(s in h)c.push(h[s][u])}return l}})